<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπË®∫Êñ≠„ÉÑ„Éº„É´ - AI & „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÁâà</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7QD0MNVWG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-J7QD0MNVWG');
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f0ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e6e6ff;
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .control-group select, .control-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .control-group select:focus, .control-group input:focus {
            border-color: #667eea;
            outline: none;
        }

        .analysis-container {
            display: grid;
            grid-template-columns: 1fr 1.4fr;
            gap: 25px;
            margin-bottom: 20px;
        }

        .image-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .image-container {
            position: relative;
            text-align: center;
            margin-bottom: 20px;
        }

        .image-container img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .image-container canvas {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px;
            cursor: crosshair;
        }

        .ball-position-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border: 3px solid #FF4500;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            box-shadow: 0 3px 12px rgba(255, 69, 0, 0.4);
            cursor: pointer;
            animation: ballPulse 1.5s ease-in-out infinite;
        }

        @keyframes ballPulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .ball-position-marker::after {
            content: 'üèåÔ∏è‚Äç‚ôÇÔ∏è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .click-instruction {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 15;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .ball-position-instruction {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 215, 0, 0.85);
            color: #333;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 10;
            border: 2px solid #FFD700;
            max-width: 150px;
            line-height: 1.2;
        }

        .score-feedback-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .score-feedback-item {
            background: linear-gradient(135deg, #f6f9fc 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .score-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .advice-text {
            color: #666;
            line-height: 1.6;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .score-label {
            color: #666;
            font-size: 0.9em;
        }

        .score-excellent { border-left-color: #28a745; }
        .score-good { border-left-color: #17a2b8; }
        .score-average { border-left-color: #ffc107; }
        .score-poor { border-left-color: #dc3545; }

        .score-excellent .score-value { color: #28a745; }
        .score-good .score-value { color: #17a2b8; }
        .score-average .score-value { color: #ffc107; }
        .score-poor .score-value { color: #dc3545; }

        .radar-container {
            position: relative;
            height: 550px;
            margin: 20px 0;
            padding: 25px;
        }

        .feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .feedback h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .feedback-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .feedback-item h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .feedback-item p {
            color: #666;
            line-height: 1.5;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .social-btn {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .social-btn:active {
            transform: translateY(0);
        }

        /* „Çø„Éñ„É¨„ÉÉ„ÉàÁî® */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
            }
            
            .analysis-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
        }

        /* „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Áî® */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 1em;
            }

            /* „Éò„ÉÉ„ÉÄ„Éº„ÅÆÁõ£‰øÆËÄÖÊÉÖÂ†±„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            .header div[style*="display: flex"] {
                flex-direction: column !important;
                text-align: center !important;
                gap: 10px !important;
                padding: 12px !important;
            }

            .header div[style*="display: flex"] img {
                width: 60px !important;
                height: 60px !important;
            }

            .analysis-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .upload-section {
                padding: 15px;
            }

            .upload-area {
                padding: 30px 20px;
            }

            .upload-icon {
                font-size: 3em;
            }

            .upload-text {
                font-size: 16px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .control-group {
                flex-direction: column;
                gap: 8px;
                text-align: left;
            }

            .control-group label {
                font-size: 16px;
                font-weight: bold;
            }

            .control-group select,
            .control-group button {
                font-size: 16px;
                padding: 12px;
                min-height: 44px; /* „Çø„ÉÉ„ÉÅ„Çø„Éº„Ç≤„ÉÉ„Éà„Çµ„Ç§„Ç∫ */
            }

            .score-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .score-feedback-item {
                padding: 15px;
            }

            .score-title {
                font-size: 16px;
            }

            .score-value {
                font-size: 18px;
            }

            .advice-text {
                font-size: 14px;
                line-height: 1.5;
            }

            /* „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            .chart-container {
                padding: 15px;
            }

            /* „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            #socialShare div[style*="display: flex"] {
                flex-direction: column !important;
                gap: 12px !important;
            }

            .social-btn {
                justify-content: center !important;
                padding: 14px 20px !important;
                font-size: 16px !important;
            }

            /* „É¨„ÉÉ„Çπ„É≥Ê°àÂÜÖ„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            #lessonPromotion {
                padding: 20px 15px !important;
            }

            #lessonPromotion div[style*="display: flex"] {
                flex-direction: column !important;
                gap: 15px !important;
            }

            #lessonPromotion img {
                width: 70px !important;
                height: 70px !important;
            }

            #lessonPromotion h3 {
                font-size: 18px !important;
            }

            #lessonPromotion p {
                font-size: 14px !important;
            }

            /* „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÊåáÁ§∫„ÅÆ„É¢„Éê„Ç§„É´ÂØæÂøú */
            #ballPositionInstruction {
                font-size: 14px !important;
                padding: 8px 12px !important;
                top: 5px !important;
                right: 5px !important;
            }

            /* ÁîªÂÉè„Ç≥„É≥„ÉÜ„Éä„ÅÆ„É¢„Éê„Ç§„É´ÂØæÂøú */
            #imageContainer {
                margin: 15px 0;
            }

            #uploadedImage {
                max-height: 300px !important;
            }
        }

        /* Â∞è„Åï„Å™„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Áî® */
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .upload-area {
                padding: 25px 15px;
            }

            .upload-icon {
                font-size: 2.5em;
            }

            .upload-text {
                font-size: 14px;
            }

            .control-group select,
            .control-group button {
                font-size: 14px;
                padding: 10px;
            }

            .score-feedback-item {
                padding: 12px;
            }

            .score-title {
                font-size: 14px;
            }

            .score-value {
                font-size: 16px;
            }

            .advice-text {
                font-size: 13px;
            }

            #lessonPromotion {
                padding: 15px 10px !important;
            }

            #lessonPromotion h3 {
                font-size: 16px !important;
            }

            #lessonPromotion p {
                font-size: 13px !important;
            }

            #uploadedImage {
                max-height: 250px !important;
            }
        }

        /* „É©„É≥„Éâ„Çπ„Ç±„Éº„Éó„É¢„Éº„ÉâÂØæÂøú */
        @media (max-width: 768px) and (orientation: landscape) {
            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 0.9em;
            }

            #uploadedImage {
                max-height: 200px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèåÔ∏è „Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπË®∫Êñ≠„ÉÑ„Éº„É´</h1>
            <p>AIÊê≠Ëºâ - MediaPipe & „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÂàÜÊûêÁâà</p>
            <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 2px solid #ddd; display: flex; align-items: center; gap: 15px;">
                <a href="https://noyamagolf.com/" target="_blank" style="display: block; flex-shrink: 0;">
                    <img src="noyama-keiji.png" alt="ÈáéÂ±±‰Ω≥Ê≤ª" style="width: 70px; height: 70px; border-radius: 50%; border: 3px solid #007bff; object-fit: cover; cursor: pointer; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                </a>
                <div style="flex: 1; color: #333;">
                    <h3 style="margin: 0 0 5px 0; font-size: 16px; font-weight: bold; color: #007bff;">
                        „ÉÜ„Ç£„Éº„ÉÅ„É≥„Ç∞„Éó„É≠ÈáéÂ±±‰Ω≥Ê≤ªÁõ£‰øÆ
                    </h3>
                    <p style="margin: 0; font-size: 14px; color: #666;">
                        <a href="https://noyamagolf.com/" target="_blank" style="color: #007bff; text-decoration: none; font-weight: 500;">
                            üåê https://noyamagolf.com/
                        </a>
                    </p>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                <div class="upload-icon">üì∏</div>
                <div class="upload-text">„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</div>
                <p>JPG, PNG, GIFÂΩ¢Âºè„Å´ÂØæÂøú</p>
            </div>
            <input type="file" id="imageInput" class="file-input" accept="image/*">
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="viewSelect">ÊíÆÂΩ±Ë¶ñÁÇπ:</label>
                <select id="viewSelect">
                    <option value="front">Ê≠£Èù¢</option>
                    <option value="back">ÂæåÊñπ</option>
                </select>
            </div>
            <div class="control-group">
                <label for="clubSelect">„ÇØ„É©„ÉñÈÅ∏Êäû:</label>
                <select id="clubSelect">
                    <option value="Driver">„Éâ„É©„Ç§„Éê„Éº</option>
                    <option value="FairwayWood">„Éï„Çß„Ç¢„Ç¶„Çß„Ç§„Ç¶„ÉÉ„Éâ</option>
                    <option value="Utility">„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£„Éº</option>
                    <option value="3Iron">3Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="4Iron">4Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="5Iron">5Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="6Iron">6Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="7Iron" selected>7Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="8Iron">8Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="9Iron">9Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="Wedge">„Ç¶„Ç®„ÉÉ„Ç∏</option>
                </select>
            </div>
            <div class="control-group">
                <button id="startDiagnosis" class="btn">üîç Ë®∫Êñ≠ÈñãÂßã</button>
            </div>
        </div>

        <div id="analysisResults" class="hidden">
            <div class="analysis-container">
                <div class="image-section">
                    <h3>üìä ÂßøÂã¢ÂàÜÊûêÁµêÊûú</h3>
                    <div class="image-container" id="imageContainer">
                        <img id="uploadedImage" alt="„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÁîªÂÉè">
                        <canvas id="poseCanvas"></canvas>
                        <div class="click-instruction" id="clickInstruction">‚ö†Ô∏è Ê≠£Èù¢ÊíÆÂΩ±ÊôÇÔºö‰∏äÊâã„ÅèÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Å®„Åç„Å´„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                        <div class="ball-position-instruction" id="ballPositionInstruction">
                            üèåÔ∏è‚Äç‚ôÇÔ∏è „Ç¥„É´„Éï„Éú„Éº„É´‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ<br>
                            <small>Ê≠£Èù¢ÊíÆÂΩ±„Åß„ÅØÂøÖÈ†à„Åß„Åô</small>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>üìà „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà</h3>
                    <div class="radar-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="score-feedback-grid" id="scoreFeedbackGrid">
                <!-- „Çπ„Ç≥„Ç¢„Å®„Ç¢„Éâ„Éê„Ç§„Çπ„ÇíÁµ±ÂêàË°®Á§∫ -->
            </div>
            
            <!-- „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Éú„Çø„É≥ -->
            <div id="socialShare" class="hidden" style="margin-top: 20px; padding: 20px; background: white; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 15px; color: #333; font-size: 18px;">üì± Ë®∫Êñ≠ÁµêÊûú„Çí„Ç∑„Çß„Ç¢„Åó„Çà„ÅÜÔºÅ</h3>
                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <button onclick="shareToTwitter()" class="social-btn twitter-btn" style="background: #1DA1F2; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                        </svg>
                        Twitter
                    </button>
                    
                    <button onclick="shareToFacebook()" class="social-btn facebook-btn" style="background: #4267B2; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        Facebook
                    </button>
                    
                    <button onclick="shareToLine()" class="social-btn line-btn" style="background: #00B900; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.629 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.070 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                        </svg>
                        LINE
                    </button>
                    
                    <button onclick="copyToClipboard()" class="social-btn copy-btn" style="background: #6c757d; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        URL„Ç≥„Éî„Éº
                    </button>
                </div>
            </div>

            <!-- Ë®∫Êñ≠ÁµêÊûúÂæå„ÅÆ„É¨„ÉÉ„Çπ„É≥Ê°àÂÜÖ -->
            <div id="lessonPromotion" class="hidden" style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);">
                <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <a href="https://noyamagolf.com/" target="_blank" style="display: block;">
                        <img src="noyama-keiji.png" alt="ÈáéÂ±±‰Ω≥Ê≤ª" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid white; object-fit: cover; cursor: pointer; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    </a>
                    <div style="color: white; text-align: left; flex: 1; min-width: 250px;">
                        <h3 style="margin: 0 0 8px 0; font-size: 20px; font-weight: bold;">
                            üèåÔ∏è Ë®∫Êñ≠ÁµêÊûú„Çí„ÇÇ„Å®„Å´„ÄÅ„Åï„Çâ„Å™„Çã‰∏äÈÅî„ÇíÁõÆÊåá„Åó„Åæ„Åõ„Çì„ÅãÔºü
                        </h3>
                        <p style="margin: 0 0 12px 0; font-size: 16px; line-height: 1.4;">
                            „Éó„É≠„ÅåÊïô„Åà„ÇãÂÆüË∑µÁöÑ„Å™„É¨„ÉÉ„Çπ„É≥„Åß„ÄÅÁêÜÊÉ≥„ÅÆ„Çπ„Ç§„É≥„Ç∞„ÇíË∫´„Å´„Å§„Åë„Åæ„Åó„Çá„ÅÜ
                        </p>
                        <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: flex-start; margin-bottom: 12px;">
                            <a href="https://noyamagolf.com/%e3%83%a9%e3%82%a6%e3%83%b3%e3%83%89%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" style="text-decoration: none;">
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px; color: white; border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                                    üèåÔ∏è „É©„Ç¶„É≥„Éâ„É¨„ÉÉ„Çπ„É≥
                                </div>
                            </a>
                            <a href="https://noyamagolf.com/%e3%82%aa%e3%83%b3%e3%83%a9%e3%82%a4%e3%83%b3%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" style="text-decoration: none;">
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px; color: white; border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                                    üíª „Ç™„É≥„É©„Ç§„É≥„É¨„ÉÉ„Çπ„É≥
                                </div>
                            </a>
                            <a href="https://noyamagolf.com/%e3%82%b9%e3%82%bf%e3%82%b8%e3%82%aa%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" style="text-decoration: none;">
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px; color: white; border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                                    üë®‚Äçüè´ „Éû„É≥„ÉÑ„Éº„Éû„É≥„É¨„ÉÉ„Çπ„É≥
                                </div>
                            </a>
                        </div>
                        <p style="margin: 0; font-size: 16px;">
                            <a href="https://noyamagolf.com/" target="_blank" style="color: #FFD700; text-decoration: underline; font-weight: bold; font-size: 18px;">ÈáéÂ±±‰Ω≥Ê≤ª„ÅÆ„Ç¥„É´„Éï„É¨„ÉÉ„Çπ„É≥</a> „ÅßË©≥Á¥∞„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ
                        </p>
                    </div>
                    <div style="color: white; font-size: 40px;">‚õ≥</div>
                </div>
            </div>
        </div>

        <div id="loadingSection" class="loading hidden">
            <div class="loading-spinner"></div>
            <p>AIÂàÜÊûê‰∏≠...</p>
        </div>
    </div>

    <script>
        let pose;
        let camera;
        let poseResults;
        let uploadedImageElement;
        let radarChartInstance;
        let userClickedBallPosition = null;
        let isBallPositionClickEnabled = false;
        let isDiagnosisStarted = false; // Ë®∫Êñ≠ÈñãÂßã„Éï„É©„Ç∞

        // MediaPipe PoseÂàùÊúüÂåñ
        function initMediaPipe() {
            pose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                }
            });

            pose.setOptions({
                modelComplexity: 0, // ËªΩÈáè„É¢„Éº„Éâ„ÅßÈ´òÈÄüÂåñ
                smoothLandmarks: false, // „Çπ„É†„Éº„Ç∏„É≥„Ç∞ÁÑ°Âäπ„ÅßÈ´òÈÄüÂåñ
                enableSegmentation: false,
                smoothSegmentation: false, // „Çπ„É†„Éº„Ç∏„É≥„Ç∞ÁÑ°Âäπ„ÅßÈ´òÈÄüÂåñ
                minDetectionConfidence: 0.4, // Ê§úÂá∫ÈñæÂÄ§„Çí‰∏ã„Åí„Å¶È´òÈÄüÂåñ
                minTrackingConfidence: 0.4 // „Éà„É©„ÉÉ„Ç≠„É≥„Ç∞ÈñæÂÄ§„Çí‰∏ã„Åí„Å¶È´òÈÄüÂåñ
            });

            pose.onResults(onPoseResults);
        }

        // PoseÁµêÊûúÂá¶ÁêÜ
        function onPoseResults(results) {
            console.log('MediaPipeÁµêÊûúÂèó‰ø°:', results);
            poseResults = results;
            
            // ÂøÖ„ÅöÊèèÁîª„ÇíÂÆüË°å
            if (uploadedImageElement) {
                console.log('ÊèèÁîª„ÇíÂÆüË°å„Åó„Åæ„Åô');
                drawPoseOverlay();
            }
            
            // ÂàÜÊûê„ÅØË®∫Êñ≠„Éú„Çø„É≥„ÅåÊäº„Åï„Çå„ÅüÊôÇ„ÅÆ„ÅøÂÆüË°å
            // analyzePosture();
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ
        const uploadArea = document.querySelector('.upload-area');
        const fileInput = document.getElementById('imageInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
            }
        });

        // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜ
        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // Google Analytics „Ç§„Éô„É≥„ÉàÈÄÅ‰ø°
            if (typeof gtag !== 'undefined') {
                gtag('event', 'image_upload', {
                    'event_category': 'engagement',
                    'event_label': 'Golf Photo Upload'
                });
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('uploadedImage');
                img.src = e.target.result;
                img.onload = function() {
                    uploadedImageElement = img;
                    userClickedBallPosition = null; // „Éú„Éº„É´‰ΩçÁΩÆ„Çí„É™„Çª„ÉÉ„Éà
                    isDiagnosisStarted = false; // Ë®∫Êñ≠„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                    
                    // „Ç≠„É£„É≥„Éê„Çπ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÁîªÂÉè„Å´Âêà„Çè„Åõ„Å¶Ë®≠ÂÆö
                    const canvas = document.getElementById('poseCanvas');
                    
                    // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÁîªÂÉè„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
                    setTimeout(() => {
                        const imgRect = img.getBoundingClientRect();
                        const containerRect = img.parentElement.getBoundingClientRect();
                        
                        // ÁîªÂÉè„ÅÆÂÆüÈöõ„ÅÆË°®Á§∫„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
                        const displayWidth = img.clientWidth;
                        const displayHeight = img.clientHeight;
                        
                        // „Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„ÇíÊ≠£Á¢∫„Å´Ë®≠ÂÆö
                        canvas.width = displayWidth;
                        canvas.height = displayHeight;
                        canvas.style.width = displayWidth + 'px';
                        canvas.style.height = displayHeight + 'px';
                        
                        // „Ç≠„É£„É≥„Éê„Çπ„ÇíÁîªÂÉè„Å®ÂÆåÂÖ®„Å´Èáç„Å≠„Çã
                        canvas.style.position = 'absolute';
                        canvas.style.top = img.offsetTop + 'px';
                        canvas.style.left = img.offsetLeft + 'px';
                        canvas.style.transform = 'none';
                        canvas.style.display = 'block';
                        canvas.style.pointerEvents = 'auto';
                        
                        console.log('„Ç≠„É£„É≥„Éê„ÇπÊúÄÁµÇË®≠ÂÆö:', canvas.width, 'x', canvas.height);
                        console.log('ÁîªÂÉè‰ΩçÁΩÆ:', img.offsetTop, img.offsetLeft);
                    }, 150);
                    
                    console.log('ÁîªÂÉè„É≠„Éº„ÉâÂÆå‰∫Ü:', img.width, 'x', img.height);
                    console.log('„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫:', canvas.width, 'x', canvas.height);
                    
                    // ÂàÜÊûêÁµêÊûú„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                    document.getElementById('analysisResults').classList.remove('hidden');
                    
                    // ÁîªÂÉè„ÇíÁ¢∫ÂÆü„Å´Ë°®Á§∫
                    img.style.display = 'block';
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '400px';
                    img.style.borderRadius = '10px';
                    
                    setupBallPositionClick();
                    updateDiagnosisButtonState(); // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                    
                    // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂæå„Å´Ëá™Âãï„ÅßMediaPipeÂá¶ÁêÜ„ÇíÂÆüË°åÔºà„Éù„Éº„Ç∫Ê§úÂá∫„ÅÆ„ÅøÔºâ
                    setTimeout(() => {
                        if (pose && uploadedImageElement) {
                            console.log('Ëá™ÂãïMediaPipeÂá¶ÁêÜÈñãÂßã');
                            pose.send({image: uploadedImageElement});
                        }
                    }, 800); // „Ç≠„É£„É≥„Éê„ÇπË®≠ÂÆöÂæå„Å´ÂÆüË°å
                };
            };
            reader.readAsDataURL(file);
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÅÆË®≠ÂÆöÔºàÂº∑ÂåñÁâàÔºâ
        function setupBallPositionClick() {
            const viewType = document.getElementById('viewSelect').value;
            const canvas = document.getElementById('poseCanvas');
            const container = document.getElementById('imageContainer');
            const instruction = document.getElementById('clickInstruction');
            const ballInstruction = document.getElementById('ballPositionInstruction');
            
            if (viewType === 'front') {
                isBallPositionClickEnabled = true;
                canvas.style.pointerEvents = 'auto';
                canvas.style.cursor = 'crosshair';
                
                // ÊåáÁ§∫„ÇíË°®Á§∫ÔºàÁ∞°ÊΩî„Å´Ôºâ
                instruction.style.display = 'block';
                ballInstruction.style.display = 'block';
                ballInstruction.innerHTML = 'üèåÔ∏è‚Äç‚ôÇÔ∏è „Ç¥„É´„Éï„Éú„Éº„É´<br>„ÇØ„É™„ÉÉ„ÇØ';
                ballInstruction.style.backgroundColor = 'rgba(255, 215, 0, 0.85)';
                ballInstruction.style.borderColor = '#FFD700';
                
                // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
                canvas.removeEventListener('click', handleBallPositionClick); // ÈáçË§áÈò≤Ê≠¢
                canvas.addEventListener('click', handleBallPositionClick);
                
                // „Éû„Ç¶„Çπ„Éõ„Éê„ÉºÂäπÊûú
                canvas.addEventListener('mouseenter', () => {
                    ballInstruction.style.backgroundColor = 'rgba(255, 215, 0, 1)';
                    ballInstruction.style.transform = 'translateX(-50%) scale(1.05)';
                });
                
                canvas.addEventListener('mouseleave', () => {
                    ballInstruction.style.backgroundColor = 'rgba(255, 215, 0, 0.9)';
                    ballInstruction.style.transform = 'translateX(-50%) scale(1)';
                });
                
                // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                updateDiagnosisButtonState();
                
                // 7ÁßíÂæå„Å´‰∏äÈÉ®ÊåáÁ§∫„ÇíÈùûË°®Á§∫
                setTimeout(() => {
                    instruction.style.display = 'none';
                }, 7000);
            } else {
                isBallPositionClickEnabled = false;
                canvas.style.pointerEvents = 'none';
                canvas.style.cursor = 'default';
                instruction.style.display = 'none';
                ballInstruction.style.display = 'none';
                canvas.removeEventListener('click', handleBallPositionClick);
                
                // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                updateDiagnosisButtonState();
            }
        }

        // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateDiagnosisButtonState() {
            const diagnosisBtn = document.getElementById('startDiagnosis');
            const viewType = document.getElementById('viewSelect').value;
            
            if (viewType === 'front') {
                if (userClickedBallPosition) {
                    // „Éú„Éº„É´‰ΩçÁΩÆ„ÅåË®≠ÂÆöÊ∏à„Åø - „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
                    diagnosisBtn.disabled = false;
                    diagnosisBtn.textContent = 'üîç Ë®∫Êñ≠ÈñãÂßã';
                    diagnosisBtn.style.opacity = '1';
                    diagnosisBtn.style.cursor = 'pointer';
                } else {
                    // „Éú„Éº„É´‰ΩçÁΩÆ„ÅåÊú™Ë®≠ÂÆö - „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
                    diagnosisBtn.disabled = true;
                    diagnosisBtn.textContent = 'üèåÔ∏è‚Äç‚ôÇÔ∏è „Ç¥„É´„Éï„Éú„Éº„É´‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    diagnosisBtn.style.opacity = '0.6';
                    diagnosisBtn.style.cursor = 'not-allowed';
                }
            } else {
                // ÂæåÊñπË¶ñÁÇπ„Åß„ÅØÈÄöÂ∏∏ÈÄö„ÇäÊúâÂäπ
                diagnosisBtn.disabled = false;
                diagnosisBtn.textContent = 'üîç Ë®∫Êñ≠ÈñãÂßã';
                diagnosisBtn.style.opacity = '1';
                diagnosisBtn.style.cursor = 'pointer';
            }
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜÔºàÂº∑ÂåñÁâàÔºâ
        function handleBallPositionClick(event) {
            if (!isBallPositionClickEnabled) return;
            
            const canvas = document.getElementById('poseCanvas');
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Ë°®Á§∫„Çµ„Ç§„Ç∫„ÇíÂèñÂæóÔºàCSS„Çµ„Ç§„Ç∫Ôºâ
            const displayWidth = rect.width;
            const displayHeight = rect.height;
            
            // „Ç≠„É£„É≥„Éê„ÇπÂ∫ßÊ®ô„ÇíÊ≠£Ë¶èÂåñÔºà0-1„ÅÆÁØÑÂõ≤Ôºâ
            const normalizedX = x / displayWidth;
            const normalizedY = y / displayHeight;
            
            userClickedBallPosition = { x: normalizedX, y: normalizedY };
            
            // „Éú„Éº„É´‰ΩçÁΩÆ„Éû„Éº„Ç´„Éº„ÇíË°®Á§∫
            showBallPositionMarker(x, y);
            
            // ÊåáÁ§∫„ÇíÊõ¥Êñ∞
            const ballInstruction = document.getElementById('ballPositionInstruction');
            ballInstruction.innerHTML = '‚úÖ „Éú„Éº„É´‰ΩçÁΩÆ„ÅåË®≠ÂÆö„Åï„Çå„Åæ„Åó„ÅüÔºÅ<br><small>Ë®∫Êñ≠ÈñãÂßã„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ</small>';
            ballInstruction.style.backgroundColor = 'rgba(40, 167, 69, 0.9)';
            ballInstruction.style.borderColor = '#28a745';
            
            // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateDiagnosisButtonState();
            
            // Ë®∫Êñ≠ÈñãÂßã„Åæ„ÅßË°®Á§∫„ÅóÁ∂ö„Åë„ÇãÔºà„Çø„Ç§„Éû„ÉºÂâäÈô§Ôºâ
            // setTimeout(() => {
            //     ballInstruction.style.display = 'none';
            // }, 5000);
            
            console.log('„Éú„Éº„É´‰ΩçÁΩÆ„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü:', userClickedBallPosition);
            console.log('„ÇØ„É™„ÉÉ„ÇØÂ∫ßÊ®ô:', x, y, '„Ç≠„É£„É≥„Éê„ÇπË°®Á§∫„Çµ„Ç§„Ç∫:', displayWidth, displayHeight);
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„Éû„Éº„Ç´„ÉºË°®Á§∫
        function showBallPositionMarker(x, y) {
            const container = document.getElementById('imageContainer');
            
            // Êó¢Â≠ò„ÅÆ„Éû„Éº„Ç´„Éº„ÇíÂâäÈô§
            const existingMarker = container.querySelector('.ball-position-marker');
            if (existingMarker) {
                existingMarker.remove();
            }
            
            // Êñ∞„Åó„ÅÑ„Éû„Éº„Ç´„Éº„Çí‰ΩúÊàê
            const marker = document.createElement('div');
            marker.className = 'ball-position-marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            
            container.appendChild(marker);
        }

        // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
        function showLoading() {
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('analysisResults').classList.add('hidden');
        }

        // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÈùûË°®Á§∫
        function hideLoading() {
            document.getElementById('loadingSection').classList.add('hidden');
            document.getElementById('analysisResults').classList.remove('hidden');
            // Ë®∫Êñ≠ÁµêÊûúÂæå„ÅÆ„É¨„ÉÉ„Çπ„É≥Ê°àÂÜÖ„ÇíË°®Á§∫
            document.getElementById('lessonPromotion').classList.remove('hidden');
            
            // „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Éú„Çø„É≥„ÇíË°®Á§∫
            document.getElementById('socialShare').classList.remove('hidden');
        }

        // ÁîªÂÉèÂá¶ÁêÜ
        async function processImage() {
            if (!uploadedImageElement) return;

            console.log('MediaPipeÂá¶ÁêÜÈñãÂßã...');
            
            // „Ç≠„É£„É≥„Éê„Çπ„ÇíÊ∫ñÂÇô
            const canvas = document.getElementById('poseCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = uploadedImageElement.clientWidth || uploadedImageElement.width;
            canvas.height = uploadedImageElement.clientHeight || uploadedImageElement.height;
            
            // MediaPipe„Åß„Éù„Éº„Ç∫Ê§úÂá∫
            try {
                await pose.send({image: uploadedImageElement});
                console.log('MediaPipeÈÄÅ‰ø°ÂÆå‰∫Ü');
                
                // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÊèèÁîª„ÇíÁ¢∫Ë™ç
                setTimeout(() => {
                    if (poseResults && poseResults.poseLandmarks) {
                        console.log('„Éù„Éº„Ç∫„Éá„Éº„Çø„ÅÇ„Çä„ÄÅÂº∑Âà∂ÊèèÁîªÂÆüË°å');
                        drawPoseOverlay();
                        // Ë®∫Êñ≠„Éú„Çø„É≥„ÅåÊäº„Åï„Çå„ÅüÊôÇ„ÅÆ„ÅøÂàÜÊûêÂÆüË°å
                        analyzePosture();
                    } else {
                        console.log('„Éù„Éº„Ç∫„Éá„Éº„Çø„Å™„Åó„ÄÅÁ©∫„Ç≠„É£„É≥„Éê„ÇπÊèèÁîª');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';
                        ctx.fillRect(10, 10, 300, 40);
                        ctx.fillStyle = '#000';
                        ctx.font = '16px Arial';
                        ctx.fillText('MediaPipe: „Éù„Éº„Ç∫Ê§úÂá∫Âá¶ÁêÜ‰∏≠...', 15, 35);
                    }
                }, 500);
            } catch (error) {
                console.error('MediaPipeÂá¶ÁêÜ„Ç®„É©„Éº:', error);
            }
        }

        // „Éù„Éº„Ç∫„Ç™„Éº„Éê„Éº„É¨„Ç§ÊèèÁîªÔºàÂº∑Âà∂Ë°®Á§∫Ôºâ
        function drawPoseOverlay() {
            const canvas = document.getElementById('poseCanvas');
            const ctx = canvas.getContext('2d');
            const img = uploadedImageElement;

            if (!canvas || !ctx || !img) {
                console.log('ÊèèÁîªË¶ÅÁ¥†„Åå‰∏çË∂≥:', {canvas: !!canvas, ctx: !!ctx, img: !!img});
                return;
            }

            // Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÁîªÂÉè„ÅÆÂÆüÈöõ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
            const displayedWidth = img.clientWidth || img.offsetWidth;
            const displayedHeight = img.clientHeight || img.offsetHeight;
            
            // ÂÖÉÁîªÂÉè„ÅÆÂÆüÈöõ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
            const originalWidth = img.naturalWidth || img.width;
            const originalHeight = img.naturalHeight || img.height;
            
            // „Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„ÇíË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÁîªÂÉè„Çµ„Ç§„Ç∫„Å´Âêà„Çè„Åõ„Çã
            canvas.width = displayedWidth;
            canvas.height = displayedHeight;
            canvas.style.width = displayedWidth + 'px';
            canvas.style.height = displayedHeight + 'px';

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            console.log('ÊèèÁîªÈñãÂßã - Ë°®Á§∫„Çµ„Ç§„Ç∫:', displayedWidth, 'x', displayedHeight);
            console.log('ÂÖÉÁîªÂÉè„Çµ„Ç§„Ç∫:', originalWidth, 'x', originalHeight);

            if (poseResults && poseResults.poseLandmarks && poseResults.poseLandmarks.length > 0) {
                console.log('MediaPipe landmarks detected:', poseResults.poseLandmarks.length);
                
                // „Çπ„Ç±„Éº„É´ÊØîÁéá„ÇíË®àÁÆóÔºàMediaPipe„ÅÆÂ∫ßÊ®ô„ÅØ0-1„ÅÆÁØÑÂõ≤Ôºâ
                const scaleX = displayedWidth;
                const scaleY = displayedHeight;
                
                // Êé•Á∂öÁ∑ö„ÇíÂÖà„Å´ÊèèÁîªÔºàËÉåÊôØÔºâ
                drawConnections(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                
                // „É©„É≥„Éâ„Éû„Éº„ÇØ„Çí‰∏ä„Å´ÊèèÁîªÔºàÂâçÊôØÔºâ
                drawLandmarks(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                
                // „Éú„Éº„É´‰ΩçÁΩÆ„Å®ÁêÜÊÉ≥‰ΩçÁΩÆ„ÇíÊèèÁîªÔºàÊ≠£Èù¢„Åã„Çâ„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÊ§úÂá∫„ÇíË©¶Ë°åÔºâ
                const viewType = document.getElementById('viewSelect').value;
                if (viewType === 'front') {
                    tryAutomaticBallDetection(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                } else {
                    drawBallPosition(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                }
            } else {
                console.log('No pose landmarks detected or empty result');
                // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊ§úÂá∫„Åï„Çå„Å™„ÅÑÂ†¥Âêà„Åß„ÇÇ‰Ωï„Åã„ÇíÊèèÁîª
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                ctx.fillRect(10, 10, 200, 30);
                ctx.fillStyle = '#000';
                ctx.font = '14px Arial';
                ctx.fillText('MediaPipe: „Éù„Éº„Ç∫Ê§úÂá∫‰∏≠...', 15, 30);
            }
        }

        // Ëá™Âãï„Éú„Éº„É´‰ΩçÁΩÆÊ§úÂá∫„ÇíË©¶Ë°å
        function tryAutomaticBallDetection(ctx, landmarks, width, height) {
            const clubType = document.getElementById('clubSelect').value;
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            
            if (!leftAnkle || !rightAnkle || !leftWrist || !rightWrist) {
                // ÂøÖË¶Å„Å™„É©„É≥„Éâ„Éû„Éº„ÇØ„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÊâãÂãïÈÅ∏Êäû„Å´Âàá„ÇäÊõø„Åà
                showBallPositionClickInstruction();
                return;
            }
            
            // Êâã„ÅÆ‰ΩçÁΩÆ„Åã„ÇâËá™Âãï„Åß„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊé®ÂÆö
            const handCenter = (leftWrist.x + rightWrist.x) / 2;
            const footY = Math.max(leftAnkle.y, rightAnkle.y);
            
            // Êé®ÂÆö‰ø°È†ºÂ∫¶„ÇíË®àÁÆóÔºàÊâãÈ¶ñ„ÅÆÊ§úÂá∫‰ø°È†ºÂ∫¶„Åå‰Ωé„ÅÑÂ†¥Âêà„ÅØÊâãÂãïÈÅ∏ÊäûÔºâ
            const confidence = Math.min(leftWrist.visibility, rightWrist.visibility);
            
            if (confidence < 0.7) {
                // ‰ø°È†ºÂ∫¶„Åå‰Ωé„ÅÑÂ†¥Âêà„ÅØÊâãÂãïÈÅ∏Êäû„Å´Âàá„ÇäÊõø„Åà
                showBallPositionClickInstruction();
                return;
            }
            
            // Ëá™ÂãïÊ§úÂá∫ÊàêÂäü - „Éú„Éº„É´‰ΩçÁΩÆ„ÇíË®≠ÂÆö
            userClickedBallPosition = { x: handCenter, y: footY + 0.03 };
            
            // Ëá™ÂãïÊ§úÂá∫„Åï„Çå„Åü„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊèèÁîª
            drawAutomaticBallPosition(ctx, handCenter, footY, width, height);
            
            // ÁêÜÊÉ≥‰ΩçÁΩÆ„ÇÇÊèèÁîªÔºàË®∫Êñ≠ÈñãÂßãÂæå„ÅÆ„ÅøÔºâ
            if (isDiagnosisStarted) {
                drawIdealBallPosition(ctx, landmarks, width, height, clubType);
            }
            
            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
            showAutoDetectionSuccess();
        }
        
        // Ëá™ÂãïÊ§úÂá∫„Åï„Çå„Åü„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊèèÁîª
        function drawAutomaticBallPosition(ctx, x, footY, width, height) {
            // Ëá™ÂãïÊ§úÂá∫„Åï„Çå„Åü„Éú„Éº„É´‰ΩçÁΩÆÔºàÈùí„ÅÑÂÜÜÔºâ
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 0.8;
            ctx.beginPath();
            ctx.arc(x * width, (footY + 0.03) * height, 10, 0, 2 * Math.PI);
            ctx.fill();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 1.0;
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Ëá™ÂãïÊ§úÂá∫', x * width, (footY + 0.03) * height - 15);
            
            // Ë¶ñË¶öÁöÑ„Éû„Éº„Ç´„Éº„ÇÇË°®Á§∫
            const ballMarkerX = x * width;
            const ballMarkerY = (footY + 0.03) * height;
            showBallPositionMarker(ballMarkerX, ballMarkerY);
        }
        
        // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊèèÁîª
        function drawIdealBallPosition(ctx, landmarks, width, height, clubType) {
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const leftHeel = landmarks[29];
            const rightHeel = landmarks[30];
            
            if (!leftAnkle || !rightAnkle) return;
            
            // Ë∂≥„ÅÆ‰ΩçÁΩÆË®àÁÆó
            const leftFootCenter = leftHeel ? leftHeel.x : leftAnkle.x;
            const rightFootCenter = rightHeel ? rightHeel.x : rightAnkle.x;
            const stanceCenter = (leftFootCenter + rightFootCenter) / 2;
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ
            const idealPositions = {
                'Driver': leftFootCenter,                // Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ
                'FairwayWood': leftFootCenter + 0.02,   // Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Utility': stanceCenter - 0.02,        // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '3Iron': stanceCenter - 0.015,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '4Iron': stanceCenter - 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '5Iron': stanceCenter - 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '6Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '7Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '8Iron': stanceCenter + 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                '9Iron': stanceCenter + 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Wedge': stanceCenter + 0.03           // ‰∏≠Â§Æ„Çà„ÇäÂè≥
            };
            
            const idealPosition = idealPositions[clubType] || stanceCenter;
            const footY = Math.max(leftAnkle.y, rightAnkle.y);
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÁ∑ë„ÅÆÂÜÜ„ÅßÊèèÁîª
            ctx.fillStyle = '#00FF00';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.arc(idealPosition * width, footY * height + 20, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#00FF00';
            ctx.globalAlpha = 1.0;
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ÁêÜÊÉ≥‰ΩçÁΩÆ', idealPosition * width, footY * height + 5);
        }
        
        // Ëá™ÂãïÊ§úÂá∫ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
        function showAutoDetectionSuccess() {
            const ballInstruction = document.getElementById('ballPositionInstruction');
            if (ballInstruction) {
                ballInstruction.innerHTML = '‚úÖ „Éú„Éº„É´‰ΩçÁΩÆ„ÇíËá™ÂãïÊ§úÂá∫„Åó„Åæ„Åó„ÅüÔºÅ<br><small>Ê≠£„Åó„ÅèÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÊôÇ„ÅØ„Éú„Éº„É´„ÅÆ‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</small>';
                ballInstruction.style.backgroundColor = 'rgba(40, 167, 69, 0.9)';
                ballInstruction.style.display = 'block';
                
                // Ë®∫Êñ≠ÈñãÂßã„Åæ„ÅßË°®Á§∫„ÅóÁ∂ö„Åë„ÇãÔºà„Çø„Ç§„Éû„ÉºÂâäÈô§Ôºâ
                // setTimeout(() => {
                //     ballInstruction.style.display = 'none';
                // }, 5000);
            }
            
            // Ë®∫Êñ≠„Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
            updateDiagnosisButtonState();
            
            // ÊâãÂãïË™øÊï¥„ÅÆ„Åü„ÇÅ„ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÇÇÊúâÂäπ„Å´„Åó„Å¶„Åä„Åè
            isBallPositionClickEnabled = true;
            const canvas = document.getElementById('poseCanvas');
            canvas.style.cursor = 'crosshair';
            canvas.removeEventListener('click', handleBallPositionClick);
            canvas.addEventListener('click', handleBallPositionClick);
        }
        
        // „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÊåáÁ§∫„ÇíË°®Á§∫
        function showBallPositionClickInstruction() {
            const ballInstruction = document.getElementById('ballPositionInstruction');
            if (ballInstruction) {
                ballInstruction.innerHTML = 'üèåÔ∏è‚Äç‚ôÇÔ∏è Ëá™ÂãïÊ§úÂá∫Â§±Êïó<br>„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                ballInstruction.style.backgroundColor = 'rgba(255, 140, 0, 0.9)';
                ballInstruction.style.display = 'block';
            }
            
            // ÊâãÂãï„ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÇíÊúâÂäπÂåñ
            isBallPositionClickEnabled = true;
            const canvas = document.getElementById('poseCanvas');
            canvas.style.cursor = 'crosshair';
            canvas.removeEventListener('click', handleBallPositionClick);
            canvas.addEventListener('click', handleBallPositionClick);
        }

        // „Éú„Éº„É´‰ΩçÁΩÆÊèèÁîªÔºàÂæåÊñπË¶ñÁÇπÁî®Ôºâ
        function drawBallPosition(ctx, landmarks, width, height) {
            const clubType = document.getElementById('clubSelect').value;
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const leftHeel = landmarks[29];
            const rightHeel = landmarks[30];
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            
            if (!leftAnkle || !rightAnkle) return;
            
            // Ë∂≥„ÅÆ‰ΩçÁΩÆË®àÁÆó
            const leftFootCenter = leftHeel ? leftHeel.x : leftAnkle.x;
            const rightFootCenter = rightHeel ? rightHeel.x : rightAnkle.x;
            const stanceCenter = (leftFootCenter + rightFootCenter) / 2;
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ
            const idealPositions = {
                'Driver': leftFootCenter,                // Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ
                'FairwayWood': leftFootCenter + 0.01,
                'Utility': stanceCenter - 0.02,
                '3Iron': stanceCenter - 0.015,
                '4Iron': stanceCenter - 0.01,
                '5Iron': stanceCenter - 0.005,
                '6Iron': stanceCenter,
                '7Iron': stanceCenter,
                '8Iron': stanceCenter + 0.005,
                '9Iron': stanceCenter + 0.01,
                'Wedge': stanceCenter + 0.03
            };
            
            const idealPosition = idealPositions[clubType] || stanceCenter;
            
            // Êé®ÂÆö„Éú„Éº„É´‰ΩçÁΩÆ
            let estimatedBallPosition = stanceCenter;
            if (leftWrist && rightWrist) {
                const handCenter = (leftWrist.x + rightWrist.x) / 2;
                estimatedBallPosition = handCenter;
            }
            
            // Ë∂≥ÂÖÉ„ÅÆÈ´ò„Åï„ÇíÂèñÂæó
            const footY = Math.max(leftAnkle.y, rightAnkle.y);
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÁ∑ë„ÅÆÂÜÜ„ÅßÊèèÁîªÔºàË®∫Êñ≠ÈñãÂßãÂæå„ÅÆ„ÅøÔºâ
            if (isDiagnosisStarted) {
                ctx.fillStyle = '#00FF00';
                ctx.globalAlpha = 0.7;
                ctx.beginPath();
                ctx.arc(idealPosition * width, footY * height + 20, 8, 0, 2 * Math.PI);
                ctx.fill();
                
                // „É©„Éô„É´
                ctx.fillStyle = '#00FF00';
                ctx.globalAlpha = 1.0;
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ÁêÜÊÉ≥', idealPosition * width, footY * height + 45);
            }
            
            // Êé®ÂÆö„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÈùí„ÅÑÂÜÜ„ÅßÊèèÁîª
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.arc(estimatedBallPosition * width, footY * height + 20, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 1.0;
            ctx.fillText('Êé®ÂÆö', estimatedBallPosition * width, footY * height + 65);
            
            ctx.globalAlpha = 1.0;
        }

        // „É©„É≥„Éâ„Éû„Éº„ÇØÊèèÁîªÔºàMediaPipeÊ®ôÊ∫ñ„Çπ„Çø„Ç§„É´„ÉªÂº∑ÂåñÁâàÔºâ
        function drawLandmarks(ctx, landmarks, width, height) {
            console.log('Drawing landmarks, count:', landmarks.length);
            
            landmarks.forEach((landmark, index) => {
                // ‰ø°È†ºÂ∫¶„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÁ∑©„Åè„Åó„Å¶„ÄÅ„Çà„ÇäÂ§ö„Åè„ÅÆÁÇπ„ÇíË°®Á§∫
                if (landmark.visibility < 0.3) return; 
                
                const x = landmark.x * width;
                const y = landmark.y * height;
                
                // ÈÉ®‰ΩçÂà•„ÅÆËâ≤ÂàÜ„ÅëÔºà„Çà„ÇäÈÆÆ„ÇÑ„Åã„Å™Ëâ≤Ôºâ
                let color;
                if (index <= 10) {
                    color = '#FF4500'; // È°î„ÉªÈ†≠ÈÉ®ÔºöËµ§„Ç™„É¨„É≥„Ç∏
                } else if (index >= 11 && index <= 22) {
                    color = '#00CED1'; // ‰∏äÂçäË∫´Ôºö„ÉÄ„Éº„ÇØ„Çø„Éº„Ç≥„Ç§„Ç∫
                } else {
                    color = '#1E90FF'; // ‰∏ãÂçäË∫´Ôºö„Éâ„ÉÉ„Ç∏„Éñ„É´„Éº
                }
                
                // ÈáçË¶Å„Å™Èñ¢ÁØÄÁÇπ„ÅØÂ§ß„Åç„ÅèË°®Á§∫Ôºà„Åï„Çâ„Å´Â∞è„Åï„ÅèÔºâ
                const isKeyPoint = [0, 11, 12, 13, 14, 15, 16, 23, 24, 25, 26, 27, 28].includes(index);
                const radius = isKeyPoint ? 2 : 1; // „Åï„Çâ„Å´Â∞è„Åï„Åè
                
                // Èñ¢ÁØÄÁÇπ„ÇíËµ§„ÅÑÂÜÜ„ÅßÊèèÁîª
                ctx.fillStyle = '#FF0000'; // Ëµ§Ëâ≤„Å´Áµ±‰∏Ä
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.fill();
                
                // Áï™Âè∑Ë°®Á§∫„ÇíÂâäÈô§Ôºà„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„ÉàÔºâ
                // if (isKeyPoint) {
                //     ctx.fillStyle = '#FFFFFF';
                //     ctx.font = 'bold 12px Arial';
                //     ctx.textAlign = 'center';
                //     ctx.strokeStyle = '#000000';
                //     ctx.lineWidth = 3;
                //     ctx.strokeText(index.toString(), x, y + 4);
                //     ctx.fillText(index.toString(), x, y + 4);
                // }
            });
        }

        // Êé•Á∂öÁ∑öÊèèÁîªÔºàMediaPipeÊ®ôÊ∫ñÊ∫ñÊã†„ÉªÂº∑ÂåñÁâàÔºâ
        function drawConnections(ctx, landmarks, width, height) {
            console.log('Drawing connections...');
            ctx.lineWidth = 2; // Á¥∞„ÅÑÁ∑ö

            // MediaPipe PoseÊ®ôÊ∫ñ„ÅÆÊé•Á∂öÁ∑öÂÆöÁæ©
            const connections = [
                // È°î
                [0, 1], [1, 2], [2, 3], [3, 7], [0, 4], [4, 5], [5, 6], [6, 8],
                // ‰∏äÂçäË∫´
                [9, 10], [11, 12], [11, 13], [13, 15], [15, 17], [15, 19], [15, 21], [17, 19],
                [12, 14], [14, 16], [16, 18], [16, 20], [16, 22], [18, 20],
                [11, 23], [12, 24], [23, 24],
                // ‰∏ãÂçäË∫´
                [23, 25], [25, 27], [27, 29], [29, 31], [27, 31],
                [24, 26], [26, 28], [28, 30], [30, 32], [28, 32]
            ];

            connections.forEach(([start, end]) => {
                // ‰ø°È†ºÂ∫¶„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÁ∑©„Åè„Åó„Å¶„ÄÅ„Çà„ÇäÂ§ö„Åè„ÅÆÁ∑ö„ÇíË°®Á§∫
                if (landmarks[start] && landmarks[end] && 
                    landmarks[start].visibility > 0.3 && landmarks[end].visibility > 0.3) {
                    
                    // Ëâ≤„ÇíÁ∑ëËâ≤„Å´Áµ±‰∏Ä
                    ctx.strokeStyle = '#00FF00'; // „Åô„Åπ„Å¶„ÅÆÊé•Á∂öÁ∑ö„ÇíÁ∑ëËâ≤„Å´
                    
                    // ÂΩ±‰ªò„Åç„ÅÆÁ∑ö„ÇíÊèèÁîª
                    ctx.shadowColor = 'rgba(0,0,0,0.3)';
                    ctx.shadowBlur = 2;
                    ctx.shadowOffsetX = 1;
                    ctx.shadowOffsetY = 1;
                    
                    ctx.beginPath();
                    ctx.moveTo(landmarks[start].x * width, landmarks[start].y * height);
                    ctx.lineTo(landmarks[end].x * width, landmarks[end].y * height);
                    ctx.stroke();
                    
                    // ÂΩ±„Çí„É™„Çª„ÉÉ„Éà
                    ctx.shadowColor = 'transparent';
                    ctx.shadowBlur = 0;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                }
            });
        }

        // ÂßøÂã¢ÂàÜÊûê
        function analyzePosture() {
            console.log('ÂàÜÊûêÈñãÂßã„ÄÅ„Éù„Éº„Ç∫„Éá„Éº„Çø:', poseResults);
            
            if (!poseResults || !poseResults.poseLandmarks) {
                alert('„Éù„Éº„Ç∫„ÅåÊ§úÂá∫„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„Çà„ÇäÊòéÁ¢∫„Å™ÂßøÂã¢„ÅÆÁîªÂÉè„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                hideLoading();
                return;
            }

            const clubType = document.getElementById('clubSelect').value;
            const scores = calculatePostureScores(poseResults.poseLandmarks, clubType);
            
            console.log('Ë®àÁÆó„Åï„Çå„Åü„Çπ„Ç≥„Ç¢:', scores);
            
            displayResults(scores);
            createRadarChart(scores);
            
            hideLoading();
        }

        // ÂßøÂã¢„Çπ„Ç≥„Ç¢Ë®àÁÆóÔºàË¶ñÁÇπÂà•Ôºâ
        function calculatePostureScores(landmarks, clubType) {
            const viewType = document.getElementById('viewSelect').value;
            let scores = {};

            if (viewType === 'front') {
                // Ê≠£Èù¢Ë¶ñÁÇπÔºö„Éú„Éº„É´‰ΩçÁΩÆ„ÄÅ„Çπ„Çø„É≥„ÇπÂπÖ„ÄÅÈáçÂøÉÈÖçÂàÜ„ÄÅ„Éê„É©„É≥„Çπ„ÄÅÈ†≠„ÅÆ‰ΩçÁΩÆ
                const stanceResult = evaluateStanceWidth(landmarks, clubType);
                const balanceResult = evaluateBalance(landmarks);
                const headResult = evaluateHeadPosition(landmarks);
                scores = {
                    ballPosition: evaluateBallPosition(landmarks, clubType).score,
                    ballPositionData: evaluateBallPosition(landmarks, clubType),
                    stance: stanceResult.score,
                    stanceStatus: stanceResult.status,
                    weight: evaluateWeightDistribution(landmarks, clubType),
                    balance: balanceResult.score,
                    balanceData: balanceResult,
                    headPosition: headResult.score,
                    headData: headResult
                };
            } else {
                // ÂæåÊñπË¶ñÁÇπÔºö‰Ωì„ÅÆÂêë„Åç„ÄÅÂâçÂÇæËßíÂ∫¶„ÄÅÊâã„ÅÆ‰ΩçÁΩÆ„ÄÅÂâçÂæå„ÅÆÈáçÂøÉ„ÄÅËÉåÁ≠ã„ÅÆÊõ≤„Åå„ÇäÂÖ∑Âêà
                scores = {
                    bodyAlignment: evaluateBodyAlignment(landmarks),
                    forwardTilt: evaluateForwardTilt(landmarks),
                    handPosition: evaluateHandPosition(landmarks, clubType),
                    frontBackWeight: evaluateFrontBackWeight(landmarks),
                    spinalCurve: evaluateSpinalCurve(landmarks)
                };
            }

            // Á∑èÂêà„Çπ„Ç≥„Ç¢Ë®àÁÆóÔºàÊï∞ÂÄ§„ÅÆ„Åø„ÇíÂØæË±°Ôºâ
            const numericScores = Object.entries(scores).filter(([key, value]) => 
                typeof value === 'number' && key !== 'total'
            ).map(([key, value]) => value);
            
            const totalScore = numericScores.reduce((sum, score) => sum + score, 0) / numericScores.length;
            scores.total = Math.round(totalScore);

            return scores;
        }

        // Êñ∞„Åó„ÅÑË©ï‰æ°Èñ¢Êï∞ÔºàÂæåÊñπË¶ñÁÇπÁî®Ôºâ
        
        // ‰Ωì„ÅÆÂêë„ÅçË©ï‰æ°ÔºàËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅÆ„É©„Ç§„É≥Ôºâ
        function evaluateBodyAlignment(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftHeel = landmarks[29];
            const rightHeel = landmarks[30];
            
            if (!leftShoulder || !rightShoulder || !leftHip || !rightHip || !leftHeel || !rightHeel) return 0;
            
            // ËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅÆ„É©„Ç§„É≥„ÅåÂπ≥Ë°å„Åã„Å©„ÅÜ„Åã„ÇíË©ï‰æ°
            const shoulderLine = Math.abs(leftShoulder.x - rightShoulder.x);
            const hipLine = Math.abs(leftHip.x - rightHip.x);
            const heelLine = Math.abs(leftHeel.x - rightHeel.x);
            
            const alignmentDeviation = Math.abs(shoulderLine - hipLine) + Math.abs(hipLine - heelLine);
            
            if (alignmentDeviation < 0.02) return 95;
            if (alignmentDeviation < 0.04) return 85;
            if (alignmentDeviation < 0.06) return 75;
            if (alignmentDeviation < 0.08) return 65;
            return 50;
        }
        
        // ÂâçÂÇæËßíÂ∫¶Ë©ï‰æ°
        function evaluateForwardTilt(landmarks) {
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!nose || !leftShoulder || !rightShoulder || !leftHip || !rightHip) return 0;
            
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            
            // ÂâçÂÇæËßíÂ∫¶„ÇíË®àÁÆó
            const tiltAngle = Math.atan2(shoulderCenter.y - hipCenter.y, shoulderCenter.x - hipCenter.x) * 180 / Math.PI;
            const idealTilt = 20; // ÁêÜÊÉ≥ÁöÑ„Å™ÂâçÂÇæËßíÂ∫¶
            const deviation = Math.abs(Math.abs(tiltAngle) - idealTilt);
            
            if (deviation < 5) return 95;
            if (deviation < 10) return 85;
            if (deviation < 15) return 75;
            if (deviation < 20) return 65;
            return 50;
        }
        
        // Êâã„ÅÆ‰ΩçÁΩÆË©ï‰æ°
        function evaluateHandPosition(landmarks, clubType) {
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            
            if (!leftWrist || !rightWrist || !leftShoulder || !rightShoulder) return 0;
            
            const handCenter = {
                x: (leftWrist.x + rightWrist.x) / 2,
                y: (leftWrist.y + rightWrist.y) / 2
            };
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            
            // Êâã„Å®ËÇ©„ÅÆ‰ΩçÁΩÆÈñ¢‰øÇ„ÇíË©ï‰æ°
            const handDistance = Math.abs(handCenter.x - shoulderCenter.x);
            
            let idealDistance;
            if (clubType === 'Driver') {
                idealDistance = 0.03; // „Éâ„É©„Ç§„Éê„Éº„ÅØÂ∞ë„ÅóÂâç
            } else {
                idealDistance = 0.01; // ‰ªñ„ÅÆ„ÇØ„É©„Éñ„ÅØËÇ©„ÅÆÁúü‰∏ã
            }
            
            const deviation = Math.abs(handDistance - idealDistance);
            
            if (deviation < 0.01) return 95;
            if (deviation < 0.02) return 85;
            if (deviation < 0.03) return 75;
            if (deviation < 0.04) return 65;
            return 50;
        }
        
        // ÂâçÂæå„ÅÆÈáçÂøÉË©ï‰æ°
        function evaluateFrontBackWeight(landmarks) {
            const nose = landmarks[0];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            
            if (!nose || !leftHip || !rightHip || !leftAnkle || !rightAnkle) return 0;
            
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            const ankleCenter = {
                x: (leftAnkle.x + rightAnkle.x) / 2,
                y: (leftAnkle.y + rightAnkle.y) / 2
            };
            
            // ÂâçÂæå„ÅÆÈáçÂøÉ„Éê„É©„É≥„Çπ„ÇíË©ï‰æ°
            const weightBalance = Math.abs(hipCenter.x - ankleCenter.x);
            
            if (weightBalance < 0.02) return 95;
            if (weightBalance < 0.04) return 85;
            if (weightBalance < 0.06) return 75;
            if (weightBalance < 0.08) return 65;
            return 50;
        }
        
        // ËÉåÁ≠ã„ÅÆÊõ≤„Åå„ÇäÂÖ∑ÂêàË©ï‰æ°
        function evaluateSpinalCurve(landmarks) {
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!nose || !leftShoulder || !rightShoulder || !leftHip || !rightHip) return 0;
            
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            
            // ËÉåÁ≠ã„ÅÆËá™ÁÑ∂„Å™„Ç´„Éº„Éñ„ÇíË©ï‰æ°ÔºàÁ∞°Áï•ÂåñÔºâ
            const spineDeviation = Math.abs(nose.x - shoulderCenter.x) + Math.abs(shoulderCenter.x - hipCenter.x);
            
            if (spineDeviation < 0.03) return 95;
            if (spineDeviation < 0.06) return 85;
            if (spineDeviation < 0.09) return 75;
            if (spineDeviation < 0.12) return 65;
            return 50;
        }
        
        // ÊóßË©ï‰æ°Èñ¢Êï∞ÔºàÊ≠£Èù¢Ë¶ñÁÇπÁî®„Å´‰øùÊåÅÔºâ
        
        // ËÑäÊ§éËßíÂ∫¶Ë©ï‰æ°ÔºàÊ≠£Èù¢„ÉªÂæåÈù¢Ë¶ñÁÇπÂØæÂøúÔºâ
        function evaluateSpineAngle(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!leftShoulder || !rightShoulder || !leftHip || !rightHip) return 0;
            
            // Ê≠£Èù¢Ë¶ñÁÇπ„Åß„ÅÆËÑäÊ§é„ÅÆÁõ¥Á∑öÊÄß„ÇíË©ï‰æ°
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            
            // Ê∞¥Âπ≥„Åã„Çâ„ÅÆÂÇæ„Åç„ÇíË®àÁÆó
            const spineDeviation = Math.abs(shoulderCenter.x - hipCenter.x);
            
            if (spineDeviation < 0.02) return 95;
            if (spineDeviation < 0.04) return 85;
            if (spineDeviation < 0.06) return 75;
            if (spineDeviation < 0.08) return 65;
            return 50;
        }

        // ËÇ©„ÅÆ‰ΩçÁΩÆË©ï‰æ°ÔºàÊ≠£Èù¢Ë¶ñÁÇπÊúÄÈÅ©ÂåñÔºâ
        function evaluateShoulderAlignment(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            
            if (!leftShoulder || !rightShoulder) return 0;
            
            // Ê≠£Èù¢Ë¶ñÁÇπ„Åß„ÅÆËÇ©„ÅÆÊ∞¥Âπ≥Â∫¶„ÇíË©ï‰æ°
            const heightDiff = Math.abs(leftShoulder.y - rightShoulder.y);
            
            // Ê≠£Èù¢„Åã„Çâ„ÅØËÇ©„ÅÆÈ´ò„Åï„ÅÆÈÅï„ÅÑ„Åå„Çà„ÇäÊòéÁ¢∫„Å´Ë¶ã„Åà„Çã
            if (heightDiff < 0.015) return 95;
            if (heightDiff < 0.03) return 85;
            if (heightDiff < 0.045) return 75;
            if (heightDiff < 0.06) return 65;
            return 50;
        }

        // ËÜù„ÅÆ‰ΩçÁΩÆË©ï‰æ°ÔºàÊ≠£Èù¢Ë¶ñÁÇπÊúÄÈÅ©ÂåñÔºâ
        function evaluateKneeAlignment(landmarks) {
            const leftKnee = landmarks[25];
            const rightKnee = landmarks[26];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!leftKnee || !rightKnee || !leftHip || !rightHip) return 0;
            
            // Ê≠£Èù¢Ë¶ñÁÇπ„Åß„ÅÆËÜù„ÅÆ‰ΩçÁΩÆ„ÇíËÇ°Èñ¢ÁØÄ„Å®„ÅÆÈñ¢‰øÇ„ÅßË©ï‰æ°
            const leftKneeAlignment = Math.abs(leftKnee.x - leftHip.x);
            const rightKneeAlignment = Math.abs(rightKnee.x - rightHip.x);
            
            // ËÜù„ÅÆÈ´ò„Åï„ÅÆÊèÉ„ÅÑÂÖ∑Âêà„ÇÇË©ï‰æ°
            const kneeHeightDiff = Math.abs(leftKnee.y - rightKnee.y);
            
            const avgAlignment = (leftKneeAlignment + rightKneeAlignment) / 2;
            const totalDeviation = avgAlignment + kneeHeightDiff;
            
            if (totalDeviation < 0.03) return 95;
            if (totalDeviation < 0.06) return 85;
            if (totalDeviation < 0.09) return 75;
            if (totalDeviation < 0.12) return 65;
            return 50;
        }

        // „Éú„Éº„É´‰ΩçÁΩÆË©ï‰æ°ÔºàÊîπËâØÁâà„Éª„ÇØ„É™„ÉÉ„ÇØÂØæÂøúÔºâ
        function evaluateBallPosition(landmarks, clubType) {
            const leftAnkle = landmarks[27]; // Â∑¶Ë∂≥È¶ñ
            const rightAnkle = landmarks[28]; // Âè≥Ë∂≥È¶ñ
            const leftHeel = landmarks[29]; // Â∑¶„Åã„Åã„Å®
            const rightHeel = landmarks[30]; // Âè≥„Åã„Åã„Å®
            const leftToe = landmarks[31]; // Â∑¶„Å§„ÅæÂÖà
            const rightToe = landmarks[32]; // Âè≥„Å§„ÅæÂÖà
            
            if (!leftAnkle || !rightAnkle || !leftHeel || !rightHeel) return 0;
            
            // „Çà„ÇäÊ≠£Á¢∫„Å™Ë∂≥„ÅÆ‰ΩçÁΩÆË®àÁÆó
            const leftFootCenter = leftHeel ? leftHeel.x : leftAnkle.x;
            const rightFootCenter = rightHeel ? rightHeel.x : rightAnkle.x;
            const stanceCenter = (leftFootCenter + rightFootCenter) / 2;
            
            // „ÇØ„É©„ÉñÂà•„ÅÆÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆÔºàÂ∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„ÇíÂü∫Ê∫ñÔºâ
            const idealPositions = {
                'Driver': leftFootCenter,                // Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ
                'FairwayWood': leftFootCenter + 0.02,   // Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Utility': stanceCenter - 0.02,        // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '3Iron': stanceCenter - 0.015,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '4Iron': stanceCenter - 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '5Iron': stanceCenter - 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '6Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '7Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '8Iron': stanceCenter + 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                '9Iron': stanceCenter + 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Wedge': stanceCenter + 0.03           // ‰∏≠Â§Æ„Çà„ÇäÂè≥
            };
            
            // ÂÆüÈöõ„ÅÆ„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊ±∫ÂÆö
            let actualBallPosition;
            
            if (userClickedBallPosition && document.getElementById('viewSelect').value === 'front') {
                // „É¶„Éº„Ç∂„Éº„Åå„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü‰ΩçÁΩÆ„Çí‰ΩøÁî®
                actualBallPosition = userClickedBallPosition.x;
            } else {
                // ÊâãÈ¶ñ„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÊé®ÂÆö
                const leftWrist = landmarks[15];
                const rightWrist = landmarks[16];
                actualBallPosition = stanceCenter; // „Éá„Éï„Ç©„É´„Éà
                
                if (leftWrist && rightWrist) {
                    // ÊâãÈ¶ñ„ÅÆ‰∏≠Â§Æ„Åã„Çâ„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊé®ÂÆö
                    const handCenter = (leftWrist.x + rightWrist.x) / 2;
                    actualBallPosition = handCenter;
                }
            }
            
            const idealPosition = idealPositions[clubType] || stanceCenter;
            const deviation = Math.abs(actualBallPosition - idealPosition);
            const isLeftOfIdeal = actualBallPosition > idealPosition; // ÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„ÇäÂ∑¶„Å´„ÅÇ„ÇãÔºàMediaPipeÂ∫ßÊ®ôÁ≥ª„Åß„ÅØÈÄÜÔºâ
            
            // „Çπ„Ç≥„Ç¢Ë®àÁÆó
            let score;
            if (deviation < 0.025) score = 95; // Ë®±ÂÆπÁØÑÂõ≤„ÇíÂ∫É„Åè
            else if (deviation < 0.05) score = 90;  // 90ÁÇπÂè∞„ÇÇËøΩÂä†
            else if (deviation < 0.075) score = 85;
            else if (deviation < 0.10) score = 75;
            else if (deviation < 0.125) score = 65;
            else score = 50;
            
            return {
                score: score,
                actualPosition: actualBallPosition,
                idealPosition: idealPosition,
                deviation: deviation,
                isLeftOfIdeal: isLeftOfIdeal,
                clubType: clubType
            };
        }

        // „Çπ„Çø„É≥„ÇπÂπÖË©ï‰æ°
        function evaluateStanceWidth(landmarks, clubType) {
            const leftFoot = landmarks[27];
            const rightFoot = landmarks[28];
            
            if (!leftFoot || !rightFoot) return { score: 0, status: 'unknown' };
            
            const stanceWidth = Math.abs(leftFoot.x - rightFoot.x);
            
            const idealWidths = {
                'Driver': 0.25,
                'FairwayWood': 0.23,
                'Utility': 0.22,
                '3Iron': 0.21,
                '4Iron': 0.21,
                '5Iron': 0.20,
                '6Iron': 0.20,
                '7Iron': 0.20,
                '8Iron': 0.19,
                '9Iron': 0.19,
                'Wedge': 0.18
            };
            
            const idealWidth = idealWidths[clubType] || 0.20;
            const deviation = stanceWidth - idealWidth;
            
            let score, status;
            
            if (Math.abs(deviation) < 0.02) {
                score = 95;
                status = 'ideal';
            } else if (Math.abs(deviation) < 0.04) {
                score = 85;
                status = deviation > 0 ? 'slightly_wide' : 'slightly_narrow';
            } else if (Math.abs(deviation) < 0.06) {
                score = 75;
                status = deviation > 0 ? 'wide' : 'narrow';
            } else if (Math.abs(deviation) < 0.08) {
                score = 65;
                status = deviation > 0 ? 'too_wide' : 'too_narrow';
            } else {
                score = 50;
                status = deviation > 0 ? 'much_too_wide' : 'much_too_narrow';
            }
            
            return { 
                score: score, 
                status: status
            };
        }

        // ÈáçÂøÉÈÖçÂàÜË©ï‰æ°ÔºàÊñ∞Ê©üËÉΩÔºâ
        function evaluateWeightDistribution(landmarks, clubType) {
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftFoot = landmarks[27];
            const rightFoot = landmarks[28];
            
            if (!leftHip || !rightHip || !leftFoot || !rightFoot) return 0;
            
            // ÈáçÂøÉ‰ΩçÁΩÆ„ÇíÊé®ÂÆöÔºàËÖ∞„ÅÆ‰ΩçÁΩÆ„Å®Ë∂≥„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÔºâ
            const hipCenter = (leftHip.x + rightHip.x) / 2;
            const footCenter = (leftFoot.x + rightFoot.x) / 2;
            
            // Â∑¶Âè≥„ÅÆÈáçÂøÉÈÖçÂàÜ„ÇíË®àÁÆó
            const weightDistribution = (hipCenter - footCenter) / Math.abs(leftFoot.x - rightFoot.x);
            
            if (clubType === 'Driver') {
                // „Éâ„É©„Ç§„Éê„ÉºÔºö6:4„ÅßÂè≥ÈáçÂøÉ„ÅåÁêÜÊÉ≥
                const idealRightWeight = 0.1; // Âè≥„Å´10%ÂÅè„Å£„ÅüÁä∂ÊÖã
                const deviation = Math.abs(weightDistribution - idealRightWeight);
                
                if (deviation < 0.05) return 95;
                if (deviation < 0.10) return 85;
                if (deviation < 0.15) return 75;
                if (deviation < 0.20) return 65;
                return 50;
            } else {
                // „Åù„ÅÆ‰ªñ„ÅÆ„ÇØ„É©„ÉñÔºö5:5„ÅßÂùáÁ≠â„ÅåÁêÜÊÉ≥
                const deviation = Math.abs(weightDistribution);
                
                if (deviation < 0.03) return 95;
                if (deviation < 0.06) return 85;
                if (deviation < 0.09) return 75;
                if (deviation < 0.12) return 65;
                return 50;
            }
        }

        // „Éê„É©„É≥„ÇπË©ï‰æ°
        function evaluateBalance(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!leftShoulder || !rightShoulder || !leftHip || !rightHip) return { score: 0, currentValue: 0, idealValue: 0, unit: 'cm' };
            
            const shoulderCenter = (leftShoulder.x + rightShoulder.x) / 2;
            const hipCenter = (leftHip.x + rightHip.x) / 2;
            const balance = Math.abs(shoulderCenter - hipCenter);
            
            // „Éê„É©„É≥„Çπ„ÅÆ„Ç∫„É¨„ÇícmÂçò‰Ωç„Å´Â§âÊèõÔºà‰ªÆÊÉ≥ÁöÑ„Å™Â§âÊèõÔºâ
            const balanceInCm = balance * 100; // 0.01 = 1cmÁõ∏ÂΩì„Å®‰ªÆÂÆö
            
            let score;
            if (balance < 0.02) score = 95;
            else if (balance < 0.04) score = 85;
            else if (balance < 0.06) score = 75;
            else if (balance < 0.08) score = 65;
            else score = 50;
            
            return {
                score: score,
                currentValue: Math.round(balanceInCm * 10) / 10,
                idealValue: 0,
                unit: 'cm„ÅÆ„Ç∫„É¨'
            };
        }

        // È†≠„ÅÆ‰ΩçÁΩÆË©ï‰æ°
        function evaluateHeadPosition(landmarks) {
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            
            if (!nose || !leftShoulder || !rightShoulder) return { score: 0, currentValue: 0, idealValue: 0, unit: 'cm' };
            
            const shoulderCenter = (leftShoulder.x + rightShoulder.x) / 2;
            const headPosition = Math.abs(nose.x - shoulderCenter);
            
            // È†≠„ÅÆ„Ç∫„É¨„ÇícmÂçò‰Ωç„Å´Â§âÊèõ
            const headOffsetInCm = headPosition * 100;
            
            let score;
            if (headPosition < 0.03) score = 95;
            else if (headPosition < 0.06) score = 85;
            else if (headPosition < 0.09) score = 75;
            else if (headPosition < 0.12) score = 65;
            else score = 50;
            
            return {
                score: score,
                currentValue: Math.round(headOffsetInCm * 10) / 10,
                idealValue: 0,
                unit: 'cm„ÅÆ„Ç∫„É¨'
            };
        }

        // ÁµêÊûúË°®Á§∫Ôºà„Çπ„Ç≥„Ç¢„Å®„Ç¢„Éâ„Éê„Ç§„Çπ„ÇíÁµ±ÂêàÔºâ
        function displayResults(scores) {
            const scoreFeedbackGrid = document.getElementById('scoreFeedbackGrid');
            scoreFeedbackGrid.innerHTML = '';
            const viewType = document.getElementById('viewSelect').value;

            // Ë¶ñÁÇπÂà•„Å´Ë°®Á§∫È†ÖÁõÆ„ÇíÂ§âÊõ¥
            let scoreItems;
            if (viewType === 'front') {
                scoreItems = [
                    { key: 'total', label: 'Á∑èÂêà„Çπ„Ç≥„Ç¢' },
                    { key: 'ballPosition', label: '„Éú„Éº„É´‰ΩçÁΩÆ' },
                    { key: 'stance', label: '„Çπ„Çø„É≥„ÇπÂπÖ' },
                    { key: 'weight', label: 'ÈáçÂøÉÈÖçÂàÜ' },
                    { key: 'balance', label: '„Éê„É©„É≥„Çπ' },
                    { key: 'headPosition', label: 'È†≠„ÅÆ‰ΩçÁΩÆ' }
                ];
            } else {
                scoreItems = [
                    { key: 'total', label: 'Á∑èÂêà„Çπ„Ç≥„Ç¢' },
                    { key: 'bodyAlignment', label: '‰Ωì„ÅÆÂêë„Åç' },
                    { key: 'forwardTilt', label: 'ÂâçÂÇæËßíÂ∫¶' },
                    { key: 'handPosition', label: 'Êâã„ÅÆ‰ΩçÁΩÆ' },
                    { key: 'frontBackWeight', label: 'ÂâçÂæå„ÅÆÈáçÂøÉ' },
                    { key: 'spinalCurve', label: 'ËÉåÁ≠ã„ÅÆÊõ≤„Åå„Çä' }
                ];
            }

            const advice = generateAdvice(scores);

            scoreItems.forEach(item => {
                if (scores[item.key] !== undefined) {
                    const scoreValue = scores[item.key];
                    const scoreClass = getScoreClass(scoreValue);
                    
                    const scoreElement = document.createElement('div');
                    scoreElement.className = `score-feedback-item ${scoreClass}`;
                    scoreElement.innerHTML = `
                        <div class="score-header">
                            <div class="score-title">${item.label}</div>
                            <div class="score-value">${scoreValue}ÁÇπ</div>
                        </div>
                        <div class="advice-text">${advice[item.key]}</div>
                    `;
                    scoreFeedbackGrid.appendChild(scoreElement);
                }
            });
        }

        // „Çπ„Ç≥„Ç¢„ÇØ„É©„ÇπÂà§ÂÆö
        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 80) return 'score-good';
            if (score >= 70) return 'score-average';
            return 'score-poor';
        }

        // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà‰ΩúÊàêÔºàË¶ñÁÇπÂà•Ôºâ
        function createRadarChart(scores) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const viewType = document.getElementById('viewSelect').value;
            
            if (radarChartInstance) {
                radarChartInstance.destroy();
            }

            let labels, scoreData, idealData;
            
            if (viewType === 'front') {
                labels = ['„Éú„Éº„É´‰ΩçÁΩÆ', '„Çπ„Çø„É≥„ÇπÂπÖ', 'ÈáçÂøÉÈÖçÂàÜ', '„Éê„É©„É≥„Çπ', 'È†≠„ÅÆ‰ΩçÁΩÆ'];
                scoreData = [
                    scores.ballPosition,
                    scores.stance,
                    scores.weight,
                    scores.balance,
                    scores.headPosition
                ];
                idealData = [100, 100, 100, 100, 100];
            } else {
                labels = ['‰Ωì„ÅÆÂêë„Åç', 'ÂâçÂÇæËßíÂ∫¶', 'Êâã„ÅÆ‰ΩçÁΩÆ', 'ÂâçÂæå„ÅÆÈáçÂøÉ', 'ËÉåÁ≠ã„ÅÆÊõ≤„Åå„Çä'];
                scoreData = [
                    scores.bodyAlignment,
                    scores.forwardTilt,
                    scores.handPosition,
                    scores.frontBackWeight,
                    scores.spinalCurve
                ];
                idealData = [100, 100, 100, 100, 100];
            }

            const data = {
                labels: labels,
                datasets: [{
                    label: '„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≥„Ç¢',
                    data: scoreData,
                    backgroundColor: 'rgba(102, 126, 234, 0.3)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 3,
                    pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(102, 126, 234, 1)',
                    pointHoverRadius: 8
                }, {
                    label: 'ÁêÜÊÉ≥ÂÄ§',
                    data: idealData,
                    backgroundColor: 'rgba(40, 167, 69, 0.15)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(40, 167, 69, 1)',
                    pointHoverRadius: 7
                }]
            };

            const config = {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            beginAtZero: true,
                            ticks: {
                                stepSize: 20,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            pointLabels: {
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: '#333',
                                padding: 15
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#333',
                                padding: 20
                            }
                        },
                        title: {
                            display: true,
                            text: `„Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπÂàÜÊûê - ${viewType === 'front' ? 'Ê≠£Èù¢Ë¶ñÁÇπ' : 'ÂæåÊñπË¶ñÁÇπ'}`,
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#333',
                            padding: 20
                        }
                    }
                }
            };

            radarChartInstance = new Chart(ctx, config);
        }

        // „Çπ„Çø„É≥„ÇπÂπÖ„ÅÆ„Ç¢„Éâ„Éê„Ç§„ÇπÁîüÊàê
        function getStanceAdvice(stanceStatus, clubType) {
            // ÁêÜÊÉ≥„ÅÆË°®Áèæ„ÇíÂàÜ„Åã„Çä„ÇÑ„Åô„Åè
            const idealDescription = clubType === 'Driver' ? 
                'ËÇ©ÂπÖ„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÇÅ' :
                'ËÇ©ÂπÖÁ®ãÂ∫¶';
                
            switch(stanceStatus) {
                case 'slightly_narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∞ë„ÅóÁã≠„ÇÅ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÁã≠„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'too_narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇ„Åã„Å™„ÇäÁã≠„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'much_too_narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÈùûÂ∏∏„Å´Áã≠„Åô„Åé„Åæ„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'slightly_wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÇÅ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∫É„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'too_wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇ„Åã„Å™„ÇäÂ∫É„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'much_too_wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÈùûÂ∏∏„Å´Â∫É„Åô„Åé„Åæ„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                default:
                    return `ÁêÜÊÉ≥Ôºö${idealDescription}`;
            }
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„ÅÆ„Ç¢„Éâ„Éê„Ç§„ÇπÁîüÊàê
        function getBallPositionAdvice(score, ballPositionData) {
            if (score >= 80) {
                return '„Éú„Éº„É´‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆ‰ΩçÁΩÆ„ÇíÊÑèË≠ò„Åó„Å¶„Ç¢„Éâ„É¨„Çπ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
            }
            
            if (!ballPositionData) {
                return '„Éú„Éº„É´‰ΩçÁΩÆ„ÇíË™øÊï¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
            }
            
            const { clubType, isLeftOfIdeal } = ballPositionData;
            
            // „ÇØ„É©„ÉñÂà•„ÅÆÁêÜÊÉ≥‰ΩçÁΩÆ„ÅÆË™¨Êòé
            const idealDescription = getIdealBallPositionDescription(clubType);
            
            // ÁèæÂú®‰ΩçÁΩÆ„ÅåÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„Çä„ÇÇÂ∑¶„Å´„ÅÇ„Çã„ÅãÂè≥„Å´„ÅÇ„Çã„Åã
            const direction = isLeftOfIdeal ? 'Âè≥ÂØÑ„Çä' : 'Â∑¶ÂØÑ„Çä';
            const currentStatus = isLeftOfIdeal ? 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∑¶' : 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÂè≥';
            
            return `ÁèæÁä∂„ÅØ${currentStatus}„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ\nüèåÔ∏è‚Äç‚ôÇÔ∏è ÁêÜÊÉ≥Ôºö${idealDescription}\nüí° ${direction}„Å´Ë™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
        }
        
        // ÁêÜÊÉ≥„Éú„Éº„É´‰ΩçÁΩÆ„ÅÆË™¨Êòé
        function getIdealBallPositionDescription(clubType) {
            switch(clubType) {
                case 'Driver':
                    return 'Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ';
                case 'FairwayWood':
                    return 'Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥';
                case 'Utility':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶';
                case '3Iron':
                case '4Iron':
                case '5Iron':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶';
                case '6Iron':
                case '7Iron':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ';
                case '8Iron':
                case '9Iron':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥';
                case 'Wedge':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂè≥';
                default:
                    return '„ÇØ„É©„Éñ„Å´Âøú„Åò„ÅüÈÅ©Âàá„Å™‰ΩçÁΩÆ';
            }
        }

        // „Ç¢„Éâ„Éê„Ç§„ÇπÁîüÊàê
        function generateAdvice(scores) {
            const clubType = document.getElementById('clubSelect').value;
            const viewType = document.getElementById('viewSelect').value;
            
            let advice = {
                total: scores.total >= 90 ? 
                    'üèÜ „Éë„Éº„Éï„Çß„ÇØ„Éà„Å™„Ç¢„Éâ„É¨„Çπ„Åß„ÅôÔºÅ„Åì„ÅÆÁ¥†Êô¥„Çâ„Åó„ÅÑÂßøÂã¢„ÇíÁ∂≠ÊåÅ„Åó„Å¶„Çπ„Ç§„É≥„Ç∞„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ„Éó„É≠„É¨„Éô„É´„ÅÆÂÆâÂÆö„Åó„Åü„Ç¢„Éâ„É¨„Çπ„ÅåÂèñ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆË™øÂ≠ê„Åß„É©„Ç¶„É≥„Éâ„Å´Ëá®„ÇÅ„Å∞„ÄÅ„Åç„Å£„Å®ËâØ„ÅÑ„Çπ„Ç≥„Ç¢„ÅåÊúüÂæÖ„Åß„Åç„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ' :
                    scores.total >= 85 ? 
                    '‚ú® ÈùûÂ∏∏„Å´ËâØ„ÅÑ„Ç¢„Éâ„É¨„Çπ„Åß„ÅôÔºÅ„Åª„ÅºÁêÜÊÉ≥ÁöÑ„Å™ÂßøÂã¢„ÅåÂèñ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ¥∞„Åã„ÅÑÂæÆË™øÊï¥„ÇíË°å„ÅÜ„Åì„Å®„Åß„ÄÅ„Åï„Çâ„Å´ÂÆâÂÆö„Åó„Åü„Ç∑„Éß„ÉÉ„Éà„ÅåÊâì„Å¶„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇ„Åì„ÅÆÂü∫Êú¨ÂßøÂã¢„Çí„Éô„Éº„Çπ„Å´Á∑¥Áøí„ÇíÁ©ç„ÅøÈáç„Å≠„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    scores.total >= 75 ? 
                    'üëç ËâØ„ÅÑ„Ç¢„Éâ„É¨„Çπ„Åß„Åô„ÄÇÂü∫Êú¨ÁöÑ„Å™ÂßøÂã¢„ÅØÁøíÂæó„Åß„Åç„Å¶„Åä„Çä„ÄÅ„ÅÑ„Åè„Å§„Åã„ÅÆ„Éù„Ç§„É≥„Éà„ÇíÊîπÂñÑ„Åô„Çã„Åì„Å®„Åß„Çà„ÇäËâØ„ÅÑ„Ç¢„Éâ„É¨„Çπ„Å´„Å™„Çä„Åæ„Åô„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Á∑¥Áøí„ÅßÁ¢∫ÂÆü„Å´‰∏äÈÅî„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    scores.total >= 65 ? 
                    '‚ö†Ô∏è „Ç¢„Éâ„É¨„Çπ„Å´ÊîπÂñÑ„ÅÆ‰ΩôÂú∞„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„ÅÑ„Åè„Å§„Åã„ÅÆÈáçË¶Å„Å™„Éù„Ç§„É≥„Éà„ÇíË¶ãÁõ¥„Åô„Åì„Å®„Åß„ÄÅ„Çà„ÇäÂÆâÂÆö„Åó„Åü„Ç¢„Éâ„É¨„Çπ„ÅåÂèñ„Çå„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇÂü∫Êú¨„Å´Á´ã„Å°Ëøî„Å£„Å¶Á∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    scores.total >= 50 ? 
                    'üìö „Ç¢„Éâ„É¨„Çπ„ÅÆÂü∫Êú¨„Åã„ÇâË¶ãÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÁèæÂú®„ÅÆÂßøÂã¢„Åß„ÅØÂÆâÂÆö„Åó„Åü„Ç∑„Éß„ÉÉ„Éà„ÅåÈõ£„Åó„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂü∫Êú¨ÁöÑ„Å™„Ç¢„Éâ„É¨„Çπ„ÅÆË¶ÅÁ¥†„Çí‰∏Ä„Å§„Åö„Å§Á¢∫Ë™ç„Åó„ÄÅÊ≠£„Åó„ÅÑ„Éï„Ç©„Éº„É†„ÇíË∫´„Å´„Å§„Åë„Çã„Åì„Å®„ÅåÈáçË¶Å„Åß„Åô„ÄÇ' :
                    'üîÑ „Ç¢„Éâ„É¨„Çπ„ÇíÊ†πÊú¨„Åã„ÇâË¶ãÁõ¥„ÅôÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂü∫Êú¨ÁöÑ„Å™Êßã„ÅàÊñπ„Åã„ÇâÂ≠¶„Å≥Áõ¥„Åô„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ„Éó„É≠„ÅÆ„É¨„ÉÉ„Çπ„É≥„ÇíÂèó„Åë„Çã„Åã„ÄÅÂü∫Êú¨ÁöÑ„Å™ÊïôÊùê„ÇíÂèÇËÄÉ„Å´„Åó„Å¶„ÄÅÊ≠£„Åó„ÅÑ„Ç¢„Éâ„É¨„Çπ„ÇíÁøíÂæó„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Á∑¥Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ',
                
                spine: scores.spine >= 80 ? 
                    'ËÑäÊ§é„ÅÆÁõ¥Á∑öÊÄß„ÅØËâØÂ•Ω„Åß„Åô„ÄÇ„Åì„ÅÆÂßøÂã¢„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    'Ê≠£Èù¢„Åã„ÇâË¶ã„Å¶„ÄÅËÇ©„Å®ËÖ∞„ÅÆ‰∏≠ÂøÉ„Åå‰∏ÄÁõ¥Á∑ö„Å´„Å™„Çã„Çà„ÅÜÊÑèË≠ò„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÂ∑¶Âè≥„ÅÆÂÇæ„Åç„Çí‰øÆÊ≠£„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                
                shoulder: scores.shoulder >= 80 ? 
                    'ËÇ©„ÅÆ‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„É™„É©„ÉÉ„ÇØ„Çπ„Åó„ÅüÁä∂ÊÖã„Çí‰øù„Å°„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    '‰∏°ËÇ©„ÅÆÈ´ò„Åï„ÇíÊèÉ„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÊ≠£Èù¢„Åã„ÇâË¶ã„Å¶Ê∞¥Âπ≥„Å´„Å™„Çã„Çà„ÅÜË™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ',
                
                knee: scores.knee >= 80 ? 
                    'ËÜù„ÅÆ‰ΩçÁΩÆ„ÅØËâØÂ•Ω„Åß„Åô„ÄÇ„Åì„ÅÆÂÆâÂÆö„Åó„Åü„Çπ„Çø„É≥„Çπ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    'ËÜù„ÅåËÇ°Èñ¢ÁØÄ„ÅÆÁúü‰∏ã„Å´Êù•„Çã„Çà„ÅÜË™øÊï¥„Åó„ÄÅ‰∏°ËÜù„ÅÆÈ´ò„Åï„ÇíÊèÉ„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ',
                
                ballPosition: getBallPositionAdvice(scores.ballPosition, scores.ballPositionData),
                
                stance: scores.stance >= 80 ? 
                    (clubType === 'Driver' ? 
                        '„Çπ„Çø„É≥„ÇπÂπÖ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Éâ„É©„Ç§„Éê„Éº„ÅØËÇ©ÂπÖ„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÅÑ„Åè„Çâ„ÅÑ„ÅåÁêÜÊÉ≥„Åß„Åô„ÄÇ' :
                        '„Çπ„Çø„É≥„ÇπÂπÖ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇËÇ©ÂπÖ„ÅåÁêÜÊÉ≥ÁöÑ„Åß„Åô„ÄÇ') :
                    getStanceAdvice(scores.stanceStatus, clubType),
                
                weight: scores.weight >= 80 ? 
                    'ÈáçÂøÉÈÖçÂàÜ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆÊÑüË¶ö„ÇíË¶ö„Åà„Å¶„Åä„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    clubType === 'Driver' ? 
                    'ÈáçÂøÉ„Çí„ÇÇ„ÅÜÂ∞ë„ÅóÂè≥Ë∂≥„Å´Áßª„Åó„Åæ„Åó„Çá„ÅÜÔºà6:4„ÅÆÈÖçÂàÜÔºâ„ÄÇ„Éâ„É©„Ç§„Éê„Éº„Åß„ÅØÂè≥ÈáçÂøÉ„ÅåÁêÜÊÉ≥„Åß„Åô„ÄÇ' :
                    'ÈáçÂøÉ„ÇíÂ∑¶Âè≥ÂùáÁ≠â„Å´ÈÖçÂàÜ„Åó„Åæ„Åó„Çá„ÅÜÔºà5:5„ÅÆÈÖçÂàÜÔºâ„ÄÇ„Éê„É©„É≥„Çπ„ÅÆÂèñ„Çå„Åü„Çπ„Çø„É≥„Çπ„ÇíÂøÉ„Åå„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                
                balance: scores.balance >= 80 ? 
                    '„Éê„É©„É≥„Çπ„ÅØËâØÂ•Ω„Åß„Åô„ÄÇ„Åì„ÅÆÂÆâÂÆö„Åó„ÅüÂßøÂã¢„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    `‰∏äÂçäË∫´„Å®‰∏ãÂçäË∫´„ÅÆ„Éê„É©„É≥„Çπ„ÇíÊï¥„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇÈáçÂøÉ„Çí‰∏≠Â§Æ„Å´‰øù„Å°„Åæ„Åô„ÄÇ${scores.balanceData ? `\nüìç ÁèæÁä∂Ôºö${scores.balanceData.currentValue}${scores.balanceData.unit} / ÁêÜÊÉ≥Ôºö${scores.balanceData.idealValue}${scores.balanceData.unit}` : ''}`,
                
                headPosition: scores.headPosition >= 80 ? 
                    'È†≠„ÅÆ‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆÁä∂ÊÖã„Çí‰øù„Å°„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    `È†≠„Çí‰∏°ËÇ©„ÅÆ‰∏≠Â§Æ„Å´‰ΩçÁΩÆ„Åï„Åõ„Åæ„Åó„Çá„ÅÜ„ÄÇÂ∑¶Âè≥„Å´ÂÇæ„Åã„Å™„ÅÑ„Çà„ÅÜÊ≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ${scores.headData ? `\nüìç ÁèæÁä∂Ôºö${scores.headData.currentValue}${scores.headData.unit} / ÁêÜÊÉ≥Ôºö${scores.headData.idealValue}${scores.headData.unit}` : ''}`
            };
            
            if (viewType === 'back') {
                advice = {
                    ...advice,
                    bodyAlignment: scores.bodyAlignment >= 80 ? 
                        '‰Ωì„ÅÆÂêë„Åç„ÅØËâØÂ•Ω„Åß„Åô„ÄÇËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅåÈÅ©Âàá„Å´ÊèÉ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ' :
                        'ËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅÆÂêë„Åç„ÇíÁõÆÊ®ôÊñπÂêë„Å´ÊèÉ„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇÂπ≥Ë°å„Å´„Å™„Çã„Çà„ÅÜÊÑèË≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                    
                    forwardTilt: scores.forwardTilt >= 80 ? 
                        'ÂâçÂÇæËßíÂ∫¶„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆËßíÂ∫¶„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        'ÂâçÂÇæËßíÂ∫¶„ÇíË™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇËÇ°Èñ¢ÁØÄ„Åã„ÇâÂâçÂÇæ„Åó„ÄÅËÉåÁ≠ã„ÅØ„Åæ„Å£„Åô„Åê‰øù„Å°„Åæ„Åô„ÄÇ',
                    
                    handPosition: scores.handPosition >= 80 ? 
                        'Êâã„ÅÆ‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆ‰ΩçÁΩÆ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        clubType === 'Driver' ? 
                        '„Éâ„É©„Ç§„Éê„Éº„ÅÆÂ†¥Âêà„ÄÅÊâã„ÅØËÇ©„ÅÆÁúü‰∏ã„Çà„ÇäÂ∞ë„ÅóÂâçÔºà‰Ωì„Åã„ÇâÈõ¢„Çå„ÇãÔºâ„Å´‰ΩçÁΩÆ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        'Êâã„ÅØËÇ©„ÅÆÁúü‰∏ã„Å´‰ΩçÁΩÆ„Åó„ÄÅ‰Ωì„Å®„ÅÆË∑ùÈõ¢„ÅØÊã≥ÔºëÔºéÔºïÔΩûÔºíÂÄã„Åè„Çâ„ÅÑ„Å´„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ',
                    
                    frontBackWeight: scores.frontBackWeight >= 80 ? 
                        'ÂâçÂæå„ÅÆÈáçÂøÉ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆ„Éê„É©„É≥„Çπ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        'ÈáçÂøÉ„Çí„Éú„Éº„É´ÂÅ¥Ôºà„Å§„ÅæÂÖàÂÅ¥Ôºâ„Å´„ÇÑ„ÇÑÁßª„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åã„Åã„Å®ÈáçÂøÉ„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜÊ≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                    
                    spinalCurve: scores.spinalCurve >= 80 ? 
                        'ËÉåÁ≠ã„ÅÆÊõ≤„Åå„ÇäÂÖ∑Âêà„ÅØËâØÂ•Ω„Åß„Åô„ÄÇËá™ÁÑ∂„Å™Ôº≥Â≠ó„Ç´„Éº„Éñ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        'ËÉåÁ≠ã„ÅÆËá™ÁÑ∂„Å™Ôº≥Â≠ó„Ç´„Éº„Éñ„ÇíÊÑèË≠ò„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÁå´ËÉå„ÇÑÂèç„ÇäËÖπ„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜÊ≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                };
            }
            
            return advice;
        }

        // Ë®∫Êñ≠ÈñãÂßã„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.addEventListener('DOMContentLoaded', function() {
            // UI„Ç≥„É≥„Éà„É≠„Éº„É´„ÇíÂç≥Â∫ß„Å´ÊúâÂäπÂåñ
            document.getElementById('viewSelect').disabled = false;
            document.getElementById('clubSelect').disabled = false;
            document.getElementById('startDiagnosis').disabled = false;
            
            // MediaPipe„ÅØÈùûÂêåÊúü„ÅßÂàùÊúüÂåñÔºàUI„Éñ„É≠„ÉÉ„ÇØ„Åó„Å™„ÅÑÔºâ
            setTimeout(() => {
                initMediaPipe();
            }, 100);
            
            // ÊíÆÂΩ±Ë¶ñÁÇπ„ÅåÂ§â„Çè„Å£„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
            document.getElementById('viewSelect').addEventListener('change', function() {
                // „Éú„Éº„É´‰ΩçÁΩÆ„Çí„É™„Çª„ÉÉ„Éà
                userClickedBallPosition = null;
                
                // Êó¢Â≠ò„ÅÆ„Éû„Éº„Ç´„Éº„ÇíÂâäÈô§
                const existingMarker = document.getElementById('imageContainer').querySelector('.ball-position-marker');
                if (existingMarker) {
                    existingMarker.remove();
                }
                
                if (uploadedImageElement) {
                    setupBallPositionClick();
                }
            });
            
            document.getElementById('startDiagnosis').addEventListener('click', function() {
                if (!uploadedImageElement) {
                    alert('„Åæ„ÅöÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                
                const viewType = document.getElementById('viewSelect').value;
                
                // Ê≠£Èù¢Ë¶ñÁÇπ„ÅÆÂ†¥Âêà„ÅØ„Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØ„ÅåÂøÖÈ†à
                if (viewType === 'front' && !userClickedBallPosition) {
                    alert('Ê≠£Èù¢ÊíÆÂΩ±„ÅÆÂ†¥Âêà„ÄÅ„Éú„Éº„É´‰ΩçÁΩÆ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\nËá™ÂãïÊ§úÂá∫„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅÁîªÂÉè‰∏ä„ÅÆ„Éú„Éº„É´„Åå„ÅÇ„Çã‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    
                    // „Éú„Éº„É´‰ΩçÁΩÆÊåáÁ§∫„ÇíÂÜçË°®Á§∫
                    const ballInstruction = document.getElementById('ballPositionInstruction');
                    ballInstruction.style.display = 'block';
                    ballInstruction.innerHTML = '‚ö†Ô∏è „Éú„Éº„É´‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ<br><small>Ê≠£Èù¢ÊíÆÂΩ±„Åß„ÅØÂøÖÈ†à„Åß„Åô</small>';
                    ballInstruction.style.backgroundColor = 'rgba(255, 193, 7, 0.9)';
                    ballInstruction.style.borderColor = '#ffc107';
                    
                    return;
                }
                
                // Ë®∫Êñ≠ÈñãÂßãÊôÇ„Å´„Éú„Éº„É´‰ΩçÁΩÆÊåáÁ§∫„ÇíÈùûË°®Á§∫
                const ballInstruction = document.getElementById('ballPositionInstruction');
                if (ballInstruction) {
                    ballInstruction.style.display = 'none';
                }
                
                // Ë®∫Êñ≠ÈñãÂßã„Éï„É©„Ç∞„ÇíË®≠ÂÆö
                isDiagnosisStarted = true;
                
                // Google Analytics „Ç§„Éô„É≥„ÉàÈÄÅ‰ø°
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'diagnosis_start', {
                        'club_type': document.getElementById('clubSelect').value,
                        'view_type': viewType,
                        'event_category': 'engagement',
                        'event_label': 'Golf Address Diagnosis'
                    });
                }
                
                showLoading();
                
                // Êó¢„Å´„Éù„Éº„Ç∫„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÂàÜÊûê„ÅÆ„ÅøÂÆüË°å
                if (poseResults && poseResults.poseLandmarks) {
                    console.log('Êó¢Â≠ò„Éù„Éº„Ç∫„Éá„Éº„Çø„ÅßÂàÜÊûêÂÆüË°å');
                    analyzePosture();
                } else {
                    console.log('„Éù„Éº„Ç∫„Éá„Éº„Çø„Å™„Åó„ÄÅMediaPipeÂá¶ÁêÜ„Åã„ÇâÈñãÂßã');
                    processImage();
                }
            });
        });

        // „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢Èñ¢Êï∞
        function shareToTwitter() {
            const text = encodeURIComponent('üèåÔ∏è AI„Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπË®∫Êñ≠„ÉÑ„Éº„É´„ÅßÂßøÂã¢„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åó„ÅüÔºÅ\n\nÈáéÂ±±‰Ω≥Ê≤ª„Éó„É≠Áõ£‰øÆ„ÅÆÊú¨Ê†ºÁöÑ„Å™Ë®∫Êñ≠„ÅåÁÑ°Êñô„ÅßÂèó„Åë„Çâ„Çå„Åæ„Åô„ÄÇ\n\n#„Ç¥„É´„Éï #„Ç¢„Éâ„É¨„ÇπË®∫Êñ≠ #„Ç¥„É´„Éï‰∏äÈÅî #AIË®∫Êñ≠');
            const url = encodeURIComponent(window.location.href);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
            
            // Google Analytics „Ç§„Éô„É≥„Éà
            if (typeof gtag !== 'undefined') {
                gtag('event', 'social_share', {
                    'method': 'Twitter',
                    'event_category': 'engagement'
                });
            }
        }

        function shareToFacebook() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
            
            // Google Analytics „Ç§„Éô„É≥„Éà
            if (typeof gtag !== 'undefined') {
                gtag('event', 'social_share', {
                    'method': 'Facebook',
                    'event_category': 'engagement'
                });
            }
        }

        function shareToLine() {
            const text = encodeURIComponent('üèåÔ∏è AI„Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπË®∫Êñ≠„ÉÑ„Éº„É´„ÅßÂßøÂã¢„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Åæ„Åó„ÅüÔºÅ\n\nÈáéÂ±±‰Ω≥Ê≤ª„Éó„É≠Áõ£‰øÆ„ÅÆÊú¨Ê†ºÁöÑ„Å™Ë®∫Êñ≠„ÅåÁÑ°Êñô„ÅßÂèó„Åë„Çâ„Çå„Åæ„Åô„ÄÇ');
            const url = encodeURIComponent(window.location.href);
            window.open(`https://social-plugins.line.me/lineit/share?url=${url}&text=${text}`, '_blank');
            
            // Google Analytics „Ç§„Éô„É≥„Éà
            if (typeof gtag !== 'undefined') {
                gtag('event', 'social_share', {
                    'method': 'LINE',
                    'event_category': 'engagement'
                });
            }
        }

        function copyToClipboard() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                // „Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Çí‰∏ÄÊôÇÁöÑ„Å´Â§âÊõ¥
                const btn = event.target.closest('.copy-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = btn.innerHTML.replace('URL„Ç≥„Éî„Éº', '‚úÖ „Ç≥„Éî„ÉºÂÆå‰∫Ü');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            }).catch(() => {
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Çí‰ΩøÁî®
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const btn = event.target.closest('.copy-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = btn.innerHTML.replace('URL„Ç≥„Éî„Éº', '‚úÖ „Ç≥„Éî„ÉºÂÆå‰∫Ü');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
            
            // Google Analytics „Ç§„Éô„É≥„Éà
            if (typeof gtag !== 'undefined') {
                gtag('event', 'social_share', {
                    'method': 'Copy URL',
                    'event_category': 'engagement'
                });
            }
        }
    </script>
</body>
</html>