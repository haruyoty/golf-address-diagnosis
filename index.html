<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>„Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπË®∫Êñ≠„ÉÑ„Éº„É´ - AI & „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÁâà</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7QD0MNVWG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-J7QD0MNVWG');
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f0ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e6e6ff;
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .control-group select, .control-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .control-group select:focus, .control-group input:focus {
            border-color: #667eea;
            outline: none;
        }

        .analysis-container {
            display: grid;
            grid-template-columns: 1fr 1.4fr;
            gap: 25px;
            margin-bottom: 20px;
        }

        .image-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .image-container {
            position: relative;
            text-align: center;
            margin-bottom: 20px;
        }

        .image-container img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .image-container canvas {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px;
            cursor: crosshair;
        }

        .ball-position-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border: 3px solid #FF4500;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            box-shadow: 0 3px 12px rgba(255, 69, 0, 0.4);
            cursor: pointer;
            animation: ballPulse 1.5s ease-in-out infinite;
        }

        @keyframes ballPulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .ball-position-marker::after {
            content: 'üèåÔ∏è‚Äç‚ôÇÔ∏è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .click-instruction {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 15;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .ball-position-instruction {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 215, 0, 0.85);
            color: #333;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 10;
            border: 2px solid #FFD700;
            max-width: 150px;
            line-height: 1.2;
        }

        .score-feedback-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .score-feedback-item {
            background: linear-gradient(135deg, #f6f9fc 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .detailed-comparison {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid #fd7e14;
        }

        .comparison-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .comparison-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .comparison-label {
            font-weight: bold;
            color: #495057;
            flex: 0 0 25%;
        }

        .comparison-current {
            color: #dc3545;
            font-weight: bold;
            flex: 0 0 30%;
            text-align: center;
        }

        .comparison-ideal {
            color: #28a745;
            font-weight: bold;
            flex: 0 0 30%;
            text-align: center;
        }

        .comparison-gap {
            color: #fd7e14;
            font-weight: bold;
            flex: 0 0 15%;
            text-align: center;
            font-size: 0.9em;
        }

        .improvement-steps {
            background: #e8f4f8;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }

        .improvement-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .improvement-step:last-child {
            margin-bottom: 0;
        }

        .step-number {
            background: #17a2b8;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .visual-comparison {
            background: #f0f8ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid #007bff;
        }

        .before-after-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .comparison-side {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            position: relative;
        }

        .comparison-before {
            background: #fff2f2;
            border: 2px solid #dc3545;
        }

        .comparison-after {
            background: #f2fff2;
            border: 2px solid #28a745;
        }

        .comparison-label-visual {
            font-weight: bold;
            margin-bottom: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
            font-size: 0.9em;
        }

        .label-before {
            background: #dc3545;
            color: white;
        }

        .label-after {
            background: #28a745;
            color: white;
        }

        .angle-display {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .angle-before {
            color: #dc3545;
        }

        .angle-after {
            color: #28a745;
        }

        .visual-indicator {
            margin: 10px 0;
            height: 60px;
            position: relative;
            background: #f8f9fa;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .before-after-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .score-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .advice-text {
            color: #666;
            line-height: 1.6;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .score-label {
            color: #666;
            font-size: 0.9em;
        }

        .score-excellent { border-left-color: #28a745; }
        .score-good { border-left-color: #17a2b8; }
        .score-average { border-left-color: #ffc107; }
        .score-poor { border-left-color: #dc3545; }

        .score-excellent .score-value { color: #28a745; }
        .score-good .score-value { color: #17a2b8; }
        .score-average .score-value { color: #ffc107; }
        .score-poor .score-value { color: #dc3545; }

        .radar-container {
            position: relative;
            height: 800px; /* „Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„ÅßÊúÄÂ§ß„Çµ„Ç§„Ç∫ */
            margin: 20px 0;
            padding: 25px;
        }

        .feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .feedback h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .feedback-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .feedback-item h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .feedback-item p {
            color: #666;
            line-height: 1.5;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .social-btn {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .social-btn:active {
            transform: translateY(0);
        }

        /* „Çø„Éñ„É¨„ÉÉ„ÉàÁî® */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
            }
            
            .analysis-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
        }

        /* „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Áî® */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 1em;
            }

            .upload-area {
                padding: 30px 15px;
                border-width: 2px;
            }

            .upload-icon {
                font-size: 3em;
            }

            .upload-text {
                font-size: 1.1em;
            }

            /* „Éò„ÉÉ„ÉÄ„Éº„ÅÆÁõ£‰øÆËÄÖÊÉÖÂ†±„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            .header div[style*="display: flex"] {
                flex-direction: column !important;
                text-align: center !important;
                gap: 10px !important;
                padding: 12px !important;
            }

            .header div[style*="display: flex"] img {
                width: 60px !important;
                height: 60px !important;
            }

            .analysis-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .upload-section {
                padding: 15px;
            }

            .upload-area {
                padding: 30px 20px;
            }

            .upload-icon {
                font-size: 3em;
            }

            .upload-text {
                font-size: 16px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .control-group {
                flex-direction: column;
                gap: 8px;
                text-align: left;
            }

            .control-group label {
                font-size: 16px;
                font-weight: bold;
            }

            .control-group select,
            .control-group button {
                font-size: 16px;
                padding: 12px;
                min-height: 44px; /* „Çø„ÉÉ„ÉÅ„Çø„Éº„Ç≤„ÉÉ„Éà„Çµ„Ç§„Ç∫ */
            }

            .score-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .score-feedback-item {
                padding: 15px;
            }

            .score-title {
                font-size: 16px;
            }

            .score-value {
                font-size: 18px;
            }

            .advice-text {
                font-size: 16px; /* „Ç≥„É°„É≥„ÉàÊñáÂ≠ó„ÇíÂ§ß„Åç„Åè */
                line-height: 1.6;
            }

            /* „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            .radar-container {
                height: 700px !important; /* „Çπ„Éû„Éõ„ÅßÊúÄÂ§ß„Çµ„Ç§„Ç∫ */
                padding: 10px !important;
            }

            /* „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            #socialShare div[style*="display: flex"] {
                flex-direction: column !important;
                gap: 12px !important;
            }

            .social-btn {
                justify-content: center !important;
                padding: 14px 20px !important;
                font-size: 16px !important;
            }

            /* „É¨„ÉÉ„Çπ„É≥Ê°àÂÜÖ„Çí„É¢„Éê„Ç§„É´Âêë„Åë„Å´Ë™øÊï¥ */
            #lessonPromotion {
                padding: 20px 15px !important;
            }

            #lessonPromotion div[style*="display: flex"] {
                flex-direction: column !important;
                gap: 15px !important;
            }

            #lessonPromotion img {
                width: 70px !important;
                height: 70px !important;
            }

            #lessonPromotion h3 {
                font-size: 18px !important;
            }

            #lessonPromotion p {
                font-size: 14px !important;
            }

            /* „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÊåáÁ§∫„ÅÆ„É¢„Éê„Ç§„É´ÂØæÂøú */
            #ballPositionInstruction {
                font-size: 14px !important;
                padding: 8px 12px !important;
                top: 5px !important;
                right: 5px !important;
            }

            /* ÁîªÂÉè„Ç≥„É≥„ÉÜ„Éä„ÅÆ„É¢„Éê„Ç§„É´ÂØæÂøú */
            #imageContainer {
                margin: 15px 0;
            }

            #uploadedImage {
                max-height: 450px !important; /* „Çπ„Éû„Éõ„Åß„ÇÇ„Çà„ÇäÂ§ß„Åç„Åè */
            }
        }

        /* Â∞è„Åï„Å™„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Áî® */
        @media (max-width: 480px) {
            .radar-container {
                height: 600px !important; /* Â∞èÂûã„Çπ„Éû„Éõ„Åß„ÇÇÂ§ß„Åç„Åè */
            }
            .container {
                padding: 8px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .upload-area {
                padding: 25px 15px;
            }

            .upload-icon {
                font-size: 2.5em;
            }

            /* „Éú„Çø„É≥„ÅÆ„Çø„ÉÉ„ÉÅÂØæÂøú */
            .control-group select,
            .control-group button {
                min-height: 48px !important; /* „Çø„ÉÉ„ÉÅ„Åó„ÇÑ„Åô„ÅÑ„Çµ„Ç§„Ç∫ */
                font-size: 16px !important; /* „Ç∫„Éº„É†Èò≤Ê≠¢ */
                padding: 12px 15px !important;
            }

            .upload-text {
                font-size: 14px;
            }

            .control-group select,
            .control-group button {
                font-size: 14px;
                padding: 10px;
            }

            .score-feedback-item {
                padding: 12px;
            }

            .score-title {
                font-size: 14px;
            }

            .score-value {
                font-size: 16px;
            }

            .advice-text {
                font-size: 15px; /* Â∞èÂûã„Çπ„Éû„Éõ„Åß„ÇÇË™≠„Åø„ÇÑ„Åô„Åè */
            }

            #lessonPromotion {
                padding: 15px 10px !important;
            }

            #lessonPromotion h3 {
                font-size: 16px !important;
            }

            #lessonPromotion p {
                font-size: 13px !important;
            }

            #uploadedImage {
                max-height: 350px !important; /* Â∞èÂûã„Çπ„Éû„Éõ„Åß„ÇÇ„Çà„ÇäÂ§ß„Åç„Åè */
            }
        }

        /* „É©„É≥„Éâ„Çπ„Ç±„Éº„Éó„É¢„Éº„ÉâÂØæÂøú */
        @media (max-width: 768px) and (orientation: landscape) {
            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 0.9em;
            }

            #uploadedImage {
                max-height: 200px !important;
            }
            
            .radar-container {
                height: 500px !important; /* „É©„É≥„Éâ„Çπ„Ç±„Éº„Éó„Åß„ÇÇÂ§ß„Åç„Åè */
            }
        }
        
        /* „É¢„Éê„Ç§„É´Â∞ÇÁî®„É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàË™øÊï¥ */
        @media (max-width: 768px) {
            .radar-container canvas {
                max-width: 100% !important;
                max-height: 650px !important; /* „Ç≠„É£„É≥„Éê„ÇπÊúÄÂ§ß„Çµ„Ç§„Ç∫ */
            }
            
            /* „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„Åß„ÇÇÊñáÂ≠ó„ÅåË¶ã„Åà„Çã„Çà„ÅÜ„Å´‰ΩôÁôΩ„ÇíÁ¢∫‰øù */
            .radar-container {
                margin: 10px 0 !important;
                padding: 5px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèåÔ∏è „Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπË®∫Êñ≠„ÉÑ„Éº„É´</h1>
            <p>AIÊê≠Ëºâ - MediaPipe & „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÂàÜÊûêÁâà</p>
            <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 2px solid #ddd; display: flex; align-items: center; gap: 15px;">
                <a href="https://noyamagolf.com/" target="_blank" style="display: block; flex-shrink: 0;">
                    <img src="noyama-keiji.png" alt="ÈáéÂ±±‰Ω≥Ê≤ª" style="width: 70px; height: 70px; border-radius: 50%; border: 3px solid #007bff; object-fit: cover; cursor: pointer; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="width: 70px; height: 70px; border-radius: 50%; border: 3px solid #007bff; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: none; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px; cursor: pointer; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">ÈáéÂ±±</div>
                </a>
                <div style="flex: 1; color: #333;">
                    <h3 style="margin: 0 0 5px 0; font-size: 16px; font-weight: bold; color: #007bff;">
                        „ÉÜ„Ç£„Éº„ÉÅ„É≥„Ç∞„Éó„É≠ÈáéÂ±±‰Ω≥Ê≤ªÁõ£‰øÆ
                    </h3>
                    <p style="margin: 0; font-size: 14px; color: #666;">
                        <a href="https://noyamagolf.com/" target="_blank" style="color: #007bff; text-decoration: none; font-weight: 500;">
                            üåê https://noyamagolf.com/
                        </a>
                    </p>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                <div class="upload-icon">üì∏</div>
                <div class="upload-text">„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</div>
                <p>JPG, PNG, GIFÂΩ¢Âºè„Å´ÂØæÂøú</p>
                
                <!-- „É¢„Éê„Ç§„É´Áî®Ôºö„Ç´„É°„É©„Å®„ÇÆ„É£„É©„É™„Éº„ÅÆÈÅ∏Êäû„Éú„Çø„É≥ -->
                <div id="mobileButtons" style="display: none; gap: 10px; margin-top: 15px;">
                    <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
                    <input type="file" id="galleryInput" accept="image/*" style="display: none;">
                    <button type="button" onclick="document.getElementById('cameraInput').click()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 14px; cursor: pointer;">üì∑ „Ç´„É°„É©</button>
                    <button type="button" onclick="document.getElementById('galleryInput').click()" style="padding: 10px 20px; background: #764ba2; color: white; border: none; border-radius: 5px; font-size: 14px; cursor: pointer;">üñºÔ∏è „ÇÆ„É£„É©„É™„Éº</button>
                </div>
            </div>
            <input type="file" id="imageInput" class="file-input" accept="image/*">
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="viewSelect">ÊíÆÂΩ±Ë¶ñÁÇπ:</label>
                <select id="viewSelect">
                    <option value="front">Ê≠£Èù¢</option>
                    <option value="back">ÂæåÊñπ</option>
                </select>
            </div>
            <div class="control-group">
                <label for="clubSelect">„ÇØ„É©„ÉñÈÅ∏Êäû:</label>
                <select id="clubSelect">
                    <option value="Driver">„Éâ„É©„Ç§„Éê„Éº</option>
                    <option value="FairwayWood">„Éï„Çß„Ç¢„Ç¶„Çß„Ç§„Ç¶„ÉÉ„Éâ</option>
                    <option value="Utility">„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£„Éº</option>
                    <option value="3Iron">3Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="4Iron">4Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="5Iron">5Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="6Iron">6Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="7Iron" selected>7Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="8Iron">8Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="9Iron">9Áï™„Ç¢„Ç§„Ç¢„É≥</option>
                    <option value="Wedge">„Ç¶„Ç®„ÉÉ„Ç∏</option>
                </select>
            </div>
            <div class="control-group">
                <button id="startDiagnosis" class="btn">üîç Ë®∫Êñ≠ÈñãÂßã</button>
            </div>
        </div>

        <div id="analysisResults" class="hidden">
            <div class="analysis-container">
                <div class="image-section">
                    <h3>üìä ÂßøÂã¢ÂàÜÊûêÁµêÊûú</h3>
                    <div class="image-container" id="imageContainer">
                        <img id="uploadedImage" alt="„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÁîªÂÉè">
                        <canvas id="poseCanvas"></canvas>
                        <div class="click-instruction" id="clickInstruction">‚ö†Ô∏è Ê≠£Èù¢ÊíÆÂΩ±ÊôÇÔºö‰∏äÊâã„ÅèÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Å®„Åç„Å´„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                        <div class="ball-position-instruction" id="ballPositionInstruction">
                            üèåÔ∏è‚Äç‚ôÇÔ∏è „Ç¥„É´„Éï„Éú„Éº„É´‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ<br>
                            <small>Ê≠£Èù¢ÊíÆÂΩ±„Åß„ÅØÂøÖÈ†à„Åß„Åô</small>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>üìà „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà</h3>
                    <div class="radar-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="score-feedback-grid" id="scoreFeedbackGrid">
                <!-- „Çπ„Ç≥„Ç¢„Å®„Ç¢„Éâ„Éê„Ç§„Çπ„ÇíÁµ±ÂêàË°®Á§∫ -->
            </div>
            
            <!-- „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Éú„Çø„É≥ -->
            <div id="socialShare" class="hidden" style="margin-top: 20px; padding: 20px; background: white; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 15px; color: #333; font-size: 18px;">üì± Ë®∫Êñ≠ÁµêÊûú„Çí„Ç∑„Çß„Ç¢„Åó„Çà„ÅÜÔºÅ</h3>
                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <button onclick="shareToTwitter()" class="social-btn twitter-btn" style="background: #1DA1F2; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                        </svg>
                        Twitter
                    </button>
                    
                    <button onclick="shareToFacebook()" class="social-btn facebook-btn" style="background: #4267B2; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        Facebook
                    </button>
                    
                    <button onclick="shareToLine()" class="social-btn line-btn" style="background: #00B900; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.629 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.070 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                        </svg>
                        LINE
                    </button>
                    
                    <button onclick="copyToClipboard()" class="social-btn copy-btn" style="background: #6c757d; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-size: 14px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: transform 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        URL„Ç≥„Éî„Éº
                    </button>
                </div>
            </div>

            <!-- Ë®∫Êñ≠ÁµêÊûúÂæå„ÅÆ„É¨„ÉÉ„Çπ„É≥Ê°àÂÜÖ -->
            <div id="lessonPromotion" class="hidden" style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 15px; text-align: center; box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);">
                <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <a href="https://noyamagolf.com/" target="_blank" style="display: block;">
                        <img src="noyama-keiji.png" alt="ÈáéÂ±±‰Ω≥Ê≤ª" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid white; object-fit: cover; cursor: pointer; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid white; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: none; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 20px; cursor: pointer; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">ÈáéÂ±±</div>
                    </a>
                    <div style="color: white; text-align: left; flex: 1; min-width: 250px;">
                        <h3 style="margin: 0 0 8px 0; font-size: 20px; font-weight: bold;">
                            üèåÔ∏è Ë®∫Êñ≠ÁµêÊûú„Çí„ÇÇ„Å®„Å´„ÄÅ„Åï„Çâ„Å™„Çã‰∏äÈÅî„ÇíÁõÆÊåá„Åó„Åæ„Åõ„Çì„ÅãÔºü
                        </h3>
                        <p style="margin: 0 0 12px 0; font-size: 16px; line-height: 1.4;">
                            „Éó„É≠„ÅåÊïô„Åà„ÇãÂÆüË∑µÁöÑ„Å™„É¨„ÉÉ„Çπ„É≥„Åß„ÄÅÁêÜÊÉ≥„ÅÆ„Çπ„Ç§„É≥„Ç∞„ÇíË∫´„Å´„Å§„Åë„Åæ„Åó„Çá„ÅÜ
                        </p>
                        <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: flex-start; margin-bottom: 12px;">
                            <a href="https://noyamagolf.com/%e3%83%a9%e3%82%a6%e3%83%b3%e3%83%89%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" style="text-decoration: none;">
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px; color: white; border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                                    üèåÔ∏è „É©„Ç¶„É≥„Éâ„É¨„ÉÉ„Çπ„É≥
                                </div>
                            </a>
                            <a href="https://noyamagolf.com/%e3%82%aa%e3%83%b3%e3%83%a9%e3%82%a4%e3%83%b3%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" style="text-decoration: none;">
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px; color: white; border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                                    üíª „Ç™„É≥„É©„Ç§„É≥„É¨„ÉÉ„Çπ„É≥
                                </div>
                            </a>
                            <a href="https://noyamagolf.com/%e3%82%b9%e3%82%bf%e3%82%b8%e3%82%aa%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" style="text-decoration: none;">
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px; color: white; border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.05)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'">
                                    üë®‚Äçüè´ „Éû„É≥„ÉÑ„Éº„Éû„É≥„É¨„ÉÉ„Çπ„É≥
                                </div>
                            </a>
                        </div>
                        <p style="margin: 0; font-size: 16px;">
                            <a href="https://noyamagolf.com/" target="_blank" style="color: #FFD700; text-decoration: underline; font-weight: bold; font-size: 18px;">ÈáéÂ±±‰Ω≥Ê≤ª„ÅÆ„Ç¥„É´„Éï„É¨„ÉÉ„Çπ„É≥</a> „ÅßË©≥Á¥∞„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ
                        </p>
                    </div>
                    <div style="color: white; font-size: 40px;">‚õ≥</div>
                </div>
            </div>
        </div>

        <div id="loadingSection" class="loading hidden">
            <div class="loading-spinner"></div>
            <p>AIÂàÜÊûê‰∏≠...</p>
        </div>
    </div>

    <script>
        let pose;
        let camera;
        let poseResults;
        let uploadedImageElement;
        let radarChartInstance;
        let userClickedBallPosition = null;
        let isBallPositionClickEnabled = false;
        let isDiagnosisStarted = false; // Ë®∫Êñ≠ÈñãÂßã„Éï„É©„Ç∞

        // MediaPipe PoseÂàùÊúüÂåñ
        function initMediaPipe() {
            try {
                if (typeof Pose === 'undefined') {
                    console.error('MediaPipe Pose„É©„Ç§„Éñ„É©„É™„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    alert('MediaPipe„É©„Ç§„Éñ„É©„É™„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                pose = new Pose({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                    }
                });

                // „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„ÇπÊ§úÂá∫
                const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                console.log('„Éá„Éê„Ç§„ÇπÊ§úÂá∫:', isMobile ? '„É¢„Éê„Ç§„É´' : 'PC');
                
                pose.setOptions({
                    modelComplexity: 0, // ÂÖ®„Éá„Éê„Ç§„Çπ„ÅßËªΩÈáè„É¢„Éº„Éâ
                    smoothLandmarks: false, // „Çπ„É†„Éº„Ç∏„É≥„Ç∞ÁÑ°Âäπ„ÅßÈ´òÈÄüÂåñ
                    enableSegmentation: false,
                    smoothSegmentation: false, // „Çπ„É†„Éº„Ç∏„É≥„Ç∞ÁÑ°Âäπ„ÅßÈ´òÈÄüÂåñ
                    minDetectionConfidence: isMobile ? 0.5 : 0.7, // „É¢„Éê„Ç§„É´„Åß„ÅØÈÅ©Â∫¶„Å™ÈñæÂÄ§
                    minTrackingConfidence: isMobile ? 0.5 : 0.7, // „É¢„Éê„Ç§„É´„Åß„ÅØÈÅ©Â∫¶„Å™ÈñæÂÄ§
                    staticImageMode: true // ÈùôÁöÑÁîªÂÉè„É¢„Éº„Éâ
                });
                console.log('MediaPipeË®≠ÂÆöÂÆå‰∫Ü');

                pose.onResults(onPoseResults);
                console.log('MediaPipeÂàùÊúüÂåñÂÆå‰∫Ü');
            } catch (error) {
                console.error('MediaPipeÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                alert('MediaPipe„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÇíÊõ¥Êñ∞„Åó„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }

        // PoseÁµêÊûúÂá¶ÁêÜ
        function onPoseResults(results) {
            console.log('MediaPipeÁµêÊûúÂèó‰ø°:', results);
            poseResults = results;
            
            // ÂøÖ„ÅöÊèèÁîª„ÇíÂÆüË°å
            if (uploadedImageElement) {
                console.log('ÊèèÁîª„ÇíÂÆüË°å„Åó„Åæ„Åô');
                drawPoseOverlay();
            }
            
            // ÂàÜÊûê„ÅØË®∫Êñ≠„Éú„Çø„É≥„ÅåÊäº„Åï„Çå„ÅüÊôÇ„ÅÆ„ÅøÂÆüË°å
            // analyzePosture();
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ
        const uploadArea = document.querySelector('.upload-area');
        const fileInput = document.getElementById('imageInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
            }
        });

        // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂá¶ÁêÜ
        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // Google Analytics „Ç§„Éô„É≥„ÉàÈÄÅ‰ø°
            if (typeof gtag !== 'undefined') {
                gtag('event', 'image_upload', {
                    'event_category': 'engagement',
                    'event_label': 'Golf Photo Upload'
                });
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('uploadedImage');
                img.src = e.target.result;
                img.onload = function() {
                    uploadedImageElement = img;
                    userClickedBallPosition = null; // „Éú„Éº„É´‰ΩçÁΩÆ„Çí„É™„Çª„ÉÉ„Éà
                    isDiagnosisStarted = false; // Ë®∫Êñ≠„Éï„É©„Ç∞„Çí„É™„Çª„ÉÉ„Éà
                    
                    // „Ç≠„É£„É≥„Éê„Çπ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÁîªÂÉè„Å´Âêà„Çè„Åõ„Å¶Ë®≠ÂÆö
                    const canvas = document.getElementById('poseCanvas');
                    
                    // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâÁîªÂÉè„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
                    setTimeout(() => {
                        const imgRect = img.getBoundingClientRect();
                        const containerRect = img.parentElement.getBoundingClientRect();
                        
                        // ÁîªÂÉè„ÅÆÂÆüÈöõ„ÅÆË°®Á§∫„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
                        const displayWidth = img.clientWidth;
                        const displayHeight = img.clientHeight;
                        
                        // „Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„ÇíÊ≠£Á¢∫„Å´Ë®≠ÂÆö
                        canvas.width = displayWidth;
                        canvas.height = displayHeight;
                        canvas.style.width = displayWidth + 'px';
                        canvas.style.height = displayHeight + 'px';
                        
                        // „Ç≠„É£„É≥„Éê„Çπ„ÇíÁîªÂÉè„Å®ÂÆåÂÖ®„Å´Èáç„Å≠„Çã
                        canvas.style.position = 'absolute';
                        canvas.style.top = img.offsetTop + 'px';
                        canvas.style.left = img.offsetLeft + 'px';
                        canvas.style.transform = 'none';
                        canvas.style.display = 'block';
                        canvas.style.pointerEvents = 'auto';
                        
                        console.log('„Ç≠„É£„É≥„Éê„ÇπÊúÄÁµÇË®≠ÂÆö:', canvas.width, 'x', canvas.height);
                        console.log('ÁîªÂÉè‰ΩçÁΩÆ:', img.offsetTop, img.offsetLeft);
                    }, 150);
                    
                    console.log('ÁîªÂÉè„É≠„Éº„ÉâÂÆå‰∫Ü:', img.width, 'x', img.height);
                    console.log('„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫:', canvas.width, 'x', canvas.height);
                    
                    // ÂàÜÊûêÁµêÊûú„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                    document.getElementById('analysisResults').classList.remove('hidden');
                    
                    // ÁîªÂÉè„ÇíÁ¢∫ÂÆü„Å´Ë°®Á§∫
                    img.style.display = 'block';
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '400px';
                    img.style.borderRadius = '10px';
                    
                    setupBallPositionClick();
                    updateDiagnosisButtonState(); // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                    
                    // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂæå„Å´Ëá™Âãï„ÅßMediaPipeÂá¶ÁêÜ„ÇíÂÆüË°åÔºà„Éù„Éº„Ç∫Ê§úÂá∫„ÅÆ„ÅøÔºâ
                    setTimeout(() => {
                        if (pose && uploadedImageElement) {
                            console.log('Ëá™ÂãïMediaPipeÂá¶ÁêÜÈñãÂßã');
                            pose.send({image: uploadedImageElement});
                        }
                    }, 800); // „Ç≠„É£„É≥„Éê„ÇπË®≠ÂÆöÂæå„Å´ÂÆüË°å
                };
            };
            reader.readAsDataURL(file);
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÅÆË®≠ÂÆöÔºàÂº∑ÂåñÁâàÔºâ
        function setupBallPositionClick() {
            const viewType = document.getElementById('viewSelect').value;
            const canvas = document.getElementById('poseCanvas');
            const container = document.getElementById('imageContainer');
            const instruction = document.getElementById('clickInstruction');
            const ballInstruction = document.getElementById('ballPositionInstruction');
            
            if (viewType === 'front') {
                isBallPositionClickEnabled = true;
                canvas.style.pointerEvents = 'auto';
                canvas.style.cursor = 'crosshair';
                
                // ÊåáÁ§∫„ÇíË°®Á§∫ÔºàÁ∞°ÊΩî„Å´Ôºâ
                instruction.style.display = 'block';
                ballInstruction.style.display = 'block';
                ballInstruction.innerHTML = 'üèåÔ∏è‚Äç‚ôÇÔ∏è „Ç¥„É´„Éï„Éú„Éº„É´<br>„ÇØ„É™„ÉÉ„ÇØ';
                ballInstruction.style.backgroundColor = 'rgba(255, 215, 0, 0.85)';
                ballInstruction.style.borderColor = '#FFD700';
                
                // „ÇØ„É™„ÉÉ„ÇØ„Éª„Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
                canvas.removeEventListener('click', handleBallPositionClick); // ÈáçË§áÈò≤Ê≠¢
                canvas.removeEventListener('touchstart', handleBallPositionClick); // ÈáçË§áÈò≤Ê≠¢
                canvas.addEventListener('click', handleBallPositionClick);
                canvas.addEventListener('touchstart', handleBallPositionClick, { passive: false });
                
                // „Éû„Ç¶„Çπ„Éõ„Éê„ÉºÂäπÊûú
                canvas.addEventListener('mouseenter', () => {
                    ballInstruction.style.backgroundColor = 'rgba(255, 215, 0, 1)';
                    ballInstruction.style.transform = 'translateX(-50%) scale(1.05)';
                });
                
                canvas.addEventListener('mouseleave', () => {
                    ballInstruction.style.backgroundColor = 'rgba(255, 215, 0, 0.9)';
                    ballInstruction.style.transform = 'translateX(-50%) scale(1)';
                });
                
                // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                updateDiagnosisButtonState();
                
                // 7ÁßíÂæå„Å´‰∏äÈÉ®ÊåáÁ§∫„ÇíÈùûË°®Á§∫
                setTimeout(() => {
                    instruction.style.display = 'none';
                }, 7000);
            } else {
                isBallPositionClickEnabled = false;
                canvas.style.pointerEvents = 'none';
                canvas.style.cursor = 'default';
                instruction.style.display = 'none';
                ballInstruction.style.display = 'none';
                canvas.removeEventListener('click', handleBallPositionClick);
                
                // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                updateDiagnosisButtonState();
            }
        }

        // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateDiagnosisButtonState() {
            const diagnosisBtn = document.getElementById('startDiagnosis');
            const viewType = document.getElementById('viewSelect').value;
            
            if (viewType === 'front') {
                if (userClickedBallPosition) {
                    // „Éú„Éº„É´‰ΩçÁΩÆ„ÅåË®≠ÂÆöÊ∏à„Åø - „Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
                    diagnosisBtn.disabled = false;
                    diagnosisBtn.textContent = 'üîç Ë®∫Êñ≠ÈñãÂßã';
                    diagnosisBtn.style.opacity = '1';
                    diagnosisBtn.style.cursor = 'pointer';
                } else {
                    // „Éú„Éº„É´‰ΩçÁΩÆ„ÅåÊú™Ë®≠ÂÆö - „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
                    diagnosisBtn.disabled = true;
                    diagnosisBtn.textContent = 'üèåÔ∏è‚Äç‚ôÇÔ∏è „Ç¥„É´„Éï„Éú„Éº„É´‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    diagnosisBtn.style.opacity = '0.6';
                    diagnosisBtn.style.cursor = 'not-allowed';
                }
            } else {
                // ÂæåÊñπË¶ñÁÇπ„Åß„ÅØÈÄöÂ∏∏ÈÄö„ÇäÊúâÂäπ
                diagnosisBtn.disabled = false;
                diagnosisBtn.textContent = 'üîç Ë®∫Êñ≠ÈñãÂßã';
                diagnosisBtn.style.opacity = '1';
                diagnosisBtn.style.cursor = 'pointer';
            }
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜÔºàÂº∑ÂåñÁâàÔºâ
        function handleBallPositionClick(event) {
            if (!isBallPositionClickEnabled) return;
            
            // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà„ÅÆÂ†¥Âêà„ÄÅ„Éá„Éï„Ç©„É´„ÉàÂãï‰Ωú„ÇíÈò≤Ê≠¢
            if (event.type === 'touchstart') {
                event.preventDefault();
            }
            
            const canvas = document.getElementById('poseCanvas');
            const rect = canvas.getBoundingClientRect();
            
            // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà„Å®„Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà„ÅÆÂ∫ßÊ®ôÂèñÂæó„ÇíÁµ±‰∏Ä
            let clientX, clientY;
            if (event.type === 'touchstart' && event.touches.length > 0) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }
            
            const x = clientX - rect.left;
            const y = clientY - rect.top;
            
            // Ë°®Á§∫„Çµ„Ç§„Ç∫„ÇíÂèñÂæóÔºàCSS„Çµ„Ç§„Ç∫Ôºâ
            const displayWidth = rect.width;
            const displayHeight = rect.height;
            
            // „Ç≠„É£„É≥„Éê„ÇπÂ∫ßÊ®ô„ÇíÊ≠£Ë¶èÂåñÔºà0-1„ÅÆÁØÑÂõ≤Ôºâ
            const normalizedX = x / displayWidth;
            const normalizedY = y / displayHeight;
            
            userClickedBallPosition = { x: normalizedX, y: normalizedY };
            
            // „Éú„Éº„É´‰ΩçÁΩÆ„Éû„Éº„Ç´„Éº„ÇíË°®Á§∫
            showBallPositionMarker(x, y);
            
            // ÊåáÁ§∫„ÇíÊõ¥Êñ∞
            const ballInstruction = document.getElementById('ballPositionInstruction');
            ballInstruction.innerHTML = '‚úÖ „Éú„Éº„É´‰ΩçÁΩÆ„ÅåË®≠ÂÆö„Åï„Çå„Åæ„Åó„ÅüÔºÅ<br><small>Ë®∫Êñ≠ÈñãÂßã„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ</small>';
            ballInstruction.style.backgroundColor = 'rgba(40, 167, 69, 0.9)';
            ballInstruction.style.borderColor = '#28a745';
            
            // Ë®∫Êñ≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            updateDiagnosisButtonState();
            
            // Ë®∫Êñ≠ÈñãÂßã„Åæ„ÅßË°®Á§∫„ÅóÁ∂ö„Åë„ÇãÔºà„Çø„Ç§„Éû„ÉºÂâäÈô§Ôºâ
            // setTimeout(() => {
            //     ballInstruction.style.display = 'none';
            // }, 5000);
            
            console.log('„Éú„Éº„É´‰ΩçÁΩÆ„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü:', userClickedBallPosition);
            console.log('„ÇØ„É™„ÉÉ„ÇØÂ∫ßÊ®ô:', x, y, '„Ç≠„É£„É≥„Éê„ÇπË°®Á§∫„Çµ„Ç§„Ç∫:', displayWidth, displayHeight);
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„Éû„Éº„Ç´„ÉºË°®Á§∫
        function showBallPositionMarker(x, y) {
            const container = document.getElementById('imageContainer');
            
            // Êó¢Â≠ò„ÅÆ„Éû„Éº„Ç´„Éº„ÇíÂâäÈô§
            const existingMarker = container.querySelector('.ball-position-marker');
            if (existingMarker) {
                existingMarker.remove();
            }
            
            // Êñ∞„Åó„ÅÑ„Éû„Éº„Ç´„Éº„Çí‰ΩúÊàê
            const marker = document.createElement('div');
            marker.className = 'ball-position-marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            
            container.appendChild(marker);
        }

        // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
        function showLoading() {
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('analysisResults').classList.add('hidden');
        }

        // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÈùûË°®Á§∫
        function hideLoading() {
            document.getElementById('loadingSection').classList.add('hidden');
            document.getElementById('analysisResults').classList.remove('hidden');
            // Ë®∫Êñ≠ÁµêÊûúÂæå„ÅÆ„É¨„ÉÉ„Çπ„É≥Ê°àÂÜÖ„ÇíË°®Á§∫
            document.getElementById('lessonPromotion').classList.remove('hidden');
            
            // „ÇΩ„Éº„Ç∑„É£„É´„Ç∑„Çß„Ç¢„Éú„Çø„É≥„ÇíË°®Á§∫
            document.getElementById('socialShare').classList.remove('hidden');
        }

        // ÁîªÂÉèÂá¶ÁêÜ
        async function processImage() {
            if (!uploadedImageElement) {
                console.error('„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÁîªÂÉè„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            if (!pose) {
                console.error('MediaPipe„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                alert('MediaPipe„ÅÆÂàùÊúüÂåñ„ÅåÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            console.log('MediaPipeÂá¶ÁêÜÈñãÂßã...');
            
            // „Ç≠„É£„É≥„Éê„Çπ„ÇíÊ∫ñÂÇô
            const canvas = document.getElementById('poseCanvas');
            if (!canvas) {
                console.error('poseCanvas„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            canvas.width = uploadedImageElement.clientWidth || uploadedImageElement.width;
            canvas.height = uploadedImageElement.clientHeight || uploadedImageElement.height;
            
            // MediaPipe„Åß„Éù„Éº„Ç∫Ê§úÂá∫Ôºà„Çø„Ç§„É†„Ç¢„Ç¶„Éà‰ªò„ÅçÔºâ
            try {
                showLoading(); // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
                console.log('MediaPipeÂá¶ÁêÜÈñãÂßã - ÁîªÂÉè„Çµ„Ç§„Ç∫:', uploadedImageElement.width, 'x', uploadedImageElement.height);
                
                // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàË®≠ÂÆöÔºà„Çπ„Éû„Éõ„Åß„ÅØÁü≠„ÇÅ„Å´Ôºâ
                const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const timeout = isMobile ? 8000 : 5000; // „É¢„Éê„Ç§„É´„ÅØ8Áßí„ÄÅPC„ÅØ5Áßí
                
                let processCompleted = false;
                
                // „Çø„Ç§„É†„Ç¢„Ç¶„Éà„Éè„É≥„Éâ„É©„Éº
                const timeoutHandler = setTimeout(() => {
                    if (!processCompleted) {
                        console.warn('MediaPipeÂá¶ÁêÜ„Çø„Ç§„É†„Ç¢„Ç¶„Éà - „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà');
                        hideLoading();
                        showFallbackMode();
                    }
                }, timeout);
                
                // MediaPipeÈÄÅ‰ø°
                await pose.send({image: uploadedImageElement});
                console.log('MediaPipeÈÄÅ‰ø°ÂÆå‰∫Ü');
                
                // ÁµêÊûú„ÉÅ„Çß„ÉÉ„ÇØÔºàÁü≠ÊôÇÈñì„ÅßË§áÊï∞ÂõûÔºâ
                let checkCount = 0;
                const maxChecks = isMobile ? 8 : 5;
                const checkInterval = 1000;
                
                const resultChecker = setInterval(() => {
                    checkCount++;
                    console.log(`ÁµêÊûú„ÉÅ„Çß„ÉÉ„ÇØ ${checkCount}/${maxChecks}`, poseResults ? '„Éá„Éº„Çø„ÅÇ„Çä' : '„Éá„Éº„Çø„Å™„Åó');
                    
                    if (poseResults && poseResults.poseLandmarks) {
                        // ÊàêÂäüÔºö„Éù„Éº„Ç∫„Éá„Éº„ÇøÂèñÂæó
                        clearInterval(resultChecker);
                        clearTimeout(timeoutHandler);
                        processCompleted = true;
                        hideLoading();
                        console.log('„Éù„Éº„Ç∫„Éá„Éº„ÇøÂèñÂæóÊàêÂäü:', poseResults.poseLandmarks.length, '„É©„É≥„Éâ„Éû„Éº„ÇØ');
                        drawPoseOverlay();
                        analyzePosture();
                    } else if (checkCount >= maxChecks) {
                        // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÔºö„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„É¢„Éº„Éâ
                        clearInterval(resultChecker);
                        clearTimeout(timeoutHandler);
                        processCompleted = true;
                        hideLoading();
                        console.log('ÊúÄÂ§ß„ÉÅ„Çß„ÉÉ„ÇØÂõûÊï∞Âà∞ÈÅî - „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„É¢„Éº„Éâ');
                        showFallbackMode();
                    }
                }, checkInterval);
                
            } catch (error) {
                hideLoading();
                console.error('MediaPipeÂá¶ÁêÜ„Ç®„É©„Éº:', error);
                showFallbackMode();
            }
        }

        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„É¢„Éº„ÉâÔºàMediaPipe„Å™„Åó„Åß„ÇÇË®∫Êñ≠ÂèØËÉΩÔºâ
        function showFallbackMode() {
            const canvas = document.getElementById('poseCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØË°®Á§∫
            ctx.fillStyle = 'rgba(0, 150, 255, 0.8)';
            ctx.fillRect(10, 10, canvas.width - 20, 80);
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('üì∑ ÊâãÂãïË®∫Êñ≠„É¢„Éº„Éâ', 20, 35);
            ctx.font = '14px Arial';
            ctx.fillText('„Éú„Éº„É´‰ΩçÁΩÆ„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë®∫Êñ≠„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 20, 55);
            ctx.fillText('ÔºàAIËá™ÂãïÊ§úÂá∫„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åó„ÅüÔºâ', 20, 75);
            
            // ÊâãÂãï„Éú„Éº„É´‰ΩçÁΩÆÈÅ∏Êäû„ÇíÊúâÂäπÂåñ
            setTimeout(() => {
                enableManualBallPositioning();
            }, 1500);
        }
        
        // ÊâãÂãï„Éú„Éº„É´‰ΩçÁΩÆÈÅ∏Êäû„ÇíÊúâÂäπÂåñ
        function enableManualBallPositioning() {
            isBallPositionClickEnabled = true;
            const canvas = document.getElementById('poseCanvas');
            canvas.style.cursor = 'crosshair';
            
            // ÊåáÁ§∫„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊõ¥Êñ∞
            showBallPositionClickInstruction();
            updateDiagnosisButtonState();
            
            console.log('ÊâãÂãï„Éú„Éº„É´‰ΩçÁΩÆÈÅ∏Êäû„É¢„Éº„ÉâÊúâÂäπÂåñ');
        }

        // „Éù„Éº„Ç∫„Ç™„Éº„Éê„Éº„É¨„Ç§ÊèèÁîªÔºàÂº∑Âà∂Ë°®Á§∫Ôºâ
        function drawPoseOverlay() {
            const canvas = document.getElementById('poseCanvas');
            const ctx = canvas.getContext('2d');
            const img = uploadedImageElement;

            if (!canvas || !ctx || !img) {
                console.log('ÊèèÁîªË¶ÅÁ¥†„Åå‰∏çË∂≥:', {canvas: !!canvas, ctx: !!ctx, img: !!img});
                return;
            }

            // Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÁîªÂÉè„ÅÆÂÆüÈöõ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
            const displayedWidth = img.clientWidth || img.offsetWidth;
            const displayedHeight = img.clientHeight || img.offsetHeight;
            
            // ÂÖÉÁîªÂÉè„ÅÆÂÆüÈöõ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
            const originalWidth = img.naturalWidth || img.width;
            const originalHeight = img.naturalHeight || img.height;
            
            // „Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„ÇíË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÁîªÂÉè„Çµ„Ç§„Ç∫„Å´Âêà„Çè„Åõ„Çã
            canvas.width = displayedWidth;
            canvas.height = displayedHeight;
            canvas.style.width = displayedWidth + 'px';
            canvas.style.height = displayedHeight + 'px';

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            console.log('ÊèèÁîªÈñãÂßã - Ë°®Á§∫„Çµ„Ç§„Ç∫:', displayedWidth, 'x', displayedHeight);
            console.log('ÂÖÉÁîªÂÉè„Çµ„Ç§„Ç∫:', originalWidth, 'x', originalHeight);

            if (poseResults && poseResults.poseLandmarks && poseResults.poseLandmarks.length > 0) {
                console.log('MediaPipe landmarks detected:', poseResults.poseLandmarks.length);
                
                // „Çπ„Ç±„Éº„É´ÊØîÁéá„ÇíË®àÁÆóÔºàMediaPipe„ÅÆÂ∫ßÊ®ô„ÅØ0-1„ÅÆÁØÑÂõ≤Ôºâ
                const scaleX = displayedWidth;
                const scaleY = displayedHeight;
                
                // Êé•Á∂öÁ∑ö„ÇíÂÖà„Å´ÊèèÁîªÔºàËÉåÊôØÔºâ
                drawConnections(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                
                // „É©„É≥„Éâ„Éû„Éº„ÇØ„Çí‰∏ä„Å´ÊèèÁîªÔºàÂâçÊôØÔºâ
                drawLandmarks(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                
                // „Éú„Éº„É´‰ΩçÁΩÆ„Å®ÁêÜÊÉ≥‰ΩçÁΩÆ„ÇíÊèèÁîªÔºàÊ≠£Èù¢„Åã„Çâ„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÊ§úÂá∫„ÇíË©¶Ë°åÔºâ
                const viewType = document.getElementById('viewSelect').value;
                if (viewType === 'front') {
                    tryAutomaticBallDetection(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                } else {
                    drawBallPosition(ctx, poseResults.poseLandmarks, scaleX, scaleY);
                }
            } else {
                console.log('No pose landmarks detected or empty result');
                // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊ§úÂá∫„Åï„Çå„Å™„ÅÑÂ†¥Âêà„Åß„ÇÇ‰Ωï„Åã„ÇíÊèèÁîª
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                ctx.fillRect(10, 10, 200, 30);
                ctx.fillStyle = '#000';
                ctx.font = '14px Arial';
                ctx.fillText('MediaPipe: „Éù„Éº„Ç∫Ê§úÂá∫‰∏≠...', 15, 30);
            }
        }

        // Ëá™Âãï„Éú„Éº„É´‰ΩçÁΩÆÊ§úÂá∫„ÇíË©¶Ë°å
        function tryAutomaticBallDetection(ctx, landmarks, width, height) {
            const clubType = document.getElementById('clubSelect').value;
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            
            if (!leftAnkle || !rightAnkle || !leftWrist || !rightWrist) {
                // ÂøÖË¶Å„Å™„É©„É≥„Éâ„Éû„Éº„ÇØ„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÊâãÂãïÈÅ∏Êäû„Å´Âàá„ÇäÊõø„Åà
                showBallPositionClickInstruction();
                return;
            }
            
            // Êâã„ÅÆ‰ΩçÁΩÆ„Åã„ÇâËá™Âãï„Åß„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊé®ÂÆö
            const handCenter = (leftWrist.x + rightWrist.x) / 2;
            const footY = Math.max(leftAnkle.y, rightAnkle.y);
            
            // Êé®ÂÆö‰ø°È†ºÂ∫¶„ÇíË®àÁÆóÔºàÊâãÈ¶ñ„ÅÆÊ§úÂá∫‰ø°È†ºÂ∫¶„Åå‰Ωé„ÅÑÂ†¥Âêà„ÅØÊâãÂãïÈÅ∏ÊäûÔºâ
            const confidence = Math.min(leftWrist.visibility, rightWrist.visibility);
            
            if (confidence < 0.7) {
                // ‰ø°È†ºÂ∫¶„Åå‰Ωé„ÅÑÂ†¥Âêà„ÅØÊâãÂãïÈÅ∏Êäû„Å´Âàá„ÇäÊõø„Åà
                showBallPositionClickInstruction();
                return;
            }
            
            // Ëá™ÂãïÊ§úÂá∫ÊàêÂäü - „Éú„Éº„É´‰ΩçÁΩÆ„ÇíË®≠ÂÆö
            userClickedBallPosition = { x: handCenter, y: footY + 0.03 };
            
            // Ëá™ÂãïÊ§úÂá∫„Åï„Çå„Åü„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊèèÁîª
            drawAutomaticBallPosition(ctx, handCenter, footY, width, height);
            
            // ÁêÜÊÉ≥‰ΩçÁΩÆ„ÇÇÊèèÁîªÔºàË®∫Êñ≠ÈñãÂßãÂæå„ÅÆ„ÅøÔºâ
            if (isDiagnosisStarted) {
                drawIdealBallPosition(ctx, landmarks, width, height, clubType);
            }
            
            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
            showAutoDetectionSuccess();
        }
        
        // Ëá™ÂãïÊ§úÂá∫„Åï„Çå„Åü„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊèèÁîª
        function drawAutomaticBallPosition(ctx, x, footY, width, height) {
            // Ëá™ÂãïÊ§úÂá∫„Åï„Çå„Åü„Éú„Éº„É´‰ΩçÁΩÆÔºàÈùí„ÅÑÂÜÜÔºâ
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 0.8;
            ctx.beginPath();
            ctx.arc(x * width, (footY + 0.03) * height, 10, 0, 2 * Math.PI);
            ctx.fill();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 1.0;
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Ëá™ÂãïÊ§úÂá∫', x * width, (footY + 0.03) * height - 15);
            
            // Ë¶ñË¶öÁöÑ„Éû„Éº„Ç´„Éº„ÇÇË°®Á§∫
            const ballMarkerX = x * width;
            const ballMarkerY = (footY + 0.03) * height;
            showBallPositionMarker(ballMarkerX, ballMarkerY);
        }
        
        // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊèèÁîª
        function drawIdealBallPosition(ctx, landmarks, width, height, clubType) {
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const leftHeel = landmarks[29];
            const rightHeel = landmarks[30];
            
            if (!leftAnkle || !rightAnkle) return;
            
            // Ë∂≥„ÅÆ‰ΩçÁΩÆË®àÁÆó
            const leftFootCenter = leftHeel ? leftHeel.x : leftAnkle.x;
            const rightFootCenter = rightHeel ? rightHeel.x : rightAnkle.x;
            const stanceCenter = (leftFootCenter + rightFootCenter) / 2;
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ
            const idealPositions = {
                'Driver': leftFootCenter,                // Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ
                'FairwayWood': leftFootCenter + 0.02,   // Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Utility': stanceCenter - 0.02,        // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '3Iron': stanceCenter - 0.015,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '4Iron': stanceCenter - 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '5Iron': stanceCenter - 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '6Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '7Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '8Iron': stanceCenter + 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                '9Iron': stanceCenter + 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Wedge': stanceCenter + 0.03           // ‰∏≠Â§Æ„Çà„ÇäÂè≥
            };
            
            const idealPosition = idealPositions[clubType] || stanceCenter;
            const footY = Math.max(leftAnkle.y, rightAnkle.y);
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÁ∑ë„ÅÆÂÜÜ„ÅßÊèèÁîª
            ctx.fillStyle = '#00FF00';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.arc(idealPosition * width, footY * height + 20, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#00FF00';
            ctx.globalAlpha = 1.0;
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ÁêÜÊÉ≥‰ΩçÁΩÆ', idealPosition * width, footY * height + 5);
        }
        
        // Ëá™ÂãïÊ§úÂá∫ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
        function showAutoDetectionSuccess() {
            const ballInstruction = document.getElementById('ballPositionInstruction');
            if (ballInstruction) {
                ballInstruction.innerHTML = '‚úÖ „Éú„Éº„É´‰ΩçÁΩÆ„ÇíËá™ÂãïÊ§úÂá∫„Åó„Åæ„Åó„ÅüÔºÅ<br><small>Ê≠£„Åó„ÅèÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÊôÇ„ÅØ„Éú„Éº„É´„ÅÆ‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</small>';
                ballInstruction.style.backgroundColor = 'rgba(40, 167, 69, 0.9)';
                ballInstruction.style.display = 'block';
                
                // Ë®∫Êñ≠ÈñãÂßã„Åæ„ÅßË°®Á§∫„ÅóÁ∂ö„Åë„ÇãÔºà„Çø„Ç§„Éû„ÉºÂâäÈô§Ôºâ
                // setTimeout(() => {
                //     ballInstruction.style.display = 'none';
                // }, 5000);
            }
            
            // Ë®∫Êñ≠„Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
            updateDiagnosisButtonState();
            
            // ÊâãÂãïË™øÊï¥„ÅÆ„Åü„ÇÅ„ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÇÇÊúâÂäπ„Å´„Åó„Å¶„Åä„Åè
            isBallPositionClickEnabled = true;
            const canvas = document.getElementById('poseCanvas');
            canvas.style.cursor = 'crosshair';
            canvas.removeEventListener('click', handleBallPositionClick);
            canvas.removeEventListener('touchstart', handleBallPositionClick);
            canvas.addEventListener('click', handleBallPositionClick);
            canvas.addEventListener('touchstart', handleBallPositionClick, { passive: false });
        }
        
        // „Éú„Éº„É´‰ΩçÁΩÆ„ÇØ„É™„ÉÉ„ÇØÊåáÁ§∫„ÇíË°®Á§∫
        function showBallPositionClickInstruction() {
            const ballInstruction = document.getElementById('ballPositionInstruction');
            if (ballInstruction) {
                ballInstruction.innerHTML = 'üèåÔ∏è‚Äç‚ôÇÔ∏è Ëá™ÂãïÊ§úÂá∫Â§±Êïó<br>„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                ballInstruction.style.backgroundColor = 'rgba(255, 140, 0, 0.9)';
                ballInstruction.style.display = 'block';
            }
            
            // ÊâãÂãï„ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÇíÊúâÂäπÂåñ
            isBallPositionClickEnabled = true;
            const canvas = document.getElementById('poseCanvas');
            canvas.style.cursor = 'crosshair';
            canvas.removeEventListener('click', handleBallPositionClick);
            canvas.removeEventListener('touchstart', handleBallPositionClick);
            canvas.addEventListener('click', handleBallPositionClick);
            canvas.addEventListener('touchstart', handleBallPositionClick, { passive: false });
        }

        // „Éú„Éº„É´‰ΩçÁΩÆÊèèÁîªÔºàÂæåÊñπË¶ñÁÇπÁî®Ôºâ
        function drawBallPosition(ctx, landmarks, width, height) {
            const clubType = document.getElementById('clubSelect').value;
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            const leftHeel = landmarks[29];
            const rightHeel = landmarks[30];
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            
            if (!leftAnkle || !rightAnkle) return;
            
            // Ë∂≥„ÅÆ‰ΩçÁΩÆË®àÁÆó
            const leftFootCenter = leftHeel ? leftHeel.x : leftAnkle.x;
            const rightFootCenter = rightHeel ? rightHeel.x : rightAnkle.x;
            const stanceCenter = (leftFootCenter + rightFootCenter) / 2;
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ
            const idealPositions = {
                'Driver': leftFootCenter,                // Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ
                'FairwayWood': leftFootCenter + 0.01,
                'Utility': stanceCenter - 0.02,
                '3Iron': stanceCenter - 0.015,
                '4Iron': stanceCenter - 0.01,
                '5Iron': stanceCenter - 0.005,
                '6Iron': stanceCenter,
                '7Iron': stanceCenter,
                '8Iron': stanceCenter + 0.005,
                '9Iron': stanceCenter + 0.01,
                'Wedge': stanceCenter + 0.03
            };
            
            const idealPosition = idealPositions[clubType] || stanceCenter;
            
            // Êé®ÂÆö„Éú„Éº„É´‰ΩçÁΩÆ
            let estimatedBallPosition = stanceCenter;
            if (leftWrist && rightWrist) {
                const handCenter = (leftWrist.x + rightWrist.x) / 2;
                estimatedBallPosition = handCenter;
            }
            
            // Ë∂≥ÂÖÉ„ÅÆÈ´ò„Åï„ÇíÂèñÂæó
            const footY = Math.max(leftAnkle.y, rightAnkle.y);
            
            // ÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÁ∑ë„ÅÆÂÜÜ„ÅßÊèèÁîªÔºàË®∫Êñ≠ÈñãÂßãÂæå„ÅÆ„ÅøÔºâ
            if (isDiagnosisStarted) {
                ctx.fillStyle = '#00FF00';
                ctx.globalAlpha = 0.7;
                ctx.beginPath();
                ctx.arc(idealPosition * width, footY * height + 20, 8, 0, 2 * Math.PI);
                ctx.fill();
                
                // „É©„Éô„É´
                ctx.fillStyle = '#00FF00';
                ctx.globalAlpha = 1.0;
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ÁêÜÊÉ≥', idealPosition * width, footY * height + 45);
            }
            
            // Êé®ÂÆö„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÈùí„ÅÑÂÜÜ„ÅßÊèèÁîª
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.arc(estimatedBallPosition * width, footY * height + 20, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#0066FF';
            ctx.globalAlpha = 1.0;
            ctx.fillText('Êé®ÂÆö', estimatedBallPosition * width, footY * height + 65);
            
            ctx.globalAlpha = 1.0;
        }

        // „É©„É≥„Éâ„Éû„Éº„ÇØÊèèÁîªÔºàMediaPipeÊ®ôÊ∫ñ„Çπ„Çø„Ç§„É´„ÉªÂº∑ÂåñÁâàÔºâ
        function drawLandmarks(ctx, landmarks, width, height) {
            console.log('Drawing landmarks, count:', landmarks.length);
            
            landmarks.forEach((landmark, index) => {
                // ‰ø°È†ºÂ∫¶„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÁ∑©„Åè„Åó„Å¶„ÄÅ„Çà„ÇäÂ§ö„Åè„ÅÆÁÇπ„ÇíË°®Á§∫
                if (landmark.visibility < 0.3) return; 
                
                const x = landmark.x * width;
                const y = landmark.y * height;
                
                // ÈÉ®‰ΩçÂà•„ÅÆËâ≤ÂàÜ„ÅëÔºà„Çà„ÇäÈÆÆ„ÇÑ„Åã„Å™Ëâ≤Ôºâ
                let color;
                if (index <= 10) {
                    color = '#FF4500'; // È°î„ÉªÈ†≠ÈÉ®ÔºöËµ§„Ç™„É¨„É≥„Ç∏
                } else if (index >= 11 && index <= 22) {
                    color = '#00CED1'; // ‰∏äÂçäË∫´Ôºö„ÉÄ„Éº„ÇØ„Çø„Éº„Ç≥„Ç§„Ç∫
                } else {
                    color = '#1E90FF'; // ‰∏ãÂçäË∫´Ôºö„Éâ„ÉÉ„Ç∏„Éñ„É´„Éº
                }
                
                // ÈáçË¶Å„Å™Èñ¢ÁØÄÁÇπ„ÅØÂ§ß„Åç„ÅèË°®Á§∫Ôºà„Åï„Çâ„Å´Â∞è„Åï„ÅèÔºâ
                const isKeyPoint = [0, 11, 12, 13, 14, 15, 16, 23, 24, 25, 26, 27, 28].includes(index);
                const radius = isKeyPoint ? 2 : 1; // „Åï„Çâ„Å´Â∞è„Åï„Åè
                
                // Èñ¢ÁØÄÁÇπ„ÇíËµ§„ÅÑÂÜÜ„ÅßÊèèÁîª
                ctx.fillStyle = '#FF0000'; // Ëµ§Ëâ≤„Å´Áµ±‰∏Ä
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.fill();
                
                // Áï™Âè∑Ë°®Á§∫„ÇíÂâäÈô§Ôºà„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„ÉàÔºâ
                // if (isKeyPoint) {
                //     ctx.fillStyle = '#FFFFFF';
                //     ctx.font = 'bold 12px Arial';
                //     ctx.textAlign = 'center';
                //     ctx.strokeStyle = '#000000';
                //     ctx.lineWidth = 3;
                //     ctx.strokeText(index.toString(), x, y + 4);
                //     ctx.fillText(index.toString(), x, y + 4);
                // }
            });
        }

        // Êé•Á∂öÁ∑öÊèèÁîªÔºàMediaPipeÊ®ôÊ∫ñÊ∫ñÊã†„ÉªÂº∑ÂåñÁâàÔºâ
        function drawConnections(ctx, landmarks, width, height) {
            console.log('Drawing connections...');
            ctx.lineWidth = 2; // Á¥∞„ÅÑÁ∑ö

            // MediaPipe PoseÊ®ôÊ∫ñ„ÅÆÊé•Á∂öÁ∑öÂÆöÁæ©
            const connections = [
                // È°î
                [0, 1], [1, 2], [2, 3], [3, 7], [0, 4], [4, 5], [5, 6], [6, 8],
                // ‰∏äÂçäË∫´
                [9, 10], [11, 12], [11, 13], [13, 15], [15, 17], [15, 19], [15, 21], [17, 19],
                [12, 14], [14, 16], [16, 18], [16, 20], [16, 22], [18, 20],
                [11, 23], [12, 24], [23, 24],
                // ‰∏ãÂçäË∫´
                [23, 25], [25, 27], [27, 29], [29, 31], [27, 31],
                [24, 26], [26, 28], [28, 30], [30, 32], [28, 32]
            ];

            connections.forEach(([start, end]) => {
                // ‰ø°È†ºÂ∫¶„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÁ∑©„Åè„Åó„Å¶„ÄÅ„Çà„ÇäÂ§ö„Åè„ÅÆÁ∑ö„ÇíË°®Á§∫
                if (landmarks[start] && landmarks[end] && 
                    landmarks[start].visibility > 0.3 && landmarks[end].visibility > 0.3) {
                    
                    // Ëâ≤„ÇíÁ∑ëËâ≤„Å´Áµ±‰∏Ä
                    ctx.strokeStyle = '#00FF00'; // „Åô„Åπ„Å¶„ÅÆÊé•Á∂öÁ∑ö„ÇíÁ∑ëËâ≤„Å´
                    
                    // ÂΩ±‰ªò„Åç„ÅÆÁ∑ö„ÇíÊèèÁîª
                    ctx.shadowColor = 'rgba(0,0,0,0.3)';
                    ctx.shadowBlur = 2;
                    ctx.shadowOffsetX = 1;
                    ctx.shadowOffsetY = 1;
                    
                    ctx.beginPath();
                    ctx.moveTo(landmarks[start].x * width, landmarks[start].y * height);
                    ctx.lineTo(landmarks[end].x * width, landmarks[end].y * height);
                    ctx.stroke();
                    
                    // ÂΩ±„Çí„É™„Çª„ÉÉ„Éà
                    ctx.shadowColor = 'transparent';
                    ctx.shadowBlur = 0;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                }
            });
        }

        // ÂßøÂã¢ÂàÜÊûê
        function analyzePosture() {
            console.log('ÂàÜÊûêÈñãÂßã„ÄÅ„Éù„Éº„Ç∫„Éá„Éº„Çø:', poseResults);
            
            if (!poseResults || !poseResults.poseLandmarks) {
                // ÊâãÂãï„É¢„Éº„Éâ„ÅÆÂ†¥ÂêàÔºö„Éú„Éº„É´‰ΩçÁΩÆ„ÅÆ„Åø„ÅßÂü∫Êú¨Ë®∫Êñ≠
                if (userClickedBallPosition) {
                    console.log('ÊâãÂãï„É¢„Éº„ÉâÔºö„Éú„Éº„É´‰ΩçÁΩÆ„ÅÆ„Åø„ÅßË®∫Êñ≠ÂÆüË°å');
                    performManualAnalysis();
                } else {
                    alert('„Éù„Éº„Ç∫„ÅåÊ§úÂá∫„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„Éú„Éº„É´‰ΩçÁΩÆ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÊâãÂãïË®∫Êñ≠„ÇíË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    hideLoading();
                }
                return;
            }

            const clubType = document.getElementById('clubSelect').value;
            const scores = calculatePostureScores(poseResults.poseLandmarks, clubType);
            
            console.log('Ë®àÁÆó„Åï„Çå„Åü„Çπ„Ç≥„Ç¢:', scores);
            
            displayResults(scores);
            createRadarChart(scores);
            
            hideLoading();
        }
        
        // ÊâãÂãïÂàÜÊûêÔºà„Éú„Éº„É´‰ΩçÁΩÆ„ÅÆ„ÅøÔºâ
        function performManualAnalysis() {
            const clubType = document.getElementById('clubSelect').value;
            const ballPos = userClickedBallPosition;
            
            console.log('ÊâãÂãïÂàÜÊûêÈñãÂßã - „Éú„Éº„É´‰ΩçÁΩÆ:', ballPos, '„ÇØ„É©„Éñ:', clubType);
            
            // ÊâãÂãï„É¢„Éº„ÉâÁî®„ÅÆÁ∞°Êòì„Çπ„Ç≥„Ç¢Ë®àÁÆó
            const manualScores = {
                ballPosition: calculateManualBallPositionScore(ballPos, clubType),
                bodyAlignment: 75, // ÊâãÂãï„É¢„Éº„Éâ„Åß„ÅØÂπ≥ÂùáÂÄ§
                forwardTilt: 75,   // ÊâãÂãï„É¢„Éº„Éâ„Åß„ÅØÂπ≥ÂùáÂÄ§
                kneeFlexion: 75,   // ÊâãÂãï„É¢„Éº„Éâ„Åß„ÅØÂπ≥ÂùáÂÄ§
                stability: 80,     // ÊâãÂãï„É¢„Éº„Éâ„Åß„ÅØÂπ≥ÂùáÂÄ§
                overall: 0
            };
            
            // ÂÖ®‰Ωì„Çπ„Ç≥„Ç¢Ë®àÁÆóÔºà„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÈáçË¶ñÔºâ
            manualScores.overall = Math.round(
                (manualScores.ballPosition * 0.4) +  // „Éú„Éº„É´‰ΩçÁΩÆ40%
                (manualScores.bodyAlignment * 0.15) + // „Åù„ÅÆ‰ªñÂêÑ15%
                (manualScores.forwardTilt * 0.15) +
                (manualScores.kneeFlexion * 0.15) +
                (manualScores.stability * 0.15)
            );
            
            console.log('ÊâãÂãïÂàÜÊûê„Çπ„Ç≥„Ç¢:', manualScores);
            
            // ÊâãÂãï„É¢„Éº„ÉâÁî®„ÅÆÁµêÊûúË°®Á§∫
            displayManualResults(manualScores, clubType);
        }
        
        // ÊâãÂãï„Éú„Éº„É´‰ΩçÁΩÆ„Çπ„Ç≥„Ç¢Ë®àÁÆó
        function calculateManualBallPositionScore(ballPos, clubType) {
            if (!ballPos) return 50;
            
            const x = ballPos.x; // 0-1„ÅÆÁØÑÂõ≤
            
            // „ÇØ„É©„Éñ„Çø„Ç§„ÉóÂà•ÁêÜÊÉ≥‰ΩçÁΩÆÔºàÁ∞°ÊòìÁâàÔºâ
            const idealPositions = {
                'driver': 0.4,    // Â∑¶ÂØÑ„Çä
                'iron': 0.5,      // ‰∏≠Â§Æ
                'wedge': 0.55     // „ÇÑ„ÇÑÂè≥ÂØÑ„Çä
            };
            
            const ideal = idealPositions[clubType] || 0.5;
            const deviation = Math.abs(x - ideal);
            
            // „Çπ„Ç≥„Ç¢Ë®àÁÆó
            if (deviation < 0.05) return 95;
            if (deviation < 0.1) return 85;
            if (deviation < 0.15) return 75;
            if (deviation < 0.2) return 65;
            return 50;
        }
        
        // ÊâãÂãï„É¢„Éº„ÉâÁµêÊûúË°®Á§∫
        function displayManualResults(scores, clubType) {
            hideLoading();
            
            // ÈÄöÂ∏∏„ÅÆÁµêÊûúË°®Á§∫„Çí‰ΩøÁî®Ôºà„Çπ„Ç≥„Ç¢„ÇíË™øÊï¥Ê∏à„ÅøÔºâ
            displayResults(scores);
            
            // ÊâãÂãï„É¢„Éº„Éâ„ÅÆÊ≥®ÊÑè‰∫ãÈ†Ö„ÇíËøΩÂä†Ë°®Á§∫
            setTimeout(() => {
                const resultSection = document.getElementById('resultSection');
                if (resultSection) {
                    const manualNotice = document.createElement('div');
                    manualNotice.style.cssText = `
                        margin-top: 15px; 
                        padding: 15px; 
                        background: rgba(0, 150, 255, 0.1); 
                        border-left: 4px solid #0096ff; 
                        border-radius: 5px;
                        font-size: 14px;
                        color: #333;
                    `;
                    manualNotice.innerHTML = `
                        <strong>üì± ÊâãÂãïË®∫Êñ≠„É¢„Éº„Éâ</strong><br>
                        AI„Éù„Éº„Ç∫Ê§úÂá∫„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„ÄÅ„Éú„Éº„É´‰ΩçÁΩÆ„ÅÆ„Åø„ÅßË®∫Êñ≠„Åó„Åæ„Åó„Åü„ÄÇ<br>
                        „Çà„ÇäË©≥Á¥∞„Å™Ë®∫Êñ≠„Å´„ÅØ„ÄÅÂÖ®Ë∫´„ÅåÂÜô„Å£„ÅüÈÆÆÊòé„Å™ÁîªÂÉè„Çí„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ
                    `;
                    resultSection.appendChild(manualNotice);
                }
            }, 500);
        }

        // ÂßøÂã¢„Çπ„Ç≥„Ç¢Ë®àÁÆóÔºàË¶ñÁÇπÂà•Ôºâ
        function calculatePostureScores(landmarks, clubType) {
            const viewType = document.getElementById('viewSelect').value;
            let scores = {};

            if (viewType === 'front') {
                // Ê≠£Èù¢Ë¶ñÁÇπÔºö„Éú„Éº„É´‰ΩçÁΩÆ„ÄÅ„Çπ„Çø„É≥„ÇπÂπÖ„ÄÅÈáçÂøÉÈÖçÂàÜ„ÄÅ„Éê„É©„É≥„Çπ„ÄÅÈ†≠„ÅÆ‰ΩçÁΩÆ
                const stanceResult = evaluateStanceWidth(landmarks, clubType);
                const balanceResult = evaluateBalance(landmarks);
                const headResult = evaluateHeadPosition(landmarks);
                const weightResult = evaluateWeightDistribution(landmarks, clubType);
                scores = {
                    ballPosition: evaluateBallPosition(landmarks, clubType).score,
                    ballPositionData: evaluateBallPosition(landmarks, clubType),
                    stance: stanceResult.score,
                    stanceStatus: stanceResult.status,
                    weight: weightResult.score,
                    weightData: weightResult,
                    balance: balanceResult.score,
                    balanceData: balanceResult,
                    headPosition: headResult.score,
                    headData: headResult
                };
            } else {
                // ÂæåÊñπË¶ñÁÇπÔºö‰Ωì„ÅÆÂêë„Åç„ÄÅÂâçÂÇæËßíÂ∫¶„ÄÅÊâã„ÅÆ‰ΩçÁΩÆ„ÄÅÂâçÂæå„ÅÆÈáçÂøÉ„ÄÅËÉåÁ≠ã„ÅÆÊõ≤„Åå„ÇäÂÖ∑Âêà
                const bodyAlignmentResult = evaluateBodyAlignment(landmarks);
                const forwardTiltResult = evaluateForwardTilt(landmarks);
                const handPositionResult = evaluateHandPosition(landmarks, clubType);
                const spinalCurveResult = evaluateSpinalCurve(landmarks);
                
                scores = {
                    bodyAlignment: bodyAlignmentResult.score,
                    bodyAlignmentData: bodyAlignmentResult,
                    forwardTilt: forwardTiltResult.score,
                    forwardTiltData: forwardTiltResult,
                    handPosition: handPositionResult.score,
                    handPositionData: handPositionResult,
                    frontBackWeight: evaluateFrontBackWeight(landmarks),
                    spinalCurve: spinalCurveResult.score,
                    spinalCurveData: spinalCurveResult
                };
            }

            // Á∑èÂêà„Çπ„Ç≥„Ç¢Ë®àÁÆóÔºàÊï∞ÂÄ§„ÅÆ„Åø„ÇíÂØæË±°Ôºâ
            const numericScores = Object.entries(scores).filter(([key, value]) => 
                typeof value === 'number' && key !== 'total'
            ).map(([key, value]) => value);
            
            const totalScore = numericScores.reduce((sum, score) => sum + score, 0) / numericScores.length;
            scores.total = Math.round(totalScore);

            return scores;
        }

        // Êñ∞„Åó„ÅÑË©ï‰æ°Èñ¢Êï∞ÔºàÂæåÊñπË¶ñÁÇπÁî®Ôºâ
        
        // ‰Ωì„ÅÆÂêë„ÅçË©ï‰æ°ÔºàËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅÆ„É©„Ç§„É≥Ôºâ
        function evaluateBodyAlignment(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftHeel = landmarks[29];
            const rightHeel = landmarks[30];
            
            if (!leftShoulder || !rightShoulder || !leftHip || !rightHip || !leftHeel || !rightHeel) {
                return { score: 0, currentValue: 0, idealValue: 0, unit: 'cm', status: 'unknown' };
            }
            
            // ËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅÆ„É©„Ç§„É≥„ÅåÂπ≥Ë°å„Åã„Å©„ÅÜ„Åã„ÇíË©ï‰æ°
            const shoulderLine = Math.abs(leftShoulder.x - rightShoulder.x);
            const hipLine = Math.abs(leftHip.x - rightHip.x);
            const heelLine = Math.abs(leftHeel.x - rightHeel.x);
            
            const alignmentDeviation = Math.abs(shoulderLine - hipLine) + Math.abs(hipLine - heelLine);
            const deviationInCm = alignmentDeviation * 50; // cmÂçò‰Ωç„Å´Â§âÊèõ
            
            let score;
            if (alignmentDeviation < 0.02) score = 95;
            else if (alignmentDeviation < 0.04) score = 85;
            else if (alignmentDeviation < 0.06) score = 75;
            else if (alignmentDeviation < 0.08) score = 65;
            else score = 50;
            
            return {
                score: score,
                currentValue: Math.round(deviationInCm * 10) / 10,
                idealValue: 0,
                unit: 'cm„ÅÆ„Ç∫„É¨',
                status: score >= 80 ? 'good' : 'needs_improvement'
            };
        }
        
        // ÂâçÂÇæËßíÂ∫¶Ë©ï‰æ°
        function evaluateForwardTilt(landmarks) {
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!nose || !leftShoulder || !rightShoulder || !leftHip || !rightHip) {
                return { score: 0, currentValue: 0, idealValue: 0, unit: 'Â∫¶', status: 'unknown' };
            }
            
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            
            // ÂâçÂÇæËßíÂ∫¶„ÇíË®àÁÆó
            const tiltAngle = Math.atan2(shoulderCenter.y - hipCenter.y, shoulderCenter.x - hipCenter.x) * 180 / Math.PI;
            const currentTilt = Math.abs(tiltAngle);
            
            // „ÇØ„É©„ÉñÂà•„ÅÆÁêÜÊÉ≥ÁöÑ„Å™ÂâçÂÇæËßíÂ∫¶
            const idealTilts = {
                'Driver': 30,
                'FairwayWood': 32,
                'Utility': 34,
                '3Iron': 36,
                '4Iron': 37,
                '5Iron': 38,
                '6Iron': 39,
                '7Iron': 40,
                '8Iron': 42,
                '9Iron': 44,
                'Wedge': 45
            };
            
            const clubType = document.getElementById('clubSelect').value;
            const idealTilt = idealTilts[clubType] || 35;
            const deviation = Math.abs(currentTilt - idealTilt);
            
            // Âà§ÂÆö„ÇíÁîò„Åè„Åô„Çã
            let score;
            if (deviation < 8) score = 95;
            else if (deviation < 15) score = 90;
            else if (deviation < 22) score = 85;
            else if (deviation < 30) score = 75;
            else score = 65;
            
            return {
                score: score,
                currentValue: Math.round(currentTilt * 10) / 10,
                idealValue: idealTilt,
                unit: 'Â∫¶',
                status: score >= 80 ? 'good' : 'needs_improvement'
            };
        }
        
        // Êâã„ÅÆ‰ΩçÁΩÆË©ï‰æ°
        function evaluateHandPosition(landmarks, clubType) {
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            
            if (!leftWrist || !rightWrist || !leftShoulder || !rightShoulder) {
                return { score: 0, currentValue: 0, idealValue: 0, unit: 'cm', status: 'unknown' };
            }
            
            const handCenter = {
                x: (leftWrist.x + rightWrist.x) / 2,
                y: (leftWrist.y + rightWrist.y) / 2
            };
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            
            // Êâã„Å®ËÇ©„ÅÆ‰ΩçÁΩÆÈñ¢‰øÇ„ÇíË©ï‰æ°
            const handDistance = Math.abs(handCenter.x - shoulderCenter.x);
            const handDistanceInCm = handDistance * 100; // cmÂçò‰Ωç„Å´Â§âÊèõ
            
            let idealDistance, idealDescription;
            if (clubType === 'Driver') {
                idealDistance = 0.03; // „Éâ„É©„Ç§„Éê„Éº„ÅØÂ∞ë„ÅóÂâç
                idealDescription = 'ËÇ©„ÅÆÁúü‰∏ã„Çà„ÇäÂ∞ë„ÅóÂâç';
            } else {
                idealDistance = 0.01; // ‰ªñ„ÅÆ„ÇØ„É©„Éñ„ÅØËÇ©„ÅÆÁúü‰∏ã
                idealDescription = 'ËÇ©„ÅÆÁúü‰∏ã';
            }
            
            const idealDistanceInCm = idealDistance * 100;
            const deviation = Math.abs(handDistance - idealDistance);
            
            let score;
            if (deviation < 0.01) score = 95;
            else if (deviation < 0.02) score = 85;
            else if (deviation < 0.03) score = 75;
            else if (deviation < 0.04) score = 65;
            else score = 50;
            
            return {
                score: score,
                currentValue: Math.round(handDistanceInCm * 10) / 10,
                idealValue: Math.round(idealDistanceInCm * 10) / 10,
                unit: 'cm',
                status: score >= 80 ? 'good' : 'needs_improvement',
                description: idealDescription
            };
        }
        
        // ÂâçÂæå„ÅÆÈáçÂøÉË©ï‰æ°
        function evaluateFrontBackWeight(landmarks) {
            const nose = landmarks[0];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            
            if (!nose || !leftHip || !rightHip || !leftAnkle || !rightAnkle) return 0;
            
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            const ankleCenter = {
                x: (leftAnkle.x + rightAnkle.x) / 2,
                y: (leftAnkle.y + rightAnkle.y) / 2
            };
            
            // ÂâçÂæå„ÅÆÈáçÂøÉ„Éê„É©„É≥„Çπ„ÇíË©ï‰æ°
            const weightBalance = Math.abs(hipCenter.x - ankleCenter.x);
            
            if (weightBalance < 0.02) return 95;
            if (weightBalance < 0.04) return 85;
            if (weightBalance < 0.06) return 75;
            if (weightBalance < 0.08) return 65;
            return 50;
        }
        
        // ËÉåÁ≠ã„ÅÆÊõ≤„Åå„ÇäÂÖ∑ÂêàË©ï‰æ°
        function evaluateSpinalCurve(landmarks) {
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!nose || !leftShoulder || !rightShoulder || !leftHip || !rightHip) {
                return { score: 0, status: 'unknown', description: '' };
            }
            
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            
            // ËÉåÁ≠ã„ÅÆËá™ÁÑ∂„Å™„Ç´„Éº„Éñ„ÇíË©ï‰æ°ÔºàÁ∞°Áï•ÂåñÔºâ
            const headToShoulder = nose.x - shoulderCenter.x;
            const shoulderToHip = shoulderCenter.x - hipCenter.x;
            const spineDeviation = Math.abs(headToShoulder) + Math.abs(shoulderToHip);
            
            let score;
            let status;
            let description;
            
            // Âà§ÂÆö„Çí„Åï„Çâ„Å´Áîò„Åè„Åô„Çã
            if (spineDeviation < 0.08) {
                score = 95;
                status = 'good';
                description = 'Ëá™ÁÑ∂„Å™SÂ≠ó„Ç´„Éº„Éñ';
            } else if (spineDeviation < 0.15) {
                score = 90;
                status = 'good';
                description = 'ËâØÂ•Ω„Å™„Ç´„Éº„Éñ';
            } else if (spineDeviation < 0.22) {
                score = 85;
                status = 'good';
                // È†≠„ÅåÂâç„Å´Âá∫„Åô„Åé„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÁå´ËÉåÂÇæÂêë
                if (headToShoulder > 0.12) {
                    description = 'Áå´ËÉåÊ∞óÂë≥';
                } else if (headToShoulder < -0.12) {
                    description = 'Âèç„ÇäÊ∞óÂë≥';
                } else {
                    description = 'ËâØÂ•Ω„Å™„Ç´„Éº„Éñ';
                }
            } else if (spineDeviation < 0.30) {
                score = 80;
                status = 'needs_improvement';
                if (headToShoulder > 0.12) {
                    description = 'Áå´ËÉåÊ∞óÂë≥';
                } else if (headToShoulder < -0.12) {
                    description = 'Âèç„ÇäÈÅé„Åé';
                } else {
                    description = 'ËªΩÂæÆ„Å™Ê≠™„Åø';
                }
            } else if (spineDeviation < 0.40) {
                score = 75;
                status = 'needs_improvement';
                if (headToShoulder > 0.15) {
                    description = 'Áå´ËÉå';
                } else if (headToShoulder < -0.15) {
                    description = 'Âèç„ÇäÈÅé„Åé';
                } else {
                    description = 'ÂßøÂã¢„ÅÆÊ≠™„Åø';
                }
            } else {
                score = 70;
                status = 'needs_improvement';
                if (headToShoulder > 0.15) {
                    description = 'Âº∑„ÅÑÁå´ËÉå';
                } else if (headToShoulder < -0.15) {
                    description = 'Âº∑„ÅÑÂèç„ÇäÈÅé„Åé';
                } else {
                    description = 'Â§ß„Åç„Å™ÂßøÂã¢„ÅÆÊ≠™„Åø';
                }
            }
            
            return { score: score, status: status, description: description };
        }
        
        // ÊóßË©ï‰æ°Èñ¢Êï∞ÔºàÊ≠£Èù¢Ë¶ñÁÇπÁî®„Å´‰øùÊåÅÔºâ
        
        // ËÑäÊ§éËßíÂ∫¶Ë©ï‰æ°ÔºàÊ≠£Èù¢„ÉªÂæåÈù¢Ë¶ñÁÇπÂØæÂøúÔºâ
        function evaluateSpineAngle(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!leftShoulder || !rightShoulder || !leftHip || !rightHip) return 0;
            
            // Ê≠£Èù¢Ë¶ñÁÇπ„Åß„ÅÆËÑäÊ§é„ÅÆÁõ¥Á∑öÊÄß„ÇíË©ï‰æ°
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2
            };
            
            // Ê∞¥Âπ≥„Åã„Çâ„ÅÆÂÇæ„Åç„ÇíË®àÁÆó
            const spineDeviation = Math.abs(shoulderCenter.x - hipCenter.x);
            
            if (spineDeviation < 0.02) return 95;
            if (spineDeviation < 0.04) return 85;
            if (spineDeviation < 0.06) return 75;
            if (spineDeviation < 0.08) return 65;
            return 50;
        }

        // ËÇ©„ÅÆ‰ΩçÁΩÆË©ï‰æ°ÔºàÊ≠£Èù¢Ë¶ñÁÇπÊúÄÈÅ©ÂåñÔºâ
        function evaluateShoulderAlignment(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            
            if (!leftShoulder || !rightShoulder) return 0;
            
            // Ê≠£Èù¢Ë¶ñÁÇπ„Åß„ÅÆËÇ©„ÅÆÊ∞¥Âπ≥Â∫¶„ÇíË©ï‰æ°
            const heightDiff = Math.abs(leftShoulder.y - rightShoulder.y);
            
            // Ê≠£Èù¢„Åã„Çâ„ÅØËÇ©„ÅÆÈ´ò„Åï„ÅÆÈÅï„ÅÑ„Åå„Çà„ÇäÊòéÁ¢∫„Å´Ë¶ã„Åà„Çã
            if (heightDiff < 0.015) return 95;
            if (heightDiff < 0.03) return 85;
            if (heightDiff < 0.045) return 75;
            if (heightDiff < 0.06) return 65;
            return 50;
        }

        // ËÜù„ÅÆ‰ΩçÁΩÆË©ï‰æ°ÔºàÊ≠£Èù¢Ë¶ñÁÇπÊúÄÈÅ©ÂåñÔºâ
        function evaluateKneeAlignment(landmarks) {
            const leftKnee = landmarks[25];
            const rightKnee = landmarks[26];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!leftKnee || !rightKnee || !leftHip || !rightHip) return 0;
            
            // Ê≠£Èù¢Ë¶ñÁÇπ„Åß„ÅÆËÜù„ÅÆ‰ΩçÁΩÆ„ÇíËÇ°Èñ¢ÁØÄ„Å®„ÅÆÈñ¢‰øÇ„ÅßË©ï‰æ°
            const leftKneeAlignment = Math.abs(leftKnee.x - leftHip.x);
            const rightKneeAlignment = Math.abs(rightKnee.x - rightHip.x);
            
            // ËÜù„ÅÆÈ´ò„Åï„ÅÆÊèÉ„ÅÑÂÖ∑Âêà„ÇÇË©ï‰æ°
            const kneeHeightDiff = Math.abs(leftKnee.y - rightKnee.y);
            
            const avgAlignment = (leftKneeAlignment + rightKneeAlignment) / 2;
            const totalDeviation = avgAlignment + kneeHeightDiff;
            
            if (totalDeviation < 0.03) return 95;
            if (totalDeviation < 0.06) return 85;
            if (totalDeviation < 0.09) return 75;
            if (totalDeviation < 0.12) return 65;
            return 50;
        }

        // „Éú„Éº„É´‰ΩçÁΩÆË©ï‰æ°ÔºàÊîπËâØÁâà„Éª„ÇØ„É™„ÉÉ„ÇØÂØæÂøúÔºâ
        function evaluateBallPosition(landmarks, clubType) {
            const leftAnkle = landmarks[27]; // Â∑¶Ë∂≥È¶ñ
            const rightAnkle = landmarks[28]; // Âè≥Ë∂≥È¶ñ
            const leftHeel = landmarks[29]; // Â∑¶„Åã„Åã„Å®
            const rightHeel = landmarks[30]; // Âè≥„Åã„Åã„Å®
            const leftToe = landmarks[31]; // Â∑¶„Å§„ÅæÂÖà
            const rightToe = landmarks[32]; // Âè≥„Å§„ÅæÂÖà
            
            if (!leftAnkle || !rightAnkle || !leftHeel || !rightHeel) return 0;
            
            // „Çà„ÇäÊ≠£Á¢∫„Å™Ë∂≥„ÅÆ‰ΩçÁΩÆË®àÁÆó
            const leftFootCenter = leftHeel ? leftHeel.x : leftAnkle.x;
            const rightFootCenter = rightHeel ? rightHeel.x : rightAnkle.x;
            const stanceCenter = (leftFootCenter + rightFootCenter) / 2;
            
            // „ÇØ„É©„ÉñÂà•„ÅÆÁêÜÊÉ≥ÁöÑ„Å™„Éú„Éº„É´‰ΩçÁΩÆÔºàÂ∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„ÇíÂü∫Ê∫ñÔºâ
            const idealPositions = {
                'Driver': leftFootCenter,                // Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ
                'FairwayWood': leftFootCenter + 0.02,   // Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Utility': stanceCenter - 0.02,        // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '3Iron': stanceCenter - 0.015,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '4Iron': stanceCenter - 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '5Iron': stanceCenter - 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶
                '6Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '7Iron': stanceCenter,                  // ‰∏≠Â§Æ
                '8Iron': stanceCenter + 0.005,         // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                '9Iron': stanceCenter + 0.01,          // ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥
                'Wedge': stanceCenter + 0.03           // ‰∏≠Â§Æ„Çà„ÇäÂè≥
            };
            
            // ÂÆüÈöõ„ÅÆ„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊ±∫ÂÆö
            let actualBallPosition;
            
            if (userClickedBallPosition && document.getElementById('viewSelect').value === 'front') {
                // „É¶„Éº„Ç∂„Éº„Åå„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü‰ΩçÁΩÆ„Çí‰ΩøÁî®
                actualBallPosition = userClickedBallPosition.x;
            } else {
                // ÊâãÈ¶ñ„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÊé®ÂÆö
                const leftWrist = landmarks[15];
                const rightWrist = landmarks[16];
                actualBallPosition = stanceCenter; // „Éá„Éï„Ç©„É´„Éà
                
                if (leftWrist && rightWrist) {
                    // ÊâãÈ¶ñ„ÅÆ‰∏≠Â§Æ„Åã„Çâ„Éú„Éº„É´‰ΩçÁΩÆ„ÇíÊé®ÂÆö
                    const handCenter = (leftWrist.x + rightWrist.x) / 2;
                    actualBallPosition = handCenter;
                }
            }
            
            const idealPosition = idealPositions[clubType] || stanceCenter;
            const deviation = Math.abs(actualBallPosition - idealPosition);
            const isLeftOfIdeal = actualBallPosition > idealPosition; // ÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„ÇäÂ∑¶„Å´„ÅÇ„ÇãÔºàMediaPipeÂ∫ßÊ®ôÁ≥ª„Åß„ÅØÈÄÜÔºâ
            
            // „Çπ„Ç≥„Ç¢Ë®àÁÆóÔºàÂ∞ë„ÅóÂé≥„Åó„ÅèË™øÊï¥Ôºâ
            let score;
            if (deviation < 0.020) score = 95; // 95ÁÇπ„ÅÆÁØÑÂõ≤„ÇíÁã≠„Åè
            else if (deviation < 0.040) score = 90;
            else if (deviation < 0.060) score = 85;
            else if (deviation < 0.080) score = 75;
            else if (deviation < 0.105) score = 65;
            else score = 50;
            
            return {
                score: score,
                actualPosition: actualBallPosition,
                idealPosition: idealPosition,
                deviation: deviation,
                isLeftOfIdeal: isLeftOfIdeal,
                clubType: clubType
            };
        }

        // „Çπ„Çø„É≥„ÇπÂπÖË©ï‰æ°
        function evaluateStanceWidth(landmarks, clubType) {
            const leftFoot = landmarks[27];
            const rightFoot = landmarks[28];
            
            if (!leftFoot || !rightFoot) return { score: 0, status: 'unknown' };
            
            const stanceWidth = Math.abs(leftFoot.x - rightFoot.x);
            
            const idealWidths = {
                'Driver': 0.28,        // ËÇ©ÂπÖ„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÇÅ
                'FairwayWood': 0.22,   // ËÇ©ÂπÖÁ®ãÂ∫¶
                'Utility': 0.22,      // ËÇ©ÂπÖÁ®ãÂ∫¶
                '3Iron': 0.22,        // ËÇ©ÂπÖÁ®ãÂ∫¶
                '4Iron': 0.22,        // ËÇ©ÂπÖÁ®ãÂ∫¶
                '5Iron': 0.22,        // ËÇ©ÂπÖÁ®ãÂ∫¶
                '6Iron': 0.22,        // ËÇ©ÂπÖÁ®ãÂ∫¶
                '7Iron': 0.22,        // ËÇ©ÂπÖÁ®ãÂ∫¶
                '8Iron': 0.22,        // ËÇ©ÂπÖÁ®ãÂ∫¶
                '9Iron': 0.22,        // ËÇ©ÂπÖÁ®ãÂ∫¶
                'Wedge': 0.22         // ËÇ©ÂπÖÁ®ãÂ∫¶ÔºàËÇ©ÂπÖ+10cm = 0.22Áõ∏ÂΩìÔºâ
            };
            
            const idealWidth = idealWidths[clubType] || 0.20;
            const deviation = stanceWidth - idealWidth;
            
            let score, status;
            
            // Âà§ÂÆö„ÇíÁîò„Åè„Åô„Çã
            if (Math.abs(deviation) < 0.04) {
                score = 95;
                status = 'ideal';
            } else if (Math.abs(deviation) < 0.07) {
                score = 90;
                status = deviation > 0 ? 'slightly_wide' : 'slightly_narrow';
            } else if (Math.abs(deviation) < 0.10) {
                score = 85;
                status = deviation > 0 ? 'wide' : 'narrow';
            } else if (Math.abs(deviation) < 0.13) {
                score = 75;
                status = deviation > 0 ? 'too_wide' : 'too_narrow';
            } else {
                score = 65;
                status = deviation > 0 ? 'much_too_wide' : 'much_too_narrow';
            }
            
            return { 
                score: score, 
                status: status
            };
        }

        // ÈáçÂøÉÈÖçÂàÜË©ï‰æ°ÔºàÊñ∞Ê©üËÉΩÔºâ
        function evaluateWeightDistribution(landmarks, clubType) {
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftFoot = landmarks[27];
            const rightFoot = landmarks[28];
            
            if (!leftHip || !rightHip || !leftFoot || !rightFoot) {
                return { score: 0, status: 'unknown', currentBalance: '', idealBalance: '' };
            }
            
            // ÈáçÂøÉ‰ΩçÁΩÆ„ÇíÊé®ÂÆöÔºàËÖ∞„ÅÆ‰ΩçÁΩÆ„Å®Ë∂≥„ÅÆ‰ΩçÁΩÆ„Åã„ÇâÔºâ
            const hipCenter = (leftHip.x + rightHip.x) / 2;
            const footCenter = (leftFoot.x + rightFoot.x) / 2;
            
            // Â∑¶Âè≥„ÅÆÈáçÂøÉÈÖçÂàÜ„ÇíË®àÁÆó
            const weightDistribution = (hipCenter - footCenter) / Math.abs(leftFoot.x - rightFoot.x);
            
            let score;
            let status;
            let currentBalance;
            let idealBalance;
            
            if (clubType === 'Driver') {
                // „Éâ„É©„Ç§„Éê„ÉºÔºö6:4„ÅßÂè≥ÈáçÂøÉ„ÅåÁêÜÊÉ≥
                idealBalance = 'Âè≥Ë∂≥6ÔºöÂ∑¶Ë∂≥4';
                const idealRightWeight = 0.1; // Âè≥„Å´10%ÂÅè„Å£„ÅüÁä∂ÊÖã
                const deviation = Math.abs(weightDistribution - idealRightWeight);
                
                if (weightDistribution > idealRightWeight + 0.15) {
                    currentBalance = 'Âè≥Ë∂≥„Å´ÈáçÂøÉ„Åå„Åã„Åã„Çä„Åô„Åé';
                    status = 'too_right';
                } else if (weightDistribution < idealRightWeight - 0.15) {
                    currentBalance = 'Â∑¶Ë∂≥„Å´ÈáçÂøÉ„Åå„Åã„Åã„Çä„Åô„Åé';
                    status = 'too_left';
                } else if (weightDistribution > idealRightWeight + 0.08) {
                    currentBalance = 'Âè≥Ë∂≥ÈáçÂøÉ„ÅåÂº∑„ÇÅ';
                    status = 'slightly_right';
                } else if (weightDistribution < idealRightWeight - 0.08) {
                    currentBalance = 'Â∑¶Ë∂≥ÈáçÂøÉ„ÅåÂº∑„ÇÅ';
                    status = 'slightly_left';
                } else {
                    currentBalance = 'ÈÅ©Âàá„Å™Âè≥ÈáçÂøÉ';
                    status = 'good';
                }
                
                if (deviation < 0.05) score = 95;
                else if (deviation < 0.10) score = 85;
                else if (deviation < 0.15) score = 75;
                else if (deviation < 0.20) score = 65;
                else score = 50;
            } else {
                // „Åù„ÅÆ‰ªñ„ÅÆ„ÇØ„É©„ÉñÔºö5:5„ÅßÂùáÁ≠â„ÅåÁêÜÊÉ≥
                idealBalance = 'Â∑¶Âè≥ÂùáÁ≠âÔºà5Ôºö5Ôºâ';
                const deviation = Math.abs(weightDistribution);
                
                if (weightDistribution > 0.12) {
                    currentBalance = 'Âè≥Ë∂≥„Å´ÈáçÂøÉ„Åå„Åã„Åã„Çä„Åô„Åé';
                    status = 'too_right';
                } else if (weightDistribution < -0.12) {
                    currentBalance = 'Â∑¶Ë∂≥„Å´ÈáçÂøÉ„Åå„Åã„Åã„Çä„Åô„Åé';
                    status = 'too_left';
                } else if (weightDistribution > 0.06) {
                    currentBalance = 'Âè≥Ë∂≥ÈáçÂøÉ„ÅåÂº∑„ÇÅ';
                    status = 'slightly_right';
                } else if (weightDistribution < -0.06) {
                    currentBalance = 'Â∑¶Ë∂≥ÈáçÂøÉ„ÅåÂº∑„ÇÅ';
                    status = 'slightly_left';
                } else {
                    currentBalance = 'ÈÅ©Âàá„Å™ÂùáÁ≠âÈÖçÂàÜ';
                    status = 'good';
                }
                
                if (deviation < 0.03) score = 95;
                else if (deviation < 0.06) score = 85;
                else if (deviation < 0.09) score = 75;
                else if (deviation < 0.12) score = 65;
                else score = 50;
            }
            
            return { 
                score: score, 
                status: status, 
                currentBalance: currentBalance, 
                idealBalance: idealBalance 
            };
        }

        // „Éê„É©„É≥„ÇπË©ï‰æ°
        function evaluateBalance(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            if (!leftShoulder || !rightShoulder || !leftHip || !rightHip) return { score: 0, currentValue: 0, idealValue: 0, unit: 'cm' };
            
            const shoulderCenter = (leftShoulder.x + rightShoulder.x) / 2;
            const hipCenter = (leftHip.x + rightHip.x) / 2;
            const balance = Math.abs(shoulderCenter - hipCenter);
            
            // „Éê„É©„É≥„Çπ„ÅÆ„Ç∫„É¨„ÇícmÂçò‰Ωç„Å´Â§âÊèõÔºà‰ªÆÊÉ≥ÁöÑ„Å™Â§âÊèõÔºâ
            const balanceInCm = balance * 100; // 0.01 = 1cmÁõ∏ÂΩì„Å®‰ªÆÂÆö
            
            let score;
            if (balance < 0.02) score = 95;
            else if (balance < 0.04) score = 85;
            else if (balance < 0.06) score = 75;
            else if (balance < 0.08) score = 65;
            else score = 50;
            
            return {
                score: score,
                currentValue: Math.round(balanceInCm * 10) / 10,
                idealValue: 0,
                unit: 'cm„ÅÆ„Ç∫„É¨'
            };
        }

        // È†≠„ÅÆ‰ΩçÁΩÆË©ï‰æ°
        function evaluateHeadPosition(landmarks) {
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            
            if (!nose || !leftShoulder || !rightShoulder) return { score: 0, currentValue: 0, idealValue: 0, unit: 'cm' };
            
            const shoulderCenter = (leftShoulder.x + rightShoulder.x) / 2;
            const headPosition = Math.abs(nose.x - shoulderCenter);
            
            // È†≠„ÅÆ„Ç∫„É¨„ÇícmÂçò‰Ωç„Å´Â§âÊèõ
            const headOffsetInCm = headPosition * 100;
            
            let score;
            if (headPosition < 0.03) score = 95;
            else if (headPosition < 0.06) score = 85;
            else if (headPosition < 0.09) score = 75;
            else if (headPosition < 0.12) score = 65;
            else score = 50;
            
            return {
                score: score,
                currentValue: Math.round(headOffsetInCm * 10) / 10,
                idealValue: 0,
                unit: 'cm„ÅÆ„Ç∫„É¨'
            };
        }

        // Ë©≥Á¥∞ÊØîËºÉ„Éá„Éº„ÇøÁîüÊàê
        function generateDetailedComparison(key, scores, clubType) {
            const viewType = document.getElementById('viewSelect').value;
            
            switch(key) {
                case 'ballPosition':
                    if (scores.ballPositionData) {
                        const data = scores.ballPositionData;
                        const positionNames = {
                            'Driver': 'Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ',
                            'FairwayWood': 'Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥',
                            'Utility': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶',
                            '3Iron': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶',
                            '4Iron': '‰∏≠Â§Æ',
                            '5Iron': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥',
                            '6Iron': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥',
                            '7Iron': '‰∏≠Â§Æ„Çà„ÇäÂè≥',
                            '8Iron': '‰∏≠Â§Æ„Çà„ÇäÂè≥',
                            '9Iron': 'Âè≥Ë∂≥„Çà„Çä',
                            'PW': 'Âè≥Ë∂≥„Çà„Çä',
                            'SW': 'Âè≥Ë∂≥ÂØÑ„Çä'
                        };
                        
                        const currentPos = data.isLeftOfIdeal ? 'ÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„ÇäÂ∑¶' : 'ÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„ÇäÂè≥';
                        const idealPos = positionNames[clubType] || 'ÈÅ©Âàá„Å™‰ΩçÁΩÆ';
                        const deviation = Math.round(data.deviation * 100 * 10) / 10;
                        
                        return {
                            current: currentPos,
                            ideal: idealPos,
                            gap: `${deviation}cm`,
                            steps: [
                                'Ë∂≥„ÅÆ‰ΩçÁΩÆ„ÇíÁ¢∫Ë™ç„Åó„ÄÅ„Çπ„Çø„É≥„Çπ„ÇíË™øÊï¥„Åó„Åæ„Åô',
                                `„Éú„Éº„É´‰ΩçÁΩÆ„Çí${data.isLeftOfIdeal ? 'Âè≥„Å´' : 'Â∑¶„Å´'}Á¥Ñ${deviation}cmÁßªÂãï„Åï„Åõ„Åæ„Åô`,
                                'Êï∞ÂõûÁ¥†ÊåØ„Çä„Çí„Åó„Å¶‰ΩçÁΩÆ„Çí‰Ωì„Å´Ë¶ö„Åà„Åï„Åõ„Åæ„Åô'
                            ]
                        };
                    }
                    return null;
                    
                case 'stance':
                    if (scores.stanceStatus) {
                        const status = scores.stanceStatus;
                        const idealDesc = clubType === 'Driver' ? 'ËÇ©ÂπÖ„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÇÅÔºàÁ¥Ñ60cmÔºâ' : 'ËÇ©ÂπÖÁ®ãÂ∫¶ÔºàÁ¥Ñ50cmÔºâ';
                        
                        let currentDesc = '';
                        let adjustmentDesc = '';
                        
                        switch(status) {
                            case 'slightly_narrow':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∞ë„ÅóÁã≠„ÅÑ';
                                adjustmentDesc = '5-10cmÂ∫É„Åí„Çã';
                                break;
                            case 'narrow':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÁã≠„ÅÑ';
                                adjustmentDesc = '10-15cmÂ∫É„Åí„Çã';
                                break;
                            case 'too_narrow':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇ„Åã„Å™„ÇäÁã≠„ÅÑ';
                                adjustmentDesc = '15-20cmÂ∫É„Åí„Çã';
                                break;
                            case 'much_too_narrow':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÈùûÂ∏∏„Å´Áã≠„ÅÑ';
                                adjustmentDesc = '20cm‰ª•‰∏äÂ∫É„Åí„Çã';
                                break;
                            case 'slightly_wide':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÅÑ';
                                adjustmentDesc = '5-10cmÁã≠„ÇÅ„Çã';
                                break;
                            case 'wide':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∫É„ÅÑ';
                                adjustmentDesc = '10-15cmÁã≠„ÇÅ„Çã';
                                break;
                            case 'too_wide':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇ„Åã„Å™„ÇäÂ∫É„ÅÑ';
                                adjustmentDesc = '15-20cmÁã≠„ÇÅ„Çã';
                                break;
                            case 'much_too_wide':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÈùûÂ∏∏„Å´Â∫É„ÅÑ';
                                adjustmentDesc = '20cm‰ª•‰∏äÁã≠„ÇÅ„Çã';
                                break;
                            default:
                                return null;
                        }
                        
                        return {
                            current: currentDesc,
                            ideal: idealDesc,
                            gap: adjustmentDesc,
                            steps: [
                                '‰∏°Ë∂≥„ÅÆ‰ΩçÁΩÆ„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åô',
                                `Ë∂≥ÂπÖ„Çí${adjustmentDesc}Ë™øÊï¥„Åó„Åæ„Åô`,
                                'Ë™øÊï¥Âæå„ÄÅÊï∞Âõû„Ç¢„Éâ„É¨„Çπ„ÇíÂèñ„ÇäÁõ¥„Åó„Å¶ÊÑüË¶ö„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åô'
                            ]
                        };
                    }
                    return null;
                    
                case 'balance':
                    if (scores.balanceData) {
                        const data = scores.balanceData;
                        return {
                            current: `${data.currentValue}${data.unit}`,
                            ideal: `${data.idealValue}${data.unit}`,
                            gap: `${Math.abs(data.currentValue - data.idealValue)}${data.unit}`,
                            steps: [
                                '‰∏äÂçäË∫´„Å®‰∏ãÂçäË∫´„ÅÆÈáçÂøÉ‰ΩçÁΩÆ„ÇíÊÑèË≠ò„Åó„Åæ„Åô',
                                'ËÇ©„Å®ËÖ∞„ÅÆ„É©„Ç§„É≥„ÇíÂπ≥Ë°å„Å´‰øù„Å°„Åæ„Åô',
                                'ÈáçÂøÉ„ÇíË∂≥Ë£è„ÅÆ‰∏≠Â§Æ„Å´ÁΩÆ„Åè„Çà„ÅÜË™øÊï¥„Åó„Åæ„Åô'
                            ]
                        };
                    }
                    return null;
                    
                case 'headPosition':
                    if (scores.headData) {
                        const data = scores.headData;
                        return {
                            current: `${data.currentValue}${data.unit}`,
                            ideal: `‰∏°ËÇ©„ÅÆ‰∏≠Â§Æ`,
                            gap: `${data.currentValue}${data.unit}`,
                            steps: [
                                '‰∏°ËÇ©„ÅÆ„É©„Ç§„É≥„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åô',
                                'È†≠„ÇíÂ∑¶Âè≥„ÅÆËÇ©„ÅÆ‰∏≠Â§Æ„Å´‰ΩçÁΩÆ„Åï„Åõ„Åæ„Åô',
                                'È°é„ÇíËªΩ„ÅèÂºï„ÅÑ„Å¶Ëá™ÁÑ∂„Å™È†≠„ÅÆ‰ΩçÁΩÆ„Çí‰øù„Å°„Åæ„Åô'
                            ]
                        };
                    }
                    return null;
                    
                case 'forwardTilt':
                    if (viewType === 'back' && scores.forwardTiltData) {
                        const data = scores.forwardTiltData;
                        const currentStatus = data.currentValue < data.idealValue ? 'ÊµÖ„Åô„Åé„Çã' : 'Ê∑±„Åô„Åé„Çã';
                        const adjustment = data.currentValue < data.idealValue ? 'Ê∑±„Åè' : 'ÊµÖ„Åè';
                        return {
                            current: currentStatus,
                            ideal: 'ÈÅ©Âàá„Å™ËßíÂ∫¶',
                            gap: 'Ë¶ÅË™øÊï¥',
                            steps: [
                                'ËÇ°Èñ¢ÁØÄ„Åã„ÇâÂâçÂÇæ„Åô„ÇãÊÑèË≠ò„ÇíÊåÅ„Å°„Åæ„Åô',
                                `ÂâçÂÇæËßíÂ∫¶„Çí${adjustment}Ë™øÊï¥„Åó„Åæ„Åô`,
                                'ËÉåÁ≠ã„ÇíÁúü„Å£Áõ¥„Åê„Å´‰øù„Å°„Å™„Åå„ÇâË™øÊï¥„Åó„Åæ„Åô'
                            ]
                        };
                    }
                    return null;
                    
                case 'handPosition':
                    if (viewType === 'back' && scores.handPositionData) {
                        const data = scores.handPositionData;
                        return {
                            current: `‰Ωì„Åã„Çâ${data.currentValue}${data.unit}`,
                            ideal: `‰Ωì„Åã„Çâ${data.idealValue}${data.unit}`,
                            gap: `${Math.abs(data.currentValue - data.idealValue)}${data.unit}`,
                            steps: [
                                'ËÖï„ÇíËá™ÁÑ∂„Å´ÂûÇ„Çâ„Åó„Åü‰ΩçÁΩÆ„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åô',
                                `Êâã„ÅÆ‰ΩçÁΩÆ„Çí‰Ωì„Å´${data.currentValue > data.idealValue ? '„Çà„ÇäËøë„Åè' : '„Çà„ÇäÈÅ†„Åè'}Ë™øÊï¥„Åó„Åæ„Åô`,
                                'ËÇ©„ÅÆÂäõ„ÇíÊäú„ÅÑ„Å¶„É™„É©„ÉÉ„ÇØ„Çπ„Åó„ÅüÊâã„ÅÆ‰ΩçÁΩÆ„Çí‰øù„Å°„Åæ„Åô'
                            ]
                        };
                    }
                    return null;
                    
                default:
                    return null;
            }
        }

        // Ë¶ñË¶öÁöÑÊØîËºÉ„Éá„Éº„ÇøÁîüÊàê
        function generateVisualComparison(key, scores, clubType) {
            const viewType = document.getElementById('viewSelect').value;
            
            switch(key) {
                case 'bodyAlignment':
                    if (viewType === 'back' && scores.bodyAlignmentData) {
                        const data = scores.bodyAlignmentData;
                        return {
                            title: '‰Ωì„ÅÆÂêë„Åç„ÅÆÊØîËºÉ',
                            beforeValue: `${data.currentValue}${data.unit}`,
                            afterValue: 'Âπ≥Ë°å„Å´Êï¥Âàó',
                            beforeDescription: 'ËÇ©„ÉªËÖ∞„Éª„Åã„Åã„Å®„ÅÆ„Ç∫„É¨',
                            afterDescription: 'ÁêÜÊÉ≥„ÅÆ‰Ωì„ÅÆÂêë„Åç',
                            improvement: '‰Ωì„ÅÆ„É©„Ç§„É≥„ÇíÊèÉ„Åà„Çã„Åì„Å®„ÅßÊñπÂêëÊÄß„ÅåÂêë‰∏ä'
                        };
                    }
                    return null;
                    
                case 'forwardTilt':
                    if (viewType === 'back' && scores.forwardTiltData) {
                        const data = scores.forwardTiltData;
                        const currentStatus = data.currentValue < data.idealValue ? 'ÊµÖ„Åô„Åé„ÇãÂâçÂÇæ' : 'Ê∑±„Åô„Åé„ÇãÂâçÂÇæ';
                        const adjustment = data.currentValue < data.idealValue ? '„Çà„ÇäÊ∑±„ÅèÂâçÂÇæ' : '„Çà„ÇäÊµÖ„ÅèÂâçÂÇæ';
                        return {
                            title: 'ÂâçÂÇæËßíÂ∫¶„ÅÆÊØîËºÉ',
                            beforeValue: currentStatus,
                            afterValue: 'ÈÅ©Âàá„Å™ÂâçÂÇæËßíÂ∫¶',
                            beforeDescription: 'ÁèæÂú®„ÅÆÂâçÂÇæÁä∂ÊÖã',
                            afterDescription: 'ÁêÜÊÉ≥„ÅÆÂâçÂÇæËßíÂ∫¶',
                            improvement: `${adjustment}„Åô„Çã„Åì„Å®„ÅßÂÆâÂÆöÊÄß„ÅåÂêë‰∏ä`
                        };
                    }
                    return null;
                    
                case 'ballPosition':
                    if (scores.ballPositionData) {
                        const data = scores.ballPositionData;
                        const positionNames = {
                            'Driver': 'Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ',
                            'FairwayWood': 'Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥',
                            'Utility': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶',
                            '3Iron': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶',
                            '4Iron': '‰∏≠Â§Æ',
                            '5Iron': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥',
                            '6Iron': '‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥',
                            '7Iron': '‰∏≠Â§Æ„Çà„ÇäÂè≥',
                            '8Iron': '‰∏≠Â§Æ„Çà„ÇäÂè≥',
                            '9Iron': 'Âè≥Ë∂≥„Çà„Çä',
                            'PW': 'Âè≥Ë∂≥„Çà„Çä',
                            'SW': 'Âè≥Ë∂≥ÂØÑ„Çä'
                        };
                        
                        const idealPos = positionNames[clubType] || 'ÈÅ©Âàá„Å™‰ΩçÁΩÆ';
                        const currentPos = data.isLeftOfIdeal ? 'ÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„ÇäÂ∑¶' : 'ÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„ÇäÂè≥';
                        const deviation = Math.round(data.deviation * 100 * 10) / 10;
                        
                        return {
                            title: '„Éú„Éº„É´‰ΩçÁΩÆ„ÅÆÊØîËºÉ',
                            beforeValue: currentPos,
                            afterValue: idealPos,
                            beforeDescription: 'ÁèæÂú®„ÅÆ„Éú„Éº„É´‰ΩçÁΩÆ',
                            afterDescription: 'ÁêÜÊÉ≥„ÅÆ„Éú„Éº„É´‰ΩçÁΩÆ',
                            improvement: `Á¥Ñ${deviation}cm„ÅÆË™øÊï¥„ÅßÂ§ßÂπÖÊîπÂñÑ`
                        };
                    }
                    return null;
                    
                case 'stance':
                    if (scores.stanceStatus) {
                        const status = scores.stanceStatus;
                        const idealDesc = clubType === 'Driver' ? 'ËÇ©ÂπÖ„Çà„ÇäÂ∞ë„ÅóÂ∫É„ÇÅ' : 'ËÇ©ÂπÖÁ®ãÂ∫¶';
                        
                        let currentDesc = '';
                        let improvement = '';
                        
                        switch(status) {
                            case 'slightly_narrow':
                            case 'narrow':
                            case 'too_narrow':
                            case 'much_too_narrow':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„ÇäÁã≠„ÅÑ„Çπ„Çø„É≥„Çπ';
                                improvement = '„Çπ„Çø„É≥„Çπ„ÇíÂ∫É„Åí„Çã„Åì„Å®„ÅßÂÆâÂÆöÊÄßÂêë‰∏ä';
                                break;
                            case 'slightly_wide':
                            case 'wide':
                            case 'too_wide':
                            case 'much_too_wide':
                                currentDesc = 'ÁêÜÊÉ≥„Çà„ÇäÂ∫É„ÅÑ„Çπ„Çø„É≥„Çπ';
                                improvement = '„Çπ„Çø„É≥„Çπ„ÇíÁã≠„ÇÅ„Çã„Åì„Å®„Åß„Éê„É©„É≥„ÇπÊîπÂñÑ';
                                break;
                            default:
                                return null;
                        }
                        
                        return {
                            title: '„Çπ„Çø„É≥„ÇπÂπÖ„ÅÆÊØîËºÉ',
                            beforeValue: currentDesc,
                            afterValue: idealDesc,
                            beforeDescription: 'ÁèæÂú®„ÅÆ„Çπ„Çø„É≥„Çπ',
                            afterDescription: 'ÁêÜÊÉ≥„ÅÆ„Çπ„Çø„É≥„Çπ',
                            improvement: improvement
                        };
                    }
                    return null;
                    
                case 'handPosition':
                    if (viewType === 'back' && scores.handPositionData) {
                        const data = scores.handPositionData;
                        const adjustment = data.currentValue > data.idealValue ? '‰Ωì„Å´Ëøë„Å•„Åë„Çã' : '‰Ωì„Åã„ÇâÈõ¢„Åô';
                        
                        return {
                            title: 'Êâã„ÅÆ‰ΩçÁΩÆ„ÅÆÊØîËºÉ',
                            beforeValue: `‰Ωì„Åã„Çâ${data.currentValue}cm`,
                            afterValue: `‰Ωì„Åã„Çâ${data.idealValue}cm`,
                            beforeDescription: 'ÁèæÂú®„ÅÆÊâã„ÅÆ‰ΩçÁΩÆ',
                            afterDescription: 'ÁêÜÊÉ≥„ÅÆÊâã„ÅÆ‰ΩçÁΩÆ',
                            improvement: `Êâã„Çí${adjustment}„Åì„Å®„Åß„Çπ„Ç§„É≥„Ç∞„Éó„É¨„Éº„É≥„ÅåÊîπÂñÑ`
                        };
                    }
                    return null;
                    
                default:
                    return null;
            }
        }

        // Ë¶ñË¶öÁöÑÊØîËºÉHTMLÁîüÊàê
        function generateVisualComparisonHTML(visualData) {
            if (!visualData) return '';
            
            return `
                <div class="visual-comparison">
                    <div style="font-weight: bold; color: #495057; margin-bottom: 10px; display: flex; align-items: center;">
                        <span style="margin-right: 8px;">üëÄ</span>
                        ${visualData.title}
                    </div>
                    <div class="before-after-container">
                        <div class="comparison-side comparison-before">
                            <div class="comparison-label-visual label-before">ÊîπÂñÑÂâç</div>
                            <div class="angle-display angle-before">${visualData.beforeValue}</div>
                            <div style="font-size: 0.9em; color: #666;">${visualData.beforeDescription}</div>
                            <div class="visual-indicator">
                                <span style="color: #dc3545; font-size: 1.5em;">‚ö†Ô∏è</span>
                            </div>
                        </div>
                        <div class="comparison-side comparison-after">
                            <div class="comparison-label-visual label-after">ÊîπÂñÑÂæå</div>
                            <div class="angle-display angle-after">${visualData.afterValue}</div>
                            <div style="font-size: 0.9em; color: #666;">${visualData.afterDescription}</div>
                            <div class="visual-indicator">
                                <span style="color: #28a745; font-size: 1.5em;">‚úÖ</span>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; padding: 10px; background: rgba(40, 167, 69, 0.1); border-radius: 5px; font-weight: bold; color: #28a745;">
                        üí° ${visualData.improvement}
                    </div>
                </div>
            `;
        }

        // Ë©≥Á¥∞ÊØîËºÉHTMLÁîüÊàê
        function generateDetailedComparisonHTML(comparisonData) {
            if (!comparisonData) return '';
            
            return `
                <div class="detailed-comparison">
                    <div style="font-weight: bold; color: #495057; margin-bottom: 10px; display: flex; align-items: center;">
                        <span style="margin-right: 8px;">üìä</span>
                        Ë©≥Á¥∞ÂàÜÊûê
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-label">È†ÖÁõÆ</div>
                        <div class="comparison-current">ÁèæÁä∂</div>
                        <div class="comparison-ideal">ÁêÜÊÉ≥</div>
                        <div class="comparison-gap">Â∑ÆÁï∞</div>
                    </div>
                    <div class="comparison-row">
                        <div class="comparison-label">‰ΩçÁΩÆ/ËßíÂ∫¶</div>
                        <div class="comparison-current">${comparisonData.current}</div>
                        <div class="comparison-ideal">${comparisonData.ideal}</div>
                        <div class="comparison-gap">${comparisonData.gap}</div>
                    </div>
                    <div class="improvement-steps">
                        <div style="font-weight: bold; color: #495057; margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="margin-right: 8px;">üéØ</span>
                            ÊîπÂñÑ„Çπ„ÉÜ„ÉÉ„Éó
                        </div>
                        ${comparisonData.steps.map((step, index) => `
                            <div class="improvement-step">
                                <div class="step-number">${index + 1}</div>
                                <div>${step}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ÁµêÊûúË°®Á§∫Ôºà„Çπ„Ç≥„Ç¢„Å®„Ç¢„Éâ„Éê„Ç§„Çπ„ÇíÁµ±ÂêàÔºâ
        function displayResults(scores) {
            const scoreFeedbackGrid = document.getElementById('scoreFeedbackGrid');
            scoreFeedbackGrid.innerHTML = '';
            const viewType = document.getElementById('viewSelect').value;

            // Ë¶ñÁÇπÂà•„Å´Ë°®Á§∫È†ÖÁõÆ„ÇíÂ§âÊõ¥
            let scoreItems;
            if (viewType === 'front') {
                scoreItems = [
                    { key: 'total', label: 'Á∑èÂêà„Çπ„Ç≥„Ç¢' },
                    { key: 'ballPosition', label: '„Éú„Éº„É´‰ΩçÁΩÆ' },
                    { key: 'stance', label: '„Çπ„Çø„É≥„ÇπÂπÖ' },
                    { key: 'weight', label: 'ÈáçÂøÉÈÖçÂàÜ' },
                    { key: 'balance', label: '„Éê„É©„É≥„Çπ' },
                    { key: 'headPosition', label: 'È†≠„ÅÆ‰ΩçÁΩÆ' }
                ];
            } else {
                scoreItems = [
                    { key: 'total', label: 'Á∑èÂêà„Çπ„Ç≥„Ç¢' },
                    { key: 'bodyAlignment', label: '‰Ωì„ÅÆÂêë„Åç' },
                    { key: 'forwardTilt', label: 'ÂâçÂÇæËßíÂ∫¶' },
                    { key: 'handPosition', label: 'Êâã„ÅÆ‰ΩçÁΩÆ' },
                    { key: 'frontBackWeight', label: 'ÂâçÂæå„ÅÆÈáçÂøÉ' },
                    { key: 'spinalCurve', label: 'ËÉåÁ≠ã„ÅÆÊõ≤„Åå„Çä' }
                ];
            }

            const advice = generateAdvice(scores);
            const clubType = document.getElementById('clubSelect').value;

            scoreItems.forEach(item => {
                if (scores[item.key] !== undefined) {
                    const scoreValue = scores[item.key];
                    const scoreClass = getScoreClass(scoreValue);
                    
                    // ÁÇπÊï∞„Å´Èñ¢„Çè„Çâ„Åö„Ç¢„Éâ„Éê„Ç§„Çπ„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„ÅøË°®Á§∫
                    
                    const scoreElement = document.createElement('div');
                    scoreElement.className = `score-feedback-item ${scoreClass}`;
                    scoreElement.innerHTML = `
                        <div class="score-header">
                            <div class="score-title">${item.label}</div>
                            <div class="score-value">${scoreValue}ÁÇπ</div>
                        </div>
                        <div class="advice-text">${advice[item.key]}</div>
                    `;
                    scoreFeedbackGrid.appendChild(scoreElement);
                }
            });
        }

        // „Çπ„Ç≥„Ç¢„ÇØ„É©„ÇπÂà§ÂÆö
        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 80) return 'score-good';
            if (score >= 70) return 'score-average';
            return 'score-poor';
        }

        // „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà‰ΩúÊàêÔºàË¶ñÁÇπÂà•Ôºâ
        function createRadarChart(scores) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const viewType = document.getElementById('viewSelect').value;
            
            if (radarChartInstance) {
                radarChartInstance.destroy();
            }

            let labels, scoreData, idealData;
            
            if (viewType === 'front') {
                labels = ['„Éú„Éº„É´‰ΩçÁΩÆ', '„Çπ„Çø„É≥„ÇπÂπÖ', 'ÈáçÂøÉÈÖçÂàÜ', '„Éê„É©„É≥„Çπ', 'È†≠„ÅÆ‰ΩçÁΩÆ'];
                scoreData = [
                    scores.ballPosition,
                    scores.stance,
                    scores.weight,
                    scores.balance,
                    scores.headPosition
                ];
                idealData = [100, 100, 100, 100, 100];
            } else {
                labels = ['‰Ωì„ÅÆÂêë„Åç', 'ÂâçÂÇæËßíÂ∫¶', 'Êâã„ÅÆ‰ΩçÁΩÆ', 'ÂâçÂæå„ÅÆÈáçÂøÉ', 'ËÉåÁ≠ã„ÅÆÊõ≤„Åå„Çä'];
                scoreData = [
                    scores.bodyAlignment,
                    scores.forwardTilt,
                    scores.handPosition,
                    scores.frontBackWeight,
                    scores.spinalCurve
                ];
                idealData = [100, 100, 100, 100, 100];
            }

            const data = {
                labels: labels,
                datasets: [{
                    label: '„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≥„Ç¢',
                    data: scoreData,
                    backgroundColor: 'rgba(102, 126, 234, 0.3)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 3,
                    pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(102, 126, 234, 1)',
                    pointHoverRadius: 8
                }, {
                    label: 'ÁêÜÊÉ≥ÂÄ§',
                    data: idealData,
                    backgroundColor: 'rgba(40, 167, 69, 0.15)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(40, 167, 69, 1)',
                    pointHoverRadius: 7
                }]
            };

            // „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Âà§ÂÆö
            const isMobile = window.innerWidth <= 768;
            
            const config = {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: isMobile ? {
                            top: 40,
                            bottom: 40,
                            left: 25,
                            right: 25
                        } : {
                            top: 50,
                            bottom: 50,
                            left: 50,
                            right: 50
                        }
                    },
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            beginAtZero: true,
                            ticks: {
                                stepSize: 20,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            pointLabels: {
                                font: {
                                    size: isMobile ? 12 : 14,
                                    weight: 'bold'
                                },
                                color: '#333',
                                padding: isMobile ? 15 : 20
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#333',
                                padding: 20
                            }
                        },
                        title: {
                            display: true,
                            text: `„Ç¥„É´„Éï„Ç¢„Éâ„É¨„ÇπÂàÜÊûê - ${viewType === 'front' ? 'Ê≠£Èù¢Ë¶ñÁÇπ' : 'ÂæåÊñπË¶ñÁÇπ'}`,
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            color: '#333',
                            padding: 20
                        }
                    }
                }
            };

            radarChartInstance = new Chart(ctx, config);
        }

        // „Çπ„Çø„É≥„ÇπÂπÖ„ÅÆ„Ç¢„Éâ„Éê„Ç§„ÇπÁîüÊàê
        function getStanceAdvice(stanceStatus, clubType) {
            // ÁêÜÊÉ≥„ÅÆË°®Áèæ„ÇíÂàÜ„Åã„Çä„ÇÑ„Åô„Åè
            const idealDescription = clubType === 'Driver' ? 
                'ËÇ©ÂπÖ„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÇÅ' :
                'ËÇ©ÂπÖÁ®ãÂ∫¶';
                
            switch(stanceStatus) {
                case 'slightly_narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∞ë„ÅóÁã≠„ÇÅ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÁã≠„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'too_narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇ„Åã„Å™„ÇäÁã≠„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'much_too_narrow':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÈùûÂ∏∏„Å´Áã≠„Åô„Åé„Åæ„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'slightly_wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÇÅ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∫É„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'too_wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇ„Åã„Å™„ÇäÂ∫É„ÅÑ„Åß„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                case 'much_too_wide':
                    return `ÁèæÁä∂„ÅØÁêÜÊÉ≥„Çà„Çä„ÇÇÈùûÂ∏∏„Å´Â∫É„Åô„Åé„Åæ„Åô„ÄÇ\nüìè ÁêÜÊÉ≥Ôºö${idealDescription}`;
                default:
                    return `ÁêÜÊÉ≥Ôºö${idealDescription}`;
            }
        }

        // „Éú„Éº„É´‰ΩçÁΩÆ„ÅÆ„Ç¢„Éâ„Éê„Ç§„ÇπÁîüÊàê
        function getBallPositionAdvice(score, ballPositionData) {
            if (score >= 80) {
                return '„Éú„Éº„É´‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆ‰ΩçÁΩÆ„ÇíÊÑèË≠ò„Åó„Å¶„Ç¢„Éâ„É¨„Çπ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
            }
            
            if (!ballPositionData) {
                return '„Éú„Éº„É´‰ΩçÁΩÆ„ÇíË™øÊï¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
            }
            
            const { clubType, isLeftOfIdeal } = ballPositionData;
            
            // „ÇØ„É©„ÉñÂà•„ÅÆÁêÜÊÉ≥‰ΩçÁΩÆ„ÅÆË™¨Êòé
            const idealDescription = getIdealBallPositionDescription(clubType);
            
            // ÁèæÂú®‰ΩçÁΩÆ„ÅåÁêÜÊÉ≥‰ΩçÁΩÆ„Çà„Çä„ÇÇÂ∑¶„Å´„ÅÇ„Çã„ÅãÂè≥„Å´„ÅÇ„Çã„Åã
            const direction = isLeftOfIdeal ? 'Âè≥ÂØÑ„Çä' : 'Â∑¶ÂØÑ„Çä';
            const currentStatus = isLeftOfIdeal ? 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÂ∑¶' : 'ÁêÜÊÉ≥„Çà„Çä„ÇÇÂè≥';
            
            return `ÁèæÁä∂„ÅØ${currentStatus}„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ\nüèåÔ∏è‚Äç‚ôÇÔ∏è ÁêÜÊÉ≥Ôºö${idealDescription}\nüí° ${direction}„Å´Ë™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
        }
        
        // ÁêÜÊÉ≥„Éú„Éº„É´‰ΩçÁΩÆ„ÅÆË™¨Êòé
        function getIdealBallPositionDescription(clubType) {
            switch(clubType) {
                case 'Driver':
                    return 'Â∑¶Ë∂≥„Åã„Åã„Å®‰ΩçÁΩÆ';
                case 'FairwayWood':
                    return 'Â∑¶Ë∂≥„Åã„Åã„Å®ÂÜÖÂÅ¥„Çà„ÇäÂ∞ë„ÅóÂè≥';
                case 'Utility':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶';
                case '3Iron':
                case '4Iron':
                case '5Iron':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂ∑¶';
                case '6Iron':
                case '7Iron':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ';
                case '8Iron':
                case '9Iron':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂ∞ë„ÅóÂè≥';
                case 'Wedge':
                    return '„Çπ„Çø„É≥„Çπ‰∏≠Â§Æ„Çà„ÇäÂè≥';
                default:
                    return '„ÇØ„É©„Éñ„Å´Âøú„Åò„ÅüÈÅ©Âàá„Å™‰ΩçÁΩÆ';
            }
        }

        // Á∑èÂêà„Çπ„Ç≥„Ç¢„ÅÆÂÖ∑‰ΩìÁöÑ„Å™„Ç≥„É°„É≥„ÉàÁîüÊàê
        function generateTotalScoreAdvice(scores, viewType) {
            // ËâØ„ÅÑÈ†ÖÁõÆ„Å®ÊîπÂñÑ„ÅåÂøÖË¶Å„Å™È†ÖÁõÆ„ÇíÂàÜÈ°û
            const goodItems = [];
            const poorItems = [];
            
            if (viewType === 'front') {
                const items = [
                    { key: 'ballPosition', name: '„Éú„Éº„É´‰ΩçÁΩÆ' },
                    { key: 'stance', name: '„Çπ„Çø„É≥„ÇπÂπÖ' },
                    { key: 'weight', name: 'ÈáçÂøÉÈÖçÂàÜ' },
                    { key: 'balance', name: '„Éê„É©„É≥„Çπ' },
                    { key: 'headPosition', name: 'È†≠„ÅÆ‰ΩçÁΩÆ' }
                ];
                items.forEach(item => {
                    if (scores[item.key] >= 75) {
                        goodItems.push(item.name);
                    } else if (scores[item.key] < 70) {
                        poorItems.push(item.name);
                    }
                });
            } else {
                const items = [
                    { key: 'bodyAlignment', name: '‰Ωì„ÅÆÂêë„Åç' },
                    { key: 'forwardTilt', name: 'ÂâçÂÇæËßíÂ∫¶' },
                    { key: 'handPosition', name: 'Êâã„ÅÆ‰ΩçÁΩÆ' },
                    { key: 'frontBackWeight', name: 'ÂâçÂæå„ÅÆÈáçÂøÉ' },
                    { key: 'spinalCurve', name: 'ËÉåÁ≠ã„ÅÆÊõ≤„Åå„Çä' }
                ];
                items.forEach(item => {
                    if (scores[item.key] >= 75) {
                        goodItems.push(item.name);
                    } else if (scores[item.key] < 70) {
                        poorItems.push(item.name);
                    }
                });
            }
            
            const totalScore = scores.total;
            let advice = '';
            
            if (totalScore >= 90) {
                advice = 'üèÜ „Éë„Éº„Éï„Çß„ÇØ„Éà„Å™„Ç¢„Éâ„É¨„Çπ„Åß„ÅôÔºÅ';
                if (goodItems.length > 0) {
                    advice += `Áâπ„Å´„Äê${goodItems.join('„Éª')}„Äë„ÅåÂÑ™ÁßÄ„Åß„ÄÅ„Éó„É≠„É¨„Éô„É´„ÅÆÂÆâÂÆö„Åó„Åü„Ç¢„Éâ„É¨„Çπ„ÅåÂèñ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
                }
                advice += '„Åì„ÅÆÁ¥†Êô¥„Çâ„Åó„ÅÑÂßøÂã¢„ÇíÁ∂≠ÊåÅ„Åó„Å¶„Çπ„Ç§„É≥„Ç∞„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ„Åç„Å£„Å®ËâØ„ÅÑ„Çπ„Ç≥„Ç¢„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ';
            } else if (totalScore >= 85) {
                advice = '‚ú® ÈùûÂ∏∏„Å´ËâØ„ÅÑ„Ç¢„Éâ„É¨„Çπ„Åß„ÅôÔºÅ';
                if (goodItems.length > 0) {
                    advice += `„Äê${goodItems.join('„Éª')}„Äë„ÅåÁâπ„Å´ËâØÂ•Ω„Åß„ÄÅ„Åª„ÅºÁêÜÊÉ≥ÁöÑ„Å™ÂßøÂã¢„ÅåÂèñ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
                }
                if (poorItems.length > 0) {
                    advice += `„Äê${poorItems.join('„Éª')}„Äë„ÇíÂæÆË™øÊï¥„Åô„Çã„Åì„Å®„Åß„ÄÅ„Åï„Çâ„Å´ÂÆâÂÆö„Åó„Åü„Ç∑„Éß„ÉÉ„Éà„ÅåÊâì„Å¶„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô„ÄÇ`;
                }
            } else if (totalScore >= 75) {
                advice = 'üëç ËâØ„ÅÑ„Ç¢„Éâ„É¨„Çπ„Åß„Åô„ÄÇ';
                if (goodItems.length > 0) {
                    advice += `„Äê${goodItems.join('„Éª')}„Äë„ÅØËâØÂ•Ω„Å™Áä∂ÊÖã„Åß„Åô„ÄÇ`;
                }
                if (poorItems.length > 0) {
                    advice += `„Äê${poorItems.join('„Éª')}„Äë„ÇíÈáçÁÇπÁöÑ„Å´ÊîπÂñÑ„Åô„Çã„Åì„Å®„Åß„ÄÅ„Çà„ÇäËâØ„ÅÑ„Ç¢„Éâ„É¨„Çπ„Å´„Å™„Çä„Åæ„Åô„ÄÇ`;
                }
                advice += 'Á∂ôÁ∂öÁöÑ„Å™Á∑¥Áøí„ÅßÁ¢∫ÂÆü„Å´‰∏äÈÅî„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ';
            } else if (totalScore >= 65) {
                advice = '‚ö†Ô∏è „Ç¢„Éâ„É¨„Çπ„Å´ÊîπÂñÑ„ÅÆ‰ΩôÂú∞„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ';
                if (goodItems.length > 0) {
                    advice += `„Äê${goodItems.join('„Éª')}„Äë„ÅØËâØ„ÅÑÁä∂ÊÖã„Çí„Ç≠„Éº„Éó„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
                }
                if (poorItems.length > 0) {
                    advice += `Áâπ„Å´„Äê${poorItems.join('„Éª')}„Äë„ÅÆË¶ãÁõ¥„Åó„ÅåÈáçË¶Å„Åß„Åô„ÄÇ`;
                }
                advice += 'Âü∫Êú¨„Å´Á´ã„Å°Ëøî„Å£„Å¶Á∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
            } else if (totalScore >= 50) {
                advice = 'üìö „Ç¢„Éâ„É¨„Çπ„ÅÆÂü∫Êú¨„Åã„ÇâË¶ãÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                if (goodItems.length > 0) {
                    advice += `„Äê${goodItems.join('„Éª')}„Äë„ÅØËâØ„ÅÑÂÇæÂêë„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ`;
                }
                if (poorItems.length > 0) {
                    advice += `„Äê${poorItems.join('„Éª')}„Äë„Çí‰∏≠ÂøÉ„Å´Âü∫Êú¨ÁöÑ„Å™„Ç¢„Éâ„É¨„Çπ„ÅÆË¶ÅÁ¥†„ÇíÁ¢∫Ë™ç„Åó„ÄÅÊ≠£„Åó„ÅÑ„Éï„Ç©„Éº„É†„ÇíË∫´„Å´„Å§„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                }
            } else {
                advice = 'üîÑ „Ç¢„Éâ„É¨„Çπ„ÇíÊ†πÊú¨„Åã„ÇâË¶ãÁõ¥„ÅôÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ';
                if (poorItems.length > 0) {
                    advice += `Áâπ„Å´„Äê${poorItems.join('„Éª')}„Äë„ÅÆÂ§ßÂπÖ„Å™ÊîπÂñÑ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`;
                }
                advice += '„Éó„É≠„ÅÆ„É¨„ÉÉ„Çπ„É≥„ÇíÂèó„Åë„Çã„Åã„ÄÅÂü∫Êú¨ÁöÑ„Å™ÊïôÊùê„ÇíÂèÇËÄÉ„Å´„Åó„Å¶„ÄÅÊ≠£„Åó„ÅÑ„Ç¢„Éâ„É¨„Çπ„ÇíÁøíÂæó„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Á∑¥Áøí„ÅåÈáçË¶Å„Åß„Åô„ÄÇ';
            }
            
            return advice;
        }

        // „Ç¢„Éâ„Éê„Ç§„ÇπÁîüÊàê
        function generateAdvice(scores) {
            const clubType = document.getElementById('clubSelect').value;
            const viewType = document.getElementById('viewSelect').value;
            
            let advice = {
                total: generateTotalScoreAdvice(scores, viewType),
                
                spine: scores.spine >= 80 ? 
                    'ËÑäÊ§é„ÅÆÁõ¥Á∑öÊÄß„ÅØËâØÂ•Ω„Åß„Åô„ÄÇ„Åì„ÅÆÂßøÂã¢„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    'Ê≠£Èù¢„Åã„ÇâË¶ã„Å¶„ÄÅËÇ©„Å®ËÖ∞„ÅÆ‰∏≠ÂøÉ„Åå‰∏ÄÁõ¥Á∑ö„Å´„Å™„Çã„Çà„ÅÜÊÑèË≠ò„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÂ∑¶Âè≥„ÅÆÂÇæ„Åç„Çí‰øÆÊ≠£„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                
                shoulder: scores.shoulder >= 80 ? 
                    'ËÇ©„ÅÆ‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„É™„É©„ÉÉ„ÇØ„Çπ„Åó„ÅüÁä∂ÊÖã„Çí‰øù„Å°„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    '‰∏°ËÇ©„ÅÆÈ´ò„Åï„ÇíÊèÉ„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÊ≠£Èù¢„Åã„ÇâË¶ã„Å¶Ê∞¥Âπ≥„Å´„Å™„Çã„Çà„ÅÜË™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ',
                
                knee: scores.knee >= 80 ? 
                    'ËÜù„ÅÆ‰ΩçÁΩÆ„ÅØËâØÂ•Ω„Åß„Åô„ÄÇ„Åì„ÅÆÂÆâÂÆö„Åó„Åü„Çπ„Çø„É≥„Çπ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    'ËÜù„ÅåËÇ°Èñ¢ÁØÄ„ÅÆÁúü‰∏ã„Å´Êù•„Çã„Çà„ÅÜË™øÊï¥„Åó„ÄÅ‰∏°ËÜù„ÅÆÈ´ò„Åï„ÇíÊèÉ„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ',
                
                ballPosition: getBallPositionAdvice(scores.ballPosition, scores.ballPositionData),
                
                stance: scores.stance >= 80 ? 
                    (clubType === 'Driver' ? 
                        '„Çπ„Çø„É≥„ÇπÂπÖ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Éâ„É©„Ç§„Éê„Éº„ÅØËÇ©ÂπÖ„Çà„Çä„ÇÇÂ∞ë„ÅóÂ∫É„ÅÑ„Åè„Çâ„ÅÑ„ÅåÁêÜÊÉ≥„Åß„Åô„ÄÇ' :
                        '„Çπ„Çø„É≥„ÇπÂπÖ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇËÇ©ÂπÖ„ÅåÁêÜÊÉ≥ÁöÑ„Åß„Åô„ÄÇ') :
                    getStanceAdvice(scores.stanceStatus, clubType),
                
                weight: scores.weight >= 80 ? 
                    'ÈáçÂøÉÈÖçÂàÜ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆÊÑüË¶ö„ÇíË¶ö„Åà„Å¶„Åä„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    (function() {
                        if (scores.weightData) {
                            const data = scores.weightData;
                            let advice = `ÁèæÁä∂„ÅØ${data.currentBalance}„Åß„Åô„ÄÇ`;
                            
                            if (data.status.includes('left')) {
                                advice += 'Â∑¶Ë∂≥„Å∏„ÅÆÈáçÂøÉ„ÇíÊ∏õ„Çâ„Åó„ÄÅÂè≥Ë∂≥„Å´„ÇÇ„ÅÜÂ∞ë„Åó‰ΩìÈáç„Çí„Åã„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                            } else if (data.status.includes('right')) {
                                advice += 'Âè≥Ë∂≥„Å∏„ÅÆÈáçÂøÉ„ÇíÊ∏õ„Çâ„Åó„ÄÅÂ∑¶Ë∂≥„Å´„ÇÇ„ÅÜÂ∞ë„Åó‰ΩìÈáç„Çí„Åã„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                            }
                            
                            advice += `\nüìç ÁêÜÊÉ≥„ÅÆÈÖçÂàÜÔºö${data.idealBalance}`;
                            return advice;
                        }
                        return clubType === 'Driver' ? 
                            'ÈáçÂøÉ„Çí„ÇÇ„ÅÜÂ∞ë„ÅóÂè≥Ë∂≥„Å´Áßª„Åó„Åæ„Åó„Çá„ÅÜÔºà6:4„ÅÆÈÖçÂàÜÔºâ„ÄÇ„Éâ„É©„Ç§„Éê„Éº„Åß„ÅØÂè≥ÈáçÂøÉ„ÅåÁêÜÊÉ≥„Åß„Åô„ÄÇ' :
                            'ÈáçÂøÉ„ÇíÂ∑¶Âè≥ÂùáÁ≠â„Å´ÈÖçÂàÜ„Åó„Åæ„Åó„Çá„ÅÜÔºà5:5„ÅÆÈÖçÂàÜÔºâ„ÄÇ„Éê„É©„É≥„Çπ„ÅÆÂèñ„Çå„Åü„Çπ„Çø„É≥„Çπ„ÇíÂøÉ„Åå„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    })(),
                
                balance: scores.balance >= 80 ? 
                    '„Éê„É©„É≥„Çπ„ÅØËâØÂ•Ω„Åß„Åô„ÄÇ„Åì„ÅÆÂÆâÂÆö„Åó„ÅüÂßøÂã¢„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    (function() {
                        let advice = 'ÁèæÁä∂„ÅØ‰∏äÂçäË∫´„Å®‰∏ãÂçäË∫´„ÅÆ„Éê„É©„É≥„Çπ„ÅåÂ¥©„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                        advice += 'ËÇ©„Å®ËÖ∞„ÅÆ„É©„Ç§„É≥„ÇíÂπ≥Ë°å„Å´‰øù„Å°„ÄÅÈáçÂøÉ„Çí‰∏≠Â§Æ„Å´ÁΩÆ„Åè„Çà„ÅÜË™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                        advice += '\nüìç ÁêÜÊÉ≥„ÅÆÂΩ¢Ôºö‰∏äÂçäË∫´„Å®‰∏ãÂçäË∫´„ÅÆ‰∏≠ÂøÉËª∏„Åå‰∏ÄÁõ¥Á∑ö';
                        return advice;
                    })(),
                
                headPosition: scores.headPosition >= 80 ? 
                    'È†≠„ÅÆ‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆÁä∂ÊÖã„Çí‰øù„Å°„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                    (function() {
                        let advice = 'ÁèæÁä∂„ÅØÈ†≠„ÅåÂ∑¶Âè≥„ÅÆ„Å©„Å°„Çâ„Åã„Å´ÂÇæ„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                        advice += 'È†≠„Çí‰∏°ËÇ©„ÅÆ‰∏≠Â§Æ„Å´‰ΩçÁΩÆ„Åï„Åõ„ÄÅÂ∑¶Âè≥„Å´ÂÇæ„Åã„Å™„ÅÑ„Çà„ÅÜÊ≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                        advice += '\nüìç ÁêÜÊÉ≥„ÅÆÂΩ¢ÔºöÈ†≠„Åå‰∏°ËÇ©„ÅÆÁúü„Çì‰∏≠„Å´‰ΩçÁΩÆ„Åó„ÄÅÈ¶ñÁ≠ã„ÅåËá™ÁÑ∂„Å´‰º∏„Å≥„ÅüÁä∂ÊÖã';
                        return advice;
                    })()
            };
            
            if (viewType === 'back') {
                advice = {
                    ...advice,
                    bodyAlignment: scores.bodyAlignment >= 80 ? 
                        '‰Ωì„ÅÆÂêë„Åç„ÅØËâØÂ•Ω„Åß„Åô„ÄÇËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅåÈÅ©Âàá„Å´ÊèÉ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ' :
                        (function() {
                            let advice = 'ÁèæÁä∂„ÅØËÇ©„ÄÅËÖ∞„ÄÅ„Åã„Åã„Å®„ÅÆ„É©„Ç§„É≥„ÅåÁõÆÊ®ôÊñπÂêë„Å´ÂØæ„Åó„Å¶„Ç∫„É¨„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                            advice += '‰ΩìÂÖ®‰Ωì„ÇíÁõÆÊ®ôÊñπÂêë„Å´Âπ≥Ë°å„Å´Âêë„Åë„Çã„Çà„ÅÜË™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                            advice += '\nüìç ÁêÜÊÉ≥„ÅÆÂΩ¢ÔºöËÇ©„ÉªËÖ∞„Éª„Åã„Åã„Å®„ÅÆ„É©„Ç§„É≥„ÅåÁõÆÊ®ôÊñπÂêë„Å®Âπ≥Ë°å„Åß‰∏ÄÁõ¥Á∑ö';
                            return advice;
                        })(),
                    
                    forwardTilt: scores.forwardTilt >= 80 ? 
                        'ÂâçÂÇæËßíÂ∫¶„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆËßíÂ∫¶„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        (function() {
                            if (scores.forwardTiltData) {
                                const data = scores.forwardTiltData;
                                const current = data.currentValue;
                                const ideal = data.idealValue;
                                let advice = '';
                                
                                if (current < ideal) {
                                    advice = 'ÁèæÂú®„ÅÆÂâçÂÇæËßíÂ∫¶„ÅåÊµÖ„Åô„Åé„Åæ„Åô„ÄÇ„ÇÇ„Å£„Å®Ê∑±„ÅèÂâçÂÇæ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                                } else {
                                    advice = 'ÁèæÂú®„ÅÆÂâçÂÇæËßíÂ∫¶„ÅåÊ∑±„Åô„Åé„Åæ„Åô„ÄÇÂâçÂÇæ„ÇíÊµÖ„Åè„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                                }
                                advice += 'ËÇ°Èñ¢ÁØÄ„Åã„ÇâÂâçÂÇæ„Åó„ÄÅËÉåÁ≠ã„ÅØ„Åæ„Å£„Åô„Åê‰øù„Å°„Åæ„Åô„ÄÇ';
                                return advice;
                            }
                            return 'ÂâçÂÇæËßíÂ∫¶„ÇíË™øÊï¥„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇËÇ°Èñ¢ÁØÄ„Åã„ÇâÂâçÂÇæ„Åó„ÄÅËÉåÁ≠ã„ÅØ„Åæ„Å£„Åô„Åê‰øù„Å°„Åæ„Åô„ÄÇ';
                        })(),
                    
                    handPosition: scores.handPosition >= 80 ? 
                        'Êâã„ÅÆ‰ΩçÁΩÆ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆ‰ΩçÁΩÆ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        (function() {
                            if (scores.handPositionData) {
                                const data = scores.handPositionData;
                                const current = data.currentValue;
                                const ideal = data.idealValue;
                                let advice = '';
                                let currentStatus = '';
                                let idealPosition = '';
                                
                                if (clubType === 'Driver') {
                                    idealPosition = 'ËÇ©„ÅÆÁúü‰∏ã„Çà„ÇäÂ∞ë„ÅóÂâçÔºà‰Ωì„Åã„ÇâÈõ¢„Çå„ÇãÔºâ';
                                } else {
                                    idealPosition = 'ËÇ©„ÅÆÁúü‰∏ãÔºà‰Ωì„Å®„ÅÆË∑ùÈõ¢„ÅØÊã≥ÔºëÔºéÔºïÔΩûÔºíÂÄã„Åè„Çâ„ÅÑÔºâ';
                                }
                                
                                if (current > ideal) {
                                    currentStatus = '‰Ωì„Åã„ÇâÈÅ†„Åô„Åé„Çã‰ΩçÁΩÆ';
                                    advice = `ÁèæÂú®Êâã„Åå${currentStatus}„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ„ÇÇ„ÅÜÂ∞ë„Åó‰Ωì„Å´Ëøë„Å•„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                                } else {
                                    currentStatus = '‰Ωì„Å´Ëøë„Åô„Åé„Çã‰ΩçÁΩÆ';
                                    advice = `ÁèæÂú®Êâã„Åå${currentStatus}„Å´„ÅÇ„Çä„Åæ„Åô„ÄÇ„ÇÇ„ÅÜÂ∞ë„Åó‰Ωì„Åã„ÇâÈõ¢„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                                }
                                advice += `\nüìç ÁêÜÊÉ≥„ÅÆ‰ΩçÁΩÆÔºö${idealPosition}`;
                                return advice;
                            }
                            return clubType === 'Driver' ? 
                                '„Éâ„É©„Ç§„Éê„Éº„ÅÆÂ†¥Âêà„ÄÅÊâã„ÅØËÇ©„ÅÆÁúü‰∏ã„Çà„ÇäÂ∞ë„ÅóÂâçÔºà‰Ωì„Åã„ÇâÈõ¢„Çå„ÇãÔºâ„Å´‰ΩçÁΩÆ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                                'Êâã„ÅØËÇ©„ÅÆÁúü‰∏ã„Å´‰ΩçÁΩÆ„Åó„ÄÅ‰Ωì„Å®„ÅÆË∑ùÈõ¢„ÅØÊã≥ÔºëÔºéÔºïÔΩûÔºíÂÄã„Åè„Çâ„ÅÑ„Å´„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                        })(),
                    
                    frontBackWeight: scores.frontBackWeight >= 80 ? 
                        'ÂâçÂæå„ÅÆÈáçÂøÉ„ÅØÈÅ©Âàá„Åß„Åô„ÄÇ„Åì„ÅÆ„Éê„É©„É≥„Çπ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        (function() {
                            let advice = 'ÁèæÁä∂„ÅØÂâçÂæå„ÅÆÈáçÂøÉ„Éê„É©„É≥„Çπ„ÅåÂ¥©„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                            advice += '„Åã„Åã„Å®ÈáçÂøÉ„Å´„Å™„Çä„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„ÄÅÈáçÂøÉ„Çí„Éú„Éº„É´ÂÅ¥Ôºà„Å§„ÅæÂÖàÂÅ¥Ôºâ„Å´„ÇÑ„ÇÑÁßª„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                            advice += '\nüìç ÁêÜÊÉ≥„ÅÆÂΩ¢ÔºöÈáçÂøÉ„ÅåË∂≥Ë£è„ÅÆ‰∏≠Â§Æ„Åã„Çâ„ÇÑ„ÇÑÂâçÂÅ¥Ôºà„Éú„Éº„É´ÂÅ¥Ôºâ„Å´‰ΩçÁΩÆ';
                            return advice;
                        })(),
                    
                    spinalCurve: scores.spinalCurve >= 80 ? 
                        'ËÉåÁ≠ã„ÅÆÊõ≤„Åå„ÇäÂÖ∑Âêà„ÅØËâØÂ•Ω„Åß„Åô„ÄÇËá™ÁÑ∂„Å™Ôº≥Â≠ó„Ç´„Éº„Éñ„ÇíÁ∂≠ÊåÅ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ' :
                        (function() {
                            if (scores.spinalCurveData && scores.spinalCurveData.description) {
                                const data = scores.spinalCurveData;
                                let advice = `ÁèæÂú®${data.description}„ÅÆÁä∂ÊÖã„Åß„Åô„ÄÇ`;
                                
                                if (data.description.includes('Áå´ËÉå')) {
                                    advice += 'ËÉ∏„ÇíÂºµ„Çä„ÄÅËÇ©Áî≤È™®„ÇíÂØÑ„Åõ„Å¶ËÉåÁ≠ã„Çí‰º∏„Å∞„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                                } else if (data.description.includes('Âèç„Çä')) {
                                    advice += 'ËÖ∞„ÅÆÂèç„Çä„ÇíÊäë„Åà„ÄÅ„ÅäËÖπ„Å´ËªΩ„ÅèÂäõ„ÇíÂÖ•„Çå„Å¶Ëá™ÁÑ∂„Å™ÂßøÂã¢„ÇíÂøÉ„Åå„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                                } else {
                                    advice += 'ËÉåÁ≠ã„ÅÆËá™ÁÑ∂„Å™Ôº≥Â≠ó„Ç´„Éº„Éñ„ÇíÊÑèË≠ò„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                                }
                                return advice;
                            }
                            return 'ËÉåÁ≠ã„ÅÆËá™ÁÑ∂„Å™Ôº≥Â≠ó„Ç´„Éº„Éñ„ÇíÊÑèË≠ò„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇÁå´ËÉå„ÇÑÂèç„ÇäËÖπ„Å´„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜÊ≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                        })()
                };
            }
            
            return advice;
        }

        // Ë®∫Êñ≠ÈñãÂßã„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.addEventListener('DOMContentLoaded', function() {
            // „É¢„Éê„Ç§„É´Ê§úÂá∫„Å®UIË™øÊï¥
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                document.getElementById('mobileButtons').style.display = 'flex';
                // „É°„Ç§„É≥„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Ç®„É™„Ç¢„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÇíÁÑ°ÂäπÂåñ
                const uploadArea = document.querySelector('.upload-area');
                uploadArea.onclick = null;
                uploadArea.style.cursor = 'default';
            }
            
            // „Ç´„É°„É©„Å®„ÇÆ„É£„É©„É™„ÉºÂÖ•Âäõ„ÅÆ„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº
            document.getElementById('cameraInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0]);
                }
            });
            
            document.getElementById('galleryInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0]);
                }
            });
            
            // UI„Ç≥„É≥„Éà„É≠„Éº„É´„ÇíÂç≥Â∫ß„Å´ÊúâÂäπÂåñ
            document.getElementById('viewSelect').disabled = false;
            document.getElementById('clubSelect').disabled = false;
            document.getElementById('startDiagnosis').disabled = false;
            
            // MediaPipe„ÅØÈùûÂêåÊúü„ÅßÂàùÊúüÂåñÔºàUI„Éñ„É≠„ÉÉ„ÇØ„Åó„Å™„ÅÑÔºâ
       
