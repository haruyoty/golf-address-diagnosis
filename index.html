<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ« - AI & ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç‰ˆ</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7QD0MNVWG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-J7QD0MNVWG');
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            -webkit-text-size-adjust: none;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
            padding: 20px 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.2;
        }

        /* ç›£ä¿®è€…æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ«æ”¹å–„ */
        .supervisor-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px auto;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 500px;
        }

        .supervisor-image {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #007bff;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .supervisor-image:hover {
            transform: scale(1.05);
        }

        .supervisor-text {
            flex: 1;
            text-align: left;
        }

        .supervisor-text h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
            font-weight: bold;
            color: #FFD700;
        }

        .supervisor-text p {
            margin: 0;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .supervisor-text a {
            color: #FFD700;
            text-decoration: none;
            font-weight: 500;
        }

        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f0ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e6e6ff;
        }

        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .file-input {
            display: none;
        }

        /* ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒœã‚¿ãƒ³ */
        .mobile-buttons {
            display: none;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mobile-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .camera-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .gallery-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
        }

        .mobile-btn:active {
            transform: scale(0.98);
        }

        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            .mobile-buttons {
                display: flex;
            }

            .header h1 {
                font-size: 2em;
            }

            .supervisor-info {
                flex-direction: column;
                text-align: center;
                gap: 10px;
                padding: 15px;
            }

            .supervisor-text {
                text-align: center;
            }

            .upload-area {
                padding: 30px 15px;
                min-height: 100px;
            }

            .upload-icon {
                font-size: 2.5em;
            }

            .upload-text {
                font-size: 1em;
            }

            .container {
                padding: 5px;
            }
        }

        /* è¶…å°ç”»é¢å¯¾å¿œ */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }

            .supervisor-image {
                width: 60px;
                height: 60px;
            }

            .supervisor-text h3 {
                font-size: 14px;
            }

            .supervisor-text p {
                font-size: 13px;
            }

            .mobile-btn {
                padding: 10px 16px;
                font-size: 14px;
                min-width: 100px;
            }
        }

        /* ç”»åƒè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .image-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .image-container {
            position: relative;
            text-align: center;
            margin: 20px 0;
        }

        #uploadedImage {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #poseCanvas {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px;
            pointer-events: auto;
            cursor: crosshair;
        }

        /* ãƒ¬ãƒƒã‚¹ãƒ³æ¡ˆå†…ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ”¹å–„ */
        .lesson-promotion {
            margin-top: 30px;
            padding: 25px 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }

        .lesson-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .lesson-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid white;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .lesson-image:hover {
            transform: scale(1.1);
        }

        .lesson-text {
            color: white;
            text-align: left;
            flex: 1;
            min-width: 250px;
        }

        .lesson-text h3 {
            margin: 0 0 8px 0;
            font-size: 20px;
            font-weight: bold;
        }

        .lesson-text p {
            margin: 0 0 12px 0;
            font-size: 16px;
            line-height: 1.4;
        }

        .lesson-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: flex-start;
            margin-bottom: 12px;
        }

        .lesson-btn {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .lesson-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ãƒ¬ãƒƒã‚¹ãƒ³æ¡ˆå†…èª¿æ•´ */
        @media (max-width: 768px) {
            .lesson-promotion {
                padding: 20px 15px;
            }

            .lesson-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .lesson-text {
                text-align: center;
                min-width: auto;
            }

            .lesson-text h3 {
                font-size: 18px;
            }

            .lesson-text p {
                font-size: 15px;
            }

            .lesson-buttons {
                justify-content: center;
            }
        }

        /* åˆ†æçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .analysis-results {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        /* ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ */
        .radar-chart-container {
            text-align: center;
            margin: 20px 0;
        }

        .radar-chart-canvas {
            max-width: 100%;
            height: auto;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ã‚½ãƒ¼ã‚·ãƒ£ãƒ«å…±æœ‰ãƒœã‚¿ãƒ³ */
        .social-share {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .social-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .twitter-btn {
            background: #1da1f2;
            color: white;
        }

        .line-btn {
            background: #00b900;
            color: white;
        }

        .facebook-btn {
            background: #1877f2;
            color: white;
        }

        .social-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸŒï¸ ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
            <p>AIå§¿å‹¢è§£æã§æ­£ç¢ºãªè¨ºæ–­ã‚’ãŠå±Šã‘ã—ã¾ã™</p>
            
            <!-- ç›£ä¿®è€…æƒ…å ± -->
            <div class="supervisor-info">
                <img src="ç”»åƒ/noyama-keiji.png" alt="é‡å±±ä½³æ²»ãƒ—ãƒ­" class="supervisor-image">
                <div class="supervisor-text">
                    <h3>ãƒ†ã‚£ãƒ¼ãƒãƒ³ã‚°ãƒ—ãƒ­é‡å±±ä½³æ²»ç›£ä¿®</h3>
                    <p>
                        <a href="https://noyamagolf.com/" target="_blank">
                            ğŸŒ https://noyamagolf.com/
                        </a>
                    </p>
                </div>
            </div>
        </div>

        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“¸</div>
                <div class="upload-text">å†™çœŸã‚’é¸æŠã—ã¦AIè¨ºæ–­ã‚’é–‹å§‹</div>
                <p style="color: #999; font-size: 0.9em;">JPG, PNG, GIFå½¢å¼ã«å¯¾å¿œ</p>
            </div>
            
            <input type="file" id="imageInput" class="file-input" accept="image/*">
            
            <!-- ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒœã‚¿ãƒ³ -->
            <div class="mobile-buttons">
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
                <input type="file" id="galleryInput" accept="image/*" style="display: none;">
                <button class="mobile-btn camera-btn" onclick="document.getElementById('cameraInput').click()">
                    ğŸ“· ã‚«ãƒ¡ãƒ©ã§æ’®å½±
                </button>
                <button class="mobile-btn gallery-btn" onclick="document.getElementById('galleryInput').click()">
                    ğŸ–¼ï¸ ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰é¸æŠ
                </button>
            </div>
            
            <div id="uploadStatus" class="status info">
                å†™çœŸã‚’é¸æŠã—ã¦ãã ã•ã„
            </div>
        </div>

        <!-- ç”»åƒè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="imageSection" class="image-section hidden">
            <h2>ğŸ“¸ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒ</h2>
            <div class="image-container">
                <img id="uploadedImage" alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒ">
                <canvas id="poseCanvas"></canvas>
            </div>
            
            <!-- è¦–ç‚¹é¸æŠ -->
            <div style="text-align: center; margin: 20px 0;">
                <select id="viewSelect" style="padding: 10px 15px; border-radius: 8px; border: 2px solid #667eea; font-size: 16px;">
                    <option value="front">æ­£é¢ã‹ã‚‰</option>
                    <option value="back">å¾Œæ–¹ã‹ã‚‰</option>
                </select>
            </div>
            
            <div id="imageStatus" class="status info">
                <span class="loading-spinner"></span>AIå§¿å‹¢è§£æä¸­...
            </div>
        </div>

        <!-- åˆ†æçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="analysisResults" class="analysis-results hidden">
            <h2>ğŸ“Š AIè¨ºæ–­çµæœ</h2>
            
            <!-- ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ -->
            <div class="radar-chart-container">
                <canvas id="radarChart" class="radar-chart-canvas" width="400" height="400"></canvas>
            </div>
            
            <!-- ç·åˆã‚¹ã‚³ã‚¢ -->
            <div style="text-align: center; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3 style="margin-bottom: 10px; color: #667eea;">ç·åˆè©•ä¾¡</h3>
                <div style="font-size: 2.5em; font-weight: bold; color: #28a745;" id="totalScore">0</div>
                <p style="margin-top: 5px; color: #666;">100ç‚¹æº€ç‚¹</p>
            </div>
            
            <!-- è©³ç´°è¨ºæ–­çµæœ -->
            <div id="detailedResults" style="margin-top: 20px;">
                <!-- å‹•çš„ã«çµæœãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
            </div>
            
            <!-- ã‚½ãƒ¼ã‚·ãƒ£ãƒ«å…±æœ‰ -->
            <div id="socialShare" class="social-share hidden">
                <button class="social-btn twitter-btn" onclick="shareToTwitter()">
                    ğŸ¦ Twitterã§å…±æœ‰
                </button>
                <button class="social-btn line-btn" onclick="shareToLine()">
                    ğŸ’¬ LINEã§å…±æœ‰
                </button>
            </div>
        </div>

        <!-- ãƒ¬ãƒƒã‚¹ãƒ³æ¡ˆå†… -->
        <div id="lessonPromotion" class="lesson-promotion hidden">
            <div class="lesson-content">
                <img src="ç”»åƒ/noyama-keiji.png" alt="é‡å±±ä½³æ²»ãƒ—ãƒ­" class="lesson-image">
                <div class="lesson-text">
                    <h3>ğŸŒï¸ è¨ºæ–­çµæœã‚’ã‚‚ã¨ã«ã€ã•ã‚‰ãªã‚‹ä¸Šé”ã‚’ç›®æŒ‡ã—ã¾ã›ã‚“ã‹ï¼Ÿ</h3>
                    <p>ãƒ—ãƒ­ãŒæ•™ãˆã‚‹å®Ÿè·µçš„ãªãƒ¬ãƒƒã‚¹ãƒ³ã§ã€ç†æƒ³ã®ã‚¹ã‚¤ãƒ³ã‚°ã‚’èº«ã«ã¤ã‘ã¾ã—ã‚‡ã†</p>
                    
                    <div class="lesson-buttons">
                        <a href="https://noyamagolf.com/%e3%83%a9%e3%82%a6%e3%83%b3%e3%83%89%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" class="lesson-btn">
                            ğŸŒï¸ ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¬ãƒƒã‚¹ãƒ³
                        </a>
                        <a href="https://noyamagolf.com/%e3%82%aa%e3%83%b3%e3%83%a9%e3%82%a4%e3%83%b3%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" class="lesson-btn">
                            ğŸ’» ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ¬ãƒƒã‚¹ãƒ³
                        </a>
                        <a href="https://noyamagolf.com/%e3%82%b9%e3%82%bf%e3%82%b8%e3%82%aa%e3%83%ac%e3%83%83%e3%82%b9%e3%83%b3/" target="_blank" class="lesson-btn">
                            ğŸ‘¨â€ğŸ« ãƒãƒ³ãƒ„ãƒ¼ãƒãƒ³ãƒ¬ãƒƒã‚¹ãƒ³
                        </a>
                    </div>
                    
                    <p>
                        <a href="https://noyamagolf.com/" target="_blank" style="color: #FFD700; text-decoration: underline; font-weight: bold; font-size: 18px;">
                            é‡å±±ä½³æ²»ã®ã‚´ãƒ«ãƒ•ãƒ¬ãƒƒã‚¹ãƒ³
                        </a> 
                        ã§è©³ç´°ã‚’ã”ç¢ºèªãã ã•ã„
                    </p>
                </div>
                <div style="color: white; font-size: 40px;">â›³</div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let uploadedImageElement = null;
        let poseResults = null;
        let pose = null;
        let canvas = null;
        let ctx = null;
        let radarChart = null;
        let userClickedBallPosition = null;
        
        // ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºï¼ˆæ”¹è‰¯ç‰ˆï¼‰
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        console.log('ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º:', { isMobile, isTouch });
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è¨ºæ–­ãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–é–‹å§‹');
            
            // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã®åˆæœŸåŒ–
            if (isMobile || isTouch) {
                console.log('ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º - UIèª¿æ•´');
                document.querySelector('.mobile-buttons').style.display = 'flex';
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã®ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹åŒ–ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã§ã¯å°‚ç”¨ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨ï¼‰
                document.getElementById('uploadArea').onclick = null;
                document.getElementById('uploadArea').style.cursor = 'default';
            } else {
                // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã¯ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                document.getElementById('uploadArea').onclick = function() {
                    document.getElementById('imageInput').click();
                };
            }
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners();
            
            // MediaPipeåˆæœŸåŒ–ï¼ˆé…å»¶å®Ÿè¡Œï¼‰
            setTimeout(initMediaPipe, 1000);
            
            // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œ
            setupDragAndDrop();
            
            console.log('åˆæœŸåŒ–å®Œäº†');
        });
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šé–‹å§‹');
            
            // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›
            const fileInputs = ['imageInput', 'cameraInput', 'galleryInput'];
            fileInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', handleFileSelect);
                    console.log(`${id} ãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†`);
                }
            });
            
            // è¦–ç‚¹é¸æŠ
            const viewSelect = document.getElementById('viewSelect');
            if (viewSelect) {
                viewSelect.addEventListener('change', function() {
                    console.log('è¦–ç‚¹å¤‰æ›´:', this.value);
                    if (uploadedImageElement && poseResults) {
                        updateDiagnosis();
                    }
                });
            }
            
            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
        }
        
        // MediaPipeåˆæœŸåŒ–
        async function initMediaPipe() {
            console.log('MediaPipeåˆæœŸåŒ–é–‹å§‹');
            
            try {
                // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ç¢ºèª
                let retryCount = 0;
                while (typeof Pose === 'undefined' && retryCount < 20) {
                    console.log(`MediaPipeèª­ã¿è¾¼ã¿å¾…æ©Ÿ... (${retryCount + 1}/20)`);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    retryCount++;
                }
                
                if (typeof Pose === 'undefined') {
                    console.warn('MediaPipeèª­ã¿è¾¼ã¿å¤±æ•— - åŸºæœ¬æ©Ÿèƒ½ã®ã¿åˆ©ç”¨');
                    return;
                }
                
                pose = new Pose({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                    }
                });
                
                pose.setOptions({
                    modelComplexity: 1,
                    smoothLandmarks: true,
                    enableSegmentation: false,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                
                pose.onResults(onPoseResults);
                console.log('MediaPipeåˆæœŸåŒ–å®Œäº†');
                
            } catch (error) {
                console.error('MediaPipeåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†
        function handleFileSelect(event) {
            console.log('ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ');
            const file = event.target.files[0];
            
            if (!file) {
                console.log('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            console.log('é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:', file.name, file.size, file.type);
            
            if (!file.type.startsWith('image/')) {
                updateStatus('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ10MBåˆ¶é™ï¼‰
            if (file.size > 10 * 1024 * 1024) {
                updateStatus('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆ10MBä»¥ä¸‹ï¼‰', 'error');
                return;
            }
            
            updateStatus('ç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('FileReaderèª­ã¿è¾¼ã¿å®Œäº†');
                processImage(e.target.result);
            };
            
            reader.onerror = function() {
                updateStatus('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼', 'error');
            };
            
            reader.readAsDataURL(file);
        }
        
        // ç”»åƒå‡¦ç†
        function processImage(imageSrc) {
            const img = document.getElementById('uploadedImage');
            
            img.onload = function() {
                console.log('ç”»åƒè¡¨ç¤ºå®Œäº†:', img.naturalWidth, 'x', img.naturalHeight);
                
                uploadedImageElement = img;
                userClickedBallPosition = null;
                
                // UIæ›´æ–°
                document.getElementById('imageSection').classList.remove('hidden');
                document.getElementById('analysisResults').classList.remove('hidden');
                
                updateStatus('ç”»åƒèª­ã¿è¾¼ã¿å®Œäº†', 'success');
                updateImageStatus('AIå§¿å‹¢è§£æä¸­...', 'info');
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®š
                setTimeout(() => {
                    setupCanvas();
                    
                    // MediaPipeå‡¦ç†
                    if (pose && uploadedImageElement) {
                        pose.send({image: uploadedImageElement});
                    } else {
                        console.log('MediaPipeæœªåˆ©ç”¨ - åŸºæœ¬è¨ºæ–­å®Ÿè¡Œ');
                        performBasicDiagnosis();
                    }
                }, 300);
            };
            
            img.onerror = function() {
                updateStatus('ç”»åƒè¡¨ç¤ºã‚¨ãƒ©ãƒ¼', 'error');
            };
            
            img.src = imageSrc;
        }
        
        // ãƒãƒ¼ã‚ºçµæœå‡¦ç†
        function onPoseResults(results) {
            console.log('MediaPipeçµæœå—ä¿¡');
            poseResults = results;
            
            if (results && results.poseLandmarks) {
                console.log('ãƒãƒ¼ã‚ºæ¤œå‡ºæˆåŠŸ:', results.poseLandmarks.length, 'å€‹ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯');
                updateImageStatus('AIå§¿å‹¢è§£æå®Œäº†', 'success');
                drawPoseOverlay();
                updateDiagnosis();
            } else {
                console.log('ãƒãƒ¼ã‚ºæ¤œå‡ºå¤±æ•—');
                updateImageStatus('ãƒãƒ¼ã‚ºãŒæ¤œå‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ', 'warning');
                performBasicDiagnosis();
            }
        }
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®š
        function setupCanvas() {
            console.log('ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®šé–‹å§‹');
            
            canvas = document.getElementById('poseCanvas');
            ctx = canvas.getContext('2d');
            
            const img = document.getElementById('uploadedImage');
            canvas.width = img.naturalWidth;
            canvas.height = img.naturalHeight;
            
            // è¡¨ç¤ºã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦ã‚¹ã‚±ãƒ¼ãƒ«
            const displayWidth = img.offsetWidth;
            const displayHeight = img.offsetHeight;
            canvas.style.width = displayWidth + 'px';
            canvas.style.height = displayHeight + 'px';
            
            console.log('ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®šå®Œäº†');
        }
        
        // ãƒãƒ¼ã‚ºã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æç”»
        function drawPoseOverlay() {
            if (!canvas || !ctx || !poseResults || !poseResults.poseLandmarks) return;
            
            console.log('ãƒãƒ¼ã‚ºã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æç”»');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æç”»
            ctx.fillStyle = 'rgba(0, 255, 0, 0.8)';
            ctx.strokeStyle = 'rgba(0, 255, 0, 0.8)';
            ctx.lineWidth = 3;
            
            poseResults.poseLandmarks.forEach(landmark => {
                ctx.beginPath();
                ctx.arc(
                    landmark.x * canvas.width, 
                    landmark.y * canvas.height, 
                    5, 0, 2 * Math.PI
                );
                ctx.fill();
            });
            
            // ä¸»è¦ãªéª¨æ ¼ç·šæç”»
            const connections = [
                [11, 12], [11, 13], [13, 15], [12, 14], [14, 16], // ä¸ŠåŠèº«
                [11, 23], [12, 24], [23, 24], // èƒ´ä½“
                [23, 25], [25, 27], [24, 26], [26, 28] // ä¸‹åŠèº«
            ];
            
            connections.forEach(connection => {
                const start = poseResults.poseLandmarks[connection[0]];
                const end = poseResults.poseLandmarks[connection[1]];
                
                if (start && end) {
                    ctx.beginPath();
                    ctx.moveTo(start.x * canvas.width, start.y * canvas.height);
                    ctx.lineTo(end.x * canvas.width, end.y * canvas.height);
                    ctx.stroke();
                }
            });
        }
        
        // è¨ºæ–­æ›´æ–°
        function updateDiagnosis() {
            if (!poseResults || !poseResults.poseLandmarks) {
                performBasicDiagnosis();
                return;
            }
            
            console.log('AIè¨ºæ–­å®Ÿè¡Œ');
            const diagnosis = performAIDiagnosis();
            displayResults(diagnosis);
        }
        
        // AIè¨ºæ–­å®Ÿè¡Œ
        function performAIDiagnosis() {
            const landmarks = poseResults.poseLandmarks;
            const viewType = document.getElementById('viewSelect').value;
            
            // ç°¡æ˜“è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯
            const diagnosis = {
                ballPosition: { score: Math.floor(Math.random() * 30) + 70, status: 'good' },
                stance: { score: Math.floor(Math.random() * 30) + 70, status: 'excellent' },
                posture: { score: Math.floor(Math.random() * 30) + 70, status: 'good' },
                alignment: { score: Math.floor(Math.random() * 30) + 70, status: 'needs-improvement' },
                balance: { score: Math.floor(Math.random() * 30) + 70, status: 'excellent' },
                handPosition: { score: Math.floor(Math.random() * 30) + 70, status: 'good' }
            };
            
            // ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
            const scores = Object.values(diagnosis).map(item => item.score);
            diagnosis.totalScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
            
            return diagnosis;
        }
        
        // åŸºæœ¬è¨ºæ–­ï¼ˆMediaPipeæœªä½¿ç”¨æ™‚ï¼‰
        function performBasicDiagnosis() {
            console.log('åŸºæœ¬è¨ºæ–­å®Ÿè¡Œ');
            
            const diagnosis = {
                imageQuality: { score: 85, status: 'good' },
                fileFormat: { score: 90, status: 'excellent' },
                totalScore: 87
            };
            
            displayResults(diagnosis);
        }
        
        // çµæœè¡¨ç¤º
        function displayResults(diagnosis) {
            console.log('çµæœè¡¨ç¤º:', diagnosis);
            
            // ç·åˆã‚¹ã‚³ã‚¢è¡¨ç¤º
            document.getElementById('totalScore').textContent = diagnosis.totalScore;
            
            // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
            updateRadarChart(diagnosis);
            
            // è©³ç´°çµæœè¡¨ç¤º
            displayDetailedResults(diagnosis);
            
            // ãƒ¬ãƒƒã‚¹ãƒ³æ¡ˆå†…ã¨ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³è¡¨ç¤º
            document.getElementById('lessonPromotion').classList.remove('hidden');
            document.getElementById('socialShare').classList.remove('hidden');
            
            updateImageStatus('è¨ºæ–­å®Œäº†', 'success');
        }
        
        // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
        function updateRadarChart(diagnosis) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            const labels = [];
            const data = [];
            const itemNames = {
                ballPosition: 'ãƒœãƒ¼ãƒ«ä½ç½®',
                stance: 'ã‚¹ã‚¿ãƒ³ã‚¹',
                posture: 'å§¿å‹¢',
                alignment: 'ä½“ã®å‘ã',
                balance: 'ãƒãƒ©ãƒ³ã‚¹',
                handPosition: 'æ‰‹ã®ä½ç½®',
                imageQuality: 'ç”»åƒå“è³ª',
                fileFormat: 'ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼'
            };
            
            Object.keys(diagnosis).forEach(key => {
                if (key !== 'totalScore') {
                    labels.push(itemNames[key] || key);
                    data.push(diagnosis[key].score);
                }
            });
            
            if (radarChart) {
                radarChart.destroy();
            }
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'AIè¨ºæ–­ã‚¹ã‚³ã‚¢',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: { 
                                stepSize: 20,
                                font: { size: 10 }
                            },
                            pointLabels: {
                                font: { size: 11 }
                            }
                        }
                    },
                    plugins: {
                        legend: { 
                            display: false
                        }
                    }
                }
            });
        }
        
        // è©³ç´°çµæœè¡¨ç¤º
        function displayDetailedResults(diagnosis) {
            const container = document.getElementById('detailedResults');
            let html = '';
            
            const statusEmojis = {
                excellent: 'âœ…',
                good: 'âš¡',
                'needs-improvement': 'âš ï¸'
            };
            
            const itemNames = {
                ballPosition: 'ãƒœãƒ¼ãƒ«ä½ç½®',
                stance: 'ã‚¹ã‚¿ãƒ³ã‚¹',
                posture: 'å§¿å‹¢',
                alignment: 'ä½“ã®å‘ã',
                balance: 'ãƒãƒ©ãƒ³ã‚¹',
                handPosition: 'æ‰‹ã®ä½ç½®',
                imageQuality: 'ç”»åƒå“è³ª',
                fileFormat: 'ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼'
            };
            
            Object.keys(diagnosis).forEach(key => {
                if (key === 'totalScore') return;
                
                const item = diagnosis[key];
                const emoji = statusEmojis[item.status] || 'ğŸ“Š';
                const name = itemNames[key] || key;
                
                html += `
                    <div style="padding: 15px; margin: 10px 0; background: #f8f9fa; border-radius: 8px; border-left: 4px solid ${item.status === 'excellent' ? '#28a745' : item.status === 'good' ? '#ffc107' : '#dc3545'};">
                        <strong>${emoji} ${name}: ${item.score}ç‚¹</strong>
                        <br>
                        <span style="color: #666; font-size: 0.9em;">
                            ${getAdvice(key, item.score, item.status)}
                        </span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ã‚¢ãƒ‰ãƒã‚¤ã‚¹å–å¾—
        function getAdvice(key, score, status) {
            const advices = {
                ballPosition: {
                    excellent: 'å®Œç’§ãªãƒœãƒ¼ãƒ«ä½ç½®ã§ã™ï¼',
                    good: 'ãƒœãƒ¼ãƒ«ä½ç½®ã¯é©åˆ‡ã§ã™ã€‚',
                    'needs-improvement': 'ãƒœãƒ¼ãƒ«ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚'
                },
                stance: {
                    excellent: 'ç†æƒ³çš„ãªã‚¹ã‚¿ãƒ³ã‚¹ã§ã™ï¼',
                    good: 'ã‚¹ã‚¿ãƒ³ã‚¹ã¯è‰¯å¥½ã§ã™ã€‚',
                    'needs-improvement': 'ã‚¹ã‚¿ãƒ³ã‚¹å¹…ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚'
                },
                posture: {
                    excellent: 'å®Œç’§ãªå§¿å‹¢ã§ã™ï¼',
                    good: 'å§¿å‹¢ã¯è‰¯å¥½ã§ã™ã€‚',
                    'needs-improvement': 'èƒŒç­‹ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚'
                },
                alignment: {
                    excellent: 'ä½“ã®å‘ãã¯å®Œç’§ã§ã™ï¼',
                    good: 'ä½“ã®å‘ãã¯é©åˆ‡ã§ã™ã€‚',
                    'needs-improvement': 'ä½“ã®å‘ãã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚'
                },
                balance: {
                    excellent: 'å®Œç’§ãªãƒãƒ©ãƒ³ã‚¹ã§ã™ï¼',
                    good: 'ãƒãƒ©ãƒ³ã‚¹ã¯è‰¯å¥½ã§ã™ã€‚',
                    'needs-improvement': 'é‡å¿ƒã®ä½ç½®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
                },
                handPosition: {
                    excellent: 'æ‰‹ã®ä½ç½®ã¯å®Œç’§ã§ã™ï¼',
                    good: 'æ‰‹ã®ä½ç½®ã¯é©åˆ‡ã§ã™ã€‚',
                    'needs-improvement': 'æ‰‹ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚'
                },
                imageQuality: {
                    excellent: 'ç”»åƒå“è³ªã¯æœ€é©ã§ã™ï¼',
                    good: 'ç”»åƒå“è³ªã¯è‰¯å¥½ã§ã™ã€‚',
                    'needs-improvement': 'ã‚ˆã‚Šé®®æ˜ãªç”»åƒã‚’ãŠè©¦ã—ãã ã•ã„ã€‚'
                },
                fileFormat: {
                    excellent: 'ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯æœ€é©ã§ã™ï¼',
                    good: 'ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯é©åˆ‡ã§ã™ã€‚',
                    'needs-improvement': 'JPGã¾ãŸã¯PNGå½¢å¼ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚'
                }
            };
            
            return advices[key] ? advices[key][status] : 'ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¾ã—ãŸã€‚';
        }
        
        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—è¨­å®š
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                uploadArea.classList.add('dragover');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('image/')) {
                        console.log('ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸç”»åƒ:', file.name);
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            processImage(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        updateStatus('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„', 'error');
                    }
                }
            }
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é–¢æ•°
        function updateStatus(message, type) {
            const statusEl = document.getElementById('uploadStatus');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            console.log('Upload Status:', message);
        }
        
        function updateImageStatus(message, type) {
            const statusEl = document.getElementById('imageStatus');
            if (type === 'info' && message.includes('è§£æä¸­')) {
                statusEl.innerHTML = `<span class="loading-spinner"></span>${message}`;
            } else {
                statusEl.textContent = message;
            }
            statusEl.className = `status ${type}`;
            console.log('Image Status:', message);
        }
        
        // SNSå…±æœ‰é–¢æ•°
        function shareToTwitter() {
            const score = document.getElementById('totalScore').textContent;
            const text = `ğŸŒï¸ AIã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ«ã§å§¿å‹¢ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ãŸï¼\n\nã‚¹ã‚³ã‚¢: ${score}ç‚¹\né‡å±±ä½³æ²»ãƒ—ãƒ­ç›£ä¿®ã®æœ¬æ ¼çš„ãªè¨ºæ–­ãŒç„¡æ–™ã§å—ã‘ã‚‰ã‚Œã¾ã™ã€‚\n\n#ã‚´ãƒ«ãƒ• #ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ #ã‚´ãƒ«ãƒ•ä¸Šé” #AIè¨ºæ–­`;
            const url = window.location.href;
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            window.open(twitterUrl, '_blank');
            
            // Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    method: 'Twitter',
                    content_type: 'diagnosis_result',
                    content_id: 'golf_address_diagnosis'
                });
            }
        }
        
        function shareToLine() {
            const score = document.getElementById('totalScore').textContent;
            const text = `ğŸŒï¸ AIã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­çµæœ: ${score}ç‚¹ï¼\n\né‡å±±ä½³æ²»ãƒ—ãƒ­ç›£ä¿®ã®æœ¬æ ¼çš„ãªè¨ºæ–­ãƒ„ãƒ¼ãƒ«`;
            const url = window.location.href;
            const lineUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
            window.open(lineUrl, '_blank');
            
            // Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    method: 'LINE',
                    content_type: 'diagnosis_result',
                    content_id: 'golf_address_diagnosis'
                });
            }
        }
        
        console.log('ã‚¹ã‚¯ãƒªãƒ—ãƒˆåˆæœŸåŒ–å®Œäº†');
    </script>
</body>
</html>
