<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ« - å®Œå…¨ç‰ˆ</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7QD0MNVWG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-J7QD0MNVWG');
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .upload-section {
            text-align: center;
            margin: 30px 0;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
        }

        .btn:hover {
            background: linear-gradient(45deg, #5a6fd8, #6a4c93);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .controls {
            text-align: center;
            margin: 30px 0;
        }

        .control-group {
            display: inline-block;
            margin: 0 15px;
            vertical-align: middle;
        }

        select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .analysis-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .container {
                max-width: 95%;
                padding: 10px;
                margin: 0 auto;
            }
            
            .analysis-container {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
                margin: 0;
            }
            
            .container {
                max-width: 100%;
                padding: 2px;
                margin: 0;
                width: 100%;
                box-sizing: border-box;
            }
            
            .main-content {
                padding: 10px;
                margin: 2px;
                border-radius: 10px;
            }
            
            .image-section, .analysis-section {
                padding: 10px;
                margin: 5px 0;
            }
            
            .header {
                padding: 10px;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 1.6em;
                margin-bottom: 5px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 14px;
                margin: 5px;
            }
            
            .control-group {
                margin: 0 5px;
            }
            
            select {
                padding: 8px 10px;
                font-size: 14px;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ï¼šè©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºç¢ºä¿ï¼ˆå¼·åŒ–ç‰ˆï¼‰ */
            .feedback-text {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                line-height: 1.8 !important;
                font-size: 15px !important;
                margin-top: 12px !important;
                margin-bottom: 12px !important;
                padding: 10px !important;
                white-space: normal !important;
                word-wrap: break-word !important;
                color: #333 !important;
                background-color: rgba(255, 255, 255, 0.9) !important;
                border-radius: 8px !important;
                border-left: 4px solid #007bff !important;
            }
            
            .feedback-text strong {
                display: inline !important;
                font-weight: bold !important;
                color: #0056b3 !important;
                font-size: 16px !important;
            }
            
            .feedback-text br {
                display: block !important;
                content: "";
                margin: 8px 0 !important;
                height: 8px !important;
            }
            
            /* ã‚¹ã‚³ã‚¢è¡¨ç¤ºé …ç›®ã®å¼·åˆ¶è¡¨ç¤º */
            .score-item {
                display: block !important;
                margin-bottom: 15px !important;
                padding: 15px !important;
                background: #f8f9fa !important;
                border-radius: 10px !important;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ï¼šç·åˆã‚¹ã‚³ã‚¢è¡¨ç¤ºã®å¼·åŒ– */
            .score-item[style*="linear-gradient"] {
                background: linear-gradient(45deg, #9C27B0, #673AB7) !important; /* ç¾ã—ã„ç´«è‰² */
                border: 5px solid #FFFFFF !important;
                box-shadow: 0 15px 35px rgba(0,0,0,0.5) !important;
                margin: 20px 0 !important;
                padding: 25px !important;
            }
            
            .score-item[style*="linear-gradient"] h4 {
                color: #FFFFFF !important;
                font-size: 2em !important;
                text-shadow: 3px 3px 6px rgba(0,0,0,0.8) !important;
                margin-bottom: 20px !important;
            }
            
            .score-item[style*="linear-gradient"] .score-display {
                color: #FFFFFF !important;
                font-size: 4em !important;
                font-weight: 900 !important;
                text-shadow: 5px 5px 10px rgba(0,0,0,0.9) !important;
                margin: 30px 0 !important;
            }
            
            .score-item[style*="linear-gradient"] .feedback-text {
                color: #FFFFFF !important;
                font-size: 1.5em !important;
                background: rgba(0,0,0,0.3) !important;
                border: 2px solid #FFFFFF !important;
                padding: 20px !important;
                margin-top: 25px !important;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
            }
            
            /* å†™çœŸè¡¨ç¤ºã®å¼·åˆ¶ */
            img[src*="é‡å±±ã‘ã„ã˜.png"], img[src*="noyama-keiji.png"] {
                display: block !important;
                width: auto !important;
                max-width: 100% !important;
                height: auto !important;
            }
        }

        .image-section, .analysis-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }

        .image-container {
            position: relative;
            text-align: center;
        }
        
        .image-wrapper {
            position: relative;
            display: inline-block;
            border: 3px solid #007bff;
            border-radius: 10px;
        }
        
        .image-wrapper img {
            max-width: 100%;
            height: auto;
            display: block;
            border-radius: 7px;
        }
        
        #poseCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            border: 0;
            background: transparent; /* ãƒ¢ãƒã‚¤ãƒ«ã§ç·šãŒè¦‹ãˆãªã„å•é¡Œå¯¾ç­–: é€æ˜ã« */
            z-index: 9999;           /* å¸¸ã«å‰é¢ */
            pointer-events: auto;    /* ãƒ•ãƒ­ãƒ³ãƒˆè¦–ç‚¹ã§ã®ã‚¯ãƒªãƒƒã‚¯æœ‰åŠ¹ */
            /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šã‚¿ãƒƒãƒç„¡åŠ¹åŒ–ã¨canvasæœ€é©åŒ– */
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            /* canvasæç”»æœ€é©åŒ– */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .ball-instruction {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            border: 3px solid #ff4757;
            border-radius: 12px;
            padding: 18px;
            margin: 15px 0;
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            box-shadow: 0 4px 15px rgba(255, 75, 87, 0.3);
            text-align: center;
            animation: pulse-bright 2s infinite;
        }
        
        @keyframes pulse-bright {
            0% { transform: scale(1); box-shadow: 0 4px 15px rgba(255, 75, 87, 0.3); }
            50% { transform: scale(1.02); box-shadow: 0 6px 20px rgba(255, 75, 87, 0.5); }
            100% { transform: scale(1); box-shadow: 0 4px 15px rgba(255, 75, 87, 0.3); }
        }

        .radar-container {
            position: relative;
            height: 300px;
        }

        .score-feedback-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .score-item {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .score-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .score-display {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .score-90plus { color: #28a745; }
        .score-80plus { color: #ffc107; }
        .score-70plus { color: #fd7e14; }
        .score-below70 { color: #dc3545; }

        .feedback-text {
            color: #666;
            line-height: 1.6;
            margin-top: 10px;
        }

        .current-status {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 3px solid #007bff;
        }

        .ideal-status {
            background: #e8f5e8;
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 3px solid #28a745;
        }

        .hidden {
            display: none;
        }

        .social-share {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .social-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="background: rgba(255, 255, 255, 0.15); border-radius: 15px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px);">
                <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <a href="https://noyamagolf.com/" target="_blank" style="display: block;">
                        <img src="./noyama-keiji .png" alt="é‡å±±ä½³æ²»ãƒ—ãƒ­" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid white; object-fit: cover; cursor: pointer; transition: transform 0.2s ease; background-color: #f0f0f0;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    </a>
                    <div style="text-align: center;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #FFD700;">ãƒ†ã‚£ãƒ¼ãƒãƒ³ã‚°ãƒ—ãƒ­</div>
                        <a href="https://noyamagolf.com/" target="_blank" style="text-decoration: none; color: white; transition: color 0.2s ease;" onmouseover="this.style.color='#FFD700'" onmouseout="this.style.color='white'">
                            <div style="font-size: 1.5em; font-weight: bold;">é‡å±±ä½³æ²» ç›£ä¿®</div>
                        </a>
                    </div>
                </div>
            </div>
            <h1>ğŸŒï¸ ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
            <p>AIå§¿å‹¢åˆ†æï¼†ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¨ºæ–­</p>
        </div>

        <div class="main-content">
            <div class="upload-section">
                <button class="btn" onclick="selectImage()">ğŸ“¸ ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰é¸æŠ</button>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>ğŸ“¹ æ’®å½±è¦–ç‚¹ï¼š</label>
                    <select id="viewSelect" onchange="handleViewChange()">
                        <option value="front">æ­£é¢æ’®å½±ï¼ˆãƒœãƒ¼ãƒ«ä½ç½®è¨­å®šå¿…è¦ï¼‰</option>
                        <option value="rear">å¾Œæ–¹æ’®å½±</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>ğŸŒï¸ ä½¿ç”¨ã‚¯ãƒ©ãƒ–ï¼š</label>
                    <select id="clubSelect">
                        <option value="driver">ãƒ‰ãƒ©ã‚¤ãƒãƒ¼</option>
                        <option value="fairway">ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰</option>
                        <option value="utility">ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¼</option>
                        <option value="iron4">4ç•ªã‚¢ã‚¤ã‚¢ãƒ³</option>
                        <option value="iron5">5ç•ªã‚¢ã‚¤ã‚¢ãƒ³</option>
                        <option value="iron6">6ç•ªã‚¢ã‚¤ã‚¢ãƒ³</option>
                        <option value="iron7">7ç•ªã‚¢ã‚¤ã‚¢ãƒ³</option>
                        <option value="iron8">8ç•ªã‚¢ã‚¤ã‚¢ãƒ³</option>
                        <option value="iron9">9ç•ªã‚¢ã‚¤ã‚¢ãƒ³</option>
                        <option value="wedge">ã‚¦ã‚§ãƒƒã‚¸</option>
                    </select>
                </div>
                <button id="diagnosisBtn" class="btn" onclick="startDiagnosis()" disabled>
                    ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„
                </button>
            </div>
        </div>

        <div id="analysisResults" class="hidden">
            <div class="analysis-container">
                <div class="image-section">
                    <h3>ğŸ“Š å§¿å‹¢åˆ†æçµæœ</h3>
                    <div class="image-container">
                        <div class="image-wrapper">
                            <img id="uploadedImage" alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒ">
                            <canvas id="poseCanvas"></canvas>
                        </div>
                        <div class="ball-instruction" id="ballInstruction" style="display: none;">
                            ğŸŒï¸â€â™‚ï¸ ç”»åƒä¸Šã§ãƒœãƒ¼ãƒ«ã®ä½ç½®ã‚’ã‚¿ãƒƒãƒ—ï¼ˆã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ï¼‰ã—ã¦ãã ã•ã„
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>ğŸ“ˆ ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</h3>
                    <div class="radar-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="score-feedback-grid" id="scoreFeedbackGrid">
                <!-- è©³ç´°ã‚¹ã‚³ã‚¢ã¨ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º -->
            </div>

            <div class="social-share">
                <h3>ğŸ“¤ çµæœã‚’ã‚·ã‚§ã‚¢</h3>
                <div class="social-buttons">
                    <button onclick="shareToTwitter()" style="background: #1DA1F2; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-weight: bold; cursor: pointer;">
                        ğŸ¦ Twitter
                    </button>
                    <button onclick="shareToFacebook()" style="background: #4267B2; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-weight: bold; cursor: pointer;">
                        ğŸ“˜ Facebook
                    </button>
                    <button onclick="shareToInstagram()" style="background: #E4405F; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-weight: bold; cursor: pointer;">
                        ğŸ“· Instagram
                    </button>
                </div>
            </div>
        </div>

        <!-- é‡å±±ä½³æ²»ãƒ¬ãƒƒã‚¹ãƒ³æ¡ˆå†… -->
        <div style="background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 40px; margin-top: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #667eea; font-size: 2.5em; margin-bottom: 15px;">ğŸŒï¸ ãƒ¬ãƒƒã‚¹ãƒ³ã®ã”æ¡ˆå†…</h2>
                <div style="display: flex; align-items: center; justify-content: center; gap: 30px; flex-wrap: wrap;">
                    <a href="https://noyamagolf.com/" target="_blank" style="display: block;">
                        <img src="./noyama-keiji .png" alt="é‡å±±ä½³æ²»ãƒ—ãƒ­" style="width: 150px; height: 150px; border-radius: 50%; border: 5px solid #667eea; object-fit: cover; box-shadow: 0 10px 20px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.2s ease; background-color: #f0f0f0;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    </a>
                    <div style="text-align: left; max-width: 500px;">
                        <a href="https://noyamagolf.com/" target="_blank" style="text-decoration: none; color: #333; transition: color 0.2s ease;" onmouseover="this.style.color='#667eea'" onmouseout="this.style.color='#333'">
                            <h3 style="color: inherit; font-size: 1.8em; margin-bottom: 10px;">é‡å±±ä½³æ²»ãƒ†ã‚£ãƒ¼ãƒãƒ³ã‚°ãƒ—ãƒ­</h3>
                        </a>
                        <div style="color: #666; font-size: 1.1em; line-height: 1.6;">
                            <p>ğŸ† PGAå…¬èªãƒ†ã‚£ãƒ¼ãƒãƒ³ã‚°ãƒ—ãƒ­</p>
                            <p>ğŸ“š ã‚´ãƒ«ãƒ•æŒ‡å°æ­´20å¹´ä»¥ä¸Š</p>
                            <p>ğŸ¯ åˆå¿ƒè€…ã‹ã‚‰ä¸Šç´šè€…ã¾ã§å¯¾å¿œ</p>
                            <p>ğŸ’ª ã‚¹ã‚³ã‚¢UPã®ã‚³ãƒ„ã‚’ãŠä¼ãˆã—ã¾ã™</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 30px;">
                <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; border-left: 4px solid #667eea;">
                    <h4 style="color: #333; font-size: 1.4em; margin-bottom: 15px;">ğŸŒï¸ ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¬ãƒƒã‚¹ãƒ³</h4>
                    <div style="color: #666; line-height: 1.6; margin-bottom: 20px;">
                        <p>å®Ÿæˆ¦å½¢å¼ã§ã®ãƒ¬ãƒƒã‚¹ãƒ³</p>
                        <p>ã‚³ãƒ¼ã‚¹ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚’å­¦ã¹ã‚‹</p>
                        <p>æœ¬æ ¼çš„ãªã‚´ãƒ«ãƒ•æŠ€è¡“å‘ä¸Š</p>
                    </div>
                    <a href="https://noyamagolf.com/?p=47" target="_blank" style="display: inline-block; background: #667eea; color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: bold;">è©³ç´°ãƒ»ãŠç”³è¾¼ã¿</a>
                </div>
                
                <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; border-left: 4px solid #28a745;">
                    <h4 style="color: #333; font-size: 1.4em; margin-bottom: 15px;">ğŸ’» ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ¬ãƒƒã‚¹ãƒ³</h4>
                    <div style="color: #666; line-height: 1.6; margin-bottom: 20px;">
                        <p>è‡ªå®…ã‹ã‚‰å—ã‘ã‚‰ã‚Œã‚‹ãƒ¬ãƒƒã‚¹ãƒ³</p>
                        <p>ã‚¹ã‚¤ãƒ³ã‚°å‹•ç”»åˆ†æ</p>
                        <p>å€‹åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹</p>
                    </div>
                    <a href="https://noyamagolf.com/?p=49" target="_blank" style="display: inline-block; background: #28a745; color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: bold;">è©³ç´°ãƒ»ãŠç”³è¾¼ã¿</a>
                </div>
                
                <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; border-left: 4px solid #fd7e14;">
                    <h4 style="color: #333; font-size: 1.4em; margin-bottom: 15px;">ğŸ‘¨â€ğŸ« ãƒãƒ³ãƒ„ãƒ¼ãƒãƒ³ãƒ¬ãƒƒã‚¹ãƒ³</h4>
                    <div style="color: #666; line-height: 1.6; margin-bottom: 20px;">
                        <p>å®Œå…¨å€‹åˆ¥æŒ‡å°</p>
                        <p>çŸ­æœŸé›†ä¸­ã§ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—</p>
                        <p>ã‚ãªãŸã«åˆã‚ã›ãŸã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ </p>
                    </div>
                    <a href="https://noyamagolf.com/?p=45" target="_blank" style="display: inline-block; background: #fd7e14; color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: bold;">è©³ç´°ãƒ»ãŠç”³è¾¼ã¿</a>
                </div>
            </div>
            
            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                <p style="color: #666; font-size: 1.1em; margin: 0;">
                    è©³ã—ãã¯ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ï¼š
                    <a href="https://noyamagolf.com/" target="_blank" style="color: #667eea; text-decoration: none; font-weight: bold;">https://noyamagolf.com/</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let pose;
        let uploadedImage = null;
        let ballPosition = null;
        let currentResults = null;
        let diagnosisCompleted = false;
        let mediaPipeReady = false;
        let detailedAnalysisData = {}; // è©³ç´°ãªåˆ†æãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜

        // äº’æ›: resetTransform ãƒãƒªãƒ•ã‚£ãƒ«ï¼ˆiOS Safari ç­‰ï¼‰
        function resetTransformSafe(ctx){
            if (ctx && typeof ctx.resetTransform === 'function') {
                try { ctx.resetTransform(); return; } catch(_) {}
            }
            if (ctx && typeof ctx.setTransform === 'function') {
                ctx.setTransform(1,0,0,1,0,0);
            }
        }

        // ç”»åƒé¸æŠæ©Ÿèƒ½
        function selectImage() {
            console.log('ç”»åƒé¸æŠé–‹å§‹...');
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = function(e) {
                console.log('ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ:', e.target.files.length);
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0]);
                }
            };
            
            input.click();
        }

        // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleImageUpload(file) {
            console.log('ç”»åƒå‡¦ç†é–‹å§‹:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('uploadedImage');
                img.src = e.target.result;
                
                img.onload = function() {
                    uploadedImage = img;
                    ballPosition = null;
                    currentResults = null;
                    console.log('âœ… ç”»åƒèª­ã¿è¾¼ã¿å®Œäº†');
                    
                    // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                    document.getElementById('analysisResults').classList.remove('hidden');
                    
            // ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®š
            setupCanvas();
                    
                    // MediaPipeå‡¦ç†ã‚’å®Ÿè¡Œï¼ˆã™ã¹ã¦ã®æ’®å½±è¦–ç‚¹ã§ï¼‰
                    if (mediaPipeReady && pose) {
                        setTimeout(() => {
                            const viewType = document.getElementById('viewSelect').value;
                            console.log(`MediaPipeå§¿å‹¢åˆ†æé–‹å§‹... è¦–ç‚¹: ${viewType}`);
                            pose.send({image: img}).then(() => {
                                console.log(`MediaPipeå‡¦ç†å®Œäº† - è¦–ç‚¹: ${viewType}`);
                            }).catch(error => {
                                console.error('MediaPipeå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                            });
                        }, 200);
                    } else {
                        console.warn('MediaPipeæœªæº–å‚™ - ã‚¹ã‚­ãƒƒãƒ—');
                    }
                    
                    updateDiagnosisButton();
                };
            };
            reader.readAsDataURL(file);
        }

        // ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®š
        function setupCanvas() {
            console.log('=== ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®šé–‹å§‹ ===');
            
            const img = document.getElementById('uploadedImage');
            const canvas = document.getElementById('poseCanvas');
            
            if (!img || !canvas) {
                console.error('è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’ç”»åƒã®è¡¨ç¤ºã‚µã‚¤ã‚ºã«åˆã‚ã›ã‚‹ï¼ˆãƒ¢ãƒã‚¤ãƒ«å®‰å®šåŒ–ï¼‰
            const setCanvasSize = () => {
                // ãƒ¢ãƒã‚¤ãƒ«å®‰å®šåŒ–: CSSãƒ”ã‚¯ã‚»ãƒ«åŸºæº–ã§æç”»ï¼ˆDPRã‚¹ã‚±ãƒ¼ãƒ«é©ç”¨ãªã—ï¼‰
                const displayW = img.clientWidth;
                const displayH = img.clientHeight;
                if (!displayW || !displayH) return;
                canvas.style.width = displayW + 'px';
                canvas.style.height = displayH + 'px';
                canvas.width = Math.round(displayW);
                canvas.height = Math.round(displayH);
                const ctx = canvas.getContext('2d');
                if (ctx) {
                    if (typeof ctx.resetTransform === 'function') { try { ctx.resetTransform(); } catch(_) {} }
                    else if (typeof ctx.setTransform === 'function') { ctx.setTransform(1,0,0,1,0,0); }
                }
                // ãƒªã‚µã‚¤ã‚ºå¾Œã«ç›´è¿‘ã®çµæœã‚’æç”»ï¼ˆè¨ºæ–­ç›´å¾Œã«æ¶ˆãˆã‚‹ã®ã‚’é˜²æ­¢ï¼‰
                try { redrawOverlay(); } catch(_) {}
            };
            setCanvasSize();
            window.addEventListener('resize', setCanvasSize, { passive: true });
            
            console.log('ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºè¨­å®šå®Œäº†');
            
            const viewType = document.getElementById('viewSelect').value;
            if (viewType === 'front') {
                // ãƒœãƒ¼ãƒ«ä½ç½®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ/ãƒã‚¤ãƒ³ã‚¿ã‚’æœ‰åŠ¹åŒ–ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
                canvas.addEventListener('click', handleCanvasClick);
                canvas.addEventListener('pointerdown', (e) => {
                    // ãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒ/ãƒšãƒ³ã‚’çµ±ä¸€å‡¦ç†
                    const fakeEvent = { clientX: e.clientX, clientY: e.clientY, preventDefault: ()=>{}, stopPropagation: ()=>{} };
                    handleCanvasClick(fakeEvent);
                    e.preventDefault();
                }, { passive: false });
                canvas.addEventListener('touchstart', (e) => {
                    // ã‚¿ãƒƒãƒã‚’ã‚¯ãƒªãƒƒã‚¯ã«å¤‰æ›
                    if (e.touches && e.touches.length > 0) {
                        const touch = e.touches[0];
                        const fakeEvent = { clientX: touch.clientX, clientY: touch.clientY, preventDefault: ()=>{}, stopPropagation: ()=>{} };
                        handleCanvasClick(fakeEvent);
                    }
                    e.preventDefault();
                }, { passive: false });
                document.getElementById('ballInstruction').style.display = 'block';
                console.log('âœ… ãƒœãƒ¼ãƒ«ä½ç½®ã‚¯ãƒªãƒƒã‚¯æœ‰åŠ¹åŒ–');
            } else {
                // ãƒœãƒ¼ãƒ«ä½ç½®ã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ï¼ˆæ—¢å­˜ã®ã‚¯ãƒªãƒƒã‚¯ã®ã¿è§£é™¤ï¼‰
                canvas.removeEventListener('click', handleCanvasClick);
                document.getElementById('ballInstruction').style.display = 'none';
                console.log('å¾Œæ–¹æ’®å½± - ãƒœãƒ¼ãƒ«ä½ç½®ä¸è¦');
            }
        }

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ï¼ˆå¤§ããªã‚¯ãƒªãƒƒã‚¯é ˜åŸŸå¯¾å¿œï¼‰
        function handleCanvasClick(event) {
            console.log('ğŸ¯ ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªãƒƒã‚¯æ¤œå‡º!');
            
            if (event && typeof event.preventDefault === 'function') event.preventDefault();
            if (event && typeof event.stopPropagation === 'function') event.stopPropagation();
            
            const canvas = document.getElementById('poseCanvas');
            const rect = canvas.getBoundingClientRect();
            // åº§æ¨™ã®å–ã‚Šã“ã¼ã—é˜²æ­¢ï¼ˆpointer/touchäº’æ›ï¼‰
            const cx = (event.clientX ?? event.pageX ?? (event.touches && event.touches[0]?.clientX));
            const cy = (event.clientY ?? event.pageY ?? (event.touches && event.touches[0]?.clientY));
            const x = cx - rect.left;
            const y = cy - rect.top;
            
            console.log('ã‚¯ãƒªãƒƒã‚¯åº§æ¨™:', Math.round(x), Math.round(y));
            
            // ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼šãƒœãƒ¼ãƒ«ã‚¯ãƒªãƒƒã‚¯é ˜åŸŸèª¿æ•´
            const isMobileClick = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
            const clickRadius = isMobileClick ? 120 : 80; // ã‚¹ãƒãƒ›120pxã€PC80px
            let ballDetected = false;
            
            // æ—¢å­˜ã®ãƒœãƒ¼ãƒ«ä½ç½®ãŒã‚ã‚Œã°ã€ãã®è¿‘ãã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
            if (ballPosition) {
                const ballX = ballPosition.x * canvas.clientWidth;
                const ballY = ballPosition.y * canvas.clientHeight;
                const distance = Math.sqrt(Math.pow(x - ballX, 2) + Math.pow(y - ballY, 2));
                
                if (distance <= clickRadius) {
                    console.log('æ—¢å­˜ãƒœãƒ¼ãƒ«ä½ç½®ã®è¿‘ãã‚’ã‚¯ãƒªãƒƒã‚¯ (è·é›¢:', Math.round(distance), 'px)');
                    ballDetected = true;
                }
            }
            
            // ãƒœãƒ¼ãƒ«ãŒæ¤œå‡ºã•ã‚Œã‚‹ã‹ã€ãƒœãƒ¼ãƒ«ä½ç½®ãŒæœªè¨­å®šã®å ´åˆã¯æ–°ã—ã„ä½ç½®ã‚’è¨­å®š
            if (ballDetected || !ballPosition) {
                // æ­£è¦åŒ–åº§æ¨™ã«å¤‰æ›
                ballPosition = {
                    x: x / canvas.clientWidth,
                    y: y / canvas.clientHeight
                };
                
                console.log('ãƒœãƒ¼ãƒ«ä½ç½®è¨­å®š:', Math.round(ballPosition.x * 100) + '%, ' + Math.round(ballPosition.y * 100) + '%');
            } else {
                console.log('ãƒœãƒ¼ãƒ«ã‹ã‚‰é ã„ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ - ç„¡è¦–');
                return;
            }
            
            // MediaPipeã®çµæœãŒã‚ã‚Œã°å†æç”»ã—ã¦ã‹ã‚‰èµ¤ã„ä¸¸ã‚’æç”»
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            // ã™ã¹ã¦ãƒ‡ãƒã‚¤ã‚¹ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã§æç”»ã™ã‚‹ãŸã‚ã€å¤‰æ›ã‚’ãƒªã‚»ãƒƒãƒˆ
            resetTransformSafe(ctx);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // MediaPipeã®å§¿å‹¢ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’å†æç”»
            if (currentResults && currentResults.poseLandmarks) {
                try {
                    // å®Œå…¨æ›¸ãç›´ã—ï¼šãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œMediaPipeæç”»
                    const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
                    console.log('ğŸ” MediaPipeæç”»é–‹å§‹ - ãƒ¢ãƒã‚¤ãƒ«:', isMobile, 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…:', window.innerWidth);
                    console.log('ğŸ” Canvasè©³ç´°:', {
                        width: canvas.width,
                        height: canvas.height,
                        clientWidth: canvas.clientWidth, 
                        clientHeight: canvas.clientHeight,
                        landmarks: currentResults.poseLandmarks.length
                    });
                    
                    // canvasã®çŠ¶æ…‹ã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆiOSå¯¾å¿œï¼‰
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    resetTransformSafe(ctx);
                    
                    // ã‚¹ãƒãƒ›ç”¨ï¼šå¿…ãšæç”»ã•ã‚Œã‚‹ç¢ºå®Ÿãªæ–¹æ³•
                    if (isMobile) {
                        console.log('ğŸ“± ã‚¹ãƒãƒ›å°‚ç”¨æç”»é–‹å§‹');
                        
                        // åŸºæœ¬è¨­å®š
                        ctx.strokeStyle = '#00FFFF';
                        ctx.lineWidth = 3; // åˆæœŸã‹ã‚‰ç´°ã
                        ctx.lineCap = 'round';
                        ctx.lineJoin = 'round';
                        ctx.fillStyle = '#FF0000';
                        
                        // ä½“ã®ä¸»è¦ãªç·šã‚’å¼·åˆ¶æç”»ï¼ˆMediaPipeã«ä¾å­˜ã—ãªã„ï¼‰
                        const landmarks = currentResults.poseLandmarks;
                        
                        // è‚©ã®ç·šï¼ˆ11-12ï¼‰
                        if (landmarks[11] && landmarks[12]) {
                            const x1 = landmarks[11].x * canvas.width;
                            const y1 = landmarks[11].y * canvas.height;
                            const x2 = landmarks[12].x * canvas.width;
                            const y2 = landmarks[12].y * canvas.height;
                            
                            ctx.beginPath();
                            ctx.moveTo(x1, y1);
                            ctx.lineTo(x2, y2);
                            ctx.stroke();
                            
                            // è‚©ã®ç‚¹ã‚‚æç”»
                            ctx.beginPath();
                            ctx.arc(x1, y1, (window.innerWidth < 768) ? 1 : 4, 0, 2 * Math.PI);
                            ctx.fill();
                            ctx.beginPath();
                            ctx.arc(x2, y2, (window.innerWidth < 768) ? 1 : 4, 0, 2 * Math.PI);
                            ctx.fill();
                        }
                        
                        // è…°ã®ç·šï¼ˆ23-24ï¼‰
                        if (landmarks[23] && landmarks[24]) {
                            const x1 = landmarks[23].x * canvas.width;
                            const y1 = landmarks[23].y * canvas.height;
                            const x2 = landmarks[24].x * canvas.width;
                            const y2 = landmarks[24].y * canvas.height;
                            
                            ctx.beginPath();
                            ctx.moveTo(x1, y1);
                            ctx.lineTo(x2, y2);
                            ctx.stroke();
                            
                            // è…°ã®ç‚¹ã‚‚æç”»
                            ctx.beginPath();
                            ctx.arc(x1, y1, (window.innerWidth < 768) ? 1 : 4, 0, 2 * Math.PI);
                            ctx.fill();
                            ctx.beginPath();
                            ctx.arc(x2, y2, (window.innerWidth < 768) ? 1 : 4, 0, 2 * Math.PI);
                            ctx.fill();
                        }
                        
                        // ä½“ã®ä¸­å¿ƒç·šï¼ˆè‚©ã‹ã‚‰è…°ï¼‰
                        if (landmarks[11] && landmarks[23]) {
                            ctx.beginPath();
                            ctx.moveTo(landmarks[11].x * canvas.width, landmarks[11].y * canvas.height);
                            ctx.lineTo(landmarks[23].x * canvas.width, landmarks[23].y * canvas.height);
                            ctx.stroke();
                        }
                        
                        if (landmarks[12] && landmarks[24]) {
                            ctx.beginPath();
                            ctx.moveTo(landmarks[12].x * canvas.width, landmarks[12].y * canvas.height);
                            ctx.lineTo(landmarks[24].x * canvas.width, landmarks[24].y * canvas.height);
                            ctx.stroke();
                        }

                        // é ­éƒ¨ï¼šè‚©ã®ä¸­ç‚¹â†’é¼»ã€è€³ã€œè€³ã€ç›®ã€œç›® ã®ãƒ©ã‚¤ãƒ³ã‚’æç”»
                        if (landmarks[11] && landmarks[12] && landmarks[0]) {
                            const sx = (landmarks[11].x + landmarks[12].x) / 2 * canvas.width;
                            const sy = (landmarks[11].y + landmarks[12].y) / 2 * canvas.height;
                            const nx = landmarks[0].x * canvas.width;
                            const ny = landmarks[0].y * canvas.height;
                            ctx.beginPath();
                            ctx.moveTo(sx, sy);
                            ctx.lineTo(nx, ny);
                            ctx.stroke();
                        }
                        if (landmarks[7] && landmarks[8]) { // è€³
                            ctx.beginPath();
                            ctx.moveTo(landmarks[7].x * canvas.width, landmarks[7].y * canvas.height);
                            ctx.lineTo(landmarks[8].x * canvas.width, landmarks[8].y * canvas.height);
                            ctx.stroke();
                        }
                        if (landmarks[2] && landmarks[5]) { // ç›®ï¼ˆå·¦ç›®ä¸­å¤®ã€œå³ç›®ä¸­å¤®ï¼‰
                            ctx.beginPath();
                            ctx.moveTo(landmarks[2].x * canvas.width, landmarks[2].y * canvas.height);
                            ctx.lineTo(landmarks[5].x * canvas.width, landmarks[5].y * canvas.height);
                            ctx.stroke();
                        }
                        
                        console.log('ğŸ“± ã‚¹ãƒãƒ›å°‚ç”¨æç”»å®Œäº† - å¼·åˆ¶MediaPipeç·šæç”»');
                    }
                    
                    // ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ç¢ºå®Ÿã«è¦‹ãˆã‚‹å¤ªã„ç·šã§æç”»
                    ctx.save(); // è¨­å®šã‚’ä¿å­˜
                    
                    // è¶…å¼·åŠ›ãƒ¢ãƒã‚¤ãƒ«ç·šè¨­å®šï¼ˆçµ¶å¯¾ã«è¦‹ãˆã‚‹ï¼‰
                    if (isMobile || window.innerWidth < 768) {
                        // ã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ï¼šæ˜ã‚‹ã„ç·šï¼ˆç´°ã‚ï¼‰
                        ctx.strokeStyle = '#00FFFF'; // ã‚·ã‚¢ãƒ³è‰²ï¼ˆæœ€ã‚‚ç›®ç«‹ã¤ï¼‰
                        ctx.lineWidth = 1; // ã‚¹ãƒãƒ›ã¯1pxã«
                        ctx.shadowColor = 'transparent';
                        ctx.shadowBlur = 0;
                        ctx.shadowOffsetX = 0;
                        ctx.shadowOffsetY = 0;
                    } else {
                        // PCç”¨ï¼šã•ã‚‰ã«å¤ªã‚ã®ç·š
                        ctx.strokeStyle = '#00FF00';
                        ctx.lineWidth = 3;
                    }
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.globalAlpha = 1.0;
                    
                    // é‡è¦ãªéª¨æ ¼ç·šã‚’æ‰‹å‹•ã§æç”»ï¼ˆç¢ºå®Ÿã«è¡¨ç¤ºï¼‰
                    const keyConnections = [
                        // ä¸ŠåŠèº«ã®ä¸»è¦ç·š
                        [11, 12], // å·¦å³è‚©
                        [11, 13], [13, 15], // å·¦è…•
                        [12, 14], [14, 16], // å³è…•
                        [11, 23], [12, 24], // è‚©ã‹ã‚‰è…°
                        [23, 24], // è…°ã®æ¨ªç·š
                        // ä¸‹åŠèº«ã®ä¸»è¦ç·š
                        [23, 25], [25, 27], // å·¦è„š
                        [24, 26], [26, 28]  // å³è„š
                    ];
                    
                    const isAndroid = /Android/i.test(navigator.userAgent);
                    const visThreshold = ((isAndroid || isMobile || window.innerWidth < 768) && document.getElementById('viewSelect').value === 'front') ? 0.2 : 0.5;
                    let linesDrawn = 0;
                    keyConnections.forEach(([startIdx, endIdx]) => {
                        const startPoint = currentResults.poseLandmarks[startIdx];
                        const endPoint = currentResults.poseLandmarks[endIdx];
                        
                        if (startPoint && endPoint &&
                            (startPoint.visibility === undefined || startPoint.visibility >= visThreshold) &&
                            (endPoint.visibility === undefined || endPoint.visibility >= visThreshold)) {
                            const startX = startPoint.x * canvas.width;
                            const startY = startPoint.y * canvas.height;
                            const endX = endPoint.x * canvas.width;
                            const endY = endPoint.y * canvas.height;
                            
                            ctx.beginPath();
                            ctx.moveTo(startX, startY);
                            ctx.lineTo(endX, endY);
                            ctx.stroke();
                            linesDrawn++;
                        }
                    });
                    
                    // é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’å·¨å¤§ã§ç›®ç«‹ã¤å††ã§æç”»
                    if (isMobile || window.innerWidth < 768) {
                        ctx.fillStyle = '#FF00FF'; // ãƒã‚¼ãƒ³ã‚¿è‰²ï¼ˆæœ€ã‚‚ç›®ç«‹ã¤ï¼‰
                        ctx.shadowColor = '#FFFF00'; // é»„è‰²ã„å½±
                        ctx.shadowBlur = 30;
                    } else {
                        ctx.fillStyle = '#FF0000';
                        ctx.shadowColor = 'transparent'; // PCç”¨ï¼šå½±ãªã—
                        ctx.shadowBlur = 0;
                    }
                    const keyPoints = [11, 12, 13, 14, 15, 16, 23, 24, 25, 26, 27, 28];
                    let pointsDrawn = 0;
                    
                    keyPoints.forEach(index => {
                        const point = currentResults.poseLandmarks[index];
                        if (point && (point.visibility === undefined || point.visibility >= visThreshold)) {
                            const x = point.x * canvas.width;
                            const y = point.y * canvas.height;
                            
                            ctx.beginPath();
                            const radius = (isMobile || window.innerWidth < 768) ? 1 : 4; // ã‚¹ãƒãƒ›1pxã€PC4px
                            ctx.arc(x, y, radius, 0, 2 * Math.PI);
                            ctx.fill();
                            pointsDrawn++;
                        }
                    });

                    // Android/ãƒ¢ãƒã‚¤ãƒ«æ­£é¢ã§ãƒ©ã‚¤ãƒ³ãŒç„¡ã‘ã‚Œã°å¯è¦–æ€§ç„¡è¦–ã§å¼·åˆ¶æç”»
                    if (linesDrawn === 0 && document.getElementById('viewSelect').value === 'front' && (isAndroid || isMobile || window.innerWidth < 768)) {
                        console.log('ğŸ“± æ­£é¢ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å¯è¦–æ€§ã‚’ç„¡è¦–ã—ã¦ä¸»è¦ãƒ©ã‚¤ãƒ³ã‚’å¼·åˆ¶æç”»');
                        ctx.save();
                        ctx.strokeStyle = '#00FFFF';
                        ctx.lineWidth = 3;
                        keyConnections.forEach(([a,b]) => {
                            const A = currentResults.poseLandmarks[a];
                            const B = currentResults.poseLandmarks[b];
                            if (A && B) {
                                ctx.beginPath();
                                ctx.moveTo(A.x * canvas.width, A.y * canvas.height);
                                ctx.lineTo(B.x * canvas.width, B.y * canvas.height);
                                ctx.stroke();
                                linesDrawn++;
                            }
                        });
                        ctx.restore();
                    }
                    
                    ctx.restore(); // è¨­å®šã‚’å¾©å…ƒ
                    
                    console.log('âœ… MediaPipeæç”»å®Œäº† - æç”»ç·šæ•°:', linesDrawn, 'æç”»ç‚¹æ•°:', pointsDrawn, 'ãƒ¢ãƒã‚¤ãƒ«:', isMobile);
                    
                    // ã‚¹ãƒãƒ›ç”¨ï¼šã•ã‚‰ã«ç¢ºå®Ÿãªè£œåŠ©ç·šæç”»
                    if (isMobile || window.innerWidth < 768) {
                        console.log('ğŸ“± ã‚¹ãƒãƒ›ç”¨è£œåŠ©ç·šæç”»é–‹å§‹');
                        ctx.strokeStyle = '#FFFF00'; // é»„è‰²ï¼ˆè£œåŠ©ç·šï¼‰
                        ctx.lineWidth = 2; // ç´°ã„è£œåŠ©ç·š
                        ctx.shadowColor = 'transparent';
                        ctx.shadowBlur = 0;
                        
                        // é‡è¦ãªä½“ã®è»¸ã‚’å¼·èª¿æç”»
                        if (currentResults.poseLandmarks[11] && currentResults.poseLandmarks[23]) {
                            // å·¦è‚©ã‹ã‚‰å·¦è…°ã¸ã®ç·š
                            ctx.beginPath();
                            ctx.moveTo(currentResults.poseLandmarks[11].x * canvas.width, currentResults.poseLandmarks[11].y * canvas.height);
                            ctx.lineTo(currentResults.poseLandmarks[23].x * canvas.width, currentResults.poseLandmarks[23].y * canvas.height);
                            ctx.stroke();
                        }
                        
                        if (currentResults.poseLandmarks[12] && currentResults.poseLandmarks[24]) {
                            // å³è‚©ã‹ã‚‰å³è…°ã¸ã®ç·š
                            ctx.beginPath();
                            ctx.moveTo(currentResults.poseLandmarks[12].x * canvas.width, currentResults.poseLandmarks[12].y * canvas.height);
                            ctx.lineTo(currentResults.poseLandmarks[24].x * canvas.width, currentResults.poseLandmarks[24].y * canvas.height);
                            ctx.stroke();
                        }
                        
                        console.log('ğŸ“± ã‚¹ãƒãƒ›ç”¨è£œåŠ©ç·šæç”»å®Œäº†');
                    }
                    
                    // ãƒ¢ãƒã‚¤ãƒ«ã§ç·šãŒè¦‹ãˆãªã„å ´åˆã®ç·Šæ€¥æªç½®ï¼ˆå¼·åŒ–ç‰ˆï¼‰
                    if ((isMobile || isAndroid) && linesDrawn === 0) {
                        console.log('âš ï¸ ç·Šæ€¥æªç½®: å¼·åˆ¶ç·šæç”»å®Ÿè¡Œ');
                        ctx.strokeStyle = '#FF0000'; // èµ¤è‰²ã§å¼·åˆ¶æç”»
                        ctx.lineWidth = 3;
                        ctx.lineCap = 'round';
                        
                        // å¤§ããªèµ¤ã„Xå°ã‚’æç”»
                        ctx.beginPath();
                        ctx.moveTo(50, 50);
                        ctx.lineTo(canvas.width - 50, canvas.height - 50);
                        ctx.moveTo(canvas.width - 50, 50);
                        ctx.lineTo(50, canvas.height - 50);
                        ctx.stroke();
                        
                        // ä¸­å¤®ã«å¤§ããªå††ã‚‚æç”»
                        ctx.fillStyle = '#FF0000';
                        ctx.beginPath();
                        ctx.arc(canvas.width/2, canvas.height/2, 4, 0, 2 * Math.PI);
                        ctx.fill();
                        
                        console.log('ğŸ”´ ç·Šæ€¥èµ¤ç·šãƒ»å††æç”»å®Œäº†');
                    }
                    
                    // ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã€å¸¸ã«è¿½åŠ ã®ç›®å°ã‚’æç”»
                    if (isMobile) {
                        ctx.fillStyle = '#00FFFF'; // ã‚·ã‚¢ãƒ³è‰²
                        ctx.fillRect(10, 10, 50, 30); // å·¦ä¸Šã«å››è§’
                        ctx.fillRect(canvas.width - 60, 10, 50, 30); // å³ä¸Šã«å››è§’
                        console.log('ğŸ”µ ãƒ¢ãƒã‚¤ãƒ«ç›®å°æç”»å®Œäº†');
                    }
                } catch (error) {
                    console.error('MediaPipeå†æç”»ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            // ãƒœãƒ¼ãƒ«ä½ç½®ã®èµ¤ã„ä¸¸ã‚’æç”»ï¼ˆãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œã‚µã‚¤ã‚ºï¼‰
            const isMobileBall = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
            const ballRadius = isMobileBall ? 8 : 10; // ã‚¹ãƒãƒ›8pxã€PC10pxï¼ˆå°‘ã—å¤§ããï¼‰

            // CSSåº§æ¨™ -> ãƒ‡ãƒã‚¤ã‚¹ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã¸å¤‰æ›ã—ã¦æç”»
            const scaleX = canvas.width / canvas.clientWidth;
            const scaleY = canvas.height / canvas.clientHeight;
            const actualX = x * scaleX;
            const actualY = y * scaleY;
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(actualX, actualY, ballRadius, 0, 2 * Math.PI);
            ctx.fill();
            // å®‰å®šã®ãŸã‚ã€æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ã§ã‚‚é‡ã­æã
            setTimeout(() => { try { redrawOverlay(); } catch(_) {} }, 0);
            
            // æŒ‡ç¤ºã‚’éè¡¨ç¤º
            document.getElementById('ballInstruction').style.display = 'none';
            
            console.log('âœ… ãƒœãƒ¼ãƒ«ä½ç½®è¨­å®šå®Œäº†');
            updateDiagnosisButton();
        }

        // æ’®å½±è¦–ç‚¹å¤‰æ›´å‡¦ç†
        function handleViewChange() {
            const viewType = document.getElementById('viewSelect').value;
            console.log('æ’®å½±è¦–ç‚¹å¤‰æ›´:', viewType);
            if (uploadedImage) {
                ballPosition = null; // ãƒªã‚»ãƒƒãƒˆ
                setupCanvas();
                
                // å¾Œæ–¹æ’®å½±ã®å ´åˆã€MediaPipeå‡¦ç†ã‚’å†å®Ÿè¡Œ
                if (viewType === 'rear' && mediaPipeReady && pose) {
                    setTimeout(() => {
                        console.log('å¾Œæ–¹æ’®å½±ï¼šMediaPipeå‡¦ç†ã‚’å†å®Ÿè¡Œ');
                        pose.send({image: uploadedImage}).then(() => {
                            console.log('å¾Œæ–¹æ’®å½±ï¼šMediaPipeå‡¦ç†å®Œäº†');
                        }).catch(error => {
                            console.error('å¾Œæ–¹æ’®å½±ï¼šMediaPipeå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                        });
                    }, 300);
                }
                
                updateDiagnosisButton();
            }
        }

        // è¨ºæ–­ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
        function updateDiagnosisButton() {
            const btn = document.getElementById('diagnosisBtn');
            const viewType = document.getElementById('viewSelect').value;
            
            console.log('è¨ºæ–­ãƒœã‚¿ãƒ³æ›´æ–°:', {
                image: !!uploadedImage,
                viewType: viewType,
                ballPosition: !!ballPosition
            });
            
            if (!uploadedImage) {
                btn.disabled = true;
                btn.textContent = 'ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„';
            } else if (viewType === 'front' && !ballPosition) {
                btn.disabled = true;
                btn.textContent = 'ãƒœãƒ¼ãƒ«ä½ç½®ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„';
            } else {
                btn.disabled = false;
                btn.textContent = 'ğŸ” è¨ºæ–­é–‹å§‹';
                btn.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
                console.log('âœ… è¨ºæ–­ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–');
            }
        }

        // è¨ºæ–­é–‹å§‹
        function startDiagnosis() {
            console.log('è¨ºæ–­é–‹å§‹...');
            const btn = document.getElementById('diagnosisBtn');
            btn.textContent = 'è¨ºæ–­ä¸­...';
            btn.disabled = true;
            
            setTimeout(() => {
                performDiagnosis();
            }, 1000);
        }

        // è¨ºæ–­å®Ÿè¡Œ
function performDiagnosis() {
            console.log('è¨ºæ–­å®Ÿè¡Œä¸­...');
            
            const viewType = document.getElementById('viewSelect').value;
            let scores;
            
            if (mediaPipeReady && currentResults && currentResults.poseLandmarks) {
                console.log('MediaPipeçµæœã‚’ä½¿ç”¨ã—ã¦è©³ç´°åˆ†æå®Ÿè¡Œ');
                scores = performMediaPipeAnalysis(currentResults.poseLandmarks, viewType);
            } else {
                console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆ†æå®Ÿè¡Œ');
                scores = performFallbackAnalysis(viewType);
            }
            
            console.log('è¨ºæ–­å®Œäº†:', scores);
            
    // çµæœè¡¨ç¤º
    displayDetailedResults(scores);
    createRadarChart(scores);

    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å†æç”»ï¼ˆè¨ºæ–­å¾Œã‚‚é ­éƒ¨ç‚¹ãƒ»ç·šãŒæ®‹ã‚‹ã‚ˆã†ã«ï¼‰
    try {
      const canvas = document.getElementById('poseCanvas');
      const ctx = canvas.getContext('2d', { willReadFrequently: true });
      if (currentResults && currentResults.poseLandmarks && canvas) {
        // ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰ç¾åœ¨ã®ãƒãƒ¼ã‚ºã‚’æ‰‹å‹•æç”»ï¼ˆè‰²ã‚’è¨ºæ–­å‰ã¨çµ±ä¸€ï¼‰
        ctx.clearRect(0,0,canvas.width, canvas.height);
        const lm = currentResults.poseLandmarks;
        ctx.strokeStyle = '#00FF00';
        ctx.lineWidth = (window.innerWidth < 768) ? 1 : 3;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        const drawLine = (a,b)=>{ if(lm[a]&&lm[b]){ ctx.beginPath(); ctx.moveTo(lm[a].x*canvas.width, lm[a].y*canvas.height); ctx.lineTo(lm[b].x*canvas.width, lm[b].y*canvas.height); ctx.stroke(); } };
        // ä¸»è¦ãƒ©ã‚¤ãƒ³
        [[11,12],[11,13],[13,15],[12,14],[14,16],[11,23],[12,24],[23,24],[23,25],[25,27],[24,26],[26,28]].forEach(p=>drawLine(p[0],p[1]));
        // è‚©ä¸­ç‚¹â†’è…°ä¸­ç‚¹
        if(lm[11]&&lm[12]&&lm[23]&&lm[24]){
          const sx=(lm[11].x+lm[12].x)/2*canvas.width, sy=(lm[11].y+lm[12].y)/2*canvas.height;
          const hx=(lm[23].x+lm[24].x)/2*canvas.width, hy=(lm[23].y+lm[24].y)/2*canvas.height;
          ctx.beginPath(); ctx.moveTo(sx,sy); ctx.lineTo(hx,hy); ctx.stroke();
          if(lm[0]){ ctx.beginPath(); ctx.moveTo(sx,sy); ctx.lineTo(lm[0].x*canvas.width, lm[0].y*canvas.height); ctx.stroke(); }
        }
        // ç‚¹ï¼ˆé ­éƒ¨å«ã‚€ï¼‰
        ctx.fillStyle = '#FF0000';
        const drawPt = (i,r=4)=>{ if(lm[i]){ ctx.beginPath(); ctx.arc(lm[i].x*canvas.width, lm[i].y*canvas.height, r, 0, 2*Math.PI); ctx.fill(); } };
        [0,1,2,3,4,5,7,8,9,10,11,12,13,14,15,16,23,24,25,26,27,28].forEach(i=>drawPt(i,4));

        // ãƒœãƒ¼ãƒ«ä¸¸ã‚‚é‡ã­ã¦ç¶­æŒ
        const viewType2 = document.getElementById('viewSelect').value;
        if (ballPosition && viewType2 === 'front'){
          ctx.fillStyle='red';
          const r = (window.innerWidth<768)?4:10;
          ctx.beginPath(); ctx.arc(ballPosition.x*canvas.width, ballPosition.y*canvas.height, r, 0, 2*Math.PI); ctx.fill();
        }
      }
    } catch(e) { console.warn('post-diagnosis overlay draw failed', e); }
            
    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
            const btn = document.getElementById('diagnosisBtn');
            btn.textContent = 'ğŸ” è¨ºæ–­é–‹å§‹';
            btn.disabled = false;
            btn.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
        }

        // MediaPipeåˆ†æ
        function performMediaPipeAnalysis(landmarks, viewType) {
            console.log('MediaPipeåˆ†æé–‹å§‹ - ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ•°:', landmarks.length);
            
            let scores;
            
            if (viewType === 'front') {
                scores = {
                    ballPosition: ballPosition ? analyzeBallPositionWithPose(landmarks) : 85,
                    stance: analyzeStanceWidth(landmarks),
                    headPosition: analyzeHeadPosition(landmarks),
                    handPosition: analyzeHandPosition(landmarks),
                    weight: analyzeWeightDistribution(landmarks)
                };
            } else { // rear
                scores = {
                    forwardLean: analyzeForwardLeanFromLandmarks(landmarks),
                    handBodyDistance: analyzeHandBodyDistance(landmarks),
                    frontBackBalance: analyzeFrontBackBalance(landmarks),
                    bodyDirection: analyzeBodyDirection(landmarks),
                    backCurvature: analyzeBackCurvature(landmarks)
                };
            }
            
            return scores;
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆ†æï¼ˆã‚¹ãƒãƒ›ã§ã‚‚å…·ä½“ã‚³ãƒ¡ãƒ³ãƒˆãŒå‡ºã‚‹ã‚ˆã†è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚‚ç”Ÿæˆï¼‰
        function performFallbackAnalysis(viewType) {
            console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆ†æå®Ÿè¡Œ');
            const rnd = () => Math.floor(Math.random() * 25) + 75;
            let scores;

            if (viewType === 'front') {
                scores = {
                    ballPosition: ballPosition ? calculateBallPositionScore() : 85,
                    stance: rnd(),
                    headPosition: rnd(),
                    handPosition: rnd(),
                    weight: rnd()
                };

                // å…·ä½“çš„ãªç¾çŠ¶ã‚’ä½œã‚‹ãŸã‚ã®ç°¡æ˜“è©³ç´°ãƒ‡ãƒ¼ã‚¿ï¼ˆç”»åƒä¸­å¿ƒåŸºæº–ï¼‰
                const centerX = 0.5;
                if (ballPosition) {
                    const diff = (ballPosition.x - centerX);
                    detailedAnalysisData.ballPosition = {
                        currentPosition: ballPosition.x,
                        idealPosition: centerX,
                        difference: diff,
                        isLeftTooMuch: diff > 0.03,
                        isRightTooMuch: diff < -0.03
                    };
                }
                // ã‚¹ã‚¿ãƒ³ã‚¹å¹…ï¼ˆä»®æƒ³ï¼‰: ã‚¹ã‚³ã‚¢ã§æ–¹å‘æ€§ã‚’æ±ºå®š
                const idealRatio = 1.2;
                const tooWide = scores.stance < 80; // ä½ã‚¹ã‚³ã‚¢ãªã‚‰åºƒã™ãã‚‹ã¨ä»®å®š
                const ratio = idealRatio + (tooWide ? 0.2 : -0.1);
                detailedAnalysisData.stance = {
                    currentRatio: ratio,
                    idealRatio: idealRatio,
                    difference: ratio - idealRatio,
                    isTooWide: tooWide,
                    isTooNarrow: !tooWide
                };
                // é ­ã®ä½ç½®ï¼ˆç”»åƒä¸­å¿ƒåŸºæº–ã§æ–¹å‘ã‚’æ±ºå®šï¼‰
                if (ballPosition) {
                    const headDiff = (ballPosition.x - centerX); // ä»£ç”¨
                    detailedAnalysisData.headPosition = {
                        difference: headDiff,
                        isLeftTooMuch: headDiff > 0.03,
                        isRightTooMuch: headDiff < -0.03
                    };
                }
                // æ‰‹ã®ä½ç½®ï¼ˆç”»åƒä¸­å¿ƒåŸºæº–ã§æ–¹å‘ã‚’æ±ºå®šï¼‰
                if (ballPosition) {
                    const handDiff = (ballPosition.x - centerX) * 0.8;
                    detailedAnalysisData.handPosition = {
                        difference: handDiff,
                        isLeftTooMuch: handDiff > 0.03,
                        isRightTooMuch: handDiff < -0.03
                    };
                }
                // ä½“é‡é…åˆ†ï¼ˆå·¦å³ã®æ–¹å‘æ€§ã ã‘æ±ºã‚ã‚‹ï¼‰
                const wDiff = (ballPosition ? (ballPosition.x - centerX) : 0);
                detailedAnalysisData.weight = {
                    difference: wDiff,
                    isLeftHeavy: wDiff > 0.03,
                    isRightHeavy: wDiff < -0.03
                };
            } else { // rear
                scores = {
                    forwardLean: rnd(),
                    handBodyDistance: rnd(),
                    frontBackBalance: rnd(),
                    bodyDirection: rnd(),
                    backCurvature: rnd()
                };

                // å¾Œæ–¹ç”¨ã®ç°¡æ˜“è©³ç´°ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¯ãƒ©ãƒ–ç†æƒ³å€¤ã«å¯¾ã—ã¦éä¸è¶³ã‚’ä½œã‚‹ï¼‰
                const club = document.getElementById('clubSelect')?.value || 'iron7';
                // ç†æƒ³è§’åº¦ï¼ˆå‚ç›´ã‹ã‚‰ä½“ã¾ã§ï¼‰: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼30Â° â†’ ã‚¦ã‚§ãƒƒã‚¸45Â°
                const idealAngles = { driver: 30, fairway: 33, utility: 35, iron7: 40, iron9: 42, wedge: 45 };
                const idealAngle = idealAngles[club] || 40;
                const currentAngle = idealAngle + (scores.forwardLean < 85 ? 6 : -4);
                detailedAnalysisData.forwardLean = {
                    currentAngle,
                    idealAngle,
                    isTooShallow: currentAngle < idealAngle,
                    isTooDeep: currentAngle > idealAngle
                };
                const idealDistance = 0.9;
                const relDist = idealDistance + (scores.handBodyDistance < 85 ? 0.08 : -0.05);
                detailedAnalysisData.handBodyDistance = {
                    currentDistance: relDist,
                    idealDistance,
                    isTooFar: relDist > idealDistance + 0.02,
                    isTooClose: relDist < idealDistance - 0.02,
                    distanceDiff: relDist - idealDistance
                };
                const balance = (scores.frontBackBalance < 85 ? 0.05 : -0.04);
                detailedAnalysisData.frontBackBalance = {
                    currentBalance: balance,
                    idealBalance: 0,
                    isTooForward: balance > 0.02,
                    isTooBackward: balance < -0.02,
                    difference: balance
                };
                // bodyDirection/backCurvature ã¯æ±ç”¨ã‚³ãƒ¡ãƒ³ãƒˆã§ã‚«ãƒãƒ¼
            }

            return scores;
        }

        // MediaPipeåˆ†æé–¢æ•°ç¾¤
        function analyzeBallPositionWithPose(landmarks) {
            try {
                const leftAnkle = landmarks[28];  // å·¦è¶³é¦–ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ï¼‰
                const rightAnkle = landmarks[27]; // å³è¶³é¦–ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ï¼‰
                const stanceCenter = (leftAnkle.x + rightAnkle.x) / 2;
                
                const selectedClub = document.getElementById('clubSelect').value;
                const idealPosition = getIdealBallPosition(selectedClub);
                const idealX = stanceCenter + (idealPosition - 0.5) * 0.3; // èª¿æ•´ä¿‚æ•°
                
                const ballDiff = ballPosition.x - idealX;
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                detailedAnalysisData.ballPosition = {
                    currentPosition: ballPosition.x,
                    idealPosition: idealX,
                    difference: ballDiff,
                    club: selectedClub,
                    idealPercentage: idealPosition * 100, // ç†æƒ³å€¤ã‚’%ã§è¡¨ç¤º
                    currentPercentage: (ballPosition.x - leftAnkle.x) / (rightAnkle.x - leftAnkle.x) * 100, // å®Ÿéš›ã®ä½ç½®ã‚’%ã§
                    isLeftTooMuch: ballDiff > 0,  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦ã«å¯„ã‚Šã™ã
                    isRightTooMuch: ballDiff < 0  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å³ã«å¯„ã‚Šã™ã
                };
                
                console.log('MediaPipeãƒœãƒ¼ãƒ«ä½ç½®åˆ†æ:', {
                    ballX: Math.round(ballPosition.x * 100) + '%',
                    stanceCenter: Math.round(stanceCenter * 100) + '%',
                    idealX: Math.round(idealX * 100) + '%',
                    diff: Math.round(ballDiff * 100) + '%'
                });
                
                if (Math.abs(ballDiff) < 0.03) return 92;
                if (Math.abs(ballDiff) < 0.06) return 85;
                if (Math.abs(ballDiff) < 0.1) return 75;
                return 68;
                
            } catch (error) {
                console.error('MediaPipeãƒœãƒ¼ãƒ«ä½ç½®åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return calculateBallPositionScore();
            }
        }

        function analyzeStanceWidth(landmarks) {
            try {
                const leftAnkle = landmarks[28];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è¶³é¦–
                const rightAnkle = landmarks[27]; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è¶³é¦–
                const leftShoulder = landmarks[12];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è‚©
                const rightShoulder = landmarks[11]; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è‚©
                
                const stanceWidth = Math.abs(rightAnkle.x - leftAnkle.x);
                const shoulderWidth = Math.abs(rightShoulder.x - leftShoulder.x);
                const ratio = stanceWidth / shoulderWidth;
                
                const selectedClub = document.getElementById('clubSelect').value;
                const idealRatio = getIdealStanceRatio(selectedClub);
                const ratioDiff = Math.abs(ratio - idealRatio);
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                detailedAnalysisData.stance = {
                    currentRatio: ratio,
                    idealRatio: idealRatio,
                    difference: ratio - idealRatio,
                    club: selectedClub,
                    isTooWide: ratio > idealRatio,
                    isTooNarrow: ratio < idealRatio,
                    stanceWidthPercent: Math.round(stanceWidth * 100),
                    shoulderWidthPercent: Math.round(shoulderWidth * 100)
                };
                
                console.log('MediaPipeã‚¹ã‚¿ãƒ³ã‚¹åˆ†æ:', {
                    ratio: ratio.toFixed(2),
                    idealRatio: idealRatio.toFixed(2),
                    club: selectedClub,
                    stanceWidth: Math.round(stanceWidth * 100) + '%',
                    shoulderWidth: Math.round(shoulderWidth * 100) + '%'
                });
                
                if (ratioDiff < 0.05) return 92;
                if (ratioDiff < 0.1) return 85;
                if (ratioDiff < 0.15) return 75;
                return 68;
                
            } catch (error) {
                console.error('MediaPipeã‚¹ã‚¿ãƒ³ã‚¹åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 78;
            }
        }

        function analyzePostureFromLandmarks(landmarks) {
            try {
                const leftShoulder = landmarks[11];
                const rightShoulder = landmarks[12];
                const leftHip = landmarks[23];
                const rightHip = landmarks[24];
                
                const shoulderCenter = {
                    x: (leftShoulder.x + rightShoulder.x) / 2,
                    y: (leftShoulder.y + rightShoulder.y) / 2
                };
                const hipCenter = {
                    x: (leftHip.x + rightHip.x) / 2,
                    y: (leftHip.y + rightHip.y) / 2
                };
                
                const forwardLean = shoulderCenter.x - hipCenter.x;
                
                console.log('MediaPipeå§¿å‹¢åˆ†æ:', {
                    forwardLean: Math.round(forwardLean * 100) + '%'
                });
                
                const idealLean = 0.03;
                const leanDiff = Math.abs(forwardLean - idealLean);
                
                if (leanDiff < 0.02) return 92;
                if (leanDiff < 0.04) return 85;
                if (leanDiff < 0.06) return 75;
                return 68;
                
            } catch (error) {
                console.error('MediaPipeå§¿å‹¢åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 82;
            }
        }

        function analyzeHandPosition(landmarks) {
            try {
                const leftWrist = landmarks[16];   // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦æ‰‹é¦–
                const rightWrist = landmarks[15];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³æ‰‹é¦–
                const leftAnkle = landmarks[28];   // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è¶³é¦–
                const rightAnkle = landmarks[27];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è¶³é¦–
                
                const handCenter = (leftWrist.x + rightWrist.x) / 2;
                const stanceCenter = (leftAnkle.x + rightAnkle.x) / 2;
                
                const selectedClub = document.getElementById('clubSelect').value;
                const idealHandOffset = getIdealHandPosition(selectedClub);
                const idealHandX = stanceCenter + idealHandOffset;
                const handDiff = handCenter - idealHandX;
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦å³ã‚’åˆ¤å®šï¼‰
                detailedAnalysisData.handPosition = {
                    currentHandPosition: handCenter,
                    idealHandPosition: idealHandX,
                    stanceCenter: stanceCenter,
                    difference: handDiff,
                    club: selectedClub,
                    isLeftTooMuch: handDiff > 0,  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦ã«å¯„ã‚Šã™ã
                    isRightTooMuch: handDiff < 0, // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å³ã«å¯„ã‚Šã™ã
                    idealOffset: idealHandOffset
                };
                
                console.log('MediaPipeæ‰‹ä½ç½®åˆ†æ - è©³ç´°:', {
                    'æ‰‹ã®å®Ÿéš›ä½ç½®(handCenter)': Math.round(handCenter * 1000) / 10,
                    'ã‚¹ã‚¿ãƒ³ã‚¹ä¸­å¤®(stanceCenter)': Math.round(stanceCenter * 1000) / 10,
                    'ç†æƒ³ä½ç½®(idealHandX)': Math.round(idealHandX * 1000) / 10,
                    'ç†æƒ³ã‚ªãƒ•ã‚»ãƒƒãƒˆ': idealHandOffset,
                    'å·®åˆ†(handDiff)': Math.round(handDiff * 1000) / 10,
                    'æ‰‹ãŒå³ã™ãã‚‹ï¼Ÿ': handDiff < 0,
                    'æ‰‹ãŒå·¦ã™ãã‚‹ï¼Ÿ': handDiff > 0,
                    'ã‚¯ãƒ©ãƒ–': selectedClub
                });
                
                // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å³ã™ãã‚‹å ´åˆï¼ˆå³è…°ã®å‰ãªã©ï¼‰ã¯æ®µéšçš„ã«å³ã—ãè©•ä¾¡
                if (handDiff < -0.10) return 15; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å¤§ããå³ã™ãã‚‹å ´åˆï¼ˆå³è…°ã®å‰ï¼‰
                if (handDiff < -0.06) return 25; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å³ã™ãã‚‹å ´åˆ
                if (handDiff < -0.03) return 40; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§ã‚„ã‚„å³ã™ãã‚‹å ´åˆ
                
                // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦ã™ãã‚‹å ´åˆã‚‚æ®µéšçš„ã«è©•ä¾¡
                if (handDiff > 0.15) return 20; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å¤§ããå·¦ã™ãã‚‹å ´åˆ
                if (handDiff > 0.10) return 30; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦ã™ãã‚‹å ´åˆ
                if (handDiff > 0.06) return 45; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§ã‚„ã‚„å·¦ã™ãã‚‹å ´åˆ
                
                // å·¦å†…ã‚‚ã‚‚ã‚ãŸã‚Šï¼ˆç†æƒ³çš„ãªä½ç½®ï¼‰ã¯é«˜å¾—ç‚¹ - ã‚ˆã‚Šå¯›å®¹ãªåŸºæº–
                if (Math.abs(handDiff) < 0.015) return 98; // éå¸¸ã«ç†æƒ³çš„
                if (Math.abs(handDiff) < 0.03) return 95;  // ç†æƒ³çš„
                if (Math.abs(handDiff) < 0.05) return 88;  // è‰¯å¥½
                if (Math.abs(handDiff) < 0.07) return 80;  // ã¾ã‚ã¾ã‚
                return 60;
                
            } catch (error) {
                console.error('MediaPipeæ‰‹ä½ç½®åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 88;
            }
        }

        function analyzeWeightDistribution(landmarks) {
            try {
                const leftAnkle = landmarks[28];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è¶³é¦–
                const rightAnkle = landmarks[27]; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è¶³é¦–
                const nose = landmarks[0];
                
                const stanceCenter = (leftAnkle.x + rightAnkle.x) / 2;
                const bodyCenter = nose.x;
                const balance = bodyCenter - stanceCenter; // æ­£ã®å€¤ï¼šå³è¶³é‡å¿ƒã€è² ã®å€¤ï¼šå·¦è¶³é‡å¿ƒ
                
                const selectedClub = document.getElementById('clubSelect').value;
                const idealWeightBalance = getIdealWeightBalance(selectedClub);
                
                // ç†æƒ³çš„ãªä½“é‡é…åˆ†ã«åŸºã¥ãç†æƒ³çš„ãªä½ç½®è¨ˆç®—
                // 0.5 = å‡ç­‰ã€0.6 = 6:4ã§å³è¶³é‡å¿ƒ
                let idealBodyPosition;
                if (idealWeightBalance === 0.6) {
                    idealBodyPosition = stanceCenter + 0.02; // å³ã«å°‘ã—ãšã‚ŒãŸä½ç½®
                } else {
                    idealBodyPosition = stanceCenter; // ä¸­å¤®
                }
                
                const positionDiff = Math.abs(bodyCenter - idealBodyPosition);
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦å³ã‚’åˆ¤å®šï¼‰
                detailedAnalysisData.weight = {
                    currentBalance: balance,
                    bodyCenter: bodyCenter,
                    stanceCenter: stanceCenter,
                    idealBodyPosition: idealBodyPosition,
                    idealWeightBalance: idealWeightBalance,
                    club: selectedClub,
                    isRightHeavy: bodyCenter < idealBodyPosition,  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å³è¶³é‡å¿ƒ
                    isLeftHeavy: bodyCenter > idealBodyPosition,   // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦è¶³é‡å¿ƒ
                    difference: bodyCenter - idealBodyPosition
                };
                
                console.log('MediaPipeä½“é‡é…åˆ†åˆ†æ:', {
                    balance: Math.round(balance * 100) + '%',
                    bodyCenter: Math.round(bodyCenter * 100) + '%',
                    stanceCenter: Math.round(stanceCenter * 100) + '%',
                    idealBodyPosition: Math.round(idealBodyPosition * 100) + '%',
                    club: selectedClub,
                    idealBalance: (idealWeightBalance * 100) + '%å³è¶³é‡å¿ƒ'
                });
                
                if (positionDiff < 0.015) return 92;
                if (positionDiff < 0.03) return 85;
                if (positionDiff < 0.045) return 75;
                return 68;
                
            } catch (error) {
                console.error('MediaPipeä½“é‡é…åˆ†åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 80;
            }
        }

        // é ­ã®ä½ç½®åˆ†æï¼ˆæ­£é¢æ’®å½±ç”¨ï¼‰
        function analyzeHeadPosition(landmarks) {
            try {
                const nose = landmarks[0];
                const leftAnkle = landmarks[28];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è¶³é¦–
                const rightAnkle = landmarks[27]; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è¶³é¦–
                
                const stanceCenter = (leftAnkle.x + rightAnkle.x) / 2;
                const headPosition = nose.x;
                
                const selectedClub = document.getElementById('clubSelect').value;
                const idealHeadPosition = getIdealHeadPosition(selectedClub);
                
                // ç†æƒ³çš„ãªé ­ã®ä½ç½®ã‚’è¨ˆç®—
                const idealHeadX = stanceCenter + (idealHeadPosition - 0.5) * 0.1; // å¾®èª¿æ•´ä¿‚æ•°
                const headDiff = headPosition - idealHeadX; // ç¬¦å·ã‚’ä¿æŒ
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦å³ã‚’åˆ¤å®šï¼‰
                detailedAnalysisData.headPosition = {
                    currentHeadPosition: headPosition,
                    idealHeadPosition: idealHeadX,
                    stanceCenter: stanceCenter,
                    difference: headDiff,
                    club: selectedClub,
                    isLeftTooMuch: headDiff > 0,  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦ã«å¯„ã‚Šã™ã
                    isRightTooMuch: headDiff < 0, // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å³ã«å¯„ã‚Šã™ã
                    idealPositionPercent: idealHeadPosition * 100
                };
                
                console.log('MediaPipeé ­ä½ç½®åˆ†æ:', {
                    headX: Math.round(headPosition * 100) + '%',
                    stanceCenter: Math.round(stanceCenter * 100) + '%',
                    idealHeadX: Math.round(idealHeadX * 100) + '%',
                    club: selectedClub,
                    diff: Math.round(headDiff * 100) + '%'
                });
                
                const absHeadDiff = Math.abs(headDiff);
                if (absHeadDiff < 0.02) return 92;
                if (absHeadDiff < 0.04) return 85;
                if (absHeadDiff < 0.06) return 75;
                return 68;
                
            } catch (error) {
                console.error('MediaPipeé ­ä½ç½®åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 85;
            }
        }

        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªãƒœãƒ¼ãƒ«ä½ç½®ã‚’å–å¾—
        function getIdealBallPosition(club) {
            const positions = {
                // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼: å·¦è¶³ã‹ã‹ã¨å†…å´
                'driver': 0.75,
                
                // ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚ˆã‚Šã‚‚ãƒœãƒ¼ãƒ«1å€‹å³
                'fairway': 0.68,       // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚ˆã‚Šãƒœãƒ¼ãƒ«1å€‹å³
                'utility': 0.68,       // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚ˆã‚Šãƒœãƒ¼ãƒ«1å€‹å³
                
                // ã‚¢ã‚¤ã‚¢ãƒ³: ã‚¯ãƒ©ãƒ–ãŒçŸ­ããªã‚‹ã«é€£ã‚Œã¦å¾ã€…ã«å³ã«ãªã‚‹
                'iron4': 0.62,         // 4ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'iron5': 0.58,         // 5ç•ªã‚¢ã‚¤ã‚¢ãƒ³  
                'iron6': 0.54,         // 6ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'iron7': 0.51,         // 7ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                
                // 8ç•ªã‚¢ã‚¤ã‚¢ãƒ³ï½ã‚¦ã‚¨ãƒƒã‚¸: ä¸¡è¶³ã®ã‚»ãƒ³ã‚¿ãƒ¼
                'iron8': 0.5,          // 8ç•ªã‚¢ã‚¤ã‚¢ãƒ³: ä¸¡è¶³ã®ã‚»ãƒ³ã‚¿ãƒ¼
                'iron9': 0.5,          // 9ç•ªã‚¢ã‚¤ã‚¢ãƒ³: ä¸¡è¶³ã®ã‚»ãƒ³ã‚¿ãƒ¼  
                'wedge': 0.5           // ã‚¦ã‚¨ãƒƒã‚¸: ä¸¡è¶³ã®ã‚»ãƒ³ã‚¿ãƒ¼
            };
            return positions[club] || 0.5;
        }
        
        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªã‚¹ã‚¿ãƒ³ã‚¹å¹…æ¯”ç‡ã‚’å–å¾—
        function getIdealStanceRatio(club) {
            const ratios = {
                'driver': 1.3,      // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯è‚©å¹…ã‚ˆã‚Šå°‘ã—åºƒã„
                'fairway': 1.2,     // ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰: è‚©å¹…ã®1.2å€
                'utility': 1.15,    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: è‚©å¹…ã®1.15å€
                'iron4': 1.1,       // 4ç•ªã‚¢ã‚¤ã‚¢ãƒ³: è‚©å¹…ã®1.1å€
                'iron5': 1.1,       // 5ç•ªã‚¢ã‚¤ã‚¢ãƒ³: è‚©å¹…ã®1.1å€
                'iron6': 1.05,      // 6ç•ªã‚¢ã‚¤ã‚¢ãƒ³: è‚©å¹…ã®1.05å€
                'iron7': 1.05,      // 7ç•ªã‚¢ã‚¤ã‚¢ãƒ³: è‚©å¹…ã®1.05å€
                'iron8': 1.0,       // 8ç•ªã‚¢ã‚¤ã‚¢ãƒ³: è‚©å¹…ã¨åŒã˜
                'iron9': 1.0,       // 9ç•ªã‚¢ã‚¤ã‚¢ãƒ³: è‚©å¹…ã¨åŒã˜
                'wedge': 1.0        // ã‚¦ã‚§ãƒƒã‚¸: è‚©å¹…ã¨åŒã˜
            };
            return ratios[club] || 1.1; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯è‚©å¹…ã®1.1å€
        }
        
        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªå·¦å³é‡å¿ƒé…åˆ†ã‚’å–å¾—ï¼ˆå³è¶³é‡å¿ƒã®å‰²åˆï¼‰
        function getIdealWeightBalance(club) {
            if (club === 'driver') {
                return 0.6; // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯6:4ã§å³è¶³é‡å¿ƒ
            } else {
                return 0.5; // ãã®ä»–ã¯å·¦å³å‡ç­‰
            }
        }
        
        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªé ­ã®ä½ç½®ã‚’å–å¾—
        function getIdealHeadPosition(club) {
            if (club === 'driver') {
                return 0.52; // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯å°‘ã—å³
            } else {
                return 0.5; // ãã®ä»–ã¯ã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆä¸¡è¶³ã®ä¸­å¤®ï¼‰
            }
        }
        
        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªå‰å‚¾è§’åº¦ã‚’å–å¾—ï¼ˆåº¦ï¼‰
        function getIdealForwardLean(club) {
            const angles = {
                'driver': 15,      // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼: æµ…ã‚ã®å‰å‚¾
                'fairway': 18,     // ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰
                'utility': 20,     // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
                'iron4': 22,       // 4ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'iron5': 24,       // 5ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'iron6': 26,       // 6ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'iron7': 28,       // 7ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'iron8': 30,       // 8ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'iron9': 32,       // 9ç•ªã‚¢ã‚¤ã‚¢ãƒ³
                'wedge': 35        // ã‚¦ã‚§ãƒƒã‚¸: æ·±ã‚ã®å‰å‚¾
            };
            return angles[club] || 25;
        }
        
        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªæ‰‹ã®ä½ç½®ã‚’å–å¾—ï¼ˆã‚¹ã‚¿ãƒ³ã‚¹ä¸­å¿ƒã‹ã‚‰ã®ç›¸å¯¾ä½ç½®ï¼‰
        function getIdealHandPosition(club) {
            // å·¦è‚¡é–¢ç¯€ã®å°‘ã—å³ãŒç†æƒ³çš„ãªæ‰‹ã®ä½ç½®ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã§ã¯å·¦å†…ã‚‚ã‚‚ã¨è¡¨ç¾ï¼‰
            // MediaPipeã§ã¯ç”»é¢ä¸Šã§å·¦ãŒå°ã•ã„å€¤ã€å³ãŒå¤§ãã„å€¤
            // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§ã¯å·¦è¶³ãŒç”»é¢å³å´ã€å³è¶³ãŒç”»é¢å·¦å´ã«ãªã‚‹
            if (club === 'driver') {
                return 0.04; // ã‚¹ã‚¿ãƒ³ã‚¹ä¸­å¿ƒã‚ˆã‚Šå³ã«4%ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦è‚¡é–¢ç¯€ã®å°‘ã—å³ï¼‰
            } else {
                return 0.03; // ã‚¹ã‚¿ãƒ³ã‚¹ä¸­å¿ƒã‚ˆã‚Šå³ã«3%ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼è¦–ç‚¹ã§å·¦è‚¡é–¢ç¯€ã®å°‘ã—å³ï¼‰
            }
        }
        
        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªæ‰‹ã®ä½ç½®ã‚’å–å¾—ï¼ˆå¾Œæ–¹è¦–ç‚¹ç”¨ï¼‰
        function getIdealHandPositionFromRear(club) {
            // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯è‚©ã®çœŸä¸‹ã‚ˆã‚Šå°‘ã—å‰ã€ãã®ä»–ã¯è‚©ã®çœŸä¸‹
            if (club === 'driver') {
                return 0.03; // è‚©ã®çœŸä¸‹ã‚ˆã‚Šå‰ã«3%ï¼ˆå°‘ã—å‰ï¼‰
            } else {
                return 0.0; // è‚©ã®çœŸä¸‹ï¼ˆ0%ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼‰
            }
        }
        
        // ã‚¯ãƒ©ãƒ–åˆ¥ã®ç†æƒ³çš„ãªæ‰‹ã¨ä½“ã®é–“éš”ã‚’å–å¾—ï¼ˆå¾Œæ–¹è¦–ç‚¹ç”¨ï¼‰
        function getIdealHandBodyDistance(club) {
            // ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æ‹³3å€‹åˆ†ã€ãã®ä»–ã¯æ‹³1.5-2å€‹åˆ†
            if (club === 'driver') {
                return 0.09; // ä½“å¹…ã®9%ç¨‹åº¦ï¼ˆæ‹³3å€‹åˆ†ï¼‰
            } else {
                return 0.05; // ä½“å¹…ã®5%ç¨‹åº¦ï¼ˆæ‹³1.5-2å€‹åˆ†ï¼‰
            }
        }

        // å¾Œæ–¹ã‹ã‚‰ã®å‰å‚¾è§’åº¦åˆ†æ
        function analyzeForwardLeanFromLandmarks(landmarks) {
            try {
                const leftShoulder = landmarks[12];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è‚©
                const rightShoulder = landmarks[11]; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è‚©
                const leftHip = landmarks[24];       // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è…°
                const rightHip = landmarks[23];      // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è…°
                
                const shoulderCenter = {
                    x: (leftShoulder.x + rightShoulder.x) / 2,
                    y: (leftShoulder.y + rightShoulder.y) / 2
                };
                const hipCenter = {
                    x: (leftHip.x + rightHip.x) / 2,
                    y: (leftHip.y + rightHip.y) / 2
                };
                
                // å‰å‚¾è§’åº¦ã‚’è¨ˆç®—ï¼ˆå‚ç›´ã‹ã‚‰ã®è§’åº¦ï¼‰
                const deltaY = shoulderCenter.y - hipCenter.y; // ä¸Šä¸‹ã®å·®ï¼ˆè‚©ãŒè…°ã‚ˆã‚Šä¸Šã«ã‚ã‚‹ï¼‰
                const deltaX = shoulderCenter.x - hipCenter.x; // å‰å¾Œã®å·®ï¼ˆç¬¦å·ã‚’ä¿æŒï¼‰
                const angle = Math.atan2(Math.abs(deltaX), Math.abs(deltaY)) * (180 / Math.PI);
                
                const selectedClub = document.getElementById('clubSelect').value;
                const idealAngle = getIdealForwardLean(selectedClub);
                const angleDiff = angle - idealAngle;
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                detailedAnalysisData.forwardLean = {
                    currentAngle: angle,
                    idealAngle: idealAngle,
                    difference: angleDiff,
                    club: selectedClub,
                    isTooShallow: angle < idealAngle,  // è§’åº¦ãŒå°ã•ã„ = æµ…ã™ãã‚‹
                    isTooDeep: angle > idealAngle,     // è§’åº¦ãŒå¤§ãã„ = æ·±ã™ãã‚‹
                    absoluteDifference: Math.abs(angleDiff)
                };
                
                console.log('MediaPipeå‰å‚¾è§’åº¦åˆ†æ:', {
                    angle: Math.round(angle) + 'åº¦',
                    idealAngle: idealAngle + 'åº¦',
                    club: selectedClub,
                    diff: Math.round(angleDiff) + 'åº¦'
                });
                
                const absAngleDiff = Math.abs(angleDiff);
                if (absAngleDiff < 3) return 92;  // 3åº¦ä»¥å†…
                if (absAngleDiff < 5) return 85;  // 5åº¦ä»¥å†…
                if (absAngleDiff < 8) return 75;  // 8åº¦ä»¥å†…
                return 68;
                
            } catch (error) {
                console.error('MediaPipeå‰å‚¾è§’åº¦åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 80;
            }
        }

        // å¾Œæ–¹ã‹ã‚‰ã®æ‰‹ã®ä½ç½®åˆ†æï¼ˆè‚©ã®çœŸä¸‹åŸºæº–ï¼‰
        function analyzeHandBodyDistance(landmarks) {
            try {
                const leftWrist = landmarks[15];
                const rightWrist = landmarks[16];
                const leftShoulder = landmarks[11];
                const rightShoulder = landmarks[12];
                
                const handCenter = {
                    x: (leftWrist.x + rightWrist.x) / 2,
                    y: (leftWrist.y + rightWrist.y) / 2
                };
                const shoulderCenter = {
                    x: (leftShoulder.x + rightShoulder.x) / 2,
                    y: (leftShoulder.y + rightShoulder.y) / 2
                };
                
                const selectedClub = document.getElementById('clubSelect').value;
                
                // è‚©ã®çœŸä¸‹ã‹ã‚‰ã®å‰å¾Œä½ç½®å·®ã‚’è¨ˆç®—
                const forwardOffset = handCenter.x - shoulderCenter.x;
                const idealForwardOffset = getIdealHandPositionFromRear(selectedClub);
                const positionDiff = Math.abs(forwardOffset - idealForwardOffset);
                
                // æ‰‹ã¨ä½“ã®é–“éš”ï¼ˆè·é›¢ï¼‰ã‚’è¨ˆç®—
                const bodyWidth = Math.abs(rightShoulder.x - leftShoulder.x);
                const handBodyDistance = Math.sqrt(
                    Math.pow(handCenter.x - shoulderCenter.x, 2) + 
                    Math.pow(handCenter.y - shoulderCenter.y, 2)
                );
                const relativeDistance = handBodyDistance / bodyWidth;
                const idealDistance = getIdealHandBodyDistance(selectedClub);
                const distanceDiff = Math.abs(relativeDistance - idealDistance);
                
                console.log('MediaPipeæ‰‹ã®ä½ç½®åˆ†æï¼ˆå¾Œæ–¹ï¼‰:', {
                    forwardOffset: Math.round(forwardOffset * 100) + '%',
                    idealForwardOffset: Math.round(idealForwardOffset * 100) + '%',
                    handBodyDistance: Math.round(relativeDistance * 100) + '%',
                    idealDistance: Math.round(idealDistance * 100) + '%',
                    club: selectedClub
                });
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                detailedAnalysisData.handBodyDistance = {
                    currentDistance: relativeDistance,
                    idealDistance: idealDistance,
                    forwardOffset: forwardOffset,
                    idealForwardOffset: idealForwardOffset,
                    club: selectedClub,
                    isTooClose: relativeDistance < (idealDistance - 0.02),
                    isTooFar: relativeDistance > (idealDistance + 0.02),
                    positionDiff: positionDiff,
                    distanceDiff: distanceDiff
                };
                
                // ä½ç½®ã¨è·é›¢ã®ä¸¡æ–¹ã‚’è©•ä¾¡ï¼ˆå¹³å‡ã‚¹ã‚³ã‚¢ï¼‰
                let positionScore = 50;
                if (positionDiff < 0.01) positionScore = 92;
                else if (positionDiff < 0.02) positionScore = 85;
                else if (positionDiff < 0.03) positionScore = 75;
                else positionScore = 68;
                
                let distanceScore = 50;
                if (distanceDiff < 0.01) distanceScore = 92;
                else if (distanceDiff < 0.02) distanceScore = 85;
                else if (distanceDiff < 0.03) distanceScore = 75;
                else distanceScore = 68;
                
                return Math.round((positionScore + distanceScore) / 2);
                
            } catch (error) {
                console.error('MediaPipeæ‰‹ã®ä½ç½®åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 82;
            }
        }

        // å¾Œæ–¹ã‹ã‚‰ã®å‰å¾Œãƒãƒ©ãƒ³ã‚¹åˆ†æ
        function analyzeFrontBackBalance(landmarks) {
            try {
                const nose = landmarks[0];
                const leftAnkle = landmarks[28];  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦è¶³é¦–
                const rightAnkle = landmarks[27]; // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³è¶³é¦–
                const leftToe = landmarks[30];    // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å·¦ã¤ã¾å…ˆ
                const rightToe = landmarks[29];   // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®å³ã¤ã¾å…ˆ
                
                const ankleCenter = (leftAnkle.x + rightAnkle.x) / 2;
                const toeCenter = (leftToe.x + rightToe.x) / 2;
                const headPosition = nose.x;
                
                // è¶³å…¨ä½“ã®ä¸­å¿ƒã¨ã¤ã¾å…ˆã®é–¢ä¿‚ã‚’è€ƒæ…®
                const footLength = Math.abs(toeCenter - ankleCenter);
                const footCenter = ankleCenter + (footLength * 0.4); // ã¤ã¾å…ˆå¯„ã‚Šã®ä½ç½®
                
                const balance = headPosition - footCenter;
                
                // ç†æƒ³çš„ãªãƒãƒ©ãƒ³ã‚¹ï¼ˆã‚„ã‚„ã¤ã¾å…ˆå¯„ã‚Šï¼‰
                const idealBalance = 0.0; // footCenterè‡ªä½“ãŒã‚„ã‚„ã¤ã¾å…ˆå¯„ã‚Šãªã®ã§0ãŒç†æƒ³
                const balanceDiff = balance - idealBalance;
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                detailedAnalysisData.frontBackBalance = {
                    currentBalance: balance,
                    idealBalance: idealBalance,
                    difference: balanceDiff,
                    headPosition: headPosition,
                    footCenter: footCenter,
                    ankleCenter: ankleCenter,
                    isTooForward: balance > idealBalance, // ã¤ã¾å…ˆå¯„ã‚Šã™ã
                    isTooBackward: balance < idealBalance, // ã‹ã‹ã¨å¯„ã‚Šã™ã
                    absoluteDifference: Math.abs(balanceDiff)
                };
                
                console.log('MediaPipeå‰å¾Œãƒãƒ©ãƒ³ã‚¹åˆ†æ:', {
                    headPosition: Math.round(headPosition * 100) + '%',
                    ankleCenter: Math.round(ankleCenter * 100) + '%',
                    footCenter: Math.round(footCenter * 100) + '%ï¼ˆã‚„ã‚„ã¤ã¾å…ˆå¯„ã‚Šï¼‰',
                    balance: Math.round(balance * 100) + '%',
                    idealBalance: '0%ï¼ˆã‚„ã‚„ã¤ã¾å…ˆå¯„ã‚ŠåŸºæº–ï¼‰',
                    diff: Math.round(balanceDiff * 100) + '%'
                });
                
                const absBalanceDiff = Math.abs(balanceDiff);
                if (absBalanceDiff < 0.02) return 92;
                if (absBalanceDiff < 0.04) return 85;
                if (absBalanceDiff < 0.06) return 75;
                return 68;
                
            } catch (error) {
                console.error('MediaPipeå‰å¾Œãƒãƒ©ãƒ³ã‚¹åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 85;
            }
        }

        // å¾Œæ–¹ã‹ã‚‰ã®ä½“ã®å‘ãåˆ†æï¼ˆè‚©ãƒ»è…°ãƒ»ã‹ã‹ã¨ãƒ©ã‚¤ãƒ³å¹³è¡Œï¼‰
        function analyzeBodyDirection(landmarks) {
            try {
                const leftShoulder = landmarks[11];
                const rightShoulder = landmarks[12];
                const leftHip = landmarks[23];
                const rightHip = landmarks[24];
                const leftHeel = landmarks[29]; // å·¦è¶³å¾Œéƒ¨
                const rightHeel = landmarks[30]; // å³è¶³å¾Œéƒ¨
                
                // å„ãƒ©ã‚¤ãƒ³ã®è§’åº¦ã‚’è¨ˆç®—
                const shoulderAngle = Math.atan2(rightShoulder.y - leftShoulder.y, rightShoulder.x - leftShoulder.x);
                const hipAngle = Math.atan2(rightHip.y - leftHip.y, rightHip.x - leftHip.x);
                const heelAngle = Math.atan2(rightHeel.y - leftHeel.y, rightHeel.x - leftHeel.x);
                
                // è§’åº¦ã‚’ãƒ©ã‚¸ã‚¢ãƒ³ã‹ã‚‰åº¦ã«å¤‰æ›
                const shoulderDeg = shoulderAngle * (180 / Math.PI);
                const hipDeg = hipAngle * (180 / Math.PI);
                const heelDeg = heelAngle * (180 / Math.PI);
                
                // å„ãƒ©ã‚¤ãƒ³é–“ã®è§’åº¦å·®ã‚’è¨ˆç®—
                const shoulderHipDiff = Math.abs(shoulderDeg - hipDeg);
                const shoulderHeelDiff = Math.abs(shoulderDeg - heelDeg);
                const hipHeelDiff = Math.abs(hipDeg - heelDeg);
                
                // 3ã¤ã®ãƒ©ã‚¤ãƒ³ã®å¹³è¡Œæ€§ã‚’è©•ä¾¡
                const maxAngleDiff = Math.max(shoulderHipDiff, shoulderHeelDiff, hipHeelDiff);
                const avgAngleDiff = (shoulderHipDiff + shoulderHeelDiff + hipHeelDiff) / 3;

                // ã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚ºåˆ¤å®šï¼ˆåŸºæº–: 0åº¦=ã‚¹ã‚¯ã‚¨ã‚¢ã€æ­£=ã‚ªãƒ¼ãƒ—ãƒ³ã€è² =ã‚¯ãƒ­ãƒ¼ã‚ºï¼‰
                const tol = 2; // è¨±å®¹èª¤å·®ï¼ˆåº¦ï¼‰
                const stateOf = (deg) => deg > tol ? 'open' : (deg < -tol ? 'closed' : 'square');
                const shoulderState = stateOf(shoulderDeg);
                const hipState = stateOf(hipDeg);
                const heelState = stateOf(heelDeg);
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                detailedAnalysisData.bodyDirection = {
                    shoulderAngle: shoulderDeg,
                    hipAngle: hipDeg,
                    heelAngle: heelDeg,
                    shoulderHipDiff: shoulderHipDiff,
                    shoulderHeelDiff: shoulderHeelDiff,
                    hipHeelDiff: hipHeelDiff,
                    maxAngleDiff: maxAngleDiff,
                    avgAngleDiff: avgAngleDiff,
                    isShoulderMisaligned: shoulderHipDiff > 3 || shoulderHeelDiff > 3,
                    isHipMisaligned: shoulderHipDiff > 3 || hipHeelDiff > 3,
                    isHeelMisaligned: shoulderHeelDiff > 3 || hipHeelDiff > 3,
                    shoulderState,
                    hipState,
                    heelState
                };
                
                console.log('MediaPipeä½“ã®å‘ãåˆ†æï¼ˆ3ãƒ©ã‚¤ãƒ³å¹³è¡Œï¼‰:', {
                    shoulderAngle: Math.round(shoulderDeg) + 'åº¦',
                    hipAngle: Math.round(hipDeg) + 'åº¦',
                    heelAngle: Math.round(heelDeg) + 'åº¦',
                    maxAngleDiff: Math.round(maxAngleDiff) + 'åº¦',
                    avgAngleDiff: Math.round(avgAngleDiff) + 'åº¦'
                });
                
                // å¹³è¡Œæ€§ã®è©•ä¾¡ï¼ˆè§’åº¦å·®ãŒå°ã•ã„ã»ã©é«˜ã‚¹ã‚³ã‚¢ï¼‰
                if (maxAngleDiff < 3 && avgAngleDiff < 2) return 92;  // 3åº¦ä»¥å†…ã®å·®ã§å¹³è¡Œ
                if (maxAngleDiff < 5 && avgAngleDiff < 3) return 85;  // 5åº¦ä»¥å†…
                if (maxAngleDiff < 8 && avgAngleDiff < 5) return 75;  // 8åº¦ä»¥å†…
                return 68;
                
            } catch (error) {
                console.error('MediaPipeä½“ã®å‘ãåˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 83;
            }
        }

        // å¾Œæ–¹ã‹ã‚‰ã®èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆåˆ†æ
        function analyzeBackCurvature(landmarks) {
            try {
                const nose = landmarks[0];
                const leftShoulder = landmarks[11];
                const rightShoulder = landmarks[12];
                const leftHip = landmarks[23];
                const rightHip = landmarks[24];
                
                const shoulderCenter = {
                    x: (leftShoulder.x + rightShoulder.x) / 2,
                    y: (leftShoulder.y + rightShoulder.y) / 2
                };
                const hipCenter = {
                    x: (leftHip.x + rightHip.x) / 2,
                    y: (leftHip.y + rightHip.y) / 2
                };
                
                // é ­-è‚©-è…°ã®ãƒ©ã‚¤ãƒ³åˆ†æ
                const upperSpine = shoulderCenter.x - nose.x;
                const lowerSpine = hipCenter.x - shoulderCenter.x;
                const curvatureRatio = Math.abs(upperSpine - lowerSpine);
                
                // åã‚Šã™ãï¼ˆè…°ã®åã‚Šï¼‰ã¨ä¸¸ã™ãã‚’åˆ¤å®š
                const totalForwardLean = shoulderCenter.x - hipCenter.x;
                const spineAlignment = upperSpine + lowerSpine;
                
                // è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                detailedAnalysisData.backCurvature = {
                    upperSpine: upperSpine,
                    lowerSpine: lowerSpine,
                    curvatureRatio: curvatureRatio,
                    totalForwardLean: totalForwardLean,
                    spineAlignment: spineAlignment,
                    isTooStraight: curvatureRatio < 0.01, // çœŸã£ã™ãã™ã
                    isTooArched: upperSpine > 0 && lowerSpine < 0 && curvatureRatio > 0.05, // åã‚Šã™ã
                    isTooRounded: upperSpine < 0 && lowerSpine > 0 && curvatureRatio > 0.05 // ä¸¸ã™ã
                };
                
                console.log('MediaPipeèƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆåˆ†æ:', {
                    upperSpine: Math.round(upperSpine * 100) + '%',
                    lowerSpine: Math.round(lowerSpine * 100) + '%',
                    curvatureRatio: Math.round(curvatureRatio * 100) + '%'
                });
                
                // ç†æƒ³çš„ãªè‡ªç„¶ãªæ¹¾æ›²
                if (curvatureRatio < 0.02) return 92;
                if (curvatureRatio < 0.04) return 85;
                if (curvatureRatio < 0.06) return 75;
                return 68;
                
            } catch (error) {
                console.error('MediaPipeèƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆåˆ†æã‚¨ãƒ©ãƒ¼:', error);
                return 84;
            }
        }

        // åŸºæœ¬çš„ãªãƒœãƒ¼ãƒ«ä½ç½®ã‚¹ã‚³ã‚¢è¨ˆç®—
        function calculateBallPositionScore() {
            if (!ballPosition) return 85;
            
            const x = ballPosition.x;
            const selectedClub = document.getElementById('clubSelect').value;
            const idealPosition = getIdealBallPosition(selectedClub);
            
            const diff = Math.abs(x - idealPosition);
            
            if (diff < 0.05) return 92; // ç†æƒ³çš„
            if (diff < 0.1) return 85;  // è‰¯å¥½
            if (diff < 0.15) return 75; // ã‚„ã‚„ä¸é©åˆ‡
            return 68; // è¦æ”¹å–„
        }

        // è©³ç´°ãªã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆé–¢æ•°ï¼ˆæ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
        function generateDetailedComment(score, type, analysisKey) {
            if (score >= 90) {
                return `ç†æƒ³çš„ãª${type.replace(/ğŸ¯|ğŸ¦µ|ğŸ‘¤|ğŸ¤š|âš–ï¸|ğŸƒ|ğŸ“|â¬‡ï¸|ğŸ“|ğŸ§­|ğŸ”„/g, '')}ã§ã™ã€‚ç¾åœ¨ã®è¨­å®šã§å„ªã‚ŒãŸçµæœãŒå‡ºã¦ã„ã¾ã™ã€‚`;
            }
            
            const data = detailedAnalysisData[analysisKey];
            if (!data) {
                return `${type.replace(/ğŸ¯|ğŸ¦µ|ğŸ‘¤|ğŸ¤š|âš–ï¸|ğŸƒ|ğŸ“|â¬‡ï¸|ğŸ“|ğŸ§­|ğŸ”„/g, '')}ã‚’æ”¹å–„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`;
            }
            
            // ãƒœãƒ¼ãƒ«ä½ç½®ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            if (analysisKey === 'ballPosition') {
                const clubNames = {
                    'driver': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
                    'fairway': 'ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰', 
                    'utility': 'ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
                    'iron4': '4ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron5': '5ç•ªã‚¢ã‚¤ã‚¢ãƒ³', 
                    'iron6': '6ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron7': '7ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron8': '8ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron9': '9ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'wedge': 'ã‚¦ã‚§ãƒƒã‚¸'
                };
                
                const clubName = clubNames[data.club] || data.club;
                const idealDescription = getIdealPositionDescription(data.club);
                
                if (data.isLeftTooMuch) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>ãƒœãƒ¼ãƒ«ãŒå·¦ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ä½ç½®ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ãƒœãƒ¼ãƒ«ã‚’ã‚‚ã†å°‘ã—å³ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚ç´„${Math.abs(Math.round(data.difference * 100))}%å³ã«èª¿æ•´ãŒå¿…è¦ã§ã™ã€‚`;
                } else if (data.isRightTooMuch) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>ãƒœãƒ¼ãƒ«ãŒå³ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ä½ç½®ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ãƒœãƒ¼ãƒ«ã‚’ã‚‚ã†å°‘ã—å·¦ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚ç´„${Math.abs(Math.round(data.difference * 100))}%å·¦ã«èª¿æ•´ãŒå¿…è¦ã§ã™ã€‚`;
                }
            }
            
            // ã‚¹ã‚¿ãƒ³ã‚¹å¹…ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            if (analysisKey === 'stance') {
                const clubNames = {
                    'driver': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
                    'fairway': 'ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰', 
                    'utility': 'ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
                    'iron4': '4ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron5': '5ç•ªã‚¢ã‚¤ã‚¢ãƒ³', 
                    'iron6': '6ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron7': '7ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron8': '8ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron9': '9ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'wedge': 'ã‚¦ã‚§ãƒƒã‚¸'
                };
                
                const clubName = clubNames[data.club] || data.club;
                const idealDescriptions = {
                    'driver': 'è‚©å¹…ã‚ˆã‚Šå°‘ã—åºƒã„å¹…ï¼ˆ1.3å€ï¼‰',
                    'fairway': 'è‚©å¹…ã®1.2å€ç¨‹åº¦',
                    'utility': 'è‚©å¹…ã®1.15å€ç¨‹åº¦', 
                    'iron4': 'è‚©å¹…ã®1.1å€ç¨‹åº¦',
                    'iron5': 'è‚©å¹…ã®1.1å€ç¨‹åº¦',
                    'iron6': 'è‚©å¹…ã®1.05å€ç¨‹åº¦',
                    'iron7': 'è‚©å¹…ã®1.05å€ç¨‹åº¦',
                    'iron8': 'è‚©å¹…ã¨åŒã˜ç¨‹åº¦',
                    'iron9': 'è‚©å¹…ã¨åŒã˜ç¨‹åº¦',
                    'wedge': 'è‚©å¹…ã¨åŒã˜ç¨‹åº¦'
                };
                const idealDescription = idealDescriptions[data.club] || 'è‚©å¹…ï½1.2å€ç¨‹åº¦';
                
                if (data.isTooWide) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>ã‚¹ã‚¿ãƒ³ã‚¹å¹…ãŒåºƒã™ãã¾ã™ï¼ˆç¾åœ¨ï¼šè‚©å¹…ã®${data.currentRatio.toFixed(1)}å€ï¼‰ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è¶³ã‚’ã‚‚ã†å°‘ã—ç‹­ã‚ã¦ã€æ©Ÿå‹•æ€§ã‚’å‘ä¸Šã•ã›ã¦ãã ã•ã„ã€‚`;
                } else if (data.isTooNarrow) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>ã‚¹ã‚¿ãƒ³ã‚¹å¹…ãŒç‹­ã™ãã¾ã™ï¼ˆç¾åœ¨ï¼šè‚©å¹…ã®${data.currentRatio.toFixed(1)}å€ï¼‰ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è¶³ã‚’ã‚‚ã†å°‘ã—åºƒã’ã¦ã€å®‰å®šæ„Ÿã‚’å‘ä¸Šã•ã›ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // ä½“é‡é…åˆ†ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            if (analysisKey === 'weight') {
                const clubNames = {
                    'driver': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
                    'fairway': 'ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰', 
                    'utility': 'ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
                    'iron4': '4ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron5': '5ç•ªã‚¢ã‚¤ã‚¢ãƒ³', 
                    'iron6': '6ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron7': '7ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron8': '8ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron9': '9ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'wedge': 'ã‚¦ã‚§ãƒƒã‚¸'
                };
                
                const clubName = clubNames[data.club] || data.club;
                const idealDescription = data.club === 'driver' ? '6:4ã§å³è¶³é‡å¿ƒ' : 'å·¦å³å‡ç­‰ï¼ˆ5:5ï¼‰';
                
                if (data.isRightHeavy) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>å³è¶³ã«ä½“é‡ãŒã‹ã‹ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>å·¦è¶³ã«ã‚ˆã‚Šä½“é‡ã‚’ã‹ã‘ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦ãã ã•ã„ã€‚`;
                } else if (data.isLeftHeavy) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>å·¦è¶³ã«ä½“é‡ãŒã‹ã‹ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>å³è¶³ã«ã‚ˆã‚Šä½“é‡ã‚’ã‹ã‘ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // é ­ã®ä½ç½®ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            if (analysisKey === 'headPosition') {
                const clubNames = {
                    'driver': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
                    'fairway': 'ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰', 
                    'utility': 'ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
                    'iron4': '4ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron5': '5ç•ªã‚¢ã‚¤ã‚¢ãƒ³', 
                    'iron6': '6ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron7': '7ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron8': '8ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron9': '9ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'wedge': 'ã‚¦ã‚§ãƒƒã‚¸'
                };
                
                const clubName = clubNames[data.club] || data.club;
                const idealDescription = data.club === 'driver' ? 'å°‘ã—å³ï¼ˆã‚¹ã‚¿ãƒ³ã‚¹ä¸­å¤®ã‚ˆã‚Šå³ï¼‰' : 'ã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆä¸¡è¶³ã®ã»ã¼ä¸­å¤®ï¼‰';
                
                if (data.isLeftTooMuch) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>é ­ãŒå·¦ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>é ­ã‚’ã‚‚ã†å°‘ã—å³ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚`;
                } else if (data.isRightTooMuch) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>é ­ãŒå³ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®ç†æƒ³ã¯${idealDescription}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>é ­ã‚’ã‚‚ã†å°‘ã—å·¦ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // æ‰‹ã®ä½ç½®ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆæ­£é¢ï¼‰
            if (analysisKey === 'handPosition') {
                if (data.isLeftTooMuch) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒå·¦ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>å·¦å†…ã‚‚ã‚‚ã‚ãŸã‚ŠãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã‚’ã‚‚ã†å°‘ã—å³ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚`;
                } else if (data.isRightTooMuch) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒå³ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>å·¦å†…ã‚‚ã‚‚ã‚ãŸã‚ŠãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã‚’ã‚‚ã†å°‘ã—å·¦ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // å‰å‚¾è§’åº¦ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆå¾Œæ–¹ï¼‰
            if (analysisKey === 'forwardLean') {
                const clubNames = {
                    'driver': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
                    'fairway': 'ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰', 
                    'utility': 'ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
                    'iron4': '4ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron5': '5ç•ªã‚¢ã‚¤ã‚¢ãƒ³', 
                    'iron6': '6ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron7': '7ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron8': '8ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron9': '9ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'wedge': 'ã‚¦ã‚§ãƒƒã‚¸'
                };
                
                const clubName = clubNames[data.club] || data.club;
                
                if (data.isTooShallow) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>å‰å‚¾è§’åº¦ãŒæµ…ã™ãã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã§ã¯é©åº¦ãªå‰å‚¾è§’åº¦ãŒå¿…è¦ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‚¡é–¢ç¯€ã‹ã‚‰ã‚‚ã†å°‘ã—æ·±ãå‰å‚¾ã—ã¦ãã ã•ã„ã€‚`;
                } else if (data.isTooDeep) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>å‰å‚¾è§’åº¦ãŒæ·±ã™ãã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã§ã¯é©åº¦ãªå‰å‚¾è§’åº¦ã‚’ä¿ã¤ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—ä¸Šä½“ã‚’èµ·ã“ã—ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // æ‰‹ã¨ä½“ã®è·é›¢ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆå¾Œæ–¹ï¼‰
            if (analysisKey === 'handBodyDistance') {
                const clubNames = {
                    'driver': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
                    'fairway': 'ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰', 
                    'utility': 'ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
                    'iron4': '4ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron5': '5ç•ªã‚¢ã‚¤ã‚¢ãƒ³', 
                    'iron6': '6ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron7': '7ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron8': '8ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'iron9': '9ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                    'wedge': 'ã‚¦ã‚§ãƒƒã‚¸'
                };
                
                const clubName = clubNames[data.club] || data.club;
                const positionIdeal = data.club === 'driver' ? 'è‚©ã®çœŸä¸‹ã‚ˆã‚Šå°‘ã—å‰' : 'è‚©ã®çœŸä¸‹';
                const distanceIdeal = data.club === 'driver' ? 'æ‹³3å€‹åˆ†' : 'æ‹³1.5ï½2å€‹åˆ†';
                
                if (data.isTooClose) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒä½“ã«è¿‘ã™ãã¦çª®å±ˆãªæ§‹ãˆã«ãªã£ã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®æ‰‹ã¯${positionIdeal}ã§ã€ä½“ã¨ã®é–“éš”ã¯${distanceIdeal}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—æ‰‹ã‚’ä½“ã‹ã‚‰é›¢ã—ã€è…•ã«ä½™è£•ã‚’æŒãŸã›ã¦ãã ã•ã„ã€‚`;
                } else if (data.isTooFar) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒä½“ã‹ã‚‰é›¢ã‚Œã™ãã¦ä¸å®‰å®šãªæ§‹ãˆã«ãªã£ã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®æ‰‹ã¯${positionIdeal}ã§ã€ä½“ã¨ã®é–“éš”ã¯${distanceIdeal}ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã‚’ã‚‚ã†å°‘ã—ä½“ã«è¿‘ã¥ã‘ã¦ã€å®‰å®šã—ãŸæ§‹ãˆã‚’ä½œã£ã¦ãã ã•ã„ã€‚`;
                } else if (data.forwardOffset && Math.abs(data.forwardOffset) > 0.02) {
                    const offsetDesc = data.forwardOffset > 0 ? 'å‰ã«å‡ºã™ã' : 'å¾Œã‚ã«ä¸‹ãŒã‚Šã™ã';
                    return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ã®å‰å¾Œä½ç½®ãŒãšã‚Œã¦ã„ã¾ã™ï¼ˆè‚©ã‹ã‚‰${offsetDesc}ï¼‰ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>${clubName}ã®æ‰‹ã¯${positionIdeal}ãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã®ä½ç½®ã‚’${data.forwardOffset > 0 ? 'å°‘ã—å¾Œã‚ã«' : 'å°‘ã—å‰ã«'}ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚`;
                } else {
                    return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ã¨ä½“ã®è·é›¢ãƒãƒ©ãƒ³ã‚¹ãŒä¸é©åˆ‡ã§ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>ä½“ã¨ã®é–“éš”ã¯${distanceIdeal}ãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã¨ä½“ã®é©åˆ‡ãªè·é›¢ã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // å‰å¾Œãƒãƒ©ãƒ³ã‚¹ã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆå¾Œæ–¹ï¼‰
            if (analysisKey === 'frontBackBalance') {
                if (data.isTooForward) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>é‡å¿ƒãŒã¤ã¾å…ˆå¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>ã‚„ã‚„ã¤ã¾å…ˆå¯„ã‚ŠãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—é‡å¿ƒã‚’ã‹ã‹ã¨å¯„ã‚Šã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚`;
                } else if (data.isTooBackward) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>é‡å¿ƒãŒã‹ã‹ã¨å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>ã‚„ã‚„ã¤ã¾å…ˆå¯„ã‚ŠãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—é‡å¿ƒã‚’ã¤ã¾å…ˆå¯„ã‚Šã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // ä½“ã®å‘ãã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆå¾Œæ–¹ï¼‰
            if (analysisKey === 'bodyDirection') {
                const problems = [];
                if (data.isShoulderMisaligned) problems.push('è‚©ã®ãƒ©ã‚¤ãƒ³');
                if (data.isHipMisaligned) problems.push('è…°ã®ãƒ©ã‚¤ãƒ³');
                if (data.isHeelMisaligned) problems.push('ã‹ã‹ã¨ã®ãƒ©ã‚¤ãƒ³');
                
                if (problems.length > 0) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>${problems.join('ã€')}ãŒãšã‚Œã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>è‚©ã€è…°ã€ã‹ã‹ã¨ã®ãƒ©ã‚¤ãƒ³ãŒå¹³è¡Œã§ãƒœãƒ¼ãƒ«ã‚’æ‰“ã¡å‡ºã—ãŸã„æ–¹å‘ã«å‘ã„ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>${problems.join('ã€')}ã‚’ä»–ã®ãƒ©ã‚¤ãƒ³ã¨å¹³è¡Œã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚`;
                } else {
                    return `<strong>ç¾çŠ¶ï¼š</strong>ä½“ã®å‘ãã«è»½å¾®ãªãšã‚ŒãŒã‚ã‚Šã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>è‚©ã€è…°ã€ã‹ã‹ã¨ã®ãƒ©ã‚¤ãƒ³ãŒå®Œå…¨ã«å¹³è¡ŒãªçŠ¶æ…‹ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>å…¨ä½“çš„ãªå§¿å‹¢ã‚’å¾®èª¿æ•´ã—ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆã®è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆå¾Œæ–¹ï¼‰
            if (analysisKey === 'backCurvature') {
                if (data.isTooArched) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>è…°ãŒåã‚Šã™ãã¦èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆãŒæ·±ã™ãã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>é©åº¦ã«ä¼¸ã³ãŸè‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è…°ã®åã‚Šã‚’æŠ‘ãˆã¦ã€ã‚‚ã†å°‘ã—èƒŒç­‹ã‚’ä¼¸ã°ã—ã¦ãã ã•ã„ã€‚`;
                } else if (data.isTooRounded) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>èƒŒä¸­ãŒä¸¸ããªã‚Šã™ãã¦çŒ«èƒŒæ°—å‘³ã«ãªã£ã¦ã„ã¾ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>é©åº¦ã«ä¼¸ã³ãŸè‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—èƒ¸ã‚’å¼µã£ã¦èƒŒç­‹ã‚’ä¼¸ã°ã—ã¦ãã ã•ã„ã€‚`;
                } else if (data.isTooStraight) {
                    return `<strong>ç¾çŠ¶ï¼š</strong>èƒŒä¸­ãŒçœŸã£ã™ãã™ãã¦è‡ªç„¶ãªæ›²ãŒã‚ŠãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>è‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ã‚’ä¿ã¤ã“ã¨ãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‡ªç„¶ãªèƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆã‚’æ„è­˜ã—ã¦ãã ã•ã„ã€‚`;
                } else {
                    return `<strong>ç¾çŠ¶ï¼š</strong>èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆãŒä¸å®‰å®šã§ã™ã€‚<br>
                           <strong>ç†æƒ³ï¼š</strong>é©åº¦ã«ä¼¸ã³ãŸè‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ãŒç†æƒ³ã§ã™ã€‚<br>
                           <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>èƒŒç­‹ã‚’ä¼¸ã°ã—ã€è‡ªç„¶ãªå§¿å‹¢ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚`;
                }
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šæ—§ã‚³ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨
            return generateOldDetailedComment(score, type);
        }
        
        // ç†æƒ³ä½ç½®ã®èª¬æ˜ã‚’å–å¾—
        function getIdealPositionDescription(club) {
            const descriptions = {
                'driver': 'å·¦è¶³ã‹ã‹ã¨å†…å´',
                'fairway': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚ˆã‚Šã‚‚ãƒœãƒ¼ãƒ«1å€‹å³',
                'utility': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚ˆã‚Šã‚‚ãƒœãƒ¼ãƒ«1å€‹å³',
                'iron4': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦',
                'iron5': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦',
                'iron6': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦', 
                'iron7': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦',
                'iron8': 'ä¸¡è¶³ã®ã‚»ãƒ³ã‚¿ãƒ¼',
                'iron9': 'ä¸¡è¶³ã®ã‚»ãƒ³ã‚¿ãƒ¼',
                'wedge': 'ä¸¡è¶³ã®ã‚»ãƒ³ã‚¿ãƒ¼'
            };
            return descriptions[club] || 'é©åˆ‡ãªä½ç½®';
        }
        
        // æ—§ã‚³ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆå‰Šé™¤äºˆå®šï¼‰
        function generateOldDetailedComment(score, type) {
            const comments = {
                'ballPosition': {
                    excellent: 'ç†æƒ³çš„ãªãƒœãƒ¼ãƒ«ä½ç½®ã§ã™ã€‚é¸æŠã•ã‚ŒãŸã‚¯ãƒ©ãƒ–ã«å¿œã˜ãŸé©åˆ‡ãªä½ç½®ã«ãƒœãƒ¼ãƒ«ãŒç½®ã‹ã‚Œã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„ãƒœãƒ¼ãƒ«ä½ç½®ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>ãƒœãƒ¼ãƒ«ä½ç½®ãŒç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯å·¦è¶³ã‹ã‹ã¨å†…å´ã€ã‚¢ã‚¤ã‚¢ãƒ³ã¯å¾ã€…ã«å³ã«ç§»å‹•ã—ã€8ç•ªã‚¢ã‚¤ã‚¢ãƒ³ï½ã‚¦ã‚§ãƒƒã‚¸ã¯ä¸¡è¶³ã‚»ãƒ³ã‚¿ãƒ¼ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ãƒœãƒ¼ãƒ«ã®ä½ç½®ã‚’ç†æƒ³ä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½ç½®ã«ç½®ãã“ã¨ã§ã€ã‚¯ãƒ©ãƒ–ã®æ€§èƒ½ã‚’æœ€å¤§é™ã«ç™ºæ®ã§ãã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>ãƒœãƒ¼ãƒ«ä½ç½®ãŒç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯å·¦è¶³ã‹ã‹ã¨å†…å´ã€ã‚¢ã‚¤ã‚¢ãƒ³ã¯å¾ã€…ã«å³ã«ç§»å‹•ã—ã€8ç•ªã‚¢ã‚¤ã‚¢ãƒ³ï½ã‚¦ã‚§ãƒƒã‚¸ã¯ä¸¡è¶³ã‚»ãƒ³ã‚¿ãƒ¼ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ãƒœãƒ¼ãƒ«ã®ä½ç½®ã‚’ç†æƒ³ä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½ç½®ã«ç½®ãã“ã¨ã§ã€ã‚¯ãƒ©ãƒ–ã®æ€§èƒ½ã‚’æœ€å¤§é™ã«ç™ºæ®ã§ãã¾ã™ã€‚'
                },
                'stance': {
                    excellent: 'ç†æƒ³çš„ãªã‚¹ã‚¿ãƒ³ã‚¹å¹…ã§ã™ã€‚è‚©å¹…ã®1.2å€ç¨‹åº¦ã®é©åˆ‡ãªå¹…ã§å®‰å®šæ„ŸãŒã‚ã‚Šã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„ã‚¹ã‚¿ãƒ³ã‚¹å¹…ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>ã‚¹ã‚¿ãƒ³ã‚¹å¹…ãŒç‹­ã™ãã¦ä¸å®‰å®šã§ã™ã€‚<br><strong>ç†æƒ³å¹…ï¼š</strong>è‚©å¹…ã®1.2å€ç¨‹åº¦ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è¶³ã‚’ã‚‚ã†å°‘ã—åºƒã’ã¦å®‰å®šæ„Ÿã‚’å‘ä¸Šã•ã›ã¦ãã ã•ã„ã€‚é©åˆ‡ãªã‚¹ã‚¿ãƒ³ã‚¹ã§ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>ã‚¹ã‚¿ãƒ³ã‚¹å¹…ãŒåºƒã™ãã¦å‹•ããŒåˆ¶é™ã•ã‚Œã¾ã™ã€‚<br><strong>ç†æƒ³å¹…ï¼š</strong>è‚©å¹…ã®1.2å€ç¨‹åº¦ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è¶³ã‚’ã‚‚ã†å°‘ã—ç‹­ã‚ã¦æ©Ÿå‹•æ€§ã‚’å‘ä¸Šã•ã›ã¦ãã ã•ã„ã€‚é©åˆ‡ãªã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚'
                },
                'posture': {
                    excellent: 'ç†æƒ³çš„ãªå‰å‚¾å§¿å‹¢ã§ã™ã€‚è‚¡é–¢ç¯€ã‹ã‚‰é©åˆ‡ãªè§’åº¦ã§å‰å‚¾ã—ã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„å§¿å‹¢ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>å‰å‚¾ãŒæµ…ã™ãã¦ç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æµ…ã‚ã€ã‚¯ãƒ©ãƒ–ãŒçŸ­ã„ã»ã©å¾ã€…ã«æ·±ãã€ã‚¦ã‚§ãƒƒã‚¸ã§æœ€ã‚‚æ·±ã„å‰å‚¾ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‚¡é–¢ç¯€ã‹ã‚‰ã‚‚ã†å°‘ã—æ·±ãå‰å‚¾ã—ã¦ãã ã•ã„ã€‚'
                          : '<strong>ç¾çŠ¶ï¼š</strong>å‰å‚¾ãŒæ·±ã™ãã¦ç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æµ…ã‚ã€ã‚¯ãƒ©ãƒ–ãŒçŸ­ã„ã»ã©å¾ã€…ã«æ·±ãã€ã‚¦ã‚§ãƒƒã‚¸ã§æœ€ã‚‚æ·±ã„å‰å‚¾ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—ä¸Šä½“ã‚’èµ·ã“ã—ã¦ãã ã•ã„ã€‚'
                },
                'handPosition': {
                    excellent: 'ç†æƒ³çš„ãªæ‰‹ã®ä½ç½®ã§ã™ã€‚ä½“ã®ä¸­å¿ƒç·šã‚ˆã‚Šå°‘ã—å·¦ã«é©åˆ‡ã«ä½ç½®ã—ã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„æ‰‹ã®ä½ç½®ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒå·¦ã«å¯„ã‚Šã™ãã¦ç†æƒ³ä½ç½®ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>ä½“ã®ä¸­å¿ƒç·šã‚ˆã‚Šå°‘ã—å·¦ï¼ˆå·¦å†…ã‚‚ã‚‚ä»˜è¿‘ï¼‰ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã‚’ã‚‚ã†å°‘ã—å³ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚æ­£ã—ã„æ‰‹ã®ä½ç½®ã«ã‚ˆã‚Šã€ã‚¹ã‚¤ãƒ³ã‚°ãƒ—ãƒ¬ãƒ¼ãƒ³ãŒå®‰å®šã—ã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒå³ã«å¯„ã‚Šã™ãã¦ç†æƒ³ä½ç½®ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>ä½“ã®ä¸­å¿ƒç·šã‚ˆã‚Šå°‘ã—å·¦ï¼ˆå·¦å†…ã‚‚ã‚‚ä»˜è¿‘ï¼‰ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã‚’ã‚‚ã†å°‘ã—å·¦ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚æ­£ã—ã„æ‰‹ã®ä½ç½®ã«ã‚ˆã‚Šã€ã‚¹ã‚¤ãƒ³ã‚°ãƒ—ãƒ¬ãƒ¼ãƒ³ãŒå®‰å®šã—ã¾ã™ã€‚'
                },
                'headPosition': {
                    excellent: 'ç†æƒ³çš„ãªé ­ã®ä½ç½®ã§ã™ã€‚é©åˆ‡ãªãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸä½ç½®ã«ã‚ã‚Šã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„é ­ã®ä½ç½®ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>é ­ãŒå·¦ã«å¯„ã‚Šã™ãã¦ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>ã‚¹ã‚¿ãƒ³ã‚¹ä¸­å¤®ã‚ˆã‚Šå°‘ã—å³ï¼ˆãƒœãƒ¼ãƒ«ã®å¾Œæ–¹ï¼‰ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>é ­ã‚’ã‚‚ã†å°‘ã—å³ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚æ­£ã—ã„é ­ã®ä½ç½®ã«ã‚ˆã‚Šã€ã‚¹ã‚¤ãƒ³ã‚°è»¸ãŒå®‰å®šã—ã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>é ­ãŒå³ã«å¯„ã‚Šã™ãã¦ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>ã‚¹ã‚¿ãƒ³ã‚¹ä¸­å¤®ï¼ˆãƒœãƒ¼ãƒ«ã®å¾Œæ–¹ï¼‰ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>é ­ã‚’ã‚‚ã†å°‘ã—å·¦ã«ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚æ­£ã—ã„é ­ã®ä½ç½®ã«ã‚ˆã‚Šã€ã‚¹ã‚¤ãƒ³ã‚°è»¸ãŒå®‰å®šã—ã¾ã™ã€‚'
                },
                'weight': {
                    excellent: 'ç†æƒ³çš„ãªä½“é‡é…åˆ†ã§ã™ã€‚ä¸¡è¶³ã«å‡ç­‰ã«ä½“é‡ãŒåˆ†æ•£ã•ã‚Œã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„ä½“é‡é…åˆ†ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>å³è¶³ã«ä½“é‡ãŒã‹ã‹ã‚Šã™ãã¦ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³é…åˆ†ï¼š</strong>ä¸¡è¶³ã«å‡ç­‰ï¼ˆ50:50ï¼‰ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>å·¦è¶³ã«ã‚ˆã‚Šä½“é‡ã‚’ã‹ã‘ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½“é‡é…åˆ†ã«ã‚ˆã‚Šã€å®‰å®šã—ãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>å·¦è¶³ã«ä½“é‡ãŒã‹ã‹ã‚Šã™ãã¦ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³é…åˆ†ï¼š</strong>ä¸¡è¶³ã«å‡ç­‰ï¼ˆ50:50ï¼‰ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>å³è¶³ã«ã‚ˆã‚Šä½“é‡ã‚’ã‹ã‘ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½“é‡é…åˆ†ã«ã‚ˆã‚Šã€å®‰å®šã—ãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚'
                },
                'forwardLean': {
                    excellent: 'ç†æƒ³çš„ãªå‰å‚¾è§’åº¦ã§ã™ã€‚ã‚¯ãƒ©ãƒ–ã«å¿œã˜ãŸé©åˆ‡ãªå‰å‚¾å§¿å‹¢ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„å‰å‚¾è§’åº¦ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>å‰å‚¾ãŒæµ…ã™ãã¦ç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æµ…ã‚ã€ã‚¯ãƒ©ãƒ–ãŒçŸ­ã„ã»ã©å¾ã€…ã«æ·±ãã€ã‚¦ã‚§ãƒƒã‚¸ã§æœ€ã‚‚æ·±ã„å‰å‚¾ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‚¡é–¢ç¯€ã‹ã‚‰ã‚‚ã†å°‘ã—æ·±ãå‰å‚¾ã—ã¦ãã ã•ã„ã€‚'
                          : '<strong>ç¾çŠ¶ï¼š</strong>å‰å‚¾ãŒæ·±ã™ãã¦ç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æµ…ã‚ã€ã‚¯ãƒ©ãƒ–ãŒçŸ­ã„ã»ã©å¾ã€…ã«æ·±ãã€ã‚¦ã‚§ãƒƒã‚¸ã§æœ€ã‚‚æ·±ã„å‰å‚¾ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—ä¸Šä½“ã‚’èµ·ã“ã—ã¦ãã ã•ã„ã€‚'
                },
                'handBodyDistance': {
                    excellent: 'ç†æƒ³çš„ãªæ‰‹ã¨ä½“ã®è·é›¢ã§ã™ã€‚é©åˆ‡ãªè·é›¢ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„æ‰‹ã¨ä½“ã®è·é›¢ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒä½“ã«è¿‘ã™ãã¦çª®å±ˆã«ãªã£ã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³è·é›¢ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æ‹³3å€‹åˆ†ã€ã‚¢ã‚¤ã‚¢ãƒ³ã¯æ‹³1.5-2å€‹åˆ†ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—ä½“ã‹ã‚‰é›¢ã—ã¦ãã ã•ã„ã€‚é©åˆ‡ãªè·é›¢ã«ã‚ˆã‚Šã€ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ãŒä½“ã‹ã‚‰é›¢ã‚Œã™ãã¦ä¸å®‰å®šã§ã™ã€‚<br><strong>ç†æƒ³è·é›¢ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æ‹³3å€‹åˆ†ã€ã‚¢ã‚¤ã‚¢ãƒ³ã¯æ‹³1.5-2å€‹åˆ†ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—ä½“ã«è¿‘ã¥ã‘ã¦ãã ã•ã„ã€‚é©åˆ‡ãªè·é›¢ã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒå‘ä¸Šã—ã¾ã™ã€‚'
                },
                'frontBackBalance': {
                    excellent: 'ç†æƒ³çš„ãªå‰å¾Œãƒãƒ©ãƒ³ã‚¹ã§ã™ã€‚é‡å¿ƒãŒé©åˆ‡ãªä½ç½®ã«ã‚ã‚Šã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„å‰å¾Œãƒãƒ©ãƒ³ã‚¹ã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>é‡å¿ƒãŒå‰ï¼ˆã¤ã¾å…ˆï¼‰ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>è¶³ã®åœŸè¸ã¾ãšä¸ŠãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—å¾Œã‚ï¼ˆã‹ã‹ã¨å´ï¼‰ã«ä½“é‡ã‚’ã‹ã‘ã¦ãã ã•ã„ã€‚é©åˆ‡ãªé‡å¿ƒä½ç½®ã«ã‚ˆã‚Šã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>é‡å¿ƒãŒå¾Œã‚ï¼ˆã‹ã‹ã¨ï¼‰ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³ä½ç½®ï¼š</strong>è¶³ã®åœŸè¸ã¾ãšä¸ŠãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—å‰ï¼ˆã¤ã¾å…ˆå´ï¼‰ã«ä½“é‡ã‚’ã‹ã‘ã¦ãã ã•ã„ã€‚é©åˆ‡ãªé‡å¿ƒä½ç½®ã«ã‚ˆã‚Šã€åŠ›å¼·ã„ã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚'
                },
                'bodyDirection': {
                    excellent: 'ç†æƒ³çš„ãªä½“ã®å‘ãã§ã™ã€‚è‚©ã¨è…°ã®ãƒ©ã‚¤ãƒ³ãŒé©åˆ‡ã«æƒã£ã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„ä½“ã®å‘ãã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>ä½“ã®å‘ãã«æ­ªã¿ãŒã‚ã‚Šã€è‚©ãƒ»è…°ãƒ»è¶³ã®ãƒ©ã‚¤ãƒ³ãŒä¸æƒã„ã§ã™ã€‚<br><strong>ç†æƒ³å‘ãï¼š</strong>è‚©ã€è…°ã€è¶³ã®ãƒ©ã‚¤ãƒ³ãŒå¹³è¡Œã§ã€ç›®æ¨™æ–¹å‘ã«å‘ã„ã¦ã„ã‚‹çŠ¶æ…‹ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‚©ã¨è…°ã®ãƒ©ã‚¤ãƒ³ã‚’æƒãˆã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½“ã®å‘ãã«ã‚ˆã‚Šã€ç‹™ã£ãŸæ–¹å‘ã«ãƒœãƒ¼ãƒ«ãŒé£›ã³ã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>ä½“ã®å‘ããŒä¸å®‰å®šã§ã€å·¦å³ã®ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³å‘ãï¼š</strong>è‚©ã€è…°ã€è¶³ã®ãƒ©ã‚¤ãƒ³ãŒå¹³è¡Œã§ã€ç›®æ¨™æ–¹å‘ã«å‘ã„ã¦ã„ã‚‹çŠ¶æ…‹ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>å·¦å³ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ•´ãˆã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½“ã®å‘ãã«ã‚ˆã‚Šã€ä¸€è²«ã—ãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚'
                },
                'backCurvature': {
                    excellent: 'ç†æƒ³çš„ãªèƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆã§ã™ã€‚è‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚',
                    good: 'æ¦‚ã­è‰¯ã„èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆã§ã™ãŒã€å¾®èª¿æ•´ã§ã‚ˆã‚Šå®‰å®šã—ã¾ã™ã€‚',
                    poor: score < 75 ? '<strong>ç¾çŠ¶ï¼š</strong>èƒŒéª¨ãŒéåº¦ã«æ›²ãŒã£ã¦çŒ«èƒŒã«ãªã£ã¦ã„ã¾ã™ã€‚<br><strong>ç†æƒ³å§¿å‹¢ï¼š</strong>è‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ã‚’ä¿ã¤ã“ã¨ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ã‚‚ã†å°‘ã—èƒŒç­‹ã‚’ä¼¸ã°ã—ã¦èƒ¸ã‚’å¼µã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„èƒŒéª¨ã®æ›²ãŒã‚Šå…·åˆã«ã‚ˆã‚Šã€ãƒ‘ãƒ¯ãƒ•ãƒ«ã§å®‰å®šã—ãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚' :
                          '<strong>ç¾çŠ¶ï¼š</strong>èƒŒéª¨ãŒçœŸã£ã™ãã™ãã¦è‡ªç„¶ãªæ¹¾æ›²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br><strong>ç†æƒ³å§¿å‹¢ï¼š</strong>è‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ã‚’ä¿ã¤ã“ã¨ãŒç†æƒ³ã§ã™ã€‚<br><strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‡ªç„¶ãªæ¹¾æ›²ã‚’æ„è­˜ã—ã¦ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸå§¿å‹¢ã‚’å–ã£ã¦ãã ã•ã„ã€‚é©åˆ‡ãªèƒŒéª¨ã®æ›²ãŒã‚Šå…·åˆã«ã‚ˆã‚Šã€ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚'
                }
            };
            
            const key = type.includes('ãƒœãƒ¼ãƒ«') ? 'ballPosition' :
                       type.includes('ã‚¹ã‚¿ãƒ³ã‚¹') ? 'stance' :
                       type.includes('å§¿å‹¢') ? 'posture' :
                       type.includes('é ­') ? 'headPosition' :
                       type.includes('æ‰‹ã®ä½ç½®') ? 'handPosition' :
                       type.includes('æ‰‹ã¨ä½“') ? 'handBodyDistance' :
                       type.includes('ä½“é‡') ? 'weight' :
                       type.includes('å‰å‚¾') ? 'forwardLean' :
                       type.includes('å‰å¾Œãƒãƒ©ãƒ³ã‚¹') ? 'frontBackBalance' :
                       type.includes('ä½“ã®å‘ã') ? 'bodyDirection' :
                       type.includes('èƒŒéª¨') ? 'backCurvature' : 'ballPosition';
            
            const categoryComments = comments[key];
            
            if (score >= 90) return categoryComments.excellent;
            
            // 90ç‚¹æœªæº€ã®å ´åˆã¯å¿…ãšè©³ç´°ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œå¼·åŒ–ï¼‰
            if (score < 90) {
                console.log('ğŸ” è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆé–‹å§‹ï¼ˆ90ç‚¹æœªæº€ï¼‰:', score, type, key);
                console.log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šè©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆå¿…é ˆç”Ÿæˆ');
                
                // è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
                let detailedComment = generateDetailedLowScoreComment(score, type, key);
                console.log('ğŸ“ è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆçµæœ:', detailedComment);
                
                if (detailedComment) {
                    console.log('âœ… è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆè¿”å´æˆåŠŸ');
                    return detailedComment;
                }
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå¼·åˆ¶çš„ã«è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
                console.error('âŒ è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆå¤±æ•— - å¼·åˆ¶ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ');
                return generateMobileDetailedComment(score, type, key);
            }
            
            return categoryComments.poor || 'æ”¹å–„ãŒå¿…è¦ã§ã™ã€‚';
        }

        // ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼ˆç¢ºå®Ÿè¡¨ç¤ºï¼‰
        function generateMobileDetailedComment(score, type, key) {
            console.log('ğŸ”¥ ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°å®Ÿè¡Œ:', score, type, key);
            
            // å…·ä½“çš„ãªç¾çŠ¶ã‚’å–å¾—
            let specificStatus = 'å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ';
            if (detailedAnalysisData && detailedAnalysisData[key]) {
                const data = detailedAnalysisData[key];
                specificStatus = generateSpecificCurrentStatus(key, data, score);
            }
            
            // å…·ä½“çš„ç¾çŠ¶ã‚’ä½¿ç”¨ã—ãŸè©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆ
            const mobileComments = {
                'ballPosition': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> ã‚¯ãƒ©ãƒ–ã«é©ã—ãŸä½ç½®ã«ç½®ãã“ã¨ãŒå¤§åˆ‡ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> ãƒœãƒ¼ãƒ«ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„`,
                'forwardLean': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> é©åˆ‡ãªå‰å‚¾è§’åº¦ã‚’ä¿ã¤ã“ã¨ãŒé‡è¦ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> è‚¡é–¢ç¯€ã‹ã‚‰å‰å‚¾ã—èƒŒç­‹ã‚’ä¼¸ã°ã—ã¦ãã ã•ã„`,
                'stance': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> è‚©å¹…ï½è‚©å¹…ã®1.2å€ç¨‹åº¦ãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> è¶³ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„`,
                'headPosition': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> ãƒœãƒ¼ãƒ«ã®çœŸä¸ŠãŒç†æƒ³ä½ç½®ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> é ­ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„`,
                'handPosition': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> å·¦å¤ªã‚‚ã‚‚ã®å†…å´ãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> æ‰‹ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„`,
                'weight': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> å·¦å³å‡ç­‰ãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> ãƒãƒ©ãƒ³ã‚¹ã‚’æ•´ãˆã¦ãã ã•ã„`,
                'handBodyDistance': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> é©åº¦ãªé–“éš”ã‚’ä¿ã¤ã“ã¨ãŒå¤§åˆ‡ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> æ‰‹ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„`,
                'frontBackBalance': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> æ‹‡æŒ‡çƒå¯„ã‚ŠãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> é‡å¿ƒã‚’èª¿æ•´ã—ã¦ãã ã•ã„`,
                'bodyDirection': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> ç›®æ¨™æ–¹å‘ã¨å¹³è¡ŒãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> ä½“ã®å‘ãã‚’èª¿æ•´ã—ã¦ãã ã•ã„`,
                'backCurvature': `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> è‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> å§¿å‹¢ã‚’èª¿æ•´ã—ã¦ãã ã•ã„`
            };
            
            const comment = mobileComments[key] || `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ãŒé‡è¦ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> åŸºæœ¬å§¿å‹¢ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„`;
            console.log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆå®Œäº†:', comment.substring(0, 30) + '...');
            return comment;
        }
        
        // ç¾åœ¨ã®çŠ¶æ…‹ã‚’å…·ä½“çš„ã«èª¬æ˜ã™ã‚‹é–¢æ•°
        function generateSpecificCurrentStatus(analysisKey, data, score) {
            console.log('ğŸ” å…·ä½“çš„ç¾çŠ¶ç”Ÿæˆ:', analysisKey, data);
            
            if (analysisKey === 'ballPosition') {
                const deviationPercent = Math.abs(Math.round(data.difference * 100));
                if (data.isLeftTooMuch) {
                    if (deviationPercent > 15) {
                        return `ãƒœãƒ¼ãƒ«ãŒç†æƒ³ã‚ˆã‚Šå·¦ã«${deviationPercent}%å¤§ããã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆéå¸¸ã«å·¦å¯„ã‚Šï¼‰`;
                    } else if (deviationPercent > 8) {
                        return `ãƒœãƒ¼ãƒ«ãŒç†æƒ³ã‚ˆã‚Šå·¦ã«${deviationPercent}%ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆæ˜ã‚‰ã‹ã«å·¦å¯„ã‚Šï¼‰`;
                    } else {
                        return `ãƒœãƒ¼ãƒ«ãŒç†æƒ³ã‚ˆã‚Šå·¦ã«${deviationPercent}%å°‘ã—ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆã‚„ã‚„å·¦å¯„ã‚Šï¼‰`;
                    }
                } else if (data.isRightTooMuch) {
                    if (deviationPercent > 15) {
                        return `ãƒœãƒ¼ãƒ«ãŒç†æƒ³ã‚ˆã‚Šå³ã«${deviationPercent}%å¤§ããã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆéå¸¸ã«å³å¯„ã‚Šï¼‰`;
                    } else if (deviationPercent > 8) {
                        return `ãƒœãƒ¼ãƒ«ãŒç†æƒ³ã‚ˆã‚Šå³ã«${deviationPercent}%ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆæ˜ã‚‰ã‹ã«å³å¯„ã‚Šï¼‰`;
                    } else {
                        return `ãƒœãƒ¼ãƒ«ãŒç†æƒ³ã‚ˆã‚Šå³ã«${deviationPercent}%å°‘ã—ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆã‚„ã‚„å³å¯„ã‚Šï¼‰`;
                    }
                }
            } else if (analysisKey === 'stance') {
                const currentRatio = data.currentRatio.toFixed(1);
                const idealRatio = data.idealRatio.toFixed(1);
                const ratioDeviation = Math.abs(data.currentRatio - data.idealRatio).toFixed(1);
                
                if (data.isTooWide) {
                    if (ratioDeviation > 0.3) {
                        return `ã‚¹ã‚¿ãƒ³ã‚¹ãŒè‚©å¹…ã®${currentRatio}å€ã§éå¸¸ã«å¹…ã™ãã¾ã™ï¼ˆç†æƒ³${idealRatio}å€ã‚ˆã‚Š${ratioDeviation}å€å¹…ã„ï¼‰`;
                    } else if (ratioDeviation > 0.15) {
                        return `ã‚¹ã‚¿ãƒ³ã‚¹ãŒè‚©å¹…ã®${currentRatio}å€ã§æ˜ã‚‰ã‹ã«å¹…ã™ãã¾ã™ï¼ˆç†æƒ³${idealRatio}å€ã‚ˆã‚Š${ratioDeviation}å€å¹…ã„ï¼‰`;
                    } else {
                        return `ã‚¹ã‚¿ãƒ³ã‚¹ãŒè‚©å¹…ã®${currentRatio}å€ã§ã‚„ã‚„å¹…ã™ãã¾ã™ï¼ˆç†æƒ³${idealRatio}å€ã‚ˆã‚Š${ratioDeviation}å€å¹…ã„ï¼‰`;
                    }
                } else if (data.isTooNarrow) {
                    if (ratioDeviation > 0.3) {
                        return `ã‚¹ã‚¿ãƒ³ã‚¹ãŒè‚©å¹…ã®${currentRatio}å€ã§éå¸¸ã«ç‹­ã™ãã¾ã™ï¼ˆç†æƒ³${idealRatio}å€ã‚ˆã‚Š${ratioDeviation}å€ç‹­ã„ï¼‰`;
                    } else if (ratioDeviation > 0.15) {
                        return `ã‚¹ã‚¿ãƒ³ã‚¹ãŒè‚©å¹…ã®${currentRatio}å€ã§æ˜ã‚‰ã‹ã«ç‹­ã™ãã¾ã™ï¼ˆç†æƒ³${idealRatio}å€ã‚ˆã‚Š${ratioDeviation}å€ç‹­ã„ï¼‰`;
                    } else {
                        return `ã‚¹ã‚¿ãƒ³ã‚¹ãŒè‚©å¹…ã®${currentRatio}å€ã§ã‚„ã‚„ç‹­ã™ãã¾ã™ï¼ˆç†æƒ³${idealRatio}å€ã‚ˆã‚Š${ratioDeviation}å€ç‹­ã„ï¼‰`;
                    }
                }
            } else if (analysisKey === 'handPosition') {
                const handDeviation = Math.abs(Math.round(data.difference * 100));
                if (data.isLeftTooMuch) {
                    if (handDeviation > 10) {
                        return `æ‰‹ãŒç†æƒ³ã‚ˆã‚Šå·¦ã«${handDeviation}%å¤§ããã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆéå¸¸ã«å·¦å¯„ã‚Šï¼‰`;
                    } else if (handDeviation > 5) {
                        return `æ‰‹ãŒç†æƒ³ã‚ˆã‚Šå·¦ã«${handDeviation}%ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆæ˜ã‚‰ã‹ã«å·¦å¯„ã‚Šï¼‰`;
                    } else {
                        return `æ‰‹ãŒç†æƒ³ã‚ˆã‚Šå·¦ã«${handDeviation}%å°‘ã—ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆã‚„ã‚„å·¦å¯„ã‚Šï¼‰`;
                    }
                } else if (data.isRightTooMuch) {
                    if (handDeviation > 10) {
                        return `æ‰‹ãŒç†æƒ³ã‚ˆã‚Šå³ã«${handDeviation}%å¤§ããã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆéå¸¸ã«å³å¯„ã‚Šï¼‰`;
                    } else if (handDeviation > 5) {
                        return `æ‰‹ãŒç†æƒ³ã‚ˆã‚Šå³ã«${handDeviation}%ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆæ˜ã‚‰ã‹ã«å³å¯„ã‚Šï¼‰`;
                    } else {
                        return `æ‰‹ãŒç†æƒ³ã‚ˆã‚Šå³ã«${handDeviation}%å°‘ã—ã‚ºã‚Œã¦ã„ã¾ã™ï¼ˆã‚„ã‚„å³å¯„ã‚Šï¼‰`;
                    }
                }
            } else if (analysisKey === 'headPosition') {
                // æ•°å­—ã¯å‡ºã•ãšæ–¹å‘ã®ã¿ã‚’æ˜ç¤º
                if (data.isLeftTooMuch) {
                    return 'é ­ãŒå·¦ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚ãƒœãƒ¼ãƒ«ã®çœŸä¸Šã€œã‚„ã‚„å¾Œæ–¹ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚';
                } else if (data.isRightTooMuch) {
                    return 'é ­ãŒå³ã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚ãƒœãƒ¼ãƒ«ã®çœŸä¸Šã€œã‚„ã‚„å¾Œæ–¹ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚';
                }
            } else if (analysisKey === 'weight') {
                // æ•°å­—ã¯å‡ºã•ãšã€å·¦å³ã®åã‚Šã‚’æ˜ç¤º
                if (data.isRightHeavy) {
                    return 'å³é‡å¿ƒã«åã£ã¦ã„ã¾ã™ã€‚å·¦å³å‡ç­‰ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¾ã—ã‚‡ã†ã€‚';
                } else if (data.isLeftHeavy) {
                    return 'å·¦é‡å¿ƒã«åã£ã¦ã„ã¾ã™ã€‚å·¦å³å‡ç­‰ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¾ã—ã‚‡ã†ã€‚';
                }
            } else if (analysisKey === 'forwardLean' && data) {
                // æ•°å­—ã‚’å‡ºã•ãšã«å®šæ€§çš„ã«è¡¨ç¾
                if (data.isTooDeep) {
                    return 'å‰å‚¾ãŒæ·±ã™ãã¾ã™ã€‚ã‚‚ã†å°‘ã—ä¸Šä½“ã‚’èµ·ã“ã—ã€è‚¡é–¢ç¯€ã‹ã‚‰ã®å‰å‚¾ã‚’æ•´ãˆã¾ã—ã‚‡ã†ã€‚';
                } else if (data.isTooShallow) {
                    return 'å‰å‚¾ãŒæµ…ã™ãã¾ã™ã€‚è‚¡é–¢ç¯€ã‹ã‚‰ã‚‚ã†å°‘ã—æ·±ãå‰å‚¾ã—ã¾ã—ã‚‡ã†ã€‚';
                } else {
                    return 'æ¦‚ã­é©åˆ‡ã§ã™ã€‚èƒŒç­‹ã‚’ä¼¸ã°ã—ã€è‚¡é–¢ç¯€ã‹ã‚‰è‡ªç„¶ãªå‰å‚¾ã‚’ä¿ã¡ã¾ã—ã‚‡ã†ã€‚';
                }
            } else if (analysisKey === 'handBodyDistance' && data) {
                // æ•°å­—ã¯ä½¿ã‚ãšã€å®šæ€§çš„ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿
                if (data.isTooFar) {
                    return 'æ‰‹ãŒä½“ã‹ã‚‰é ã™ãã¾ã™ã€‚ã‚‚ã†å°‘ã—ä½“ã«è¿‘ã¥ã‘ã€è…•ã«è»½ã„ä½™è£•ãŒå‡ºã‚‹ä½ç½®ã«ã—ã¾ã—ã‚‡ã†ã€‚';
                } else if (data.isTooClose) {
                    return 'æ‰‹ãŒä½“ã«è¿‘ã™ãã¾ã™ã€‚ã‚‚ã†å°‘ã—ä½“ã‹ã‚‰é›¢ã—ã¦ã€è…•ã«è‡ªç„¶ãªã‚†ã¨ã‚Šã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚';
                } else {
                    return 'æ¦‚ã­é©åˆ‡ã§ã™ã€‚è…•ã«è»½ã„ä½™è£•ã‚’ä¿ã¡ã€åŠ›ã¿ã®ãªã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†ã€‚';
                }
            } else if (analysisKey === 'frontBackBalance' && data.currentBalance !== undefined) {
                // æ•°å­—ãªã—ã®æ–¹å‘æŒ‡ç¤º
                if (data.isTooForward) {
                    return 'ã¤ã¾å…ˆé‡å¿ƒã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚æ‹‡æŒ‡çƒã€œåœŸè¸ã¾ãšã«é‡å¿ƒã‚’æ•´ãˆã¾ã—ã‚‡ã†ã€‚';
                } else if (data.isTooBackward) {
                    return 'ã‹ã‹ã¨é‡å¿ƒã«å¯„ã‚Šã™ãã¦ã„ã¾ã™ã€‚æ‹‡æŒ‡çƒã€œåœŸè¸ã¾ãšã«é‡å¿ƒã‚’æ•´ãˆã¾ã—ã‚‡ã†ã€‚';
                }
            } else if (analysisKey === 'bodyDirection' && data && (data.shoulderState || data.hipState || data.heelState)) {
                // è‚©ãƒ»è…°ãƒ»ã‹ã‹ã¨ã®ã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚ºã‚’æ˜ç¤ºï¼ˆæ•°å€¤ã¯å‡ºã•ãªã„ï¼‰
                const label = (s) => s === 'open' ? 'ã‚ªãƒ¼ãƒ—ãƒ³' : (s === 'closed' ? 'ã‚¯ãƒ­ãƒ¼ã‚º' : 'ã‚¹ã‚¯ã‚¨ã‚¢');
                const parts = [];
                if (data.shoulderState) parts.push(`è‚©ã¯${label(data.shoulderState)}`);
                if (data.hipState) parts.push(`è…°ã¯${label(data.hipState)}`);
                if (data.heelState) parts.push(`ã‹ã‹ã¨ã¯${label(data.heelState)}`);
                if (parts.length === 0) return 'ä½“ã®å‘ãã¯æ¦‚ã­ã‚¹ã‚¯ã‚¨ã‚¢ã§ã™ã€‚ç›®æ¨™ãƒ©ã‚¤ãƒ³ã¨å¹³è¡Œã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚';
                return parts.join('ã€') + 'ã€‚ç›®æ¨™ãƒ©ã‚¤ãƒ³ã¨å¹³è¡Œã«æ•´ãˆã¾ã—ã‚‡ã†ã€‚';
            } else if (analysisKey === 'bodyDirection' && data.currentAngle !== undefined) {
                const angleDeviation = Math.abs(Math.round(data.currentAngle));
                if (data.isOpenToTarget) {
                    if (angleDeviation > 15) {
                        return `ä½“ãŒç›®æ¨™ã‚ˆã‚Šéå¸¸ã«å¤§ããé–‹ã„ã¦ã„ã¾ã™ï¼ˆ${angleDeviation}Â°é–‹ã„ã¦ã„ã‚‹ï¼‰`;
                    } else if (angleDeviation > 8) {
                        return `ä½“ãŒç›®æ¨™ã‚ˆã‚Šæ˜ã‚‰ã‹ã«é–‹ã„ã¦ã„ã¾ã™ï¼ˆ${angleDeviation}Â°é–‹ã„ã¦ã„ã‚‹ï¼‰`;
                    } else {
                        return `ä½“ãŒç›®æ¨™ã‚ˆã‚Šã‚„ã‚„é–‹ã„ã¦ã„ã¾ã™ï¼ˆ${angleDeviation}Â°é–‹ã„ã¦ã„ã‚‹ï¼‰`;
                    }
                } else if (data.isClosedToTarget) {
                    if (angleDeviation > 15) {
                        return `ä½“ãŒç›®æ¨™ã‚ˆã‚Šéå¸¸ã«å¤§ããé–‰ã˜ã¦ã„ã¾ã™ï¼ˆ${angleDeviation}Â°é–‰ã˜ã¦ã„ã‚‹ï¼‰`;
                    } else if (angleDeviation > 8) {
                        return `ä½“ãŒç›®æ¨™ã‚ˆã‚Šæ˜ã‚‰ã‹ã«é–‰ã˜ã¦ã„ã¾ã™ï¼ˆ${angleDeviation}Â°é–‰ã˜ã¦ã„ã‚‹ï¼‰`;
                    } else {
                        return `ä½“ãŒç›®æ¨™ã‚ˆã‚Šã‚„ã‚„é–‰ã˜ã¦ã„ã¾ã™ï¼ˆ${angleDeviation}Â°é–‰ã˜ã¦ã„ã‚‹ï¼‰`;
                    }
                }
            } else if (analysisKey === 'backCurvature' && data.curvatureRatio !== undefined) {
                const curvaturePercent = Math.round(data.curvatureRatio * 100);
                if (data.isTooArched) {
                    if (curvaturePercent > 8) {
                        return `èƒŒä¸­ãŒéå¸¸ã«å¤§ããåã‚Šã™ãã¦ã„ã¾ã™ï¼ˆåã‚Šåº¦${curvaturePercent}%ï¼‰`;
                    } else if (curvaturePercent > 5) {
                        return `èƒŒä¸­ãŒæ˜ã‚‰ã‹ã«åã‚Šã™ãã¦ã„ã¾ã™ï¼ˆåã‚Šåº¦${curvaturePercent}%ï¼‰`;
                    } else {
                        return `èƒŒä¸­ãŒã‚„ã‚„åã‚Šã™ãã¦ã„ã¾ã™ï¼ˆåã‚Šåº¦${curvaturePercent}%ï¼‰`;
                    }
                } else if (data.isTooRounded) {
                    if (curvaturePercent > 8) {
                        return `èƒŒä¸­ãŒéå¸¸ã«å¤§ããä¸¸ã¾ã‚Šã™ãã¦ã„ã¾ã™ï¼ˆä¸¸ã¿åº¦${curvaturePercent}%ï¼‰`;
                    } else if (curvaturePercent > 5) {
                        return `èƒŒä¸­ãŒæ˜ã‚‰ã‹ã«ä¸¸ã¾ã‚Šã™ãã¦ã„ã¾ã™ï¼ˆä¸¸ã¿åº¦${curvaturePercent}%ï¼‰`;
                    } else {
                        return `èƒŒä¸­ãŒã‚„ã‚„ä¸¸ã¾ã‚Šã™ãã¦ã„ã¾ã™ï¼ˆä¸¸ã¿åº¦${curvaturePercent}%ï¼‰`;
                    }
                } else if (data.isTooStraight) {
                    return `èƒŒä¸­ãŒçœŸã£ã™ãã™ãã¦è‡ªç„¶ãªæ›²ç·šãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆæ›²ç·šåº¦${curvaturePercent}%ï¼‰`;
                }
            }
            
            // ãã®ä»–ã®ã‚«ãƒ†ã‚´ãƒªã®ã‚¹ã‚³ã‚¢åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ
            if (score < 60) {
                return 'éå¸¸ã«å¤§ããªå•é¡ŒãŒã‚ã‚Šã¾ã™';
            } else if (score < 70) {
                return 'æ˜ã‚‰ã‹ãªå•é¡ŒãŒã‚ã‚Šã¾ã™';
            } else if (score < 80) {
                return 'æ”¹å–„ãŒå¿…è¦ã§ã™';
            } else {
                return 'è»½å¾®ãªã‚ºãƒ¬ãŒã‚ã‚Šã¾ã™';
            }
        }

        // 90ç‚¹ä»¥ä¸‹ã®è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼‰
        function generateDetailedLowScoreComment(score, type, key) {
            const clubSelect = document.getElementById('clubSelect');
            const selectedClub = clubSelect ? clubSelect.value : 'driver';
            
            const clubNames = {
                'driver': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼',
                'fairway': 'ãƒ•ã‚§ã‚¢ã‚¦ã‚§ã‚¤ã‚¦ãƒƒãƒ‰',
                'utility': 'ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
                'iron4': '4ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                'iron5': '5ç•ªã‚¢ã‚¤ã‚¢ãƒ³', 
                'iron6': '6ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                'iron7': '7ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                'iron8': '8ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                'iron9': '9ç•ªã‚¢ã‚¤ã‚¢ãƒ³',
                'wedge': 'ã‚¦ã‚§ãƒƒã‚¸'
            };
            
            const clubName = clubNames[selectedClub] || selectedClub;
            
            if (key === 'ballPosition') {
                const idealPositions = {
                    'driver': 'å·¦è¶³ã‹ã‹ã¨å†…å´',
                    'fairway': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚ˆã‚Š1å€‹å³',
                    'utility': 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚ˆã‚Š1å€‹å³',
                    'iron4': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦',
                    'iron5': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦',
                    'iron6': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦',
                    'iron7': 'ã‚»ãƒ³ã‚¿ãƒ¼ã‚ˆã‚Šå°‘ã—å·¦',
                    'iron8': 'ä¸¡è¶³ã‚»ãƒ³ã‚¿ãƒ¼',
                    'iron9': 'ä¸¡è¶³ã‚»ãƒ³ã‚¿ãƒ¼',
                    'wedge': 'ä¸¡è¶³ã‚»ãƒ³ã‚¿ãƒ¼'
                };
                
                return `<strong>ç¾çŠ¶ï¼š</strong>ãƒœãƒ¼ãƒ«ä½ç½®ãŒç†æƒ³ä½ç½®ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>${clubName}ã¯${idealPositions[selectedClub] || 'é©åˆ‡ãªä½ç½®'}ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ãƒœãƒ¼ãƒ«ã®ä½ç½®ã‚’ç†æƒ³ä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½ç½®ã«ç½®ãã“ã¨ã§ã€ã‚¯ãƒ©ãƒ–ã®æ€§èƒ½ã‚’æœ€å¤§é™ã«ç™ºæ®ã§ãã¾ã™ã€‚`;
            }
            
            if (key === 'forwardLean') {
                const idealAngles = {
                    'driver': '15åº¦',
                    'fairway': '18åº¦',
                    'utility': '20åº¦',
                    'iron4': '22åº¦',
                    'iron5': '24åº¦',
                    'iron6': '26åº¦',
                    'iron7': '28åº¦',
                    'iron8': '30åº¦',
                    'iron9': '32åº¦',
                    'wedge': '35åº¦'
                };
                
                return `<strong>ç¾çŠ¶ï¼š</strong>å‰å‚¾ãŒç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯æµ…ã‚ã€ã‚¯ãƒ©ãƒ–ãŒçŸ­ã„ã»ã©å¾ã€…ã«æ·±ãã€ã‚¦ã‚§ãƒƒã‚¸ã§æœ€ã‚‚æ·±ã„å‰å‚¾ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‚¡é–¢ç¯€ã‹ã‚‰é©åˆ‡ã«å‰å‚¾ã—ã€èƒŒç­‹ã‚’ã¾ã£ã™ãã«ä¿ã£ã¦ãã ã•ã„ã€‚`;
            }
            
            if (key === 'stance') {
                return `<strong>ç¾çŠ¶ï¼š</strong>ã‚¹ã‚¿ãƒ³ã‚¹å¹…ãŒç†æƒ³ã‹ã‚‰å¤§ãããšã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>è‚©å¹…ã®1.2å€ç¨‹åº¦ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è¶³ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦é©åˆ‡ãªã‚¹ã‚¿ãƒ³ã‚¹å¹…ã‚’ä½œã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚ˆã‚Šã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚`;
            }
            
            if (key === 'headPosition') {
                return `<strong>ç¾çŠ¶ï¼š</strong>é ­ã®ä½ç½®ãŒé©æ­£ä½ç½®ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>ãƒœãƒ¼ãƒ«ã®çœŸä¸Šã¾ãŸã¯ã‚„ã‚„å¾Œæ–¹ã«é ­ã‚’é…ç½®ã™ã‚‹ã®ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>é ­ã®ä½ç½®ã‚’ãƒœãƒ¼ãƒ«ã®çœŸä¸Šã«èª¿æ•´ã—ã€èƒŒéª¨ã‚’ã¾ã£ã™ãã«ä¿ã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„é ­ã®ä½ç½®ã«ã‚ˆã‚Šãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚`;
            }
            
            if (key === 'handPosition') {
                return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ã®ä½ç½®ãŒç†æƒ³ä½ç½®ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>æ‰‹ã¯å·¦å¤ªã‚‚ã‚‚ã®å†…å´ã«ä½ç½®ã™ã‚‹ã®ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã®ä½ç½®ã‚’å·¦å¤ªã‚‚ã‚‚ã®å†…å´ã«èª¿æ•´ã—ã€è‡ªç„¶ãªãƒãƒ³ãƒ‰ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚’ä½œã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„æ‰‹ã®ä½ç½®ã«ã‚ˆã‚Šå®‰å®šã—ãŸã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚`;
            }
            
            if (key === 'weight') {
                return `<strong>ç¾çŠ¶ï¼š</strong>ä½“é‡é…åˆ†ãŒç†æƒ³ã‹ã‚‰åã£ã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>å·¦å³ã®è¶³ã«å‡ç­‰ã«ä½“é‡ã‚’é…åˆ†ã™ã‚‹ã®ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>ä¸¡è¶³ã«ãƒãƒ©ãƒ³ã‚¹è‰¯ãä½“é‡ã‚’ã‹ã‘ã€å®‰å®šã—ãŸã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½“é‡é…åˆ†ã«ã‚ˆã‚Šå®‰å®šã—ãŸã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚`;
            }
            
            if (key === 'handBodyDistance') {
                return `<strong>ç¾çŠ¶ï¼š</strong>æ‰‹ã¨ä½“ã®è·é›¢ãŒé©æ­£ç¯„å›²ã‹ã‚‰å¤–ã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>æ‰‹ã¨ä½“ã®é–“ã«é©åº¦ãªé–“éš”ã‚’ä¿ã¤ã®ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>æ‰‹ã‚’ä½“ã‹ã‚‰é©åº¦ã«é›¢ã—ã€è…•ã«ä½™è£•ã‚’æŒãŸã›ã¦ãã ã•ã„ã€‚æ­£ã—ã„è·é›¢ã«ã‚ˆã‚Šè‡ªç„¶ãªã‚¹ã‚¤ãƒ³ã‚°ãƒ—ãƒ¬ãƒ¼ãƒ³ãŒä½œã‚Œã¾ã™ã€‚`;
            }
            
            if (key === 'frontBackBalance') {
                return `<strong>ç¾çŠ¶ï¼š</strong>å‰å¾Œã®é‡å¿ƒãƒãƒ©ãƒ³ã‚¹ãŒç†æƒ³ã‹ã‚‰åã£ã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>ã‚„ã‚„æ‹‡æŒ‡çƒå¯„ã‚Šã«é‡å¿ƒã‚’ç½®ãã®ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>é‡å¿ƒã‚’é©åˆ‡ãªä½ç½®ã«èª¿æ•´ã—ã€å®‰å®šã—ãŸæ§‹ãˆã‚’ä½œã£ã¦ãã ã•ã„ã€‚æ­£ã—ã„ãƒãƒ©ãƒ³ã‚¹ã«ã‚ˆã‚Šãƒ‘ãƒ¯ãƒ•ãƒ«ãªã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚`;
            }
            
            if (key === 'bodyDirection') {
                return `<strong>ç¾çŠ¶ï¼š</strong>ä½“ã®å‘ããŒç›®æ¨™æ–¹å‘ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>è‚©ã¨è…°ã®ãƒ©ã‚¤ãƒ³ãŒç›®æ¨™ã¨å¹³è¡Œã«ãªã‚‹ã®ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>è‚©ã¨è…°ã‚’ç›®æ¨™ãƒ©ã‚¤ãƒ³ã¨å¹³è¡Œã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚æ­£ã—ã„ä½“ã®å‘ãã«ã‚ˆã‚Šç‹™ã£ãŸæ–¹å‘ã¸ã®é£›çƒãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚`;
            }
            
            if (key === 'backCurvature') {
                return `<strong>ç¾çŠ¶ï¼š</strong>èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆãŒç†æƒ³ã‹ã‚‰å¤–ã‚Œã¦ã„ã¾ã™ã€‚<br>
                        <strong>ç†æƒ³ï¼š</strong>èƒŒéª¨ã‚’è‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ã«ä¿ã¤ã®ãŒç†æƒ³ã§ã™ã€‚<br>
                        <strong>æ”¹å–„æ–¹æ³•ï¼š</strong>èƒ¸ã‚’å¼µã‚Šã€èƒŒç­‹ã‚’ã¾ã£ã™ãã«ä¿ã¡ãªãŒã‚‰è‚¡é–¢ç¯€ã‹ã‚‰å‰å‚¾ã—ã¦ãã ã•ã„ã€‚æ­£ã—ã„å§¿å‹¢ã«ã‚ˆã‚ŠåŠ¹ç‡çš„ãªã‚¹ã‚¤ãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚`;
            }
            
            return null;
        }

        // è©³ç´°çµæœè¡¨ç¤º
        function displayDetailedResults(scores) {
            const grid = document.getElementById('scoreFeedbackGrid');
            const viewType = document.getElementById('viewSelect').value;
            
            // è¦–ç‚¹ã«å¿œã˜ãŸã‚¹ã‚³ã‚¢é …ç›®ã¨ãƒ©ãƒ™ãƒ«ã‚’å‹•çš„ã«è¨­å®š
            let scoreItems = [];
            let scoreValues = [];
            
            if (viewType === 'front') {
                scoreItems = [
                    {label: 'ğŸ¯ ãƒœãƒ¼ãƒ«ä½ç½®', value: scores.ballPosition},
                    {label: 'ğŸ¦µ ã‚¹ã‚¿ãƒ³ã‚¹å¹…', value: scores.stance},
                    {label: 'ğŸ‘¤ é ­ã®ä½ç½®', value: scores.headPosition},
                    {label: 'ğŸ¤š æ‰‹ã®ä½ç½®', value: scores.handPosition},
                    {label: 'âš–ï¸ ä½“é‡é…åˆ†', value: scores.weight}
                ];
            } else { // rear
                scoreItems = [
                    {label: 'â¬‡ï¸ å‰å‚¾è§’åº¦', value: scores.forwardLean},
                    {label: 'ğŸ“ æ‰‹ã¨ä½“ã®è·é›¢', value: scores.handBodyDistance},
                    {label: 'âš–ï¸ å‰å¾Œãƒãƒ©ãƒ³ã‚¹', value: scores.frontBackBalance},
                    {label: 'ğŸ§­ ä½“ã®å‘ã', value: scores.bodyDirection},
                    {label: 'ğŸ”„ èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆ', value: scores.backCurvature}
                ];
            }
            
            // ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
            const totalScore = Math.round(scoreItems.reduce((sum, item) => sum + item.value, 0) / scoreItems.length);
            
            console.log('è©³ç´°çµæœè¡¨ç¤º:', scores, 'è¦–ç‚¹:', viewType);
            
            // MediaPipeä½¿ç”¨æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
            const analysisMethod = mediaPipeReady && currentResults && currentResults.poseLandmarks ? 
                'AIå§¿å‹¢åˆ†æã«ã‚ˆã‚Šé«˜ç²¾åº¦ãªè¨ºæ–­ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ' : 
                'åŸºæœ¬åˆ†æãƒ¢ãƒ¼ãƒ‰ã§è¨ºæ–­ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ';
            
            // ã‚¹ã‚³ã‚¢é …ç›®ã®HTMLç”Ÿæˆï¼ˆåˆ†æã‚­ãƒ¼ã‚’å«ã‚€ï¼‰
            let scoreItemsHTML = '';
            if (viewType === 'front') {
                scoreItemsHTML = `
                    ${createDetailedScoreItem('ğŸ¯ ãƒœãƒ¼ãƒ«ä½ç½®', scores.ballPosition, 'ballPosition')}
                    ${createDetailedScoreItem('ğŸ¦µ ã‚¹ã‚¿ãƒ³ã‚¹å¹…', scores.stance, 'stance')}
                    ${createDetailedScoreItem('ğŸ‘¤ é ­ã®ä½ç½®', scores.headPosition, 'headPosition')}
                    ${createDetailedScoreItem('ğŸ¤š æ‰‹ã®ä½ç½®', scores.handPosition, 'handPosition')}
                    ${createDetailedScoreItem('âš–ï¸ ä½“é‡é…åˆ†', scores.weight, 'weight')}
                `;
            } else { // rear
                scoreItemsHTML = `
                    ${createDetailedScoreItem('â¬‡ï¸ å‰å‚¾è§’åº¦', scores.forwardLean, 'forwardLean')}
                    ${createDetailedScoreItem('ğŸ“ æ‰‹ã¨ä½“ã®è·é›¢', scores.handBodyDistance, 'handBodyDistance')}
                    ${createDetailedScoreItem('âš–ï¸ å‰å¾Œãƒãƒ©ãƒ³ã‚¹', scores.frontBackBalance, 'frontBackBalance')}
                    ${createDetailedScoreItem('ğŸ§­ ä½“ã®å‘ã', scores.bodyDirection, 'bodyDirection')}
                    ${createDetailedScoreItem('ğŸ”„ èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆ', scores.backCurvature, 'backCurvature')}
                `;
            }
            
            grid.innerHTML = `
                <div class="score-item" style="grid-column: 1 / -1; background: #e8f5e8; border-left: 4px solid #28a745;">
                    <p style="margin: 0; color: #155724; font-weight: bold;">ğŸ“Š ${analysisMethod}</p>
                </div>
                ${scoreItemsHTML}
                <div class="score-item" style="grid-column: 1 / -1; text-align: center; background: linear-gradient(45deg, #2E86AB, #A23B72); color: white; border: 3px solid #ffffff; box-shadow: 0 8px 25px rgba(0,0,0,0.3);">
                    <h4 style="color: #FFFFFF; font-size: 1.6em; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">ğŸ“Š ç·åˆã‚¹ã‚³ã‚¢</h4>
                    <div class="score-display" style="color: #FFFFFF; font-size: 3.5em; font-weight: bold; text-shadow: 3px 3px 6px rgba(0,0,0,0.7); margin: 20px 0;">${totalScore}ç‚¹</div>
                    <div class="feedback-text" style="color: #FFFFFF; font-size: 1.3em; margin-top: 20px; line-height: 1.5; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        ${generateOverallComment(totalScore)}
                    </div>
                </div>
            `;
        }
        
        // ç·åˆã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
        function generateOverallComment(totalScore) {
            if (totalScore >= 90) {
                return 'ç´ æ™´ã‚‰ã—ã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ï¼ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ã®æ§‹ãˆãŒã§ãã¦ã„ã¾ã™ã€‚ã“ã®èª¿å­ã§ç·´ç¿’ã‚’ç¶šã‘ã¦ãã ã•ã„ã€‚';
            } else if (totalScore >= 80) {
                return 'ã¨ã¦ã‚‚è‰¯ã„ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚ä¸Šè¨˜ã®å¾®èª¿æ•´ã§ã•ã‚‰ã«å‘ä¸Šã§ãã¾ã™ã€‚';
            } else if (totalScore >= 70) {
                return 'åŸºæœ¬çš„ãªéƒ¨åˆ†ã¯è‰¯å¥½ã§ã™ã€‚ä¸Šè¨˜ã®æ”¹å–„ç‚¹ã‚’æ„è­˜ã—ã¦ç·´ç¿’ã—ã¦ãã ã•ã„ã€‚';
            } else {
                return 'æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šè¨˜ã®å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã«å¾“ã£ã¦åŸºæœ¬çš„ãªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚';
            }
        }

        // è©³ç´°ã‚¹ã‚³ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ä½œæˆï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œå¼·åŒ–ï¼‰
        function createDetailedScoreItem(title, score, analysisKey) {
            console.log('ğŸ”„ createDetailedScoreItemå®Ÿè¡Œ:', title, score, analysisKey);
            
            const scoreClass = score >= 90 ? 'score-90plus' : 
                              score >= 80 ? 'score-80plus' : 
                              score >= 70 ? 'score-70plus' : 'score-below70';
            
            // 90ç‚¹ä»¥ä¸‹ã§ç¢ºå®Ÿã«è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
            let detailedFeedback = '';
            if (score < 90) {
                console.log('ğŸ“± 90ç‚¹æœªæº€æ¤œå‡º - è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆå¼·åˆ¶ç”Ÿæˆ:', score);
                
                // è©³ç´°åˆ†æãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å…·ä½“çš„ãªç¾çŠ¶ã‚’å–å¾—
                let specificStatus = 'å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ';
                if (detailedAnalysisData && detailedAnalysisData[analysisKey]) {
                    const data = detailedAnalysisData[analysisKey];
                    specificStatus = generateSpecificCurrentStatus(analysisKey, data, score);
                }
                // ãªãŠå…·ä½“æ–‡ãŒå¾—ã‚‰ã‚Œãªã„å ´åˆã¯ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®æ–¹å‘æŒ‡ç¤ºã‚’ç”¨æ„
                if (!specificStatus || specificStatus === 'å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ') {
                    if (analysisKey === 'ballPosition') {
                        if (ballPosition) {
                            const dir = ballPosition.x < 0.5 ? 'å³' : 'å·¦';
                            specificStatus = `ãƒœãƒ¼ãƒ«ä½ç½®ãŒã‚„ã‚„${dir}å¯„ã‚Šã§ã™`;
                        } else {
                            specificStatus = 'ãƒœãƒ¼ãƒ«ä½ç½®ã®è¨­å®šãŒå¿…è¦ã§ã™ï¼ˆç”»åƒä¸Šã§ã‚¿ãƒƒãƒ—ï¼‰';
                        }
                    } else if (analysisKey === 'stance') {
                        specificStatus = score < 80 ? 'ã‚¹ã‚¿ãƒ³ã‚¹ãŒåºƒã™ãã¾ã™' : 'ã‚¹ã‚¿ãƒ³ã‚¹ãŒç‹­ã™ãã¾ã™';
                    } else if (analysisKey === 'headPosition') {
                        specificStatus = 'é ­ã®ä½ç½®ãŒä¸­å¿ƒã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ï¼ˆãƒœãƒ¼ãƒ«ã®çœŸä¸Šã€œã‚„ã‚„å¾Œæ–¹ãŒç†æƒ³ï¼‰';
                    } else if (analysisKey === 'handPosition') {
                        specificStatus = 'æ‰‹ã®ä½ç½®ãŒé©æ­£ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™ï¼ˆå·¦å¤ªã‚‚ã‚‚å†…å´ãŒç›®å®‰ï¼‰';
                    } else if (analysisKey === 'weight') {
                        specificStatus = score < 80 ? 'å·¦è¶³ã«å¯„ã‚Šã™ãã§ã™' : 'å³è¶³ã«å¯„ã‚Šã™ãã§ã™';
                    } else if (analysisKey === 'forwardLean') {
                        specificStatus = score < 80 ? 'å‰å‚¾ãŒæµ…ã™ãã¾ã™' : 'å‰å‚¾ãŒæ·±ã™ãã¾ã™';
                    } else if (analysisKey === 'handBodyDistance') {
                        specificStatus = score < 80 ? 'æ‰‹ãŒä½“ã‹ã‚‰é ã™ãã¾ã™' : 'æ‰‹ãŒä½“ã«è¿‘ã™ãã¾ã™';
                    } else if (analysisKey === 'frontBackBalance') {
                        specificStatus = score < 80 ? 'é‡å¿ƒãŒã¤ã¾å…ˆå¯„ã‚Šã§ã™' : 'é‡å¿ƒãŒã‹ã‹ã¨å¯„ã‚Šã§ã™';
                    } else if (analysisKey === 'bodyDirection') {
                        specificStatus = 'ä½“ã®å‘ããŒç›®æ¨™ã‹ã‚‰ãšã‚Œã¦ã„ã¾ã™';
                    } else if (analysisKey === 'backCurvature') {
                        specificStatus = 'èƒŒä¸­ã®ã‚«ãƒ¼ãƒ–ãŒä¸è‡ªç„¶ã§ã™';
                    }
                }
                
                // å„ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«å…·ä½“çš„ãªç¾çŠ¶ã‚’å–å¾—ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆ
                const mobileDetailedComments = {};
                
                if (analysisKey === 'ballPosition') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> ã‚¯ãƒ©ãƒ–ã«é©ã—ãŸä½ç½®ã«é…ç½®ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> ãƒœãƒ¼ãƒ«ã®ä½ç½®ã‚’ç†æƒ³ä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„`;
                } else if (analysisKey === 'stance') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> è‚©å¹…ã®1.2å€ç¨‹åº¦ãŒç†æƒ³çš„ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> è¶³ã®ä½ç½®ã‚’èª¿æ•´ã—ã¦é©åˆ‡ãªã‚¹ã‚¿ãƒ³ã‚¹å¹…ã‚’ä½œã£ã¦ãã ã•ã„`;
                } else if (analysisKey === 'headPosition') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> ãƒœãƒ¼ãƒ«ã®çœŸä¸Šã¾ãŸã¯ã‚„ã‚„å¾Œæ–¹ãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> é ­ã®ä½ç½®ã‚’ãƒœãƒ¼ãƒ«ã®çœŸä¸Šã«èª¿æ•´ã—ã¦ãã ã•ã„`;
                } else if (analysisKey === 'handPosition') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> å·¦å¤ªã‚‚ã‚‚ã®å†…å´ãŒç†æƒ³çš„ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> æ‰‹ã®ä½ç½®ã‚’å·¦å¤ªã‚‚ã‚‚ã®å†…å´ã«èª¿æ•´ã—ã¦ãã ã•ã„`;
                } else if (analysisKey === 'weight') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> å·¦å³ã®è¶³ã«å‡ç­‰ã«é…åˆ†ã™ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> ä¸¡è¶³ã«ãƒãƒ©ãƒ³ã‚¹ã‚ˆãä½“é‡ã‚’ã‹ã‘ã¦ãã ã•ã„`;
                } else if (analysisKey === 'forwardLean') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> é©åˆ‡ãªå‰å‚¾è§’åº¦ã‚’ä¿ã¤ã“ã¨ãŒé‡è¦ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> è‚¡é–¢ç¯€ã‹ã‚‰å‰å‚¾ã—ã€èƒŒç­‹ã‚’ã¾ã£ã™ãã«ä¿ã£ã¦ãã ã•ã„`;
                } else if (analysisKey === 'handBodyDistance') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> é©åº¦ãªé–“éš”ã‚’ä¿ã¤ã“ã¨ãŒå¤§åˆ‡ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> æ‰‹ã‚’ä½“ã‹ã‚‰é©åº¦ã«é›¢ã—ã€è…•ã«ä½™è£•ã‚’æŒãŸã›ã¦ãã ã•ã„`;
                } else if (analysisKey === 'frontBackBalance') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> ã‚„ã‚„æ‹‡æŒ‡çƒå¯„ã‚Šã«é‡å¿ƒã‚’ç½®ãã®ãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> é‡å¿ƒã‚’é©åˆ‡ãªä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„`;
                } else if (analysisKey === 'bodyDirection') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> è‚©ã¨è…°ã®ãƒ©ã‚¤ãƒ³ãŒç›®æ¨™ã¨å¹³è¡Œã«ãªã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> è‚©ã¨è…°ã‚’ç›®æ¨™ãƒ©ã‚¤ãƒ³ã¨å¹³è¡Œã«èª¿æ•´ã—ã¦ãã ã•ã„`;
                } else if (analysisKey === 'backCurvature') {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> è‡ªç„¶ãªSå­—ã‚«ãƒ¼ãƒ–ãŒç†æƒ³ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> å§¿å‹¢ã‚’èª¿æ•´ã—ã¦ãã ã•ã„`;
                } else {
                    mobileDetailedComments[analysisKey] = `<strong>ç¾çŠ¶:</strong> ${specificStatus}<br><strong>ç†æƒ³:</strong> æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ãŒé‡è¦ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> åŸºæœ¬å§¿å‹¢ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„`;
                }
                
                detailedFeedback = mobileDetailedComments[analysisKey] || '<strong>ç¾çŠ¶:</strong> æ”¹å–„ãŒå¿…è¦ã§ã™<br><strong>ç†æƒ³:</strong> æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ãŒé‡è¦ã§ã™<br><strong>æ”¹å–„æ–¹æ³•:</strong> åŸºæœ¬å§¿å‹¢ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„';
                console.log('âœ… ãƒ¢ãƒã‚¤ãƒ«è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆå®Œäº†:', detailedFeedback.substring(0, 30) + '...');
            } else {
                // 90ç‚¹ä»¥ä¸Šã®å ´åˆ
                detailedFeedback = `ç†æƒ³çš„ãª${title.replace(/ğŸ¯|ğŸ¦µ|ğŸ‘¤|ğŸ¤š|âš–ï¸|â¬‡ï¸|ğŸ“|ğŸ§­|ğŸ”„/g, '')}ã§ã™ã€‚ç¾åœ¨ã®è¨­å®šã§å„ªã‚ŒãŸçµæœãŒå‡ºã¦ã„ã¾ã™ã€‚`;
                console.log('âœ… 90ç‚¹ä»¥ä¸Šã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆå®Œäº†');
            }
            
            return `
                <div class="score-item" style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h4>${title}</h4>
                    <div class="score-display ${scoreClass}">${score}ç‚¹</div>
                    <div class="feedback-text" style="display: block !important; visibility: visible !important; opacity: 1 !important; line-height: 1.8 !important; font-size: 15px !important; margin-top: 12px !important; padding: 10px !important; background-color: rgba(255, 255, 255, 0.9) !important; border-radius: 8px !important; border-left: 4px solid #007bff !important; color: #333 !important;">${detailedFeedback}</div>
                </div>
            `;
        }

        // MediaPipeåˆæœŸåŒ–ï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œå¼·åŒ–ç‰ˆï¼‰
        function initMediaPipe() {
            console.log('MediaPipeåˆæœŸåŒ–é–‹å§‹...', {
                userAgent: navigator.userAgent,
                isMobile: /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                windowWidth: window.innerWidth
            });

            return new Promise((resolve, reject) => {
                // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã®æ¤œå‡º
                const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

                // MediaPipeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ç¢ºèª
                const checkLibraries = () => {
                    try {
                        return (typeof Pose !== 'undefined' &&
                                typeof drawConnectors !== 'undefined' &&
                                typeof drawLandmarks !== 'undefined' &&
                                typeof POSE_CONNECTIONS !== 'undefined');
                    } catch (e) {
                        console.warn('ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªã‚¨ãƒ©ãƒ¼:', e);
                        return false;
                    }
                };

                // ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã¯å¾…æ©Ÿæ™‚é–“ã‚’å»¶é•·
                const maxAttempts = isMobile ? 100 : 50; // ãƒ¢ãƒã‚¤ãƒ«10ç§’ã€PC5ç§’
                let attempts = 0;

                const checkInterval = setInterval(() => {
                    attempts++;

                    if (checkLibraries()) {
                        clearInterval(checkInterval);

                        try {
                            pose = new Pose({
                                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
                            });

                            // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®è»½é‡è¨­å®š
                            const options = isMobile ? {
                                modelComplexity: 0, // ãƒ¢ãƒã‚¤ãƒ«ã¯è»½é‡ãƒ¢ãƒ‡ãƒ«
                                smoothLandmarks: false, // ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ç„¡åŠ¹
                                enableSegmentation: false, // ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹
                                minDetectionConfidence: 0.7, // æ¤œå‡ºé–¾å€¤é«˜ã‚
                                minTrackingConfidence: 0.7
                            } : {
                                modelComplexity: 1,
                                smoothLandmarks: true,
                                minDetectionConfidence: 0.5,
                                minTrackingConfidence: 0.5
                            };

                            console.log('MediaPipeè¨­å®š:', options);
                            pose.setOptions(options);
                            pose.onResults(onPoseResults);

                            mediaPipeReady = true;
                            console.log('âœ… MediaPipeåˆæœŸåŒ–å®Œäº† - ãƒ¢ãƒã‚¤ãƒ«:', isMobile);
                            resolve(true);

                        } catch (error) {
                            console.error('MediaPipeåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                            mediaPipeReady = false;
                            // ãƒ¢ãƒã‚¤ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰
                            if (isMobile) {
                                console.warn('ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹');
                            }
                            resolve(false);
                        }

                    } else if (attempts >= maxAttempts) {
                        clearInterval(checkInterval);
                        console.warn('MediaPipeåˆæœŸåŒ–ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ - è©¦è¡Œå›æ•°:', attempts);
                        mediaPipeReady = false;
                        resolve(false);
                    }

                    // é€²æ—è¡¨ç¤ºï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
                    if (attempts % 10 === 0) {
                        console.log(`MediaPipeåˆæœŸåŒ–ä¸­... ${attempts}/${maxAttempts}`);
                    }
                }, 100);
            });
        }

        // MediaPipeã®çµæœå‡¦ç†
        function onPoseResults(results) {
            console.log('MediaPipeçµæœå–å¾—:', results.poseLandmarks ? 'æˆåŠŸ' : 'å¤±æ•—');
            currentResults = results;
            
            const canvas = document.getElementById('poseCanvas');
            if (!canvas || !uploadedImage) return;
            
            const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const viewType = document.getElementById('viewSelect').value;
            console.log('ç¾åœ¨ã®æ’®å½±è¦–ç‚¹:', viewType);
            
            // MediaPipeã®å§¿å‹¢ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’æç”»ï¼ˆã™ã¹ã¦ã®è¦–ç‚¹ã§è¡¨ç¤ºï¼‰
            if (results.poseLandmarks) {
                try {
                    // å®Œå…¨æ›¸ãç›´ã—ï¼šè¨ºæ–­æ™‚ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œMediaPipeæç”»
                    const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
                    console.log('ğŸ” è¨ºæ–­MediaPipeæç”»é–‹å§‹ - ãƒ¢ãƒã‚¤ãƒ«:', isMobile, 'è¦–ç‚¹:', viewType, 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…:', window.innerWidth);
                    console.log('ğŸ” è¨ºæ–­Canvasè©³ç´°:', {
                        width: canvas.width,
                        height: canvas.height,
                        clientWidth: canvas.clientWidth, 
                        clientHeight: canvas.clientHeight,
                        landmarks: results.poseLandmarks.length
                    });
                    
                    // canvasã®çŠ¶æ…‹ã‚’å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆiOSå¯¾å¿œï¼‰
                    // ã“ã“ã§ã¯è¿½åŠ ã®ã‚¹ã‚±ãƒ¼ãƒ«ã¯ã‹ã‘ãšã€ãƒ‡ãƒã‚¤ã‚¹ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã§ç›´æ¥æç”»ã™ã‚‹
                    resetTransformSafe(ctx);
                    
                    // å¸¸ã«æ‰‹å‹•ã§ä¸»è¦ãªãƒãƒ¼ã‚ºãƒ©ã‚¤ãƒ³æç”»ï¼ˆåº§æ¨™ç³»ã®ä¸ä¸€è‡´ã‚’å›é¿ï¼‰
                    {
                        console.log('ğŸ”„ MediaPipeå…¬å¼ãƒ¡ã‚½ãƒƒãƒ‰æœªåˆ©ç”¨ - æ‰‹å‹•æç”»é–‹å§‹');
                        
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šæ‰‹å‹•ã§ä¸»è¦ãªãƒãƒ¼ã‚ºãƒ©ã‚¤ãƒ³æç”»
                        const landmarks = results.poseLandmarks;
                        
                        // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®è¨­å®š
                        ctx.strokeStyle = '#00FF00';
                        ctx.lineWidth = 3;
                        ctx.lineCap = 'round';
                        ctx.lineJoin = 'round';
                        
                        // è‚©ã®ç·šï¼ˆ11-12ï¼‰
                        if (landmarks[11] && landmarks[12]) {
                            ctx.beginPath();
                            ctx.moveTo(landmarks[11].x * canvas.width, landmarks[11].y * canvas.height);
                            ctx.lineTo(landmarks[12].x * canvas.width, landmarks[12].y * canvas.height);
                            ctx.stroke();
                        }
                        
                        // è…°ã®ç·šï¼ˆ23-24ï¼‰
                        if (landmarks[23] && landmarks[24]) {
                            ctx.beginPath();
                            ctx.moveTo(landmarks[23].x * canvas.width, landmarks[23].y * canvas.height);
                            ctx.lineTo(landmarks[24].x * canvas.width, landmarks[24].y * canvas.height);
                            ctx.stroke();
                        }
                        
                        // ä½“ã®ä¸­å¿ƒç·šï¼ˆè‚©ã®ä¸­ç‚¹ã‹ã‚‰è…°ã®ä¸­ç‚¹ï¼‰
                        if (landmarks[11] && landmarks[12] && landmarks[23] && landmarks[24]) {
                            const shoulderCenterX = (landmarks[11].x + landmarks[12].x) / 2 * canvas.width;
                            const shoulderCenterY = (landmarks[11].y + landmarks[12].y) / 2 * canvas.height;
                            const hipCenterX = (landmarks[23].x + landmarks[24].x) / 2 * canvas.width;
                            const hipCenterY = (landmarks[23].y + landmarks[24].y) / 2 * canvas.height;
                            
                            ctx.beginPath();
                            ctx.moveTo(shoulderCenterX, shoulderCenterY);
                            ctx.lineTo(hipCenterX, hipCenterY);
                            ctx.stroke();
                        }
                        
                        // è¶³ã®ç·šï¼ˆ27-28, 31-32ï¼‰
                        if (landmarks[27] && landmarks[28]) {
                            ctx.beginPath();
                            ctx.moveTo(landmarks[27].x * canvas.width, landmarks[27].y * canvas.height);
                            ctx.lineTo(landmarks[28].x * canvas.width, landmarks[28].y * canvas.height);
                            ctx.stroke();
                        }
                        
                        // ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚‚æç”»ï¼ˆé ­éƒ¨ã‚’å«ã‚€ï¼‰
                        ctx.fillStyle = '#FF0000';
                        const radius = (window.innerWidth < 768) ? 2 : 4;

                        [0,1,2,3,4,5,7,8,9,10, 11,12,23,24,27,28].forEach(index => {
                            if (landmarks[index]) {
                                ctx.beginPath();
                                ctx.arc(
                                    landmarks[index].x * canvas.width,
                                    landmarks[index].y * canvas.height,
                                    radius,
                                    0,
                                    2 * Math.PI
                                );
                                ctx.fill();
                            }
                        });
                        
                        console.log('ğŸ”„ æ‰‹å‹•æç”»å®Œäº†');
                    }
                    
                    // ä»•ä¸Šã’ã®è¨­å®šï¼ˆæ—¢ã«æ‰‹å‹•æç”»æ¸ˆã¿ã®ãŸã‚ã“ã“ã§ã¯ä½•ã‚‚ã—ãªã„ï¼‰
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.globalAlpha = 1.0;
                    
                    // é‡è¦ãªéª¨æ ¼ç·šã‚’æ‰‹å‹•ã§æç”»ï¼ˆç¢ºå®Ÿã«è¡¨ç¤ºï¼‰
                    const keyConnections = [
                        // ä¸ŠåŠèº«ã®ä¸»è¦ç·š
                        [11, 12], // å·¦å³è‚©
                        [11, 13], [13, 15], // å·¦è…•
                        [12, 14], [14, 16], // å³è…•
                        [11, 23], [12, 24], // è‚©ã‹ã‚‰è…°
                        [23, 24], // è…°ã®æ¨ªç·š
                        // ä¸‹åŠèº«ã®ä¸»è¦ç·š
                        [23, 25], [25, 27], // å·¦è„š
                        [24, 26], [26, 28]  // å³è„š
                    ];
                    
                    const isAndroid2 = /Android/i.test(navigator.userAgent);
                    const visThreshold2 = ((isAndroid2 || isMobile || window.innerWidth < 768) && viewType === 'front') ? 0.2 : 0.5;
                    let linesDrawn = 0;
                    keyConnections.forEach(([startIdx, endIdx]) => {
                        const startPoint = results.poseLandmarks[startIdx];
                        const endPoint = results.poseLandmarks[endIdx];
                        
                        if (startPoint && endPoint &&
                            (startPoint.visibility === undefined || startPoint.visibility >= visThreshold2) &&
                            (endPoint.visibility === undefined || endPoint.visibility >= visThreshold2)) {
                            const startX = startPoint.x * canvas.width;
                            const startY = startPoint.y * canvas.height;
                            const endX = endPoint.x * canvas.width;
                            const endY = endPoint.y * canvas.height;
                            
                            ctx.beginPath();
                            ctx.moveTo(startX, startY);
                            ctx.lineTo(endX, endY);
                            ctx.stroke();
                            linesDrawn++;
                        }
                    });
                    
                    // é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’å·¨å¤§ã§ç›®ç«‹ã¤å††ã§æç”»
                    if (isMobile || window.innerWidth < 768) {
                        ctx.fillStyle = '#FF00FF'; // ãƒã‚¼ãƒ³ã‚¿è‰²ï¼ˆæœ€ã‚‚ç›®ç«‹ã¤ï¼‰
                        ctx.shadowColor = '#FFFF00'; // é»„è‰²ã„å½±
                        ctx.shadowBlur = 30;
                    } else {
                        ctx.fillStyle = '#FF0000';
                        ctx.shadowColor = 'transparent'; // PCç”¨ï¼šå½±ãªã—
                        ctx.shadowBlur = 0;
                    }
                    const keyPoints = [11, 12, 13, 14, 15, 16, 23, 24, 25, 26, 27, 28];
                    let pointsDrawn = 0;
                    
                    keyPoints.forEach(index => {
                        const point = results.poseLandmarks[index];
                        if (point && (point.visibility === undefined || point.visibility >= visThreshold2)) {
                            const x = point.x * canvas.width;
                            const y = point.y * canvas.height;
                            
                            ctx.beginPath();
                            const radius = (isMobile || window.innerWidth < 768) ? 1 : 4; // ã‚¹ãƒãƒ›1pxã€PC4px
                            ctx.arc(x, y, radius, 0, 2 * Math.PI);
                            ctx.fill();
                            pointsDrawn++;
                        }
                    });

                    // Android/ãƒ¢ãƒã‚¤ãƒ«æ­£é¢ã§ãƒ©ã‚¤ãƒ³ãŒç„¡ã‘ã‚Œã°å¯è¦–æ€§ç„¡è¦–ã§å¼·åˆ¶æç”»
                    if (linesDrawn === 0 && viewType === 'front' && (isAndroid2 || isMobile || window.innerWidth < 768)) {
                        console.log('ğŸ“± æ­£é¢ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯(è¨ºæ–­): å¯è¦–æ€§ã‚’ç„¡è¦–ã—ã¦ä¸»è¦ãƒ©ã‚¤ãƒ³ã‚’å¼·åˆ¶æç”»');
                        ctx.save();
                        ctx.strokeStyle = '#00FFFF';
                        ctx.lineWidth = 3;
                        keyConnections.forEach(([a,b]) => {
                            const A = results.poseLandmarks[a];
                            const B = results.poseLandmarks[b];
                            if (A && B) {
                                ctx.beginPath();
                                ctx.moveTo(A.x * canvas.width, A.y * canvas.height);
                                ctx.lineTo(B.x * canvas.width, B.y * canvas.height);
                                ctx.stroke();
                                linesDrawn++;
                            }
                        });
                        ctx.restore();
                    }
                    // é ­éƒ¨ã®ç‚¹ã¨ãƒ©ã‚¤ãƒ³ã‚’æœ€å¾Œã«å¿…ãšä¸Šæãï¼ˆæ¶ˆå¤±é˜²æ­¢ï¼‰
                    try {
                        const lm = results.poseLandmarks;
                        ctx.save();
                        ctx.strokeStyle = '#00FF00';
                        ctx.fillStyle = '#FF0000';
                        ctx.lineWidth = 2;
                        // é¼»
                        if (lm[0]) { ctx.beginPath(); ctx.arc(lm[0].x*canvas.width, lm[0].y*canvas.height, (window.innerWidth < 768) ? 1 : 4, 0, 2*Math.PI); ctx.fill(); }
                        // ç›®-ç›®ãƒ©ã‚¤ãƒ³
                        if (lm[2] && lm[5]) { ctx.beginPath(); ctx.moveTo(lm[2].x*canvas.width, lm[2].y*canvas.height); ctx.lineTo(lm[5].x*canvas.width, lm[5].y*canvas.height); ctx.stroke(); }
                        // è€³-è€³ãƒ©ã‚¤ãƒ³
                        if (lm[7] && lm[8]) { ctx.beginPath(); ctx.moveTo(lm[7].x*canvas.width, lm[7].y*canvas.height); ctx.lineTo(lm[8].x*canvas.width, lm[8].y*canvas.height); ctx.stroke(); }
                        // è‚©ä¸­ç‚¹â†’é¼»
                        if (lm[11] && lm[12] && lm[0]) {
                            const cx = (lm[11].x + lm[12].x)/2 * canvas.width;
                            const cy = (lm[11].y + lm[12].y)/2 * canvas.height;
                            ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(lm[0].x*canvas.width, lm[0].y*canvas.height); ctx.stroke();
                        }
                        ctx.restore();
                    } catch(e) { console.warn('head overlay fail', e); }
                    
                    ctx.restore(); // è¨­å®šã‚’å¾©å…ƒ
                    
                    console.log('âœ… è¨ºæ–­MediaPipeæç”»å®Œäº† - è¦–ç‚¹:', viewType, 'æç”»ç·šæ•°:', linesDrawn, 'æç”»ç‚¹æ•°:', pointsDrawn, 'ãƒ¢ãƒã‚¤ãƒ«:', isMobile);
                    
                    // ãƒ¢ãƒã‚¤ãƒ«/Androidã§ç·šãŒè¦‹ãˆãªã„å ´åˆã®ç·Šæ€¥æªç½®
                    if ((isMobile || isAndroid2) && linesDrawn === 0) {
                        console.log('âš ï¸ è¨ºæ–­ç·Šæ€¥æªç½®: å¼·åˆ¶ç·šæç”»å®Ÿè¡Œ');
                        ctx.strokeStyle = '#FF0000'; // èµ¤è‰²ã§å¼·åˆ¶æç”»
                        ctx.lineWidth = 4;
                        ctx.beginPath();
                        ctx.moveTo(100, 100);
                        ctx.lineTo(200, 200);
                        ctx.moveTo(200, 100);
                        ctx.lineTo(100, 200);
                        ctx.stroke();
                        console.log('ğŸ”´ è¨ºæ–­ç·Šæ€¥èµ¤ç·šæç”»å®Œäº†');
                    }
                } catch (error) {
                    console.error('æç”»ã‚¨ãƒ©ãƒ¼:', error);
                }
            } else {
                console.log('MediaPipeç·šæç”»ã‚¹ã‚­ãƒƒãƒ— - ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ãªã—');
            }
            
            // ãƒœãƒ¼ãƒ«ä½ç½®ã®èµ¤ã„ä¸¸ã‚’å†æç”»ï¼ˆæ­£é¢æ’®å½±æ™‚ã®ã¿ãƒ»ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œã‚µã‚¤ã‚ºï¼‰
            if (ballPosition && viewType === 'front') {
                const isMobileBallDiag = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
                const ballRadiusDiag = isMobileBallDiag ? 8 : 10; // ã‚¹ãƒãƒ›8pxã€PC10pxï¼ˆå°‘ã—å¤§ããï¼‰

                // æ­£è¦åŒ– -> ãƒ‡ãƒã‚¤ã‚¹ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã§å†æç”»
                ctx.fillStyle = 'red';
                ctx.beginPath();
                const drawX = ballPosition.x * canvas.width;
                const drawY = ballPosition.y * canvas.height;
                ctx.arc(drawX, drawY, ballRadiusDiag, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        // ç›´è¿‘ã®æ¨å®šçµæœã‹ã‚‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å†æç”»ï¼ˆãƒªã‚µã‚¤ã‚ºå¾Œ/è¨ºæ–­å¾Œã«ä½¿ç”¨ï¼‰
        function redrawOverlay(){
            const canvas = document.getElementById('poseCanvas');
            if (!canvas || !currentResults || !currentResults.poseLandmarks) return;
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            ctx.clearRect(0,0,canvas.width,canvas.height);
            const lm = currentResults.poseLandmarks;
                        ctx.strokeStyle = '#00FF00';
            ctx.lineWidth = (window.innerWidth < 768) ? 1 : 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            const line=(a,b)=>{ if(lm[a]&&lm[b]){ ctx.beginPath(); ctx.moveTo(lm[a].x*canvas.width, lm[a].y*canvas.height); ctx.lineTo(lm[b].x*canvas.width, lm[b].y*canvas.height); ctx.stroke(); }}
            [[11,12],[11,13],[13,15],[12,14],[14,16],[11,23],[12,24],[23,24],[23,25],[25,27],[24,26],[26,28]].forEach(p=>line(p[0],p[1]));
            if(lm[11]&&lm[12]&&lm[23]&&lm[24]){
                const sx=(lm[11].x+lm[12].x)/2*canvas.width, sy=(lm[11].y+lm[12].y)/2*canvas.height;
                const hx=(lm[23].x+lm[24].x)/2*canvas.width, hy=(lm[23].y+lm[24].y)/2*canvas.height;
                ctx.beginPath(); ctx.moveTo(sx,sy); ctx.lineTo(hx,hy); ctx.stroke();
                if(lm[0]){ ctx.beginPath(); ctx.moveTo(sx,sy); ctx.lineTo(lm[0].x*canvas.width, lm[0].y*canvas.height); ctx.stroke(); }
            }
                        ctx.fillStyle = '#FF0000';
            const dot=(i)=>{ if(lm[i]){ ctx.beginPath(); ctx.arc(lm[i].x*canvas.width, lm[i].y*canvas.height, (window.innerWidth<768)?1:4, 0, 2*Math.PI); ctx.fill(); }}
            [0,1,2,3,4,5,7,8,9,10,11,12,13,14,15,16,23,24,25,26,27,28].forEach(dot);
            const viewType = document.getElementById('viewSelect').value;
            if(ballPosition && viewType==='front'){
                ctx.fillStyle='red';
                const r=(window.innerWidth<768)?8:10;
                ctx.beginPath(); ctx.arc(ballPosition.x*canvas.width, ballPosition.y*canvas.height, r, 0, 2*Math.PI); ctx.fill();
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ç”¨ã®ç°¡æ˜“è¨ºæ–­
        function performFallbackAnalysis() {
            console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ºæ–­å®Ÿè¡Œ');

            const viewType = document.getElementById('viewSelect').value;
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

            // åŸºæœ¬çš„ãªã‚¹ã‚³ã‚¢ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
            const fallbackScores = {
                ballPosition: 70,
                stance: 75,
                posture: 70,
                armPosition: 65,
                weightDistribution: 70,
                headPosition: 75
            };

            // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const fallbackComments = {
                ballPosition: 'MediaPipeæœªå¯¾å¿œï¼šæ‰‹å‹•ã§ãƒœãƒ¼ãƒ«ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„',
                stance: 'MediaPipeæœªå¯¾å¿œï¼šè¶³å¹…ã‚’è‚©å¹…ç¨‹åº¦ã«ä¿ã¡ã¾ã—ã‚‡ã†',
                posture: 'MediaPipeæœªå¯¾å¿œï¼šèƒŒç­‹ã‚’ä¼¸ã°ã—å‰å‚¾ã‚’æ„è­˜ã—ã¦ãã ã•ã„',
                armPosition: isMobile ? 'ãƒ¢ãƒã‚¤ãƒ«è¨ºæ–­ï¼šè…•ã¯è‡ªç„¶ã«å‚ã‚‰ã—ã¾ã—ã‚‡ã†' : 'è…•ã®ä½ç½®ã‚’ç¢ºèªã—ã¦ãã ã•ã„',
                weightDistribution: 'MediaPipeæœªå¯¾å¿œï¼šä½“é‡ã‚’å‡ç­‰ã«åˆ†æ•£ã•ã›ã¾ã—ã‚‡ã†',
                headPosition: 'MediaPipeæœªå¯¾å¿œï¼šé ­ã¯å‹•ã‹ã•ãšæ­£é¢ã‚’å‘ãã¾ã—ã‚‡ã†'
            };

            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®ç·åˆã‚¹ã‚³ã‚¢è¡¨ç¤º
            const averageScore = Math.round(Object.values(fallbackScores).reduce((a, b) => a + b, 0) / Object.keys(fallbackScores).length);

            document.getElementById('overallScore').textContent = `ç·åˆã‚¹ã‚³ã‚¢: ${averageScore}ç‚¹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼‰`;

            // è©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
            const detailsDiv = document.getElementById('analysisDetails');
            if (detailsDiv) {
                detailsDiv.innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 5px;">
                        <h4>ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰</h4>
                        <p>MediaPipeãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚æ‰‹å‹•ã§ã®èª¿æ•´ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                    </div>
                    ${Object.entries(fallbackComments).map(([key, comment]) =>
                        `<div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 3px;">
                            <strong>${getJapaneseLabel(key)}:</strong> ${comment}
                        </div>`
                    ).join('')}
                `;
            }

            return fallbackScores;
        }

        // æ—¥æœ¬èªãƒ©ãƒ™ãƒ«å–å¾—
        function getJapaneseLabel(key) {
            const labels = {
                ballPosition: 'ãƒœãƒ¼ãƒ«ä½ç½®',
                stance: 'ã‚¹ã‚¿ãƒ³ã‚¹',
                posture: 'å§¿å‹¢',
                armPosition: 'è…•ã®ä½ç½®',
                weightDistribution: 'ä½“é‡é…åˆ†',
                headPosition: 'é ­ã®ä½ç½®'
            };
            return labels[key] || key;
        }

        // åˆæœŸåŒ–ï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œå¼·åŒ–ç‰ˆï¼‰
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - åˆæœŸåŒ–é–‹å§‹');

            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
            console.log('ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±:', { isMobile, userAgent: navigator.userAgent, windowWidth: window.innerWidth });

            // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
            if (isMobile) {
                const statusDiv = document.querySelector('.status-info');
                if (statusDiv) {
                    statusDiv.innerHTML += `
                        <div style="background: #e3f2fd; border: 1px solid #2196f3; padding: 8px; margin: 5px 0; border-radius: 4px; font-size: 12px;">
                            ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚MediaPipeåˆæœŸåŒ–ä¸­...
                        </div>
                    `;
                }
            }

            // MediaPipeåˆæœŸåŒ–ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãï¼‰
            try {
                const initTimeout = new Promise((_, reject) =>
                    setTimeout(() => reject(new Error('åˆæœŸåŒ–ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ')), isMobile ? 15000 : 10000)
                );

                const initResult = await Promise.race([initMediaPipe(), initTimeout]);

                if (initResult) {
                    console.log('âœ… MediaPipeåˆæœŸåŒ–æˆåŠŸ');
                    if (isMobile) {
                        const statusDiv = document.querySelector('.status-info');
                        if (statusDiv) {
                            statusDiv.innerHTML += `
                                <div style="background: #e8f5e8; border: 1px solid #4caf50; padding: 8px; margin: 5px 0; border-radius: 4px; font-size: 12px;">
                                    âœ… MediaPipeåˆæœŸåŒ–å®Œäº†ï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼‰
                                </div>
                            `;
                        }
                    }
                } else {
                    throw new Error('MediaPipeåˆæœŸåŒ–å¤±æ•—');
                }

            } catch (error) {
                console.warn('MediaPipeåˆæœŸåŒ–å¤±æ•— - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œ:', error.message);
                mediaPipeReady = false;

                // ãƒ¢ãƒã‚¤ãƒ«ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é€šçŸ¥
                const statusDiv = document.querySelector('.status-info');
                if (statusDiv) {
                    statusDiv.innerHTML += `
                        <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 8px; margin: 5px 0; border-radius: 4px; font-size: 12px;">
                            âš ï¸ MediaPipeæœªå¯¾å¿œ - æ‰‹å‹•èª¿æ•´ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™
                        </div>
                    `;
                }
            }

            console.log('âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™å®Œäº† - MediaPipeçŠ¶æ…‹:', mediaPipeReady);
        });

        // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆä½œæˆ
        function createRadarChart(results) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const viewType = document.getElementById('viewSelect').value;
            
            // è¦–ç‚¹ã«å¿œã˜ãŸãƒ©ãƒ™ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ã‚’å‹•çš„ã«è¨­å®š
            let labels = [];
            let data = [];
            
            if (viewType === 'front') {
                labels = ['ãƒœãƒ¼ãƒ«ä½ç½®', 'ã‚¹ã‚¿ãƒ³ã‚¹å¹…', 'é ­ã®ä½ç½®', 'æ‰‹ã®ä½ç½®', 'ä½“é‡é…åˆ†'];
                data = [results.ballPosition, results.stance, results.headPosition, results.handPosition, results.weight];
            } else { // rear
                labels = ['å‰å‚¾è§’åº¦', 'æ‰‹ã¨ä½“ã®è·é›¢', 'å‰å¾Œãƒãƒ©ãƒ³ã‚¹', 'ä½“ã®å‘ã', 'èƒŒä¸­ã®æ›²ãŒã‚Šå…·åˆ'];
                data = [results.forwardLean, results.handBodyDistance, results.frontBackBalance, results.bodyDirection, results.backCurvature];
            }
            
            if (window.radarChartInstance) {
                window.radarChartInstance.destroy();
            }
            
            window.radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ç¾åœ¨ã®ã‚¹ã‚³ã‚¢',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)'
                    }, {
                        label: 'ç†æƒ³ã‚¹ã‚³ã‚¢',
                        data: new Array(labels.length).fill(95),
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(76, 175, 80, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 16
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: {
                                    size: 14
                                }
                            },
                            pointLabels: {
                                font: {
                                    size: 16
                                }
                            }
                        }
                    }
                }
            });
        }

        // ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚·ã‚§ã‚¢æ©Ÿèƒ½
        function shareToTwitter() {
            const text = encodeURIComponent('ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ«ã§è¨ºæ–­ã—ã¾ã—ãŸï¼ #ã‚´ãƒ«ãƒ• #ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­');
            window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
        }

        function shareToFacebook() {
            try {
                const url = window.location.href;
                const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                const popup = window.open(shareUrl, 'facebook-share', 'width=600,height=400,scrollbars=yes,resizable=yes');
                
                if (!popup) {
                    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã®ä»£æ›¿æ¡ˆ
                    navigator.clipboard.writeText(url).then(() => {
                        alert('ğŸ”— URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nFacebookã§æ‰‹å‹•ã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚');
                    }).catch(() => {
                        alert('Facebookã‚·ã‚§ã‚¢ãƒšãƒ¼ã‚¸ã‚’é–‹ãã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\nä»¥ä¸‹ã®URLã‚’æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦Facebookã§å…±æœ‰ã—ã¦ãã ã•ã„:\n\n' + url);
                    });
                }
            } catch (error) {
                console.error('Facebookå…±æœ‰ã‚¨ãƒ©ãƒ¼:', error);
                alert('Facebookå…±æœ‰ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }

        function shareToInstagram() {
            try {
                // è¨ºæ–­çµæœã®æƒ…å ±ã‚’å–å¾—
                const totalScore = document.querySelector('#totalScore')?.textContent || 'çµæœæœªå–å¾—';
                const message = `ğŸŒï¸â€â™‚ï¸ ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­çµæœ: ${totalScore}\n\né‡å±±ä½³æ²»ãƒ—ãƒ­ç›£ä¿®ã®AIè¨ºæ–­ã§å§¿å‹¢ã‚’ãƒã‚§ãƒƒã‚¯ï¼\n\n#ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ #é‡å±±ä½³æ²»ãƒ—ãƒ­ç›£ä¿® #ã‚´ãƒ«ãƒ•ä¸Šé” #ã‚¢ãƒ‰ãƒ¬ã‚¹æ”¹å–„`;
                
                // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
                navigator.clipboard.writeText(message).then(() => {
                    alert('ğŸ“· Instagramã§ã®å…±æœ‰æ–¹æ³•:\n\n1. è¨ºæ–­çµæœã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±\n2. ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ\n3. Instagramã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ï¼\n\n#ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ #é‡å±±ä½³æ²»ãƒ—ãƒ­ç›£ä¿®');
                }).catch(() => {
                    alert('ğŸ“· Instagramã§ã®å…±æœ‰æ–¹æ³•:\n\n1. è¨ºæ–­çµæœã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±\n2. ä»¥ä¸‹ã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ä½¿ç”¨ã—ã¦Instagramã§æŠ•ç¨¿ã—ã¦ãã ã•ã„:\n\n#ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ #é‡å±±ä½³æ²»ãƒ—ãƒ­ç›£ä¿® #ã‚´ãƒ«ãƒ•ä¸Šé”');
                });
            } catch (error) {
                console.error('Instagramå…±æœ‰ã‚¨ãƒ©ãƒ¼:', error);
                alert('ğŸ“· è¨ºæ–­çµæœã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã£ã¦ã€Instagramã§å…±æœ‰ã—ã¦ãã ã•ã„ï¼\n\n#ã‚´ãƒ«ãƒ•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨ºæ–­ #é‡å±±ä½³æ²»ãƒ—ãƒ­ç›£ä¿®');
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - åˆæœŸåŒ–é–‹å§‹');
            
            // MediaPipeåˆæœŸåŒ–
            const mediaPipeReady = initMediaPipe();
            if (!mediaPipeReady) {
                console.warn('MediaPipeåˆæœŸåŒ–å¤±æ•— - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œ');
            }
            
            console.log('âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†');
        });
    </script>
</body>
</html>
